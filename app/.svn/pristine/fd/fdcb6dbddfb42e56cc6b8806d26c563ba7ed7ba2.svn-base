<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>工资信息</title>
    <link href="../css/PublicStyle.css" rel="stylesheet" />
    <link href="../css/wkd_main_wap.css" rel="stylesheet" />
</head>

<body>


    <div class="rs_mainBox pb0">
        <div class="rsBoxMsg p0">
            <div class="rs_jqInfo">
                <div class="rs_jqTitle">
                    <span onclick="moveMonth(-1)" tapmode></span>
                    <h1 class="zhong" id="dateChk" tapmode onclick="chagFrr(this);"></h1>
                    <span class="right" onclick="moveMonth(1)" tapmode></span>
                </div>
            </div>
        </div>
    </div>

    <section id="list">

    </section>

    <script type="text/template" id="template">
        <div class="rs_mainBox pt0">
            <div class="rsBoxMsg p0">
                <div class="rs_jqInfo">
                    <div class="rs_jbspBox p20">
                        <div class="rs_spList">
                            <span>部门</span><b>{{=it.data.DEPARTMENT}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>职号</span><b>{{=it.data.EMPID}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>姓名</span><b>{{=it.data.CHINESENAME}}</b>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="rs_mainBox pt0">
            <div class="rsBoxMsg p0">
                <div class="rs_jqInfo">
                    <div class="rs_jqTitle" style="padding-left:0">
                        <h1 class="zhong" style="width:100%">收入</h1>
                    </div>
                    <div class="rs_jbspBox p20 open">
                        <div class="rs_spList">
                            <span>基本工资</span><b>{{=it.data.BASE_PAY}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>职责津贴</span><b>{{=it.data.DUTIES_ALLOWANCE}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>岗位补助</span><b>{{=it.data.POST_SUBSIDIES}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>技术补助</span><b>{{=it.data.TECHNIQUE_ALLOWANCE}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>业绩工资3</span><b>{{=it.data.PERFORMANCE_PAY3}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>夜班补助</span><b>{{=it.data.NIGHT_DUTY_SUBSIDY}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>淡季奖</span><b>{{=it.data.OFF_SEA_BOUNS}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>住房补助</span><b>{{=it.data.RESIDENTIAL_GRANTS}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>地区补助</span><b>{{=it.data.REGIONAL_GRANTS}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>特殊补助</span><b>{{=it.data.SPECIAL_GRANTS}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>午餐补助</span><b>{{=it.data.DINNER_ALLOWANCE_DICI}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>手机话费</span><b>{{=it.data.MOBILE_PHONE_FEE}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>燃油费</span><b>{{=it.data.FUEL_SURCHARGE_FEE}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>高温补助</span><b>{{=it.data.PAYMENT_HT_ALLOWANCE}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>独生子女</span><b>{{=it.data.ONLY_CHILD}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>支给错误</span><b>{{=it.data.STICKS_TO_THE_WRONG}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>其他支给</span><b>{{=it.data.TO_THE_OTHER}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>未勤扣除</span><b>{{=it.data.NOT_ATTENDANCE_MINUS}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>迟早私扣除</span><b>{{=it.data.LATE_MINUS+ it.data.LEAVE_EARLY_MINUS}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>休假减除</span><b>{{=it.data.HOLIDAY_MINUS_LONG + it.data.MATERNITY_MINUS}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>事病减除</span><b>{{=it.data.LEAVE_MINUS+it.data.SICK_MINUS}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>旷工减除</span><b>{{=it.data.ABSENTEEISM_MINUS}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>休职减除</span><b>{{=it.data.LEVEL_OFF_MINUS}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>其他减除</span><b>{{=it.data.OTHER_LESS}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>放假减除</span><b>{{=it.data.HOLIDAY_MINUS_SHORT+ it.data.HOLIDAY_MINUS_LONG}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>试用扣除</span><b>{{=it.data.PROBATION_DEDUCTION}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>支给合计</span><b>{{=it.data.THIS_TOTAL_SUPPORT}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>其他计税</span><b>{{=it.data.GIFT_COST}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>免税支给</span><b>{{=it.data.TAX_FREE_SUPPORT}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>税后减除</span><b>{{=it.data.TAX_AFTER_MINUS}}</b>
                        </div>
                    </div>
                    <div class="wkd_open" tapmode onclick="toggleList(this);"><a href="javascript:void(0)">点击展开</a></div>
                </div>
            </div>
        </div>
        <div class="rs_mainBox pt0">
            <div class="rsBoxMsg p0">
                <div class="rs_jqInfo">
                    <div class="rs_jqTitle" style="padding-left:0">
                        <h1 class="zhong" style="width:100%">支出</h1>
                    </div>
                    <div class="rs_jbspBox p20">
                        <div class="rs_spList">
                            <span>养老保险</span><b>{{=it.data.PERSONAL_PENSION}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>医疗保险</span><b>{{=it.data.PERSONAL_MEDICAL}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>待业保险</span><b>{{=it.data.PERSONAL_UNEMPLOYED}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>住房公积金</span><b>{{=it.data.PERSONAL_HOUSING_FUND}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>所得税</span><b>{{=it.data.THIS_ACTUAL_TAX}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>个人负担</span><b>{{=it.data.PAYMENT_OF_INDIVIDUAL}}</b>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="rs_mainBox pt0">
            <div class="rsBoxMsg p0">
                <div class="rs_jqInfo">
                    <div class="rs_jqTitle" style="padding-left:0">
                        <h1 class="zhong" style="width:100%">实领</h1>
                    </div>
                    <div class="rs_jbspBox p20">
                        <div class="rs_spList">
                            <span>减除合计</span><b>{{=it.data.TOTAL_DEDUCTIONS}}</b>
                        </div>
                        <div class="rs_spList">
                            <span>实领工资</span><b class="red">{{=it.data.THIS_ACTUAL_WAGE}}</b>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </script>

</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/jquery-3.1.1.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/remotedb.js"></script>
<script type="text/javascript" src="../script/doT.min.js"></script>


<script type="text/javascript">
    var curDate = new Date().format("yyyyMM");
    var monthJson = [{
        text: new Date().format("yyyy-MM"),
        date: new Date().format("yyyyMM")
    }];
    apiready = function() {
        loginState();
        pageInit();
        getJBList(curDate);
        //getJBList();
    }

    function chagFrr(obj) {
        var _this = $(obj);

        actMenu("请选择月份", monthJson, function(ret, err) {
            if (ret && ret.items && ret.items.length > 0) {
                curDate = ret.items[0].date;
                $("#dateChk").text(ret.items[0].text);
                getJBList(curDate);
            }
        });
    }

    function moveMonth(month) {
        var curMonth = new Date($("#dateChk").text());
        curMonth.setMonth(curMonth.getMonth() + month);
        if (curMonth > new Date()) {
            toast("日期不能大于当前月份");
            return;
        }
        $("#dateChk").text(curMonth.format("yyyy-MM"));
        curDate = curMonth.format("yyyyMM");
        getJBList(curDate);
    }

    function pageInit() {
        $("#list").html("");
        $("#dateChk").text(new Date().format("yyyy-MM"));
        //下拉
        api.setCustomRefreshHeaderInfo({
            bgColor: '#f0f0f0'
        }, function() {
            $("#list").html("");
            getJBList(curDate);
        });

        //手动下拉
        api.addEventListener({
            name: 'headerLoading'
        }, function(ret, err) {
            api.refreshHeaderLoading();
        });

        initMonth();
    }

    function initMonth() {
        var cur = new Date();
        cur.setDate(1);
        for (var i = 0; i < 120; i++) {
            var arr = {};
            cur.setMonth(cur.getMonth() - 1);
            arr.text = cur.format("yyyy-MM");
            arr.date = cur.format("yyyyMM");
            monthJson.push(arr);
        }
    }

    function getJBList(date) {
        fnPost('pa/' + date, {
            body: JSON.stringify({
                month: date
            })
        }, true, function(ret, err) {
            api.refreshHeaderLoadDone();
            if (ret && ret.resultCode == 200) {
                if (ret.data) {
                    jbList(ret);
                } else {
                    toast('目前月份暂无工资信息');
                    $("#list").html("<div style='text-align:center;margin-top:30px'>目前月份暂无工资信息</div>");
                }
            } else {
                toast('网络不佳，请重试');
            }
        });
    }

    function jbList(data_) {
        var list = $api.byId('list');
        var tempFn = doT.template($api.byId('template').innerHTML);
        var resultHTML = tempFn(data_);
        $api.html(list, resultHTML)
        api.parseTapmode();
    }

    function toggleList(obj) {
        var _this = $(obj);
        if (_this.prev().hasClass("open")) {
            _this.prev().removeClass("open");
            _this.find("a").html("点击收回");
        } else {
            _this.prev().addClass("open");
            _this.find("a").html("点击展开");
        }
    }
</script>

</html>
