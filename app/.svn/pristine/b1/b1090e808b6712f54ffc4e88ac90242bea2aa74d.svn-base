<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>人事管理</title>
    <link href="../css/PublicStyle.css" rel="stylesheet" />
    <link href="../css/wkd_main_wap.css" rel="stylesheet" />
</head>

<body>
    <div class="rs_search" style="display:none">
        <span id="srBtn"></span><input type="search" placeholder="请输入姓名" id="keyWord" />
    </div>
    <section id="list">

    </section>
    <script type="text/template" id="template">
        {{ for(var i = 0; i
        < it.data.list.length;i++) { }} <div class="rs_mainBox {{=i > 0? 'pt0': ''}}">
            <div class="rsBoxMsg p0">
                <div class="rs_jbBox">
                    <div class="rs_jbTitel" AFFIRMNO="{{=it.data.list[i].AFFIRM_NO}}">
                        <h1>{{=it.data.list[i].CHINESENAME}}</h1>
                        <span>是否外借：{{=it.data.list[i].ISLEND}}</span>
                    </div>
                    <div class="rs_jbMsg">
                        <div class="rs_jsMsgL open-win" win="s_gongzhang_Details" login="true" param='{"DOCUMENTNO":"{{=it.data.list[i].DOCUMENTNO}}"}'>
                            <h1><span class="zm">{{=it.data.list[i].CODE_NAME}}</span></h1>
                            <h2>
                              <p>部门：{{=it.data.list[i].APPLYDEPTNAME}}</p>
				                  		<p>接收单位：{{=it.data.list[i].DEPTNAME}}</p>
                            </h2>
                            <p>{{=it.data.list[i].USEINFORMATION}}</p>
                        </div>

                        <div class="rs_jbMsgR">
                            {{? it.data.list[i].ACTIVE == 1}}
                            <div class="rs_cjwcz"></div>
                            {{?? it.data.list[i].ACTIVE == 2}}
                            <div class="rs_cjyfj"></div>
                            {{?? it.data.list[i].ACTIVE == 0}}
                            <div class="rs_cjspz"></div>
                            {{?}}
                        </div>
                    </div>
                </div>
            </div>
            </div>
            {{ } }}
    </script>
    <div class="rs_mainBox pt0 bottomLoading" id="loading"></div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/jquery-3.1.1.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/remotedb.js"></script>
<script type="text/javascript" src="../script/doT.min.js"></script>
<script type="text/javascript">
    var pageindex = 0;
    apiready = function() {
        loginState();
        pageInit();
        getJBList();
        domOprate();
    }

    function pageInit() {
        $("#list,#loading").html("");
        pageindex = 0;
        //上拉
        upPull();

        //下拉
        api.setCustomRefreshHeaderInfo({
            bgColor: '#f0f0f0'
        }, function() {
            $("#list,#loading").html("");
            $(".rs_cjBtn").addClass("none")
            pageindex = 0;
            upPull();
            getJBList();
        });

        //手动下拉
        api.addEventListener({
            name: 'headerLoading'
        }, function(ret, err) {
            api.refreshHeaderLoading();
        });

    }

    function upPull() {
        //上拉加载
        api.addEventListener({
            name: 'scrolltobottom',
            extra: {
                threshold: 10 // 距离底部还有多少触发scrolltobottom事件
            }
        }, function(ret, err) {
            pageindex += 1;
            getJBList();
        });
    }

    function domOprate() {
        $("#srBtn").click(function() {
            pageInit();
            getJBList();
        });

        $("#keyWord").on('keypress', function(e) {
            var keycode = e.which || e.keyCode
            if (keycode === 13) {
                e.preventDefault()
                pageInit();
                getJBList();
            }
        });
    }


    function getJBList() {
        fnPost('applyInfo', {
            body: JSON.stringify({
                content: "sealApplyInfo",
                currentPage: pageindex,
                key: $api.byId('keyWord').value
            })
        }, true, function(ret, err) {
            if (ret && ret.resultCode == 200) {
                pageindex == 0 ? api.refreshHeaderLoadDone() : "";
                if (ret.data && ret.data.list && ret.data.list.length > 0) {
                    jbList(ret, pageindex);
                } else {
                    $api.html($api.byId('loading'), "没有数据啦");
                    api.removeEventListener({
                        name: 'scrolltobottom'
                    });
                }
            } else {
                api.toast({
                    msg: '网络不佳，请重试',
                    duration: 2000,
                    location: 'bottom'
                });
            }
        });
    }

    function jbList(data_, index_) {
        var list = $api.byId('list');
        var tempFn = doT.template($api.byId('template').innerHTML);
        var resultHTML = tempFn(data_);
        index_ == 0 ? $api.html(list, resultHTML) : $api.append(list, resultHTML);
        api.parseTapmode();
        fnReadyOpenWin();
    }

    //手动刷新
    function fnRefreshHeaderLoading() {
        api.refreshHeaderLoading();
    };
</script>

</html>
