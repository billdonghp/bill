<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>人事管理</title>
    <link href="../css/PublicStyle.css" rel="stylesheet" />
    <link href="../css/wkd_main_wap.css" rel="stylesheet" />
</head>

<body>

    <div class="rs_loginBgBox">
        <img src="../image/logo.png">
    </div>
    <div class="rs_loginMsg">
        <div class="rs_inpItem">
            <input type="text" placeholder="请输入职号" id="username">
        </div>
        <div class="rs_inpItem">
            <input type="password" placeholder="请输入密码" id="passwd">
        </div>
        <div class="rs_inpItem margintop15">
            <button tapmode onclick="fnLogin();">登 录</button>
        </div>
        <div class="rs_inpItem">
            <span class="act"></span><a href="javascript:void(0)">记住账号</a>
            <a href="javascript:void(0)" class="forget">忘记密码？</a>
        </div>
    </div>
    <div class="rs_loginfoot">

    </div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/remotedb.js"></script>
<script type="text/javascript" src="../script/jquery-3.1.1.js"></script>
<script type="text/javascript" src="../script/core-min.js"></script>
<script type="text/javascript" src="../script/enc-base64-min.js"></script>
<script type="text/javascript">
    apiready = function() {
        dousPost();
        //locatapp();
    };

    function dousPost() {
        api.addEventListener({
            name: 'appintent'
        }, function(ret, err) {
            var appParam = ret.appParam;
            if (appParam) {
                var username = CryptoJS.enc.Base64.parse(appParam.username).toString(CryptoJS.enc.Utf8);
                var password = CryptoJS.enc.Base64.parse(appParam.password).toString(CryptoJS.enc.Utf8);
                postLogin(username, password);
            }
        });
    }


    function fnLogin() {
        if ($.trim($("#username").val()) == "") {
            toast('请输入职号');
            return;
        }
        if ($.trim($("#passwd").val()) == "") {
            toast('请输入密码');
            return;
        }
        postLogin($api.byId('username').value, $api.byId('passwd').value);
    }


    function postLogin(username, pwd) {
        fnPost('login', {
            body: JSON.stringify({
                username: username,
                password: pwd,
                test: "test"
            })
        }, false, function(ret, err) {
            if (ret && ret.resultCode == 200) {
                api.setPrefs({
                    key: 'tokenKey',
                    value: ret.authorization
                });
                $api.rmStorage('currUser');
                $api.setStorage('username', username);
                api.sendEvent({
                    name: 'headerLoading'
                });

                api.closeWin();
            } else {
                toast('用户名或密码错误');
            }
        });
    }
</script>

</html>
