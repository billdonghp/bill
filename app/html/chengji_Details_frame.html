<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>评价成绩审批</title>
    <link href="../css/PublicStyle.css" rel="stylesheet" />
    <link href="../css/wkd_main_wap.css" rel="stylesheet" />
</head>

<body>
    <section id="list">

    </section>
    <script type="text/template" id="template">
        <div class="rs_mainBox">
            <div class="rsBoxMsg pt5">
                <div class="rs_jbspBox" id="rs_jbspBox" AFFIRMNO="{{=it.data.list[0].AFFIRM_NO}}">
                    <div class="rs_spList">
                        <span>姓名</span><b>{{=it.data.list[0].CHINESENAME}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>工种</span><b>{{=it.data.list[0].CRAFT}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>岗位</span><b>{{=it.data.list[0].LINE}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>工序</span><b>{{=it.data.list[0].JOBCONTENT}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>认证时间</span><b>{{=it.data.list[0].EV_PERIOD_ID}}.{{=it.data.list[0].PROVEDATE}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>熟练度</span><b>{{=it.data.list[0].PROFICIENCY}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>标准动作</span><b>{{=it.data.list[0].STANDARDACTION}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>作业标准遵守</span><b>{{=it.data.list[0].OPERATIONCOM}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>作业品质</span><b>{{=it.data.list[0].QUALITYOFWORK}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>单项得分</span><b>{{=it.data.list[0].COMPOSITE}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>工序技能等级</span><b>{{=it.data.list[0].SKILLLEVEL}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>工作难度系数</span><b></b>
                    </div>
                    <div class="rs_spList">
                        <span>工序得分</span><b>{{=it.data.list[0].SKILLSCORE}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>累计积分</span><b>{{=it.data.list[0].SUMSCORE}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>问题点</span><b>{{=it.data.list[0].REMARK}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>认证人</span><b>{{=it.data.list[0].PROVEBY}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>是否复审</span><b>{{=it.data.list[0].CONFIRMDATE}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>是否一线通</span><b>{{=it.data.list[0].SHEOPERCYQ}}</b>
                    </div>
                    <div class="rs_spList">
                        <span>是否保留积分</span><b>{{=it.data.list[0].PURPOSE}}</b>
                    </div>
                </div>
            </div>
        </div>
        {{? it.data.list[0].affirmList}}
        <div class="rs_mainBox pt0">
            <div class="rsBoxMsg pt5">
                <div class="rs_cjqk">
                    <h1>裁决情况</h1> {{ for(var i = 0; i
                    < it.data.list[0].affirmList.length;i++) { }} <div class="rs_tkMsg">
                        <span class="{{=it.data.list[0].affirmList[i].affirmFlag== 0 ? 'ws' : 'tg'}}">{{=it.data.list[0].affirmList[i].affirmFlag == 1 ? "通过" : (it.data.list[0].affirmList[i].affirmFlag == 2 ? "否决" : "未审")}}</span>
                        <h1>{{=it.data.list[0].affirmList[i].affirmorName}}  {{=it.data.list[0].affirmList[i].affirmFlag== 0 ? "" : it.data.list[0].affirmList[i].updateDate}}</h1> {{? it.data.list[0].affirmList[i].affirmFlag != 0 }}
                        <p>意见：{{=it.data.list[0].affirmList[i].remark}} </p> {{?}}
                </div>
                {{ } }}
            </div>
        </div>
        </div>
        {{?}} {{? it.data.list[0].AFFIRM_FLAG == 0}}
        <div class="rs_mainBox pt0">
            <div class="rsBoxMsg pt5">
                <div class="rs_cjqk">
                    <h1>裁决意见</h1>
                    <div class="rs_cjTxt pt10">
                        <textarea placeholder="请输入裁决意见" id="mark"></textarea>
                    </div>
                    <div class="rs_cjBtn">
                        <button class="red" tapmode onclick="fnPostAffirm(2);">否决</button>
                        <button tapmode onclick="fnPostAffirm(1);">通过</button>
                    </div>
                </div>
            </div>
        </div>
        {{?}}
    </script>
</body>

</html>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript" src="../script/remotedb.js"></script>
<script type="text/javascript" src="../script/doT.min.js"></script>

<script type="text/javascript">
    apiready = function() {
        loginState();
        var pageParam = api.pageParam;
        frameInit(pageParam);
    };

    function frameInit(pageParam) {
        if (!pageParam) {
            pageError();
        } else {
            dataInit(pageParam);
        }
    }


    function dataInit(pageParam) {
        fnPost('affirmInfo', {
            body: JSON.stringify({
                applyNo: pageParam.OTNO,
                applyType: "evs",
                content: lisType.evsResultAffirm,
                currentPage: 0,
                key: ""
            })
        }, true, function(ret, err) {
            if (ret && ret.resultCode == 200) {
                if (ret.data && ret.data.list && ret.data.list.length > 0) {
                    jbList(ret);
                } else {
                    pageError();
                }
            } else {
                api.toast({
                    msg: '网络不佳，请重试',
                    duration: 2000,
                    location: 'bottom'
                });
            }
        });
    }

    function jbList(data_) {
        var list = $api.byId('list');
        var tempFn = doT.template($api.byId('template').innerHTML);
        var resultHTML = tempFn(data_);
        $api.html(list, resultHTML);
        api.parseTapmode();
    }

    function fnPostAffirm(fg) {
        fnPost('affirm', {
            body: JSON.stringify({
                affirmNo: $api.attr($api.byId('rs_jbspBox'), 'AFFIRMNO'),
                affirmRemark: $api.byId('mark').value,
                content: lisType.evsResultAffirm,
                flag: fg
            })
        }, true, function(ret, err) {
            if (ret && ret.resultCode == 200) {
                api.alert({
                    title: '审批成功',
                    msg: '审批-' + (fg == 1 ? "通过" : "否决"),
                }, function(ret, err) {
                    api.closeWin();
                    api.sendEvent({
                        name: 'headerLoading'
                    });
                });
            } else {
                api.toast({
                    msg: '网络不佳，请重试',
                    duration: 2000,
                    location: 'bottom'
                });
            }
        });
    }
</script>
