<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="pa.common">
	<!-- retrieve salary information -->
	<select id="RetrievePaInfo" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[	
		  SELECT PA_HISTORY.*,
		  		 SUBSTR(PA_HISTORY.PA_MONTH,1,4) AS "YEAR", 
			   	 SUBSTR(PA_HISTORY.PA_MONTH,5,6) AS "MONTH",
		  	     TO_CHAR(PA_HISTORY.DATE_STARTED,'YYYY-MM-DD') AS JOIN_DATE,
		  	     (NVL(PA_HISTORY.HOLIDAY_MINUS,0)+NVL(PA_HISTORY.HOLIDAY_MINUS_SHORT,0)+NVL(PA_HISTORY.HOLIDAY_MINUS_LONG,0)) as HOLIDAY_MINUS_ALL,
			     (NVL(PA_HISTORY.vacation,0)+NVL(PA_HISTORY.vacation_long,0)+NVL(PA_HISTORY.vacation_short,0)) as vacation_ALL                             				                	
			FROM PA_HISTORY	
			WHERE PA_HISTORY.EMPID=#empID#		                
			AND PA_HISTORY.PA_MONTH=#PaMonth#
	]]>
	</select>

	<!-- retrieve basic salary information-->
	<select id="RetrieveBasicPaInfo" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[	
				  
			SELECT B.*, 
				   SUBSTR (B.PA_MONTH, 1, 4) AS "YEAR",
			       SUBSTR (B.PA_MONTH, 5, 6) AS "MONTH",
			       TO_CHAR (B.DATE_STARTED, 'YYYY-MM-DD') AS JOIN_DATE,
			       (NVL(B.HOLIDAY_MINUS,0)+NVL(B.HOLIDAY_MINUS_SHORT,0)+NVL(B.HOLIDAY_MINUS_LONG,0)) as HOLIDAY_MINUS_ALL,
			       (NVL(B.vacation,0)+NVL(B.vacation_long,0)+NVL(B.vacation_short,0)) as vacation_ALL
			  FROM PA_HISTORY B
			 WHERE B.PA_MONTH = #PaMonth#
			   AND B.EMPID = #empID#
			 

	]]>
	</select>

	<!-- retrieve salary information -->
	<select id="RetrieveSalary" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[	
		 SELECT PA_HISTORY.*,
		 		TO_CHAR(PA_HISTORY.DATE_STARTED,'YYYY-MM-DD') AS JOIN_DATE,
		 		SUBSTR(PA_HISTORY.PA_MONTH,1,4) AS "YEAR", 
			   	SUBSTR(PA_HISTORY.PA_MONTH,5,6) AS "MONTH"
		   FROM PA_HISTORY	
		  WHERE PA_HISTORY.EMPID=#empID#		                
			AND substr(PA_HISTORY.PA_MONTH,0,4)=#PaYear#
	   order by PA_HISTORY.PA_MONTH
	]]>
	</select>

	<!-- retrieve personal information for salary of year -->
	<select id="RetrievePersonalInfoForSalary"
		parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[	
		 SELECT A.*,
		 		TO_CHAR(JOINDATE,'YYYY-MM-DD') JOIN_DATE  		 	   
		   FROM PA_HR_V A
		  WHERE EMPID = #empID:VARCHAR#
		    AND CPNY_ID = #cpnyId:VARCHAR#
	]]>
	</select>

	<!-- retrieve punishment information for fund of reward in PA -->
	<select id="RetrievePunishmentInfo" parameterClass="SimpleMap"
		resultClass="PunishMent">
		<![CDATA[
		    SELECT 
                    A.EMPID                             empID,
                    A.CHINESENAME                       chineseName,
                    B.DEPTNAME                          department,
                    A.DEPTID                            deptID,
                    C.POSTID                            postCode,
                    D.POST_NAME                         post,
                    A.POSITION_CODE                     positionCode,
                    E.CODE_NAME                         position,
                    A.POST_COEF                         postCoef,
                    A.POST_GRADE_CODE                   postGradeCode,
                    F.CODE_NAME                         postGrade,
                    
                    G.PUNISHMENT_NO						punishmentNo,
                    G.ACTIVITY                          activity,
                    TO_CHAR(G.CREATE_DATE,'YYYY-MM-DD') createDate,
                    G.CREATED_BY                        createdBy,
                    G.TRANS_CODE                        transCode,
                    H.CODE_NAME                         transCodeName,
                    G.TRANS_NO                          transNo,
                    TO_CHAR(G.UPDATE_DATE,'YYYY-MM-DD') updateDate,
                    G.UPDATED_BY                        updatedBy,      
                    
					TO_CHAR(G.DATE_PUNISHED,'YYYY-MM-DD') punishDate,
					TO_CHAR(G.DATE_RELEASED,'YYYY-MM-DD') releaseDate,
					G.ORDERNO							orderNo,
					G.PUN_RESULT						punishResult,
					G.PUN_TYPE_ID						punishTypeCode,
					I.CODE_NAME							punishType,
					G.VIOLATION_TYPE_CODE				violationTypeCode,
					J.CODE_NAME							violationType,
					G.PUNISHER_CODE						punisherCode,
					K.CODE_NAME							punisher
                    FROM
                            HR_EMPLOYEE A,
                            HR_DEPARTMENT B,
                            HR_EMP_POST C,
                            HR_POST D,
                            SY_CODE E,
                            SY_CODE F,
                            HR_PUNISHMENT G,
                            SY_CODE H,
                            SY_CODE I,
                            SY_CODE J,
                            SY_CODE K
                            
                    WHERE
                            A.DEPTID = B.DEPTID(+)
                        AND A.EMPID = C.EMPID(+)
                        AND C.POSTID = D.POST_ID(+)
                        AND A.POSITION_CODE = E.CODE_ID(+)
                        AND A.POST_GRADE_CODE = F.CODE_ID(+)
                        AND A.EMPID(+)=G.EMPID
                        AND G.TRANS_CODE=H.CODE_ID(+)
                        AND G.PUN_TYPE_ID=I.CODE_ID(+)
                        AND G.VIOLATION_TYPE_CODE=J.CODE_ID(+)
                        AND G.PUNISHER_CODE=K.CODE_ID(+)
                        AND A.EMPID=#empID#
                        AND EXTRACT(YEAR FROM G.DATE_PUNISHED)=#PaYear#
		]]>

		<![CDATA[
	 		ORDER BY  A.EMPID,G.DATE_PUNISHED DESC 
		 ]]>
	</select>

	<!-- retrieve reward information for PA-->
	<select id="RetrieveRewardInfo" parameterClass="SimpleMap"
		resultClass="Reward">
		<![CDATA[
	 
	 	   SELECT REWARD_NO             			 rewardNo,
				  A.EMPID                 			 empID,
				  B.CHINESENAME						 chineseName,
				  B.DEPTID							 deptID,
				  F.DEPTNAME						 department,
				  REWARD_TYPE_CODE      			 rewardTypeCode,
				  C.CODE_NAME						 rewardType,
				  TO_CHAR(REWARD_DATE,'YYYY-MM-DD')  rewardDate,
				  REWARD_CONTENTS        			 rewardContents,
				  REWARD_SORT_CODE       			 rewardSortCode,
				  D.CODE_NAME			 			 rewardSort,
				  ACHIEVEMENT_TYPE_CODE  			 achievementTypeCode,
				  E.CODE_NAME			 			 achievementType,
				  REWARD_AMOUNT          			 rewardAmount,
				  REWARD_BONUS           			 rewardBonus,
				  TO_CHAR(A.CREATE_DATE,'YYYY-MM-DD') createDate,
				  A.CREATED_BY             			 createdBy ,
				  TO_CHAR(A.UPDATE_DATE,'YYYY-MM-DD') updateDate,
				  A.UPDATED_BY             			 updatedBy,
				  A.ORDERNO                			 orderNo,
				  A.ACTIVITY               			 activity
		 	 FROM HR_REWARD A,
			 	  HR_EMPLOYEE B,
				  SY_CODE C,
				  SY_CODE D,
				  SY_CODE E,
				  HR_DEPARTMENT F
			WHERE A.EMPID = #empID#
			  AND A.EMPID = B.EMPID(+)
			  AND A.REWARD_TYPE_CODE = C.CODE_ID(+)
			  AND A.REWARD_SORT_CODE = D.CODE_ID(+)
			  AND A.ACHIEVEMENT_TYPE_CODE = E.CODE_ID(+)
			  AND B.DEPTID = F.DEPTID(+)
			  AND EXTRACT(YEAR FROM A.REWARD_DATE)=#PaYear#
					 
		]]>
	</select>

<!-- retrieve evaluation information for PA-->
	<select id="RetrieveEvaluationInfo" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
	 
			SELECT EV_YEAR YEAR, 
				   EV_PERIOD_NAME PERIODNAME, 
				   EV_EMP_ID EMPID, 
				   EV_GRADE_NAME GRADENAME
			FROM HR_EV_TYPE2_V EVA
			WHERE EVA.EV_EMP_ID = #empID# 
				AND EVA.EV_YEAR = #PaYear#
								 
		]]>
	</select>

</sqlMap>
