<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="gm.woodProducts">

	 <select id="DocumentListForConfigNumber" parameterClass="SimpleMap" resultClass="int">
			<![CDATA[			
	 select count(*) from(select distinct gwa.document_no,                
	                gwa.wp_applyerid,
	                gwa.wp_applyername,
	                gwa.wp_applyerdeptname,
	                to_char(gwa.hope_completed_date, 'yyyy-mm-dd') as hope_completed_date
	 from ga_woodproducts_apply gwa, GA_SEALPRODUCTS_SET gws
	 where gwa.document_no in (select distinct t.apply_no
	                             from ga_woodproducts_affirm t
	                             where t.activity = '1' and t.affirm_flag='1')
	 and gwa.active = '1' and gws.woodproducts_id = gwa.wpid
	 and  gwa.confirm_flag!=4
	              			]]>
	<isNotEmpty prepend="AND" property="doucemntno">
				<![CDATA[
			 		gwa.document_no=#doucemntno:VARCHAR#
				]]>
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="status">
				<![CDATA[
			 		gwa.confirm_flag=#status:VARCHAR#
				]]>
	</isNotEmpty>
	
	<isNotEmpty prepend="AND" property="dept">
				<![CDATA[
			 		gwa.WP_APPLYERDEPTNAME like '%' || #dept:VARCHAR# || '%'
				]]>
	</isNotEmpty>
	
	<isNotEmpty prepend="AND" property="starttime">
				<![CDATA[
			 		gwa.apply_date>=to_date(#starttime:VARCHAR#,'yyyy-mm-dd')
				]]>
	</isNotEmpty>
	
	<isNotEmpty prepend="AND" property="endtime">
				<![CDATA[
			 		gwa.apply_date<=to_date(#endtime:VARCHAR#,'yyyy-mm-dd')
				]]>
	</isNotEmpty>
		<![CDATA[
		)
		]]>
	</select>
	
	<select id="DocumentListForConfigList"  parameterClass="SimpleMap"	 resultClass="SimpleMap">
			<![CDATA[
	select distinct gwa.document_no,                
	                gwa.wp_applyerid,
	                gwa.wp_applyername,
	                gwa.wp_applyerdeptname,
	                gwa.note,gwa.confirm_flag,
	                gwa.confignote,
	                to_char(gwa.hope_completed_date, 'yyyy-mm-dd') as hope_completed_date
	 from ga_woodproducts_apply gwa, GA_SEALPRODUCTS_SET gws
	 where gwa.document_no in (select distinct t.apply_no
	                             from ga_woodproducts_affirm t
	                             where t.activity = '1' and t.affirm_flag='1')
	 and gwa.active = '1' and gws.woodproducts_id = gwa.wpid
	 and  gwa.confirm_flag!=4
	   			]]>
	<isNotEmpty prepend="AND" property="doucemntno">
				<![CDATA[
			 		gwa.document_no=#doucemntno:VARCHAR#
				]]>
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="status">
				<![CDATA[
			 		gwa.confirm_flag=#status:VARCHAR#
				]]>
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="dept">
				<![CDATA[
			 		gwa.WP_APPLYERDEPTNAME like '%' || #dept:VARCHAR# || '%'
				]]>
	</isNotEmpty>
	
	<isNotEmpty prepend="AND" property="starttime">
				<![CDATA[
			 		gwa.apply_date>=to_date(#starttime:VARCHAR#,'yyyy-mm-dd')
				]]>
	</isNotEmpty>
	
	<isNotEmpty prepend="AND" property="endtime">
				<![CDATA[
			 		gwa.apply_date<=to_date(#endtime:VARCHAR#,'yyyy-mm-dd')
				]]>
	</isNotEmpty>
	   			<![CDATA[
	  order by gwa.document_no desc ,gwa.confirm_flag	
	   			]]>
	</select>
	<select id="getWoodProductsSet"  parameterClass="SimpleMap"	 resultClass="SimpleMap">
			<![CDATA[
			select gws.woodproducts_id,
		       gws.products_name,
		       gws.measurement_unit_price,		      
		       to_char(gws.create_date,'YYYY-MM-DD') create_date,
		       gws.create_id,
		       gws.active,
		       hr.chinesename,
		       hr.deptid,
		       dep.deptname,
		       NVL(gws.notes,'æ— ') notes
		  from GA_SEALPRODUCTS_SET gws, hr_employee hr, hr_department dep
		 where gws.create_id = hr.person_id(+)
		   and dep.deptid(+) = hr.deptid
		   and gws.ACTIVE = '1'
		   and gws.cpny_id=#cpnyId:VARCHAR#
			]]>
	<![CDATA[
		 order by gws.create_date desc

	   			]]>
	</select>
	
	<select id="ProductsImageView"  parameterClass="SimpleMap"	 resultClass="SimpleMap">
			<![CDATA[
	select t.documentno key, t.chinesename, t.pathaddress, t.filename
	  from file_or_photo_path t
	  where t.documentno=#key:VARCHAR#	
	   			]]>
	</select>
	


	<update id="updateGa_woodproducts_apply"  parameterClass="SimpleMap">
		<![CDATA[
			update ga_products_apply  t 
			set t.confirm_flag=#flag:VARCHAR#,
				t.confirm_confirmorid=#adminId:VARCHAR#,
				t.confirmoridea=#confirmorIdea:VARCHAR#,
				t.confirm_confirmdate=SYSDATE
			where t.apply_no=#applyNo:VARCHAR#
   		]]>
	</update>
	
	<select id="getWoodProductsObject"  parameterClass="string"	 resultClass="SimpleMap">
			<![CDATA[
			select T.*,HR.EMPID,HR.CHINESENAME from GA_SEALPRODUCTS_SET t ,HR_EMPLOYEE HR
				WHERE T.CREATE_ID=HR.PERSON_ID
				AND  t.woodproducts_id=#seqId:VARCHAR#	
	   			]]>
	</select>
	
	<select id="getwoodProductionList"  parameterClass="SimpleMap"	 resultClass="SimpleMap">
			<![CDATA[
			 SELECT 			 
			  PRODUCTSNO,
			  SPECIFICATIONNO,
			  PRODUCTIONNAME,
			  L ,
			  W ,
			  H ,
			  UNITPRICE ,
			  SUMPRICE ,
			  TO_CHAR(CREATE_DATE,'YYYY-MM-DD') CREATE_DATE,
			  CREATE_BY ,
			  CPNY_ID   
          FROM  GA_WOODPRODUCTION_SET
          WHERE CPNY_ID=#cpnyId:VARCHAR#
          AND ACTIVE=1
          ]]>
      <isNotEmpty prepend="AND" property="productionName">
				<![CDATA[
			 		PRODUCTIONNAME LIKE '%'||#productionName:VARCHAR#||'%'
				]]>
	   </isNotEmpty>
	   <isNotEmpty prepend="AND" property="specificationNo">
				<![CDATA[
			 		SPECIFICATIONNO LIKE '%'||#specificationNo:VARCHAR#||'%'
				]]>
	   </isNotEmpty>
		
	</select>
	<select id="getwoodProductionListNumber"  parameterClass="SimpleMap"	 resultClass="int">
			<![CDATA[
			 SELECT 			 
			  COUNT(*)
          FROM  GA_WOODPRODUCTION_SET
          WHERE CPNY_ID=#cpnyId:VARCHAR#
          ]]>
      <isNotEmpty prepend="AND" property="productionName">
				<![CDATA[
			 		PRODUCTIONNAME LIKE '%'||#productionName:VARCHAR#||'%'
				]]>
	   </isNotEmpty>
	   <isNotEmpty prepend="AND" property="specificationNo">
				<![CDATA[
			 		SPECIFICATIONNO LIKE '%'||#specificationNo:VARCHAR#||'%'
				]]>
	   </isNotEmpty>
	</select>
	<insert id="addWoodProduction" parameterClass="SimpleMap">
	INSERT INTO  GA_WOODPRODUCTION_SET
	(         
      PRODUCTSNO,
	  SPECIFICATIONNO,
	  PRODUCTIONNAME,
	  L ,
	  W ,
	  H ,
	  SUMPRICE ,
	  CREATE_DATE,
	  CREATE_BY ,
	  CPNY_ID   
	)VALUES
	(
	GA_SEALPRODUCT_SET_SEQ.NEXTVAL,
	#SPECIFICATIONNO:VARCHAR#,
	#PRODUCTIONNAME:VARCHAR#,
	#L:NUMERIC#,
	#W:NUMERIC#,
	#H:NUMERIC#,
	#SUMPRICE:NUMERIC#,
	SYSDATE,
	#adminId:VARCHAR#,
	#cpnyId:VARCHAR#
	)	
	</insert>	
   <update id="updateWoodProduction" parameterClass="SimpleMap">
    UPDATE GA_WOODPRODUCTION_SET
    SET  
    L=#L:NUMERIC#,
    W=#W:NUMERIC#,
    H=#H:NUMERIC#,
    SUMPRICE=#SUMPRICE:NUMERIC#
    WHERE PRODUCTSNO=#PRODUCTSNO:NUMERIC#	
	</update>
	<update id="deleteWoodProduction" parameterClass="SimpleMap">
	 UPDATE GA_WOODPRODUCTION_SET  SET  ACTIVE=0,CREATE_BY=#adminId:VARCHAR# WHERE PRODUCTSNO=#PRODUCTSNO:NUMERIC#
	</update>	
</sqlMap>