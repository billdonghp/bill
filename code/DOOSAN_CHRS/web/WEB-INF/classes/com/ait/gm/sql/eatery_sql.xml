<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="gm.eatery">
	<select id="StatisticList" parameterClass="SimpleMap"
		resultClass="SimpleMap" remapResults="true">

		<![CDATA[
		select de.deptid,
		       de.deptname,		       
		       NVL(macrecodes.lunchrecords, 0) lunchrecords,
		       NVL(macrecodes.supperrecords, 0) supperrecords,
		       NVL(macrecodes.dinnerrecords, 0) dinnerrecords,
		       NVL(macrecodes.breakrecords, 0) breakrecords,
		       NVL(confirmrecords.lunchcounts, 0) lunchcounts,
		       NVL(confirmrecords.suppercounts, 0) suppercounts,
		       NVL(confirmrecords.dinnercounts, 0) dinnercounts,
		       NVL(confirmrecords.breakcounts, 0) breakcounts,
		       confirmrecords.REMARK,
		 ]]>
		<isEqual prepend="" property="cpnyId" compareValue="63000000">
			<!-- 只有DISD才有班车 -->
			<![CDATA[
		        NVL(confirmrecords.line_one, 0) line_one,
		        NVL(confirmrecords.line_two, 0) line_two,
		        NVL(confirmrecords.line_three, 0) line_three,
		        NVL(confirmrecords.line_four, 0) line_four,
		        NVL(confirmrecords.line_five, 0) line_five,
		        NVL(confirmrecords.line_six, 0) line_six,
		        NVL(confirmrecords.line_seven, 0) line_seven,
		        NVL(confirmrecords.line_eight, 0) line_eight,
		        NVL(confirmrecords.line_nine, 0) line_nine,
		        NVL(confirmrecords.line_ten, 0) line_ten,
		        NVL(confirmrecords.line_eleven, 0) line_eleven,
		        NVL(confirmrecords.line_twelve, 0) line_twelve,
		        NVL(confirmrecords.line_thirteen, 0) line_thirteen,
		        NVL(confirmrecords.line_fourteen, 0) line_fourteen,
		        NVL(confirmrecords.line_fifteen, 0) line_fifteen,
		        NVL(confirmrecords.line_sixteen, 0) line_sixteen,
		        NVL(confirmrecords.line_seventeen, 0) line_seventeen,
		        NVL(confirmrecords.line_eighteen, 0) line_eighteen,
		        NVL(confirmrecords.line_nineteen, 0) line_nineteen,
		        NVL(confirmrecords.line_twenty, 0) line_twenty,
			]]>
		</isEqual>
		<![CDATA[
		       hr_get_level_deptid(de.deptid, '4') fourdeptid
		  from hr_department de,
		       (select sum(lunchrecords) lunchrecords,
		               sum(supperrecords) supperrecords,
		               sum(dinnerrecords) dinnerrecords,
		               sum(breakrecords) breakrecords,
		               deptid
		          from (select NVL(decode(basedata.type, #lunch:VARCHAR#, basedata.counts), 0) lunchrecords,
		                       NVL(decode(basedata.type, #supper:VARCHAR#, basedata.counts), 0) supperrecords,
		                       NVL(decode(basedata.type, #dinner:VARCHAR#, basedata.counts), 0) dinnerrecords,
		                       NVL(decode(basedata.type, #break:VARCHAR#, basedata.counts), 0) breakrecords,
		                       deptid
		                  from (select count(records.empid) counts,
		                               records.deptid,
		                               records.type
		                          from (select hr.empid,
		                                       de.deptid,
		                                       get_eatery_type(to_char(t.r_time,
		                                                               'YYYY-MM-DD HH24:MI'),
		                                                       #cpnyId:VARCHAR#,
		                                                       'id') type
		                                  from ar_eatery_records t,
		                                       hr_employee       hr,
		                                       hr_department     de
		                                 where t.empid = hr.person_id(+)
		                                   and hr.deptid = de.deptid(+)
		                                   and t.cpny_id = #cpnyId:VARCHAR#
		                                   and to_char(t.r_time, 'YYYY-MM-DD') =
		                                       #current_date:VARCHAR#
		                                   AND EXISTS
		                                 (SELECT SAD.ADMIN_DEPTID
		                                          FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
		                                         WHERE SAD.ADMIN_NO = SA.ADMINNO
		                                           AND SA.ADMINID = #AdminId:VARCHAR#
		                                           AND SAD.ADMIN_DEPTID = hr.DEPTID)) records
		                         group by records.deptid, records.type) basedata)
		         group by deptid) macrecodes,
		       (select sum(lunchcounts) lunchcounts,
		               sum(suppercounts) suppercounts,
		               sum(dinnercounts) dinnercounts,
		               sum(breakcounts) breakcounts,
		  ]]>
		<isEqual prepend="" property="cpnyId" compareValue="63000000">
			<!-- 只有DISD才有班车 -->
			<![CDATA[
					   sum(line_one) line_one,
		               sum(line_two) line_two,
		               sum(line_three) line_three,
		               sum(line_four) line_four,
		               sum(line_five) line_five,
		               sum(line_six) line_six,
		               sum(line_seven) line_seven,
		               sum(line_eight) line_eight,
		               sum(line_nine) line_nine,
		               sum(line_ten) line_ten,
		               sum(line_eleven) line_eleven,
		               sum(line_twelve) line_twelve,
		               sum(line_thirteen) line_thirteen,
		               sum(line_fourteen) line_fourteen,
		               sum(line_fifteen) line_fifteen,
		               sum(line_sixteen) line_sixteen,
		               sum(line_seventeen) line_seventeen,
		               sum(line_eighteen) line_eighteen,
		               sum(line_nineteen) line_nineteen,
		               sum(line_twenty) line_twenty,
			]]>
		</isEqual>
		<![CDATA[
		               count_dept deptid,
		               REMARK 
		          from (select NVL(decode(countdata.countm_type,
		                                  #lunch:VARCHAR#,
		                                  countdata.count_num),
		                           0) lunchcounts,
		                       NVL(decode(countdata.countm_type,
		                                  #supper:VARCHAR#,
		                                  countdata.count_num),
		                           0) suppercounts,
		                       NVL(decode(countdata.countm_type,
		                                   #dinner:VARCHAR#,
		                                  countdata.count_num),
		                           0) dinnercounts,
		                       NVL(decode(countdata.countm_type,
		                                   #break:VARCHAR#,
		                                  countdata.count_num),
		                           0) breakcounts,
		 ]]>
		<isEqual prepend="" property="cpnyId" compareValue="63000000">
			<!-- 只有DISD才有班车 -->
			<![CDATA[
				   NVL(decode(countdata.countm_type,#line_one:VARCHAR#,countdata.count_num),0) line_one,
                   NVL(decode(countdata.countm_type,#line_two:VARCHAR#,countdata.count_num),0) line_two,
                   NVL(decode(countdata.countm_type,#line_three:VARCHAR#,countdata.count_num),0) line_three,
                   NVL(decode(countdata.countm_type,#line_four:VARCHAR#,countdata.count_num),0) line_four,
                   NVL(decode(countdata.countm_type,#line_five:VARCHAR#,countdata.count_num),0) line_five,
                   NVL(decode(countdata.countm_type,#line_six:VARCHAR#,countdata.count_num),0) line_six,
                   NVL(decode(countdata.countm_type,#line_seven:VARCHAR#,countdata.count_num),0) line_seven,
                   NVL(decode(countdata.countm_type,#line_eight:VARCHAR#,countdata.count_num),0) line_eight,
                   NVL(decode(countdata.countm_type,#line_nine:VARCHAR#,countdata.count_num),0) line_nine,
                   NVL(decode(countdata.countm_type,#line_ten:VARCHAR#,countdata.count_num),0) line_ten,
                   NVL(decode(countdata.countm_type,#line_eleven:VARCHAR#,countdata.count_num),0) line_eleven,
                   NVL(decode(countdata.countm_type,#line_twelve:VARCHAR#,countdata.count_num),0) line_twelve,
                   NVL(decode(countdata.countm_type,#line_thirteen:VARCHAR#,countdata.count_num),0) line_thirteen,
                   NVL(decode(countdata.countm_type,#line_fourteen:VARCHAR#,countdata.count_num),0) line_fourteen,
                   NVL(decode(countdata.countm_type,#line_fifteen:VARCHAR#,countdata.count_num),0) line_fifteen,
                   NVL(decode(countdata.countm_type,#line_sixteen:VARCHAR#,countdata.count_num),0) line_sixteen,
                   NVL(decode(countdata.countm_type,#line_seventeen:VARCHAR#,countdata.count_num),0) line_seventeen,
                   NVL(decode(countdata.countm_type,#line_eighteen:VARCHAR#,countdata.count_num),0) line_eighteen,
                   NVL(decode(countdata.countm_type,#line_nineteen:VARCHAR#,countdata.count_num),0) line_nineteen,
                   NVL(decode(countdata.countm_type,#line_twenty:VARCHAR#,countdata.count_num),0) line_twenty,
			]]>
		</isEqual>
		<![CDATA[
		                       countdata.count_dept,
		                       countdata.REMARK
		                  from (select t.countm_type, t.count_dept, t.count_num,t.REMARK
		                          from gm_eatery_confirm t
		                         where t.cpny_id = #cpnyId:VARCHAR#
		                           and t.flag = 0
		                           and to_char(t.count_date, 'YYYY-MM-DD') =
		                               #current_date:VARCHAR#) countdata) confirmdata
		         group by count_dept,REMARK) confirmrecords
		 where de.dept_level not in (0, 1, 2, 3)
		   and de.deptid = macrecodes.deptid(+)
		   and de.deptid = confirmrecords.deptid(+)
		   and EXISTS (SELECT SAD.ADMIN_DEPTID
		          FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
		         WHERE SAD.ADMIN_NO = SA.ADMINNO
		           AND SA.ADMINID = #AdminId:VARCHAR#
		           AND SAD.ADMIN_DEPTID = de.DEPTID)	   

		]]>

	</select>

	<select id="StatisticListKO" parameterClass="SimpleMap"
		resultClass="SimpleMap" remapResults="true">

		<![CDATA[
		select de.deptid,
		       de.deptname,		       
		       NVL(macrecodes.lunchrecords, 0) lunchrecords,
		       NVL(macrecodes.supperrecords, 0) supperrecords,
		       NVL(macrecodes.dinnerrecords, 0) dinnerrecords,
		       NVL(macrecodes.breakrecords, 0) breakrecords,
		       NVL(confirmrecords.lunchcounts, 0) lunchcounts,
		       NVL(confirmrecords.suppercounts, 0) suppercounts,
		       NVL(confirmrecords.dinnercounts, 0) dinnercounts,
		       NVL(confirmrecords.breakcounts, 0) breakcounts,
		       confirmrecords.REMARK,
		 ]]>
		<isEqual prepend="" property="cpnyId" compareValue="63000000">
			<!-- 只有DISD才有班车 -->
			<![CDATA[
				NVL(confirmrecords.line_one, 0) line_one,
		        NVL(confirmrecords.line_two, 0) line_two,
		        NVL(confirmrecords.line_three, 0) line_three,
		        NVL(confirmrecords.line_four, 0) line_four,
		        NVL(confirmrecords.line_five, 0) line_five,
		        NVL(confirmrecords.line_six, 0) line_six,
		        NVL(confirmrecords.line_seven, 0) line_seven,
		        NVL(confirmrecords.line_eight, 0) line_eight,
		        NVL(confirmrecords.line_nine, 0) line_nine,
		        NVL(confirmrecords.line_ten, 0) line_ten,
		        NVL(confirmrecords.line_eleven, 0) line_eleven,
		        NVL(confirmrecords.line_twelve, 0) line_twelve,
		        NVL(confirmrecords.line_thirteen, 0) line_thirteen,
		        NVL(confirmrecords.line_fourteen, 0) line_fourteen,
		        NVL(confirmrecords.line_fifteen, 0) line_fifteen,
		        NVL(confirmrecords.line_sixteen, 0) line_sixteen,
		        NVL(confirmrecords.line_seventeen, 0) line_seventeen,
		        NVL(confirmrecords.line_eighteen, 0) line_eighteen,
		        NVL(confirmrecords.line_nineteen, 0) line_nineteen,
		        NVL(confirmrecords.line_twenty, 0) line_twenty,
			]]>
		</isEqual>
		<![CDATA[
		       hr_get_level_deptid(de.deptid, '4') fourdeptid
		  from hr_department de,
		       (select sum(lunchrecords) lunchrecords,
		               sum(supperrecords) supperrecords,
		               sum(dinnerrecords) dinnerrecords,
		               sum(breakrecords) breakrecords,
		               deptid
		          from (select NVL(decode(basedata.type, #lunch:VARCHAR#, basedata.counts), 0) lunchrecords,
		                       NVL(decode(basedata.type, #supper:VARCHAR#, basedata.counts), 0) supperrecords,
		                       NVL(decode(basedata.type, #dinner:VARCHAR#, basedata.counts), 0) dinnerrecords,
		                       NVL(decode(basedata.type, #break:VARCHAR#, basedata.counts), 0) breakrecords,
		                       deptid
		                  from (select count(records.empid) counts,
		                               records.deptid,
		                               records.type
		                          from (select hr.empid,
		                                       de.deptid,
		                                       get_eatery_type(to_char(t.r_time,
		                                                               'YYYY-MM-DD HH24:MI'),
		                                                       #cpnyId:VARCHAR#,
		                                                       'id') type
		                                  from ar_eatery_records t,
		                                       hr_employee       hr,
		                                       hr_department     de
		                                 where t.empid = hr.person_id(+)
		                                   and hr.deptid = de.deptid(+)
		                                   and t.cpny_id = #cpnyId:VARCHAR#
		                                   and to_char(t.r_time, 'YYYY-MM-DD') =
		                                       #current_date:VARCHAR#
		                                   AND EXISTS
		                                 (SELECT SAD.ADMIN_DEPTID
		                                          FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
		                                         WHERE SAD.ADMIN_NO = SA.ADMINNO
		                                           AND SA.ADMINID = #AdminId:VARCHAR#
		                                           AND SAD.ADMIN_DEPTID = hr.DEPTID)) records
		                         group by records.deptid, records.type) basedata)
		         group by deptid) macrecodes,
		       (select sum(lunchcounts) lunchcounts,
		               sum(suppercounts) suppercounts,
		               sum(dinnercounts) dinnercounts,
		               sum(breakcounts) breakcounts,
		  ]]>
		<isEqual prepend="" property="cpnyId" compareValue="63000000">
			<!-- 只有DISD才有班车 -->
			<![CDATA[
					   sum(line_one) line_one,
		               sum(line_two) line_two,
		               sum(line_three) line_three,
		               sum(line_four) line_four,
		               sum(line_five) line_five,
		               sum(line_six) line_six,
		               sum(line_seven) line_seven,
		               sum(line_eight) line_eight,
		               sum(line_nine) line_nine,
		               sum(line_ten) line_ten,
		               sum(line_eleven) line_eleven,
		               sum(line_twelve) line_twelve,
		               sum(line_thirteen) line_thirteen,
		               sum(line_fourteen) line_fourteen,
		               sum(line_fifteen) line_fifteen,
		               sum(line_sixteen) line_sixteen,
		               sum(line_seventeen) line_seventeen,
		               sum(line_eighteen) line_eighteen,
		               sum(line_nineteen) line_nineteen,
		               sum(line_twenty) line_twenty,
			]]>
		</isEqual>
		<![CDATA[
		               count_dept deptid,
		               REMARK
		          from (select NVL(decode(countdata.countm_type,
		                                  #lunch:VARCHAR#,
		                                  countdata.count_num),
		                           0) lunchcounts,
		                       NVL(decode(countdata.countm_type,
		                                  #supper:VARCHAR#,
		                                  countdata.count_num),
		                           0) suppercounts,
		                       NVL(decode(countdata.countm_type,
		                                   #dinner:VARCHAR#,
		                                  countdata.count_num),
		                           0) dinnercounts,
		                       NVL(decode(countdata.countm_type,
		                                   #break:VARCHAR#,
		                                  countdata.count_num),
		                           0) breakcounts,
		 ]]>
		<isEqual prepend="" property="cpnyId" compareValue="63000000">
			<!-- 只有DISD才有班车 -->
			<![CDATA[
				   NVL(decode(countdata.countm_type,#line_one:VARCHAR#,countdata.count_num),0) line_one,
                   NVL(decode(countdata.countm_type,#line_two:VARCHAR#,countdata.count_num),0) line_two,
                   NVL(decode(countdata.countm_type,#line_three:VARCHAR#,countdata.count_num),0) line_three,
                   NVL(decode(countdata.countm_type,#line_four:VARCHAR#,countdata.count_num),0) line_four,
                   NVL(decode(countdata.countm_type,#line_five:VARCHAR#,countdata.count_num),0) line_five,
                   NVL(decode(countdata.countm_type,#line_six:VARCHAR#,countdata.count_num),0) line_six,
                   NVL(decode(countdata.countm_type,#line_seven:VARCHAR#,countdata.count_num),0) line_seven,
                   NVL(decode(countdata.countm_type,#line_eight:VARCHAR#,countdata.count_num),0) line_eight,
                   NVL(decode(countdata.countm_type,#line_nine:VARCHAR#,countdata.count_num),0) line_nine,
                   NVL(decode(countdata.countm_type,#line_ten:VARCHAR#,countdata.count_num),0) line_ten,
                   NVL(decode(countdata.countm_type,#line_eleven:VARCHAR#,countdata.count_num),0) line_eleven,
                   NVL(decode(countdata.countm_type,#line_twelve:VARCHAR#,countdata.count_num),0) line_twelve,
                   NVL(decode(countdata.countm_type,#line_thirteen:VARCHAR#,countdata.count_num),0) line_thirteen,
                   NVL(decode(countdata.countm_type,#line_fourteen:VARCHAR#,countdata.count_num),0) line_fourteen,
                   NVL(decode(countdata.countm_type,#line_fifteen:VARCHAR#,countdata.count_num),0) line_fifteen,
                   NVL(decode(countdata.countm_type,#line_sixteen:VARCHAR#,countdata.count_num),0) line_sixteen,
                   NVL(decode(countdata.countm_type,#line_seventeen:VARCHAR#,countdata.count_num),0) line_seventeen,
                   NVL(decode(countdata.countm_type,#line_eighteen:VARCHAR#,countdata.count_num),0) line_eighteen,
                   NVL(decode(countdata.countm_type,#line_nineteen:VARCHAR#,countdata.count_num),0) line_nineteen,
                   NVL(decode(countdata.countm_type,#line_twenty:VARCHAR#,countdata.count_num),0) line_twenty,
                   
                           
			]]>
		</isEqual>
		<![CDATA[
		                       countdata.count_dept,
		                       countdata.REMARK
		                  from (select t.countm_type, t.count_dept, t.count_num,t.REMARK
		                          from gm_eatery_ko_confirm t
		                         where t.cpny_id = #cpnyId:VARCHAR#
		                           and t.flag = 0
		                           and to_char(t.count_date, 'YYYY-MM-DD') =
		                               #current_date:VARCHAR#) countdata) confirmdata
		         group by count_dept,REMARK) confirmrecords
		 where de.dept_level not in (0, 1, 2, 3)
		   and de.deptid = macrecodes.deptid(+)
		   and de.deptid = confirmrecords.deptid(+)
		   and EXISTS (SELECT SAD.ADMIN_DEPTID
		          FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
		         WHERE SAD.ADMIN_NO = SA.ADMINNO
		           AND SA.ADMINID = #AdminId:VARCHAR#
		           AND SAD.ADMIN_DEPTID = de.DEPTID)	   

		]]>

	</select>

	<select id="StatisticConfimList" parameterClass="SimpleMap"
		resultClass="SimpleMap" remapResults="true">
		<![CDATA[
				           
		SELECT * FROM (SELECT DE.DEPTNAME,
                    NVL(MACRECODES.LUNCHRECORDS, 0) LUNCHRECORDS,
                    NVL(MACRECODES.SUPPERRECORDS, 0) SUPPERRECORDS,
                    NVL(MACRECODES.DINNERRECORDS, 0) DINNERRECORDS,
                    NVL(MACRECODES.BREAKRECORDS, 0) BREAKRECORDS,
                    NVL(CONFIRMRECORDS.LUNCHCOUNTS, 0) LUNCHCOUNTS,
                    NVL(CONFIRMRECORDS.SUPPERCOUNTS, 0) SUPPERCOUNTS,
                    NVL(CONFIRMRECORDS.DINNERCOUNTS, 0) DINNERCOUNTS,
                    NVL(CONFIRMRECORDS.BREAKCOUNTS, 0) BREAKCOUNTS,
         ]]>
		<isEqual prepend="" property="cpnyId" compareValue="63000000">
			<!-- 只有DISD才有班车 -->
			<![CDATA[
					NVL(CONFIRMRECORDS.LINE_ONE, 0) LINE_ONE,
					NVL(CONFIRMRECORDS.LINE_TWO, 0) LINE_TWO,
					NVL(CONFIRMRECORDS.LINE_THREE, 0) LINE_THREE,
					NVL(CONFIRMRECORDS.LINE_FOUR, 0) LINE_FOUR,
					NVL(CONFIRMRECORDS.LINE_FIVE, 0) LINE_FIVE,
					NVL(CONFIRMRECORDS.LINE_SIX, 0) LINE_SIX,
					NVL(CONFIRMRECORDS.LINE_SEVEN, 0) LINE_SEVEN,
					NVL(CONFIRMRECORDS.LINE_EIGHT, 0) LINE_EIGHT,
					NVL(CONFIRMRECORDS.LINE_NINE, 0) LINE_NINE,
					NVL(CONFIRMRECORDS.LINE_TEN, 0) LINE_TEN,
					NVL(CONFIRMRECORDS.LINE_ELEVEN, 0) LINE_ELEVEN,
					NVL(CONFIRMRECORDS.LINE_TWELVE, 0) LINE_TWELVE,
					NVL(CONFIRMRECORDS.LINE_THIRTEEN, 0) LINE_THIRTEEN,
					NVL(CONFIRMRECORDS.LINE_FOURTEEN, 0) LINE_FOURTEEN,
					NVL(CONFIRMRECORDS.LINE_FIFTEEN, 0) LINE_FIFTEEN,
					NVL(CONFIRMRECORDS.LINE_SIXTEEN, 0) LINE_SIXTEEN,
					NVL(CONFIRMRECORDS.LINE_SEVENTEEN, 0) LINE_SEVENTEEN,
					NVL(CONFIRMRECORDS.LINE_EIGHTEEN, 0) LINE_EIGHTEEN,
					NVL(CONFIRMRECORDS.LINE_NINETEEN, 0) LINE_NINETEEN,
					NVL(CONFIRMRECORDS.LINE_TWENTY, 0) LINE_TWENTY,
			]]>
		</isEqual>
		<![CDATA[
                    DE.DEPTID
               FROM HR_DEPT_TREE_V DE,
                    (SELECT SUM(DECODE(RECORDS.TYPE, #lunch:VARCHAR#, 1, 0)) LUNCHRECORDS,
                            SUM(DECODE(RECORDS.TYPE, #supper:VARCHAR#, 1, 0)) SUPPERRECORDS,
                            SUM(DECODE(RECORDS.TYPE, #dinner:VARCHAR#, 1, 0)) DINNERRECORDS,
                            SUM(DECODE(RECORDS.TYPE, #break:VARCHAR#, 1, 0)) BREAKRECORDS,
       
                            NVL(RECORDS.DEPTID, #cpnyId:VARCHAR#) AS DEPTID
                       FROM (SELECT HR.EMPID,
                                    DE.FOURTHDEPT AS DEPTID,
                                    GET_EATERY_TYPE(TO_CHAR(T.R_TIME,
                                                            'YYYY-MM-DD HH24:MI'),
                                                    #cpnyId:VARCHAR#,
                                                    'id') TYPE
                               FROM AR_EATERY_RECORDS T,
                                    HR_EMPLOYEE       HR,
                                    HR_DEPARTMENT     DE
                              WHERE T.EMPID = HR.PERSON_ID(+)
                                AND HR.DEPTID = DE.DEPTID(+)
                                AND T.CPNY_ID = #cpnyId:VARCHAR#
                                AND TO_CHAR(T.R_TIME, 'YYYY-MM-DD') =
                                    #current_date:VARCHAR#
                                AND EXISTS
                              (SELECT SAD.ADMIN_DEPTID
                                       FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
                                      WHERE SAD.ADMIN_NO = SA.ADMINNO
                                        AND SA.ADMINID = #AdminId:VARCHAR#
                                        AND SAD.ADMIN_DEPTID = HR.DEPTID)) RECORDS
                      GROUP BY ROLLUP(RECORDS.DEPTID)) MACRECODES,
                    (SELECT SUM(DECODE(T.COUNTM_TYPE, #lunch:VARCHAR#, COUNT_NUM, 0)) LUNCHCOUNTS,
                            SUM(DECODE(T.COUNTM_TYPE, #supper:VARCHAR#, COUNT_NUM, 0)) SUPPERCOUNTS,
                            SUM(DECODE(T.COUNTM_TYPE, #dinner:VARCHAR#, COUNT_NUM, 0)) DINNERCOUNTS,
                            SUM(DECODE(T.COUNTM_TYPE, #break:VARCHAR#, COUNT_NUM, 0)) BREAKCOUNTS,
                ]]>
		<isEqual prepend="" property="cpnyId" compareValue="63000000">
			<!-- 只有DISD才有班车 -->
			<![CDATA[
							SUM(DECODE(T.COUNTM_TYPE, #line_one:VARCHAR#, COUNT_NUM, 0)) LINE_ONE,
                            SUM(DECODE(T.COUNTM_TYPE, #line_two:VARCHAR#, COUNT_NUM, 0)) LINE_TWO,
                            SUM(DECODE(T.COUNTM_TYPE, #line_three:VARCHAR#, COUNT_NUM, 0)) LINE_THREE,
                            SUM(DECODE(T.COUNTM_TYPE, #line_four:VARCHAR#, COUNT_NUM, 0)) LINE_FOUR,
                            SUM(DECODE(T.COUNTM_TYPE, #line_five:VARCHAR#, COUNT_NUM, 0)) LINE_FIVE,
                            SUM(DECODE(T.COUNTM_TYPE, #line_six:VARCHAR#, COUNT_NUM, 0)) LINE_SIX,
                            SUM(DECODE(T.COUNTM_TYPE, #line_seven:VARCHAR#, COUNT_NUM, 0)) LINE_SEVEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_eight:VARCHAR#, COUNT_NUM, 0)) LINE_EIGHT,
                            SUM(DECODE(T.COUNTM_TYPE, #line_nine:VARCHAR#, COUNT_NUM, 0)) LINE_NINE,
                            SUM(DECODE(T.COUNTM_TYPE, #line_ten:VARCHAR#, COUNT_NUM, 0)) LINE_TEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_eleven:VARCHAR#, COUNT_NUM, 0)) LINE_ELEVEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_twelve:VARCHAR#, COUNT_NUM, 0)) LINE_TWELVE,
                            SUM(DECODE(T.COUNTM_TYPE, #line_thirteen:VARCHAR#, COUNT_NUM, 0)) LINE_THIRTEEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_fourteen:VARCHAR#, COUNT_NUM, 0)) LINE_FOURTEEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_fifteen:VARCHAR#, COUNT_NUM, 0)) LINE_FIFTEEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_sixteen:VARCHAR#, COUNT_NUM, 0)) LINE_SIXTEEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_seventeen:VARCHAR#, COUNT_NUM, 0)) LINE_SEVENTEEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_eighteen:VARCHAR#, COUNT_NUM, 0)) LINE_EIGHTEEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_nineteen:VARCHAR#, COUNT_NUM, 0)) LINE_NINETEEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_twenty:VARCHAR#, COUNT_NUM, 0)) LINE_TWENTY,
						]]>
		</isEqual>
		<![CDATA[
                            NVL(T.COUNT_FOURDEPT, #cpnyId:VARCHAR#) AS DEPTID
                       FROM GM_EATERY_CONFIRM T
                      WHERE T.CPNY_ID = #cpnyId:VARCHAR#
                        AND TO_CHAR(T.COUNT_DATE, 'YYYY-MM-DD') =
                            #current_date:VARCHAR#
                      GROUP BY ROLLUP(T.COUNT_FOURDEPT)) CONFIRMRECORDS
				 WHERE DE.DEPTID = MACRECODES.DEPTID(+)
                   AND DE.DEPTID = CONFIRMRECORDS.DEPTID(+)
        ]]>
		<isNotEqual prepend="AND" property="cpnyId" compareValue="78000000">
			<!-- 只有DISD才有班车 -->
			<![CDATA[
					DE.DEPT_LEVEL BETWEEN 1 AND 4
			]]>
		</isNotEqual>
		<isEqual prepend="AND" property="cpnyId" compareValue="78000000">
			<!-- 只有DISD才有班车 -->
			<![CDATA[
					DE.DEPT_LEVEL BETWEEN 1 AND 5
			]]>
		</isEqual>
		<![CDATA[
                   AND EXISTS (SELECT SAD.ADMIN_DEPTID
                       FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
                      WHERE SAD.ADMIN_NO = SA.ADMINNO
                        AND SA.ADMINID = #AdminId:VARCHAR#
                        AND SAD.ADMIN_DEPTID = DE.DEPTID))
		]]>

	</select>
	
	<select id="StatisticConfimListKO" parameterClass="SimpleMap"
		resultClass="SimpleMap" remapResults="true">
		<![CDATA[
						           
		SELECT * FROM (SELECT DE.DEPTNAME,
                    NVL(MACRECODES.LUNCHRECORDS, 0) LUNCHRECORDS,
                    NVL(MACRECODES.SUPPERRECORDS, 0) SUPPERRECORDS,
                    NVL(MACRECODES.DINNERRECORDS, 0) DINNERRECORDS,
                    NVL(MACRECODES.BREAKRECORDS, 0) BREAKRECORDS,
                    NVL(CONFIRMRECORDS.LUNCHCOUNTS, 0) LUNCHCOUNTS,
                    NVL(CONFIRMRECORDS.SUPPERCOUNTS, 0) SUPPERCOUNTS,
                    NVL(CONFIRMRECORDS.DINNERCOUNTS, 0) DINNERCOUNTS,
                    NVL(CONFIRMRECORDS.BREAKCOUNTS, 0) BREAKCOUNTS,
         ]]>
		<isEqual prepend="" property="cpnyId" compareValue="63000000">
			<!-- 只有DISD才有班车 -->
			<![CDATA[
					NVL(CONFIRMRECORDS.LINE_ONE, 0) LINE_ONE,
					NVL(CONFIRMRECORDS.LINE_TWO, 0) LINE_TWO,
					NVL(CONFIRMRECORDS.LINE_THREE, 0) LINE_THREE,
					NVL(CONFIRMRECORDS.LINE_FOUR, 0) LINE_FOUR,
					NVL(CONFIRMRECORDS.LINE_FIVE, 0) LINE_FIVE,
					NVL(CONFIRMRECORDS.LINE_SIX, 0) LINE_SIX,
					NVL(CONFIRMRECORDS.LINE_SEVEN, 0) LINE_SEVEN,
					NVL(CONFIRMRECORDS.LINE_EIGHT, 0) LINE_EIGHT,
					NVL(CONFIRMRECORDS.LINE_NINE, 0) LINE_NINE,
					NVL(CONFIRMRECORDS.LINE_TEN, 0) LINE_TEN,
					NVL(CONFIRMRECORDS.LINE_ELEVEN, 0) LINE_ELEVEN,
					NVL(CONFIRMRECORDS.LINE_TWELVE, 0) LINE_TWELVE,
					NVL(CONFIRMRECORDS.LINE_THIRTEEN, 0) LINE_THIRTEEN,
					NVL(CONFIRMRECORDS.LINE_FOURTEEN, 0) LINE_FOURTEEN,
					NVL(CONFIRMRECORDS.LINE_FIFTEEN, 0) LINE_FIFTEEN,
					NVL(CONFIRMRECORDS.LINE_SIXTEEN, 0) LINE_SIXTEEN,
					NVL(CONFIRMRECORDS.LINE_SEVENTEEN, 0) LINE_SEVENTEEN,
					NVL(CONFIRMRECORDS.LINE_EIGHTEEN, 0) LINE_EIGHTEEN,
					NVL(CONFIRMRECORDS.LINE_NINETEEN, 0) LINE_NINETEEN,
					NVL(CONFIRMRECORDS.LINE_TWENTY, 0) LINE_TWENTY,
					
			]]>
		</isEqual>
		<![CDATA[
                    DE.DEPTID
               FROM HR_DEPT_TREE_V DE,
                    (SELECT SUM(DECODE(RECORDS.TYPE, #lunch:VARCHAR#, 1, 0)) LUNCHRECORDS,
                            SUM(DECODE(RECORDS.TYPE, #supper:VARCHAR#, 1, 0)) SUPPERRECORDS,
                            SUM(DECODE(RECORDS.TYPE, #dinner:VARCHAR#, 1, 0)) DINNERRECORDS,
                            SUM(DECODE(RECORDS.TYPE, #break:VARCHAR#, 1, 0)) BREAKRECORDS,
       
                            NVL(RECORDS.DEPTID, #cpnyId:VARCHAR#) AS DEPTID
                       FROM (SELECT HR.EMPID,
                                    DE.FOURTHDEPT AS DEPTID,
                                    GET_EATERY_TYPE(TO_CHAR(T.R_TIME,
                                                            'YYYY-MM-DD HH24:MI'),
                                                    #cpnyId:VARCHAR#,
                                                    'id') TYPE
                               FROM AR_EATERY_RECORDS T,
                                    HR_EMPLOYEE       HR,
                                    HR_DEPARTMENT     DE
                              WHERE T.EMPID = HR.PERSON_ID(+)
                                AND HR.DEPTID = DE.DEPTID(+)
                                AND T.CPNY_ID = #cpnyId:VARCHAR#
                                AND TO_CHAR(T.R_TIME, 'YYYY-MM-DD') =
                                    #current_date:VARCHAR#
                                AND EXISTS
                              (SELECT SAD.ADMIN_DEPTID
                                       FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
                                      WHERE SAD.ADMIN_NO = SA.ADMINNO
                                        AND SA.ADMINID = #AdminId:VARCHAR#
                                        AND SAD.ADMIN_DEPTID = HR.DEPTID)) RECORDS
                      GROUP BY ROLLUP(RECORDS.DEPTID)) MACRECODES,
                    (SELECT SUM(DECODE(T.COUNTM_TYPE, #lunch:VARCHAR#, COUNT_NUM, 0)) LUNCHCOUNTS,
                            SUM(DECODE(T.COUNTM_TYPE, #supper:VARCHAR#, COUNT_NUM, 0)) SUPPERCOUNTS,
                            SUM(DECODE(T.COUNTM_TYPE, #dinner:VARCHAR#, COUNT_NUM, 0)) DINNERCOUNTS,
                            SUM(DECODE(T.COUNTM_TYPE, #break:VARCHAR#, COUNT_NUM, 0)) BREAKCOUNTS,
                ]]>
		<isEqual prepend="" property="cpnyId" compareValue="63000000">
			<!-- 只有DISD才有班车 -->
			<![CDATA[
							SUM(DECODE(T.COUNTM_TYPE, #line_one:VARCHAR#, COUNT_NUM, 0)) LINE_ONE,
                            SUM(DECODE(T.COUNTM_TYPE, #line_two:VARCHAR#, COUNT_NUM, 0)) LINE_TWO,
                            SUM(DECODE(T.COUNTM_TYPE, #line_three:VARCHAR#, COUNT_NUM, 0)) LINE_THREE,
                            SUM(DECODE(T.COUNTM_TYPE, #line_four:VARCHAR#, COUNT_NUM, 0)) LINE_FOUR,
                            SUM(DECODE(T.COUNTM_TYPE, #line_five:VARCHAR#, COUNT_NUM, 0)) LINE_FIVE,
                            SUM(DECODE(T.COUNTM_TYPE, #line_six:VARCHAR#, COUNT_NUM, 0)) LINE_SIX,
                            SUM(DECODE(T.COUNTM_TYPE, #line_seven:VARCHAR#, COUNT_NUM, 0)) LINE_SEVEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_eight:VARCHAR#, COUNT_NUM, 0)) LINE_EIGHT,
                            SUM(DECODE(T.COUNTM_TYPE, #line_nine:VARCHAR#, COUNT_NUM, 0)) LINE_NINE,
                            SUM(DECODE(T.COUNTM_TYPE, #line_ten:VARCHAR#, COUNT_NUM, 0)) LINE_TEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_eleven:VARCHAR#, COUNT_NUM, 0)) LINE_ELEVEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_twelve:VARCHAR#, COUNT_NUM, 0)) LINE_TWELVE,
                            SUM(DECODE(T.COUNTM_TYPE, #line_thirteen:VARCHAR#, COUNT_NUM, 0)) LINE_THIRTEEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_fourteen:VARCHAR#, COUNT_NUM, 0)) LINE_FOURTEEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_fifteen:VARCHAR#, COUNT_NUM, 0)) LINE_FIFTEEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_sixteen:VARCHAR#, COUNT_NUM, 0)) LINE_SIXTEEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_seventeen:VARCHAR#, COUNT_NUM, 0)) LINE_SEVENTEEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_eighteen:VARCHAR#, COUNT_NUM, 0)) LINE_EIGHTEEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_nineteen:VARCHAR#, COUNT_NUM, 0)) LINE_NINETEEN,
                            SUM(DECODE(T.COUNTM_TYPE, #line_twenty:VARCHAR#, COUNT_NUM, 0)) LINE_TWENTY,
						]]>
		</isEqual>
		<![CDATA[
                            NVL(T.COUNT_FOURDEPT, #cpnyId:VARCHAR#) AS DEPTID
                       FROM GM_EATERY_KO_CONFIRM T
                      WHERE T.CPNY_ID = #cpnyId:VARCHAR#
                        AND TO_CHAR(T.COUNT_DATE, 'YYYY-MM-DD') =
                            #current_date:VARCHAR#
                      GROUP BY ROLLUP(T.COUNT_FOURDEPT)) CONFIRMRECORDS
				 WHERE DE.DEPTID = MACRECODES.DEPTID(+)
                   AND DE.DEPTID = CONFIRMRECORDS.DEPTID(+)
        ]]>
		<isNotEqual prepend="AND" property="cpnyId" compareValue="78000000">
			<!-- 只有DISD才有班车 -->
			<![CDATA[
					DE.DEPT_LEVEL BETWEEN 1 AND 4
			]]>
		</isNotEqual>
		<isEqual prepend="AND" property="cpnyId" compareValue="78000000">
			<!-- 只有DISD才有班车 -->
			<![CDATA[
					DE.DEPT_LEVEL BETWEEN 1 AND 5
			]]>
		</isEqual>
		<![CDATA[
                   AND EXISTS (SELECT SAD.ADMIN_DEPTID
                       FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
                      WHERE SAD.ADMIN_NO = SA.ADMINNO
                        AND SA.ADMINID = #AdminId:VARCHAR#
                        AND SAD.ADMIN_DEPTID = DE.DEPTID))
		]]>

	</select>

	<insert id="insertStatistic" parameterClass="SimpleMap">
		<![CDATA[
			insert into gm_eatery_confirm (EAT_CONFIRM_ID,EAT_CONFIRM_EATERY,EAT_CONFIRM_DEPT,EAT_CONFIRM_DATE,EAT_CONFIRM_PEOPLE,EAT_DATE) 
			values(GM_EATERY_CONFIRM_SEQ.NEXTVAL,#eateryno#,#deptid#,TO_DATE(#EAT_CONFIRM_DATE#,'YYYY-MM-DD'),#PeopleNum#,TO_DATE(#EAT_DATE#,'YYYY-MM-DD'))
		]]>
	</insert>
	<select id="allVisiterApproval1" parameterClass="SimpleMap"
		resultClass="string">
		<![CDATA[
			 select affirm.affirm_flag
			  from HR_EMPLOYEE HR, ga_card_application_affirm affirm
			 where affirm.apply_no = #applyno:VARCHAR#
			   and affirm.affirmor_id = hr.empid
			   and affirm.affirm_level =
			       (select a.affirm_level
			          from (select affirm.apply_no,
			                       affirm.ga_affirm_no,
			                       hr.chinesename,
			                       hr.empid,
			                       affirm.affirm_flag,
			                       affirm.affirm_level
			                  from HR_EMPLOYEE HR, ga_card_application_affirm affirm
			                 where affirm.apply_no = #applyno:VARCHAR#
			                   and empid = #affirmorid:VARCHAR#
			                   and affirm.affirmor_id = hr.empid
			                 order by affirm.affirm_level) a) + 1
	  	]]>
	</select>

	<select id="allVisiterApproval2" parameterClass="SimpleMap"
		resultClass="string">
		<![CDATA[
			 select affirm.affirm_flag
			  from HR_EMPLOYEE HR, ga_card_application_affirm affirm
			 where affirm.apply_no = #applyno:VARCHAR#
			   and affirm.affirmor_id = hr.empid
			   and affirm.affirm_level =
			       (select a.affirm_level
			          from (select affirm.apply_no,
			                       affirm.ga_affirm_no,
			                       hr.chinesename,
			                       hr.empid,
			                       affirm.affirm_flag,
			                       affirm.affirm_level
			                  from HR_EMPLOYEE HR, ga_card_application_affirm affirm
			                 where affirm.apply_no = #applyno:VARCHAR#
			                   and empid = #affirmorid:VARCHAR#
			                   and affirm.affirmor_id = hr.empid
			                 order by affirm.affirm_level) a) - 1
	  	]]>
	</select>

	<select id="getTopAffirmId" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
		select affirm.affirmor_id,HR.chinesename
			  from HR_EMPLOYEE HR, ga_card_application_affirm affirm
			 where affirm.apply_no = #applyno:VARCHAR#
			   and affirm.affirmor_id = hr.empid
			   and affirm.affirm_level =
			       (select a.affirm_level
			          from (select affirm.apply_no,
			                       affirm.ga_affirm_no,
			                       hr.chinesename,
			                       hr.empid,
			                       affirm.affirm_flag,
			                       affirm.affirm_level
			                  from HR_EMPLOYEE HR, ga_card_application_affirm affirm
			                 where affirm.apply_no = #applyno:VARCHAR#
			                   and empid = #affirmorid:VARCHAR#
			                   and affirm.affirmor_id = hr.empid
			                 order by affirm.affirm_level) a) + 1
		]]>
	</select>


	<update id="StatisticConfim" parameterClass="SimpleMap">
		<![CDATA[
		UPDATE gm_eatery_confirm T
				SET T.FLAG=#updateFlag:VARCHAR#
				WHERE  t.cpny_id = #cpnyId:VARCHAR#
				 AND to_char(t.count_date, 'YYYY-MM-DD') = #current_date:VARCHAR#
				 AND    EXISTS
                         (SELECT SAD.ADMIN_DEPTID
                                  FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
                                 WHERE SAD.ADMIN_NO = SA.ADMINNO
                                   AND SA.ADMINID =  #adminId:VARCHAR#
                                   AND SAD.ADMIN_DEPTID = T.COUNT_DEPT) 
		  ]]>
	</update>
	<update id="StatisticConfimKO" parameterClass="SimpleMap">
		<![CDATA[
		UPDATE gm_eatery_ko_confirm T
				SET T.FLAG=#updateFlag:VARCHAR#
				WHERE  t.cpny_id = #cpnyId:VARCHAR#
				 AND to_char(t.count_date, 'YYYY-MM-DD') = #current_date:VARCHAR#
				 AND    EXISTS
                         (SELECT SAD.ADMIN_DEPTID
                                  FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
                                 WHERE SAD.ADMIN_NO = SA.ADMINNO
                                   AND SA.ADMINID =  #adminId:VARCHAR#
                                   AND SAD.ADMIN_DEPTID = T.COUNT_DEPT) 
		  ]]>
	</update>
	<select id="StatisticFlag" parameterClass="SimpleMap"
		resultClass="int">
		<![CDATA[
		select count(*) counts from gm_eatery_confirm T     
		       where t.cpny_id = #cpnyId:VARCHAR#
		       and T.FLAG=1
		                   and to_char(t.count_date, 'YYYY-MM-DD') = #current_date:VARCHAR#
		         AND    EXISTS
		                         (SELECT SAD.ADMIN_DEPTID
		                                  FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
		                                 WHERE SAD.ADMIN_NO = SA.ADMINNO
		                                   AND SA.ADMINID =  #AdminId:VARCHAR#
		                                   AND SAD.ADMIN_DEPTID = T.COUNT_DEPT) 	
		  ]]>
	</select>
	<select id="StatisticFlagKO" parameterClass="SimpleMap"
		resultClass="int">
		<![CDATA[
		select count(*) counts from gm_eatery_ko_confirm T     
		       where t.cpny_id = #cpnyId:VARCHAR#
		       and T.FLAG=1
		                   and to_char(t.count_date, 'YYYY-MM-DD') = #current_date:VARCHAR#
		         AND    EXISTS
		                         (SELECT SAD.ADMIN_DEPTID
		                                  FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
		                                 WHERE SAD.ADMIN_NO = SA.ADMINNO
		                                   AND SA.ADMINID =  #AdminId:VARCHAR#
		                                   AND SAD.ADMIN_DEPTID = T.COUNT_DEPT) 	
		  ]]>
	</select>
	<select id="getapplyemail" parameterClass="SimpleMap"
		resultClass="string">
		<![CDATA[	
select email from hr_employee where person_id=#applerId:VARCHAR#
    ]]>
	</select>

	<select id="getupaffrimemail" parameterClass="SimpleMap"
		resultClass="string">
		<![CDATA[	
select  h.email
from ga_card_application_affirm t,hr_employee h
where  t.apply_no=#card_id:VARCHAR# 
and t.affirmor_id = h.empid 
and t.affirm_level = #affrimlevel:VARCHAR# + 1 
order by t.affirm_level
    ]]>
	</select>

	<select id="getupaffrimemail1" parameterClass="SimpleMap"
		resultClass="string">
		<![CDATA[	
select  h.email
from ga_voiture_affirm t,hr_employee h
where  t.apply_no=#applyno:VARCHAR# 
and t.affirmor_id = h.person_id 
and t.affirm_level = #affrimlevel:numeric# + 1 
order by t.affirm_level
    ]]>
	</select>
	
	<select id="getupaffrimemaildriverot" parameterClass="SimpleMap"
		resultClass="string">
		<![CDATA[	
			select  h.email
			from ga_driver_ot_affirm t,hr_employee h
			where  t.apply_no=#applyno:VARCHAR# 
			and t.affirmor_id = h.person_id 
			and t.affirm_level = #affrimlevel:numeric# + 1 
			order by t.affirm_level
    ]]>
	</select>
	
	<select id="getupaffrimemailbusarrange" parameterClass="SimpleMap"
		resultClass="string">
		<![CDATA[	
			select  h.email
			from ga_bus_arrange_affirm t,hr_employee h
			where  t.apply_no=#applyno:VARCHAR# 
			and t.affirmor_id = h.person_id 
			and t.affirm_level = #affrimlevel:numeric# + 1 
			order by t.affirm_level
    ]]>
	</select>

	<update id="confirmExpressAffirm" parameterClass="SimpleMap">
		<![CDATA[
update ga_card_application_affirm  set AFFIRM_FLAG=#AFFIRM_FLAG:NUMERIC#
where  ga_affirm_no=#affirmno:NUMERIC#
  ]]>
	</update>
	<update id="confirmExpressApply" parameterClass="SimpleMap">
		<![CDATA[
update ga_card_application  set active=#AFFIRM_FLAG:NUMERIC#
where card_id=#card_id:NUMERIC#
  ]]>
	</update>
	<update id="updateVoitureApply">
		<![CDATA[
		update GA_VOITURE_APPLY  set active=#flag:varchar#
		where VOITURE_APPLYID=#applyno:NUMERIC#
	  ]]>
	</update>
	<update id="updateVoitureAffirm">
		<![CDATA[
		update GA_VOITURE_AFFIRM  set AFFIRM_FLAG=#flag:varchar#,AFFIRMORIDEA = #affirmorIdea:varchar#
		where ID=#affirmNo:NUMERIC#
	  ]]>
	</update>
	<update id="updateDriverOtApply">
		<![CDATA[
		update ga_driver_ot_apply  set active=#flag:varchar#
		where DRIVER_OT_APPLYID=#applyno:NUMERIC#
	  ]]>
	</update>
	<update id="updateBusArrangeApply">
		<![CDATA[
		update ga_bus_arrange_apply  set active=#flag:varchar#
		where bus_arrange_applyid=#applyno:NUMERIC#
	  ]]>
	</update>
	<update id="updateDriverOtAffirm">
		<![CDATA[
		update GA_DRIVER_OT_AFFIRM  set AFFIRM_FLAG=#flag:varchar#,AFFIRMORIDEA = #affirmorIdea:varchar#
		where ID=#affirmNo:NUMERIC#
	  ]]>
	</update>
	<update id="updateBusArrangeAffirm">
		<![CDATA[
		update GA_BUS_ARRANGE_AFFIRM  set AFFIRM_FLAG=#flag:varchar#,AFFIRMORIDEA = #affirmorIdea:varchar#
		where ID=#affirmNo:NUMERIC#
	  ]]>
	</update>

	<select id="getVoitureListInt" parameterClass="SimpleMap"
		resultClass="int">
		<![CDATA[	
	select count(*)
  from ga_voiture_apply t,
  hr_employee he
 where t.voiture_applyid in
       (select distinct a.apply_no
          from ga_voiture_affirm a
         where a.active = 1)
        ]]>
		<isNotEmpty prepend="AND" property="applerId">
			<![CDATA[
			EXISTS ( SELECT SAD.ADMIN_DEPTID
				   FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
				  WHERE SAD.ADMIN_NO = SA.ADMINNO
				    AND SA.ADMINID = #applerId:VARCHAR2#
				    AND SAD.ADMIN_DEPTID = t.APPLYER_DEPTNAME	
			   ) 
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="ADMIN_ID">
			<![CDATA[		
			   t.APPLYER_ID = #ADMIN_ID:varchar#
		]]>
		</isNotEmpty>
		<isEqual prepend="AND" property="qryType" compareValue="0">
			<![CDATA[
						  t.active = 0
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="1">
			<!-- 决裁通过的 -->
			<![CDATA[
						 t.active = 1
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="2">
			<!-- 决裁否决的 -->
			<![CDATA[
						t.active =2
			]]>
		</isEqual>

		<isNotEmpty prepend="AND" property="key">
			<![CDATA[		   
		 (t.applyer_id LIKE  '%'||#key:VARCHAR# || '%'   or he.chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deptid">
			<![CDATA[		   
		 	he.deptid=#deptid:VARCHAR#
		]]>
		</isNotEmpty>
		
		 <isNotEmpty prepend="AND" property="cpnyId">
		<![CDATA[		   
		 he.cpny_id=#cpnyId:VARCHAR#
		]]>	
	</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		 t.APPLY_DATE >= to_date(#startDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			<![CDATA[		   
		 t.APPLY_ENDDATE <= to_date(#endDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<![CDATA[
         and he.person_id = t.applyer_id
    ]]>
	</select>

	<select id="getVoitureListList" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[	
	select t.VOITURE_APPLYID,
		he.chinesename,
		to_char(t.CREATE_DATE,'YYYY-MM-DD HH24:MI:SS') as CREATE_DATE,
		t.APPLYER_ID,
       dt.DEPTNAME as applyer_deptname,
       to_char(t.apply_date, 'YYYY-MM-DD') as APPLY_DATE,
       t.apply_starttime,
       to_char(t.apply_enddate, 'YYYY-MM-DD') as APPLY_ENDDATE,
       t.apply_endtime,
       t.apply_userscount,
       t.DEPARTURES,
       t.DESTINATIONS,
       t.KILOMETER,
       t.LARDER,
       t.PURPOSE,
       t.DRIVERFLAG,
       t.MODIFY_FLAG,
       t.ACTIVE,
        t.confirmidea,
       hr.chinesename as chinesename1,
       t.active
  from ga_voiture_apply t,
  hr_employee he,
   hr_department dt,hr_employee hr
 where hr.person_id(+) = t.confirmorid
   and t.voiture_applyid in
       (select distinct a.apply_no
          from ga_voiture_affirm a
         where a.active = 1)
        ]]>

		<isNotEmpty prepend="AND" property="applerId">
			<![CDATA[
			EXISTS ( SELECT SAD.ADMIN_DEPTID
				   FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
				  WHERE SAD.ADMIN_NO = SA.ADMINNO
				    AND SA.ADMINID = #applerId:VARCHAR2#
				    AND SAD.ADMIN_DEPTID = t.APPLYER_DEPTNAME	
			   ) 
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="ADMIN_ID">
			<![CDATA[		
			   t.APPLYER_ID = #ADMIN_ID:varchar#
		]]>
		</isNotEmpty>
		
		<isEqual prepend="AND" property="qryType" compareValue="0">
			<![CDATA[
						  t.active = 0
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="1">
			<!-- 决裁通过的 -->
			<![CDATA[
						 t.active = 1
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="2">
			<!-- 决裁否决的 -->
			<![CDATA[
						t.active =2
			]]>
		</isEqual>
		<isNotEmpty prepend="AND" property="key">
			<![CDATA[		   
		 (t.applyer_id LIKE  '%'||#key:VARCHAR# || '%'   or he.chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deptid">
			<![CDATA[		   
		 t.APPLYER_DEPTNAME=#deptid:VARCHAR#
		]]>
		</isNotEmpty>
		
		 <isNotEmpty prepend="AND" property="cpnyId">
		<![CDATA[		   
		 he.cpny_id=#cpnyId:VARCHAR#
		]]>	
	</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		 t.APPLY_DATE >= to_date(#startDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			<![CDATA[		   
		 t.APPLY_ENDDATE <= to_date(#endDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<![CDATA[
         and he.person_id = t.applyer_id
          and dt.DEPTID = t.applyer_deptname
          and t.create_date is not null
         order by t.create_date desc,t.apply_starttime desc
    ]]>
	</select>
	
	<select id="getDriverOtListList" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[	
	select 
				T.DRIVER_OT_APPLYID,
				t.applyer_id,
				t.applyer_chinesename,
				t.driver_id,
			    t.driver_chinesename,
			    s.code_name as driver_ot_type_name,
			    s1.code_name as ot_type_name,
				to_char(t.apply_date,'YYYY-MM-DD') as apply_date,
				to_char(t.apply_startdate,'YYYY-MM-DD') as apply_startdate,
				t.apply_starttime,
				to_char(t.apply_enddate,'YYYY-MM-DD') as apply_enddate,
				t.apply_endtime,
				t.reason,
				t.remark,
				t.active,
				t.ot_length,
				to_char(t.CREATE_DATE,'YYYY-MM-DD HH24:MI:SS') as CREATE_DATE
				 from GA_DRIVER_OT_APPLY t,
				  sy_code s,
				  sy_code s1,
				  hr_employee he
				 where  t.DRIVER_OT_APPLYID in
				       (select distinct a.apply_no
				          from GA_DRIVER_OT_AFFIRM a
				         where a.active = 1)
				        and t.DRIVER_OT_TYPE = s.code_id(+)
				        and t.OTTYPE = s1.code_id(+)
        ]]>

		
		<isNotEmpty prepend="AND" property="ADMIN_ID">
			<![CDATA[		
			   t.APPLYER_ID = #ADMIN_ID:varchar#
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="driverOtType">
			<![CDATA[		
			   t.DRIVER_OT_TYPE = #driverOtType:varchar#
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="OTTypeCode">
			<![CDATA[		
			   t.OTTYPE = #OTTypeCode:varchar#
		]]>
		</isNotEmpty>

		<isEqual prepend="AND" property="qryType" compareValue="0">
			<![CDATA[
						 t.active = 0
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="1">
			<!-- 决裁通过的 -->
			<![CDATA[
						  t.active = 1
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="2">
			<!-- 决裁否决的 -->
			<![CDATA[
						 t.active = 2
			]]>
		</isEqual>
		<isNotEmpty prepend="AND" property="key">
			<![CDATA[		   
		 (t.driver_chinesename LIKE  '%'||#key:VARCHAR# || '%'   or t.applyer_chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		 t.APPLY_STARTDATE >= to_date(#startDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			<![CDATA[		   
		 t.APPLY_ENDDATE <= to_date(#endDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<![CDATA[
         and he.person_id = t.applyer_id
         order by t.DRIVER_OT_APPLYID desc
    ]]>
	</select>
	
	
	<select id="getBusArrangeListList" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[	
	      select 
			    t.bus_arrange_applyid,
		        t.applyer_id,
		        t.applyer_chinesename,
		        t.driver_id,
		        t.driver_chinesename,
		        s.code_name as bus,
		        s1.code_name as bus_area,
		        to_char(t.apply_startdate,'YYYY-MM-DD') as apply_startdate,
		        t.apply_starttime,
		        to_char(t.arrive_date,'YYYY-MM-DD') as arrive_date,
		        t.arrive_time,
		        t.seatnum,
		        t.ridenum,
		        nvl(t.ridenum/t.seatnum,0) as ridepercent,
		        decode(least(to_number(replace(arrive_time,':','')),745),'745',1,0) as arrive_time_flag,
		        t.remark,
		        t.active,
		        to_char(t.create_date,'YYYY-MM-DD') as create_date
				 from GA_bus_arrange_APPLY t,
				  sy_code s,
				  sy_code s1,
				  hr_employee he
				 where  t.bus_arrange_applyid in
				       (select distinct a.apply_no
				          from GA_BUS_ARRANGE_AFFIRM a
				         where a.active = 1)
				        and t.bus = s.code_id(+)
				        and t.bus_area = s1.code_id(+)
        ]]>

		
		<isNotEmpty prepend="AND" property="ADMIN_ID">
			<![CDATA[		
			   t.APPLYER_ID = #ADMIN_ID:varchar#
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="busAreaType">
		<![CDATA[		   
		  t.bus_area = #busAreaType:VARCHAR#
		]]>	
		</isNotEmpty>	
		
		<isNotEmpty prepend="AND" property="busTypeCode">
			<![CDATA[		   
			 t.bus = #busTypeCode:VARCHAR#
			]]>	
		</isNotEmpty>	
		
         <isEqual prepend="AND" property="arriveType" compareValue="1">
			<![CDATA[
						 decode(least(to_number(replace(t.arrive_time,':','')),745),'745',1,0) = 1
			]]>
		</isEqual>	

		<isEqual prepend="AND" property="arriveType" compareValue="0">
			<![CDATA[
						 decode(least(to_number(replace(t.arrive_time,':','')),745),'745',1,0) = 0
			]]>
		</isEqual>
		
		<isEqual prepend="AND" property="qryType" compareValue="0">
			<![CDATA[
						 t.active = 0
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="1">
			<!-- 决裁通过的 -->
			<![CDATA[
						  t.active = 1
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="2">
			<!-- 决裁否决的 -->
			<![CDATA[
						 t.active = 2
			]]>
		</isEqual>
		<isNotEmpty prepend="AND" property="key">
			<![CDATA[		   
		 (t.driver_chinesename LIKE  '%'||#key:VARCHAR# || '%'   or t.applyer_chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		 t.APPLY_STARTDATE >= to_date(#startDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			<![CDATA[		   
		 t.ARRIVE_DATE <= to_date(#endDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<![CDATA[
         and he.person_id = t.applyer_id
         order by t.bus_arrange_applyid desc
    ]]>
	</select>
	
	<select id="getDriverOtListInt" parameterClass="SimpleMap"
		resultClass="int">
		<![CDATA[	
	         select count(*)
				 from GA_DRIVER_OT_APPLY t,
				  hr_employee he
				 where  t.DRIVER_OT_APPLYID in
				       (select distinct a.apply_no
				          from GA_DRIVER_OT_AFFIRM a
				         where a.active = 1)
        ]]>

		
		<isNotEmpty prepend="AND" property="ADMIN_ID">
			<![CDATA[		
			   t.APPLYER_ID = #ADMIN_ID:varchar#
		]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="driverOtType">
			<![CDATA[		
			   t.DRIVER_OT_TYPE = #driverOtType:varchar#
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="OTTypeCode">
			<![CDATA[		
			   t.OTTYPE = #OTTypeCode:varchar#
		]]>
		</isNotEmpty>

		<isEqual prepend="AND" property="qryType" compareValue="0">
			<![CDATA[
						 t.active = 0
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="1">
			<!-- 决裁通过的 -->
			<![CDATA[
						   t.active = 1
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="2">
			<!-- 决裁否决的 -->
			<![CDATA[
						  t.active = 2
			]]>
		</isEqual>
		<isNotEmpty prepend="AND" property="key">
			<![CDATA[		   
		 (t.driver_chinesename LIKE  '%'||#key:VARCHAR# || '%'   or t.applyer_chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		 t.APPLY_STARTDATE >= to_date(#startDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			<![CDATA[		   
		 t.APPLY_ENDDATE <= to_date(#endDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<![CDATA[
         and he.person_id = t.applyer_id
         
 order by t.DRIVER_OT_APPLYID desc
    ]]>
	</select>
	
	<select id="getBusArrangeListInt" parameterClass="SimpleMap"
		resultClass="int">
		<![CDATA[	
	         select count(*)
				from GA_bus_arrange_APPLY t,
				  sy_code s,
				  sy_code s1,
				  hr_employee he
				 where  t.bus_arrange_applyid in
				       (select distinct a.apply_no
				          from GA_BUS_ARRANGE_AFFIRM a
				         where a.active = 1)
				        and t.bus = s.code_id(+)
				        and t.bus_area = s1.code_id(+)
        ]]>

		
		<isNotEmpty prepend="AND" property="ADMIN_ID">
			<![CDATA[		
			   t.APPLYER_ID = #ADMIN_ID:varchar#
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="busAreaType">
		<![CDATA[		   
		  t.bus_area = #busAreaType:VARCHAR#
		]]>	
		</isNotEmpty>	
		
		<isNotEmpty prepend="AND" property="busTypeCode">
			<![CDATA[		   
			 t.bus = #busTypeCode:VARCHAR#
			]]>	
		</isNotEmpty>	

        <isEqual prepend="AND" property="arriveType" compareValue="1">
			<![CDATA[
						 decode(least(to_number(replace(t.arrive_time,':','')),745),'745',1,0) = 1
			]]>
		</isEqual>	

		<isEqual prepend="AND" property="arriveType" compareValue="0">
			<![CDATA[
						 decode(least(to_number(replace(t.arrive_time,':','')),745),'745',1,0) = 0
			]]>
		</isEqual>
		
		<isEqual prepend="AND" property="qryType" compareValue="0">
			<![CDATA[
						 t.active = 0
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="1">
			<!-- 决裁通过的 -->
			<![CDATA[
						  t.active = 1
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="2">
			<!-- 决裁否决的 -->
			<![CDATA[
						 t.active = 2
			]]>
		</isEqual>
		<isNotEmpty prepend="AND" property="key">
			<![CDATA[		   
		 (t.driver_chinesename LIKE  '%'||#key:VARCHAR# || '%'   or t.applyer_chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		 t.APPLY_STARTDATE >= to_date(#startDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			<![CDATA[		   
		 t.ARRIVE_DATE <= to_date(#endDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<![CDATA[
         and he.person_id = t.applyer_id
         order by t.bus_arrange_applyid desc
    ]]>
	</select>
	
	<select id="allvoitureApproval" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
		select t.id,
       t.affirm_flag,
       t.apply_no,
       t.affirm_level,
       t.affirmor_id,
       hr.chinesename,
       CASE WHEN 
       T.AFFIRM_LEVEL=MAX_AFFIRM_TABLE.MAX_AFFIRM_LEVEL
       THEN 1
       ELSE 0
       END MAX_AFFIRM_FLAG,
       AFFIRMORIDEA
  from ga_voiture_affirm t,
       hr_employee hr,
       (select  max(affirm.affirm_level) MAX_AFFIRM_LEVEL
          from ga_voiture_affirm affirm
         WHERE affirm.apply_no=#applyId:NUMERIC#
        ) MAX_AFFIRM_TABLE
 where t.affirmor_id = hr.person_id
   and t.apply_no = #applyId:NUMERIC#
 order by t.affirm_level

	  	]]>
	</select>
	<select id="getDistinctionList" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
	select t.distinction_id,
       t.distinction,
       to_char(t.apply_date,'YYYY-MM-DD') as apply_date,
       t.apply_starttime,
       to_char(t.apply_date,'YYYY-MM-DD') as end_date,
       t.apply_endtime,
       t.content,
       t.drive_way,
       t.apply_no,
       t.note,
       t.create_date
  from ga_voiture_apply_distinction t 
  where t.apply_no = #applyId:NUMERIC#
 order by  t.distinction 
	
	]]>

	</select>
	
	<select id="allDriverOtApproval" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
		select t.id,
       t.affirm_flag,
       t.apply_no,
       t.affirm_level,
       t.affirmor_id,
       hr.chinesename,
       CASE WHEN 
       T.AFFIRM_LEVEL=MAX_AFFIRM_TABLE.MAX_AFFIRM_LEVEL
       THEN 1
       ELSE 0
       END MAX_AFFIRM_FLAG,
       AFFIRMORIDEA
  from ga_driver_ot_affirm t,
       hr_employee hr,
       (select  max(affirm.affirm_level) MAX_AFFIRM_LEVEL
          from ga_driver_ot_affirm affirm
         WHERE affirm.apply_no=#applyId:NUMERIC#
        ) MAX_AFFIRM_TABLE
 where t.affirmor_id = hr.person_id
   and t.apply_no = #applyId:NUMERIC#
 order by t.affirm_level

	  	]]>
	</select>
	
	<select id="allBusArrangeApproval" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
		select t.id,
       t.affirm_flag,
       t.apply_no,
       t.affirm_level,
       t.affirmor_id,
       hr.chinesename,
       CASE WHEN 
       T.AFFIRM_LEVEL=MAX_AFFIRM_TABLE.MAX_AFFIRM_LEVEL
       THEN 1
       ELSE 0
       END MAX_AFFIRM_FLAG,
       AFFIRMORIDEA
  from ga_bus_arrange_affirm t,
       hr_employee hr,
       (select  max(affirm.affirm_level) MAX_AFFIRM_LEVEL
          from ga_bus_arrange_affirm affirm
         WHERE affirm.apply_no=#applyId:NUMERIC#
        ) MAX_AFFIRM_TABLE
 where t.affirmor_id = hr.person_id
   and t.apply_no = #applyId:NUMERIC#
 order by t.affirm_level

	  	]]>
	</select>

	<delete id="delvoiture" parameterClass="SimpleMap">
		<![CDATA[
	 delete ga_voiture_apply y where y.voiture_applyid=#applyNo:VARCHAR#
	
	]]>
	</delete>

	<delete id="delvoiture1" parameterClass="SimpleMap">
		<![CDATA[
	 delete ga_voiture_affirm y where y.Apply_No=#applyNo:VARCHAR#
	
	]]>
	</delete>

	<select id="getCar_name" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
	 select t.DRIVER,e.VOITURE_BRAND,e.VOITURE_NUMBER ,t.DRIVER_PHONE
	 from ga_booking_voiture t,GA_VOITURE e where t.applyno=#applyId:VARCHAR#  and e.voiture_id=t.vehicle
	
	]]>

	</select>
	<select id="getVoitureApplyInfo1" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
	 select y.voiture_applyid, 
	        y.apply_userscount,
	        dt.DEPTNAME as applyer_deptname,
	        y.Purpose,E.CHINESENAME,
	        y.larder_deptname,
	        y.larder,
	        y.larder_post,
	        y.tell_phone
  		from ga_voiture_apply y,hr_employee e,hr_department dt
 		where y.voiture_applyid = #LEAVE_NO:VARCHAR# and y.applyer_id=e.person_id and y.applyer_deptname=dt.DEPTID
	
	]]>
	</select>
	<select id="getCarList" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
	 select t.voiture_id,t.voiture_brand,t.voiture_number from ga_voiture t where t.cpny_id=#cpny_id:varchar#
	]]>
	</select>
	<select id="getRy" parameterClass="SimpleMap" resultClass="int">
		<![CDATA[
	select sum(t.amount) from ga_voiture_expense t,ga_voiture e where t.causes=#code:varchar#  and t.voitureno=e.voiture_id and e.cpny_id=#cpny_id:varchar#
	and to_date(#stratdate:varchar#,'YYYY-MM-DD') <t.timing_date and to_date(#enddate:varchar#,'YYYY-MM-DD')>t.timing_date and t.VOITURENO=#voiture_id:varchar#
	]]>
	</select>
	<select id="getRyInt" parameterClass="SimpleMap"
		resultClass="int">
		<![CDATA[
	select count(e.vehicle) from ga_booking_voiture e WHERE to_date(#stratdate:varchar#,'YYYY-MM-DD') <e.booking_date and to_date(#enddate:varchar#,'YYYY-MM-DD')>e.booking_date and e.vehicle=#voiture_id:varchar#
	]]>
	</select>
	<select id="getVoiTureDetail" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
	select g.voiture_brand,
   g.voiture_number,
   m.chinesename,
   pt.deptname,
   y.APPLY_USERSCOUNT,
   y.DEPARTURES,
   y.DESTINATIONS,
   y.KILOMETER,
   y.PURPOSE,
   e.driver as driver_name,
   to_char(e.BOOKING_DATE,'YYYY-MM-DD') as BOOKING_DATE
    from ga_booking_voiture e,
   ga_voiture_apply   y,
   ga_voiture         g,
   hr_employee        m,
   hr_department      pt
   WHERE e.applyno = y.voiture_applyid
     and e.vehicle = g.voiture_id
     and y.applyer_id = m.person_id
     and m.deptid = pt.deptid and g.cpny_id=#cpny_id:varchar#
     and to_date(#stratdate:varchar#, 'YYYY-MM-DD') <= e.booking_date
     and to_date(#enddate:varchar#, 'YYYY-MM-DD') >= e.booking_date
     order by e.booking_date
	]]>
	</select>

	<insert id="arrangementAdd" parameterClass="SimpleMap">
		INSERT INTO GM_EATERY_ARRANGEMENT ( PKNO, ARRANGEMENT_DATE,
		EATERY_TYPE, FOOD_TYPE, NUM, FLAG, REMARK, CREATE_BY,
		CREATE_DATE, CPNY_ID, DIFF )VALUES(
		GM_EATERY_ARRANGEMENT_SEQ.NEXTVAL,
		TO_DATE(#arrangementDate:VARCHAR#,'YYYY-MM-DD'),
		#eateryType:NUMERIC#, #foodType:VARCHAR#, #num:NUMERIC#,
		#flag:NUMERIC#, #Remarks:VARCHAR#, #adminId:VARCHAR#, SYSDATE,
		#cpnyId:VARCHAR#, #diff:VARCHAR# )

	</insert>
	<insert id="arrangementDelete" parameterClass="SimpleMap">
		DELETE FROM GM_EATERY_ARRANGEMENT WHERE
		arrangement_date=TO_DATE(#arrangementDate:VARCHAR#,'YYYY-MM-DD')
		AND CPNY_ID=#cpnyId:VARCHAR#

	</insert>

	<select id="arrangementViewCount" parameterClass="SimpleMap"
		resultClass="int">

		select count(*) from ( select distinct t.arrangement_date from
		gm_eatery_arrangement t where t.cpny_id=#cpnyId:VARCHAR#
		<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		     t.arrangement_date between to_date(#startDate:VARCHAR#,'YYYY-MM-DD') and to_date(#endDate:VARCHAR#,'YYYY-MM-DD')	
		    ]]>
		</isNotEmpty>
		<![CDATA[	 
		 )
		]]>

	</select>

	<select id="CheckArrangement" parameterClass="SimpleMap"
		resultClass="int">
		select count(*) from gm_eatery_arrangement t where
		t.arrangement_date=to_date(#arrangementDate:VARCHAR#,'YYYY-MM-DD')
		and t.cpny_id=#cpnyId:VARCHAR#
	</select>


	<select id="arrangementViewList" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[		
				select to_char(base.arrangement_date, 'YYYY-MM-DD') arrangement_date,
				       base.remark,
				       break.chinesenum breakchinesenum,
				       decode(break.chineseflag, 1, '供餐', '无供餐') breakchineseflag,
				       lunch.chinesenum lunchchinesenum,
				       decode(lunch.chineseflag, 1, '供餐', '无供餐') lunchchineseflag,
				       lunch.koreannum lunchkoreannum,
				       decode(lunch.koreanflag, 1, '供餐', '无供餐') lunchkoreanflag,
				       supper.chinesenum supperinesenum,
				       decode(supper.chineseflag, 1, '供餐', '无供餐') supperchineseflag,
				       supper.koreannum supperkoreannum,
				       decode(supper.koreanflag, 1, '供餐', '无供餐') supperkoreanflag,
				       dinner.chinesenum dinnerchinesenum,
				       decode(dinner.chineseflag, 1, '供餐', '无供餐') dinnerchineseflag,
				       bus.line_onenum,
				       decode(bus.line_oneflag, 2, '无班车',  3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座',4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_oneflag,
				       bus.line_sixnum,
				       decode(bus.line_sixflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_sixflag,
				       bus.line_sevennum,
				       decode(bus.line_sevenflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_sevenflag,
				       bus.line_eightnum,
				       decode(bus.line_eightflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_eightflag,
				       bus.line_ninenum,
				       decode(bus.line_nineflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_nineflag,
				       bus.line_tennum,
				       decode(bus.line_tenflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_tenflag,
				       bus.line_elevennum,
				       decode(bus.line_elevenflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_elevenflag,
				       bus.line_twonum,
				       decode(bus.line_twoflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_twoflag,
				       bus.line_threenum,
				       decode(bus.line_threeflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_threeflag,
				       bus.line_fournum,
				       decode(bus.line_fourflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_fourflag,
				       bus.line_fivenum,
				       decode(bus.line_fiveflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_fiveflag,
				       bus.line_twelvenum,
				       decode(bus.line_twelveflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_twelveflag,
				       bus.line_thirteennum,
				       decode(bus.line_thirteenflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_thirteenflag,
				       bus.line_fourteennum,
				       decode(bus.line_fourteenflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_fourteenflag,
				       bus.line_fifteennum,
				       decode(bus.line_fifteenflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_fifteenflag,
				       bus.line_sixteennum,
				       decode(bus.line_sixteenflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_sixteenflag,
				       bus.line_seventeennum,
				       decode(bus.line_seventeenflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_seventeenflag,
				       bus.line_eighteennum,
				       decode(bus.line_eighteenflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_eighteenflag,
				       bus.line_nineteennum,
				       decode(bus.line_nineteenflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_nineteenflag,
				       bus.line_twentynum,
				       decode(bus.line_twentyflag, 2, '无班车',   3, '45座1班', 9, '45座2班', 10,'莱山区芝罘区合并45座', 4, '33座', 5, '23座', 6, 'ISTANA', 7, '开发区和福山合并45座', 8, '开发区和福山合并33座', 11, '福山和莱山合并45座', 12, '福山和莱山合并33座', 13, '莱山区芝罘区合并23座', 14, '莱山区芝罘区合并33座', 15, '开发区和福山合并23座', 16, '福山和莱山合并23座') line_twentyflag,
				       RECIPES.RECIPES_ID,
				       RECIPES.RECIPES_NAME,
				       RECIPES.RECIPES_DATE,
				       RECIPES.FILE_ADDRESS
				
				from 
				(select  distinct
				t.arrangement_date,
				t.remark
				from gm_eatery_arrangement t
				where t.cpny_id=#cpnyId:VARCHAR#) base,
				(select 
				arrangement_date,
				sum(chinesenum) chinesenum,
				sum(chineseflag) chineseflag,
				sum(koreannum) koreannum,
				sum(koreanflag) koreanflag
				from (
				select 
				  t.eatery_type,
				  decode(t.food_type,#Cinese_Food:VARCHAR#,t.num) chinesenum,
				  decode(t.food_type,#Cinese_Food:VARCHAR#,t.flag) chineseflag,
				  decode(t.food_type,#Korean_Food:VARCHAR#,t.num) koreannum,
				  decode(t.food_type,#Korean_Food:VARCHAR#,t.flag) koreanflag,
				 t.arrangement_date
				 from gm_eatery_arrangement t
				where t.cpny_id=#cpnyId:VARCHAR#
				and t.eatery_type=#lunch:NUMERIC#)
				group by arrangement_date)lunch,
				(select 
				arrangement_date,
				sum(chinesenum) chinesenum,
				sum(chineseflag) chineseflag
				from (
				select 
				  t.eatery_type,
				  decode(t.food_type,#Cinese_Food:VARCHAR#,t.num) chinesenum,
				  decode(t.food_type,#Cinese_Food:VARCHAR#,t.flag) chineseflag,
				 t.arrangement_date
				 from gm_eatery_arrangement t
				where t.cpny_id=#cpnyId:VARCHAR#
				and t.eatery_type=#break:NUMERIC#)
				group by arrangement_date)break,
				(select 
				arrangement_date,
				sum(chinesenum) chinesenum,
				sum(chineseflag) chineseflag,
				sum(koreannum) koreannum,
				sum(koreanflag) koreanflag
				from (
				select 
				  t.eatery_type,
				  decode(t.food_type,#Cinese_Food:VARCHAR#,t.num) chinesenum,
				  decode(t.food_type,#Cinese_Food:VARCHAR#,t.flag) chineseflag,
				  decode(t.food_type,#Korean_Food:VARCHAR#,t.num) koreannum,
				  decode(t.food_type,#Korean_Food:VARCHAR#,t.flag) koreanflag,
				 t.arrangement_date
				 from gm_eatery_arrangement t
				where t.cpny_id=#cpnyId:VARCHAR#
				and t.eatery_type=#supper:NUMERIC#)
				group by arrangement_date) supper,
				(select 
				arrangement_date,
				sum(chinesenum) chinesenum,
				sum(chineseflag) chineseflag
				from (
				select 
				  t.eatery_type,
				  decode(t.food_type,#Cinese_Food:VARCHAR#,t.num) chinesenum,
				  decode(t.food_type,#Cinese_Food:VARCHAR#,t.flag) chineseflag,
				 t.arrangement_date
				 from gm_eatery_arrangement t
				where t.cpny_id=#cpnyId:VARCHAR#
				and t.eatery_type=#dinner:NUMERIC#)
				group by arrangement_date) dinner,
				(select 
				arrangement_date,
				 sum(line_onenum) line_onenum,
				 sum(line_oneflag) line_oneflag,
				 sum(line_twonum) line_twonum,
				 sum(line_twoflag) line_twoflag,
				 sum(line_threenum) line_threenum,
				 sum(line_threeflag) line_threeflag,
				 sum(line_fournum) line_fournum,
				 sum(line_fourflag) line_fourflag,
				 sum(line_fivenum) line_fivenum,
				 sum(line_fiveflag) line_fiveflag,
				 sum(line_sixnum) line_sixnum,
				 sum(line_sixflag) line_sixflag,
				 sum(line_sevennum) line_sevennum,
				 sum(line_sevenflag) line_sevenflag,
				 sum(line_eightnum) line_eightnum,
				 sum(line_eightflag) line_eightflag,
				 sum(line_ninenum) line_ninenum,
				 sum(line_nineflag) line_nineflag,
				 sum(line_tennum) line_tennum,
				 sum(line_tenflag) line_tenflag,
				 sum(line_elevennum) line_elevennum,
				 sum(line_elevenflag) line_elevenflag,
				 sum(line_twelvenum) line_twelvenum,
				 sum(line_twelveflag) line_twelveflag,
				 sum(line_thirteennum) line_thirteennum,
				 sum(line_thirteenflag) line_thirteenflag,
				 sum(line_fourteennum) line_fourteennum,
				 sum(line_fourteenflag) line_fourteenflag,
				 sum(line_fifteennum) line_fifteennum,
				 sum(line_fifteenflag) line_fifteenflag,
				 sum(line_sixteennum) line_sixteennum,
				 sum(line_sixteenflag) line_sixteenflag,
				 sum(line_seventeennum) line_seventeennum,
				 sum(line_seventeenflag) line_seventeenflag,
				 sum(line_eighteennum) line_eighteennum,
				 sum(line_eighteenflag) line_eighteenflag,
				 sum(line_nineteennum) line_nineteennum,
				 sum(line_nineteenflag) line_nineteenflag,
				 sum(line_twentynum) line_twentynum,
				 sum(line_twentyflag) line_twentyflag
				from (
				select 
				  t.eatery_type,
				  decode(t.food_type,#line_one:VARCHAR#,t.num) line_onenum,
				  decode(t.food_type,#line_one:VARCHAR#,t.flag) line_oneflag,
				  decode(t.food_type,#line_two:VARCHAR#,t.num) line_twonum,
				  decode(t.food_type,#line_two:VARCHAR#,t.flag) line_twoflag,
				  decode(t.food_type,#line_three:VARCHAR#,t.num) line_threenum,
				  decode(t.food_type,#line_three:VARCHAR#,t.flag) line_threeflag,
				  decode(t.food_type,#line_four:VARCHAR#,t.num) line_fournum,
				  decode(t.food_type,#line_four:VARCHAR#,t.flag) line_fourflag,
				  decode(t.food_type,#line_five:VARCHAR#,t.num) line_fivenum,
				  decode(t.food_type,#line_five:VARCHAR#,t.flag) line_fiveflag,
				  decode(t.food_type,#line_six:VARCHAR#,t.num) line_sixnum,
				  decode(t.food_type,#line_six:VARCHAR#,t.flag) line_sixflag,
				  decode(t.food_type,#line_seven:VARCHAR#,t.num) line_sevennum,
				  decode(t.food_type,#line_seven:VARCHAR#,t.flag) line_sevenflag,
				  decode(t.food_type,#line_eight:VARCHAR#,t.num) line_eightnum,
				  decode(t.food_type,#line_eight:VARCHAR#,t.flag) line_eightflag,
				  decode(t.food_type,#line_nine:VARCHAR#,t.num) line_ninenum,
				  decode(t.food_type,#line_nine:VARCHAR#,t.flag) line_nineflag,
				  decode(t.food_type,#line_ten:VARCHAR#,t.num) line_tennum,
				  decode(t.food_type,#line_ten:VARCHAR#,t.flag) line_tenflag,
				  decode(t.food_type,#line_eleven:VARCHAR#,t.num) line_elevennum,
				  decode(t.food_type,#line_eleven:VARCHAR#,t.flag) line_elevenflag,
				  decode(t.food_type,#line_twelve:VARCHAR#,t.num) line_twelvenum,
				  decode(t.food_type,#line_twelve:VARCHAR#,t.flag) line_twelveflag,
				  decode(t.food_type,#line_thirteen:VARCHAR#,t.num) line_thirteennum,
				  decode(t.food_type,#line_thirteen:VARCHAR#,t.flag) line_thirteenflag,
				  decode(t.food_type,#line_fourteen:VARCHAR#,t.num) line_fourteennum,
				  decode(t.food_type,#line_fourteen:VARCHAR#,t.flag) line_fourteenflag,
				  decode(t.food_type,#line_fifteen:VARCHAR#,t.num) line_fifteennum,
				  decode(t.food_type,#line_fifteen:VARCHAR#,t.flag) line_fifteenflag,
				  decode(t.food_type,#line_sixteen:VARCHAR#,t.num) line_sixteennum,
				  decode(t.food_type,#line_sixteen:VARCHAR#,t.flag) line_sixteenflag,
				  decode(t.food_type,#line_seventeen:VARCHAR#,t.num) line_seventeennum,
				  decode(t.food_type,#line_seventeen:VARCHAR#,t.flag) line_seventeenflag, 
				  decode(t.food_type,#line_eighteen:VARCHAR#,t.num) line_eighteennum,
				  decode(t.food_type,#line_eighteen:VARCHAR#,t.flag) line_eighteenflag,
				  decode(t.food_type,#line_nineteen:VARCHAR#,t.num) line_nineteennum,
				  decode(t.food_type,#line_nineteen:VARCHAR#,t.flag) line_nineteenflag,
				  decode(t.food_type,#line_twenty:VARCHAR#,t.num) line_twentynum,
				  decode(t.food_type,#line_twenty:VARCHAR#,t.flag) line_twentyflag,
				 t.arrangement_date
				 from gm_eatery_arrangement t
				where t.cpny_id=#cpnyId:VARCHAR#
				and t.eatery_type=#bus:NUMERIC#)
				group by arrangement_date) bus,
				(
				SELECT T.RECIPES_ID,
				       T.RECIPES_NAME,
				       T.RECIPES_DATE,
				       T.FILE_ADDRESS,
				       T.CPNY_ID
				  FROM GA_RECIPES_RECODE T
				 WHERE T.CPNY_ID = #cpnyId:VARCHAR#
					    ]]>
		<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
						     T.RECIPES_DATE  between to_date(#startDate:VARCHAR#,'YYYY-MM-DD') and to_date(#endDate:VARCHAR#,'YYYY-MM-DD')	
						    ]]>
		</isNotEmpty>
		<![CDATA[				 
				)RECIPES
				where base.arrangement_date=lunch.arrangement_date(+)
				     and base.arrangement_date=break.arrangement_date(+)
				     and base.arrangement_date=supper.arrangement_date(+)
				     and base.arrangement_date=dinner.arrangement_date(+)
				     and base.arrangement_date=bus.arrangement_date(+)	
				     and base.arrangement_date=RECIPES.RECIPES_DATE(+)
	             ]]>
		<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		     base.arrangement_date  between to_date(#startDate:VARCHAR#,'YYYY-MM-DD') and to_date(#endDate:VARCHAR#,'YYYY-MM-DD')	
		    ]]>
		</isNotEmpty>
		<![CDATA[	
		order by base.arrangement_date  desc
		   ]]>

	</select>

	<select id="arrangementUpdateView" parameterClass="SimpleMap"
		resultClass="SimpleMap">

		select arrangement.arrangement_date, NVL(gm.gm_type, '班车')
		typeName, arrangement.pkno, arrangement.food_type,
		arrangement.remark, arrangement.flag, arrangement.num,
		arrangement.diff, case when arrangement.diff='eatery' then
		sy.code_name when arrangement.diff='bus' then line.line_name end
		as foodtypeName from gm_eatery_arrangement arrangement,
		gm_eatery gm,sy_code sy,gm_bus_line line where
		arrangement.eatery_type = gm.gm_id(+) and arrangement.cpny_id =
		#cpnyId:VARCHAR# and arrangement.food_type=sy.code_id(+) and
		arrangement.food_type=line.line_code(+) and
		arrangement.arrangement_date=to_date(#arrangementDate:VARCHAR#,'YYYY-MM-DD')
		order by ORDER_NO,line.view_order,sy.code_no
	</select>

	<update id="arrangementUpdate" parameterClass="SimpleMap">

		update gm_eatery_arrangement t set t.flag=#flag:NUMERIC#,
		t.num=#num:NUMERIC#, t.remark=#Remarks:VARCHAR#,
		t.update_by=#adminId:VARCHAR#, t.update_date=SYSDATE where
		t.pkno=#pkNo:NUMERIC#

	</update>

	<select id="getVoitureApply1" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
	select dt.deptname,
	e.chinesename,
	t.APPLY_USERSCOUNT,
       to_char(t.APPLY_DATE, 'YYYY-MM-DD') APPLY_DATE,
       LARDER,
       t.DEPARTURES,
       t.DESTINATIONS,
       to_char(t.APPLY_DATE, 'YYYY-MM-DD') APPLY_DATE,
       to_char(t.APPLY_ENDDATE,'YYYY-MM-DD') APPLY_ENDDATE,
       t.APPLY_STARTTIME,
       t.APPLY_ENDTIME,
       t.KILOMETER,
       t.PURPOSE
  from ga_voiture_apply t, hr_department dt,hr_employee e
 where t.applyer_deptname = dt.deptid
   and t.voiture_applyid = #applyno:varchar# and e.person_id = t.applyer_id
	]]>
	</select>

	<select id="getVoitureApply2" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
	select e.chinesename name
  from ga_voiture_affirm a, ga_voiture_apply b, hr_employee e
 where b.voiture_applyid = #applyno:varchar#
   and a.apply_no = b.voiture_applyid
   and e.person_id = a.affirmor_id
	]]>
	</select>

	<select id="getrivaList" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
	select * from ga_booking_voiture r where r.applyno= #applyno:varchar#
	]]>
	</select>

	<select id="getDeptname" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
	select t.deptname,t.deptid
  from hr_department t, hr_employee e
 where e.person_id = #person_id:varchar#
   and e.deptid = t.deptid
	]]>
	</select>

	<delete id="deleteConfimArrangementKO" parameterClass="SimpleMap">
		delete from gm_eatery_arrangement t where
		t.cpny_id=#cpnyId:VARCHAR# and t.food_type like 'Korean%' and
		t.arrangement_date=to_date(#current_date:VARCHAR#,'YYYY-MM-DD')
	</delete>
	<insert id="confimArrangementKO" parameterClass="SimpleMap">
		insert into gm_eatery_arrangement SELECT
		gm_eatery_arrangement_seq.nextval AS pkno,
		to_date(#current_date:VARCHAR#,'YYYY-MM-DD') ARRANGEMENT_DATE,
		TO_NUMBER(BASE.countm_type) EATERY_TYPE, BASE.FOOD_TYPE,
		BASE.NUM, 0 FLAG, '' REMARK, #adminId:VARCHAR# CREATE_BY,
		SYSDATE CREATE_DATE, #adminId:VARCHAR# UPDATE_BY, SYSDATE
		UPDATE_DATE, #cpnyId:VARCHAR# CPNY_ID, BASE.DIFF FROM (select
		sum(t.count_num) num, t.countm_type, CASE WHEN T.COUNTM_TYPE
		LIKE 'line%' THEN 'bus' ELSE 'eatery' END AS DIFF, CASE WHEN
		T.COUNTM_TYPE LIKE 'line%' THEN T.COUNTM_TYPE ELSE 'Korean_Food'
		END AS FOOD_TYPE from gm_eatery_ko_confirm t where t.count_date
		= to_date(#current_date:VARCHAR#, 'YYYY-MM-DD') AND
		T.COUNTM_TYPE NOT LIKE '%line%' and t.cpny_id=#cpnyId:VARCHAR#
		AND T.COUNTM_TYPE IN (#lunch:VARCHAR#, #supper:VARCHAR#) group
		by t.countm_type )BASE

	</insert>
	<delete id="deleteConfimArrangement" parameterClass="SimpleMap">
		delete from gm_eatery_arrangement t where
		t.cpny_id=#cpnyId:VARCHAR# and (t.food_type like 'Cinese%' OR
		t.food_type LIKE 'line%') and
		t.arrangement_date=to_date(#current_date:VARCHAR#,'YYYY-MM-DD')
	</delete>
	<insert id="confimArrangement" parameterClass="SimpleMap">
		insert into gm_eatery_arrangement SELECT
		gm_eatery_arrangement_seq.nextval AS pkno,
		to_date(#current_date:VARCHAR#,'YYYY-MM-DD') ARRANGEMENT_DATE,
		CASE WHEN BASE.countm_type NOT LIKE 'line%' THEN
		TO_NUMBER(BASE.countm_type) ELSE TO_NUMBER('99') END AS
		EATERY_TYPE, BASE.FOOD_TYPE, BASE.NUM, CASE WHEN
		BASE.countm_type NOT LIKE 'line%' THEN 0 ELSE 2 END AS FLAG, ''
		REMARK, #adminId:VARCHAR# CREATE_BY, SYSDATE CREATE_DATE,
		#adminId:VARCHAR# UPDATE_BY, SYSDATE UPDATE_DATE,
		#cpnyId:VARCHAR# CPNY_ID, BASE.DIFF FROM ( select sum(base.num)
		num, base.countm_type, base.DIFF, base.FOOD_TYPE from (select
		sum(t.count_num) num, t.countm_type, CASE WHEN T.COUNTM_TYPE
		LIKE 'line%' THEN 'bus' ELSE 'eatery' END AS DIFF, CASE WHEN
		T.COUNTM_TYPE LIKE 'line%' THEN T.COUNTM_TYPE ELSE 'Cinese_Food'
		END AS FOOD_TYPE from gm_eatery_confirm t where t.count_date =
		to_date(#current_date:VARCHAR#, 'YYYY-MM-DD') and
		t.cpny_id=#cpnyId:VARCHAR# group by t.countm_type UNION select
		sum(t.count_num) num, t.countm_type, CASE WHEN T.COUNTM_TYPE
		LIKE 'line%' THEN 'bus' ELSE 'eatery' END AS DIFF, CASE WHEN
		T.COUNTM_TYPE LIKE 'line%' THEN T.COUNTM_TYPE ELSE 'Cinese_Food'
		END AS FOOD_TYPE from gm_eatery_ko_confirm t where t.count_date
		= to_date(#current_date:VARCHAR#, 'YYYY-MM-DD') and
		t.countm_type like '%line%' and t.cpny_id=#cpnyId:VARCHAR# group
		by t.countm_type) base group by base.countm_type, base.diff,
		base.food_type )base
	</insert>
	<insert id="recipesAdd" parameterClass="SimpleMap">
		INSERT INTO GA_RECIPES_RECODE ( RECIPES_ID, RECIPES_NAME,
		RECIPES_DATE, FILE_ADDRESS, CPNY_ID )VALUES (
		#RECIPES_ID:NUMERIC#, #RECIPES_NAME:VARCHAR#,
		TO_DATE(#RECIPES_DATE#,'YYYY-MM-DD'), #FILE_ADDRESS:VARCHAR#,
		#CPNY_ID:VARCHAR# )

	</insert>
	<delete id="recipesDelete" parameterClass="SimpleMap">
		DELETE FROM GA_RECIPES_RECODE WHERE
		RECIPES_DATE=TO_DATE(#RECIPES_DATE#,'YYYY-MM-DD') AND
		CPNY_ID=#CPNY_ID:VARCHAR#
	</delete>
	<select id="eatApplyList" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
	select e.empid,e.chinesename,t.deptname,t1.deptname as deptname1,e.person_id,#selectdate:varchar# as otDate
	 from hr_employee e,hr_department t,hr_department t1
	 where (EXISTS ( SELECT SAD.ADMIN_DEPTID
					  FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
					  WHERE SAD.ADMIN_NO = SA.ADMINNO
					   AND SA.ADMINID = #adminId:varchar#
					   AND SAD.ADMIN_DEPTID = t.DEPTID	
				   ) OR e.person_id=#adminId:varchar#)
           and e.deptid=t.deptid
           and e.date_left is null 
           and e.status_code<>'EmpStatus3'
           and t1.deptid=t.fourthdept          
           and NOT EXISTS(
		   select
		   Y.ID
		   FROM gm_eatapply y
		   WHERE  to_char(y.otdate, 'YYYY-MM-DD') =#selectdate:varchar# 
		   and e.person_id = y.person_id   
		   )
            ]]>
		<isNotEmpty prepend="AND" property="deptID">
			<![CDATA[	
			EXISTS
					 (SELECT *
					          FROM HR_DEPARTMENT B1
					         WHERE B1.DEPTID = E.DEPTID
					         START WITH B1.DEPTID = #deptID:VARCHAR#
					        CONNECT BY PRIOR B1.DEPTID = B1.PARENT_DEPT_ID)  
		    
		    ]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="key">
			<![CDATA[		   
		     (e.empid=#key:varchar# or e.chinesename like '%' || #key:VARCHAR# || '%')
		    ]]>
		</isNotEmpty>
	</select>

	<select id="eatApplySize" parameterClass="SimpleMap"
		resultClass="int">
		<![CDATA[
	select count(*)
	 from hr_employee e,hr_department t
	 WHERE  (EXISTS ( SELECT SAD.ADMIN_DEPTID
					  FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
					  WHERE SAD.ADMIN_NO = SA.ADMINNO
					   AND SA.ADMINID = #adminId:varchar#
					   AND SAD.ADMIN_DEPTID = t.DEPTID	
				   ) OR e.person_id=#adminId:varchar#)
           and e.deptid=t.deptid
           and e.date_left is null 
           and e.status_code<>'EmpStatus3'
           and NOT EXISTS(
		   select
		   Y.ID
		   FROM gm_eatapply y
		   WHERE  to_char(y.otdate, 'YYYY-MM-DD') =#selectdate:varchar# 
		   and e.person_id = y.person_id   
		   )
            ]]>
		<isNotEmpty prepend="AND" property="deptID">
			<![CDATA[		   
		     EXISTS
					 (SELECT *
					          FROM HR_DEPARTMENT B1
					         WHERE B1.DEPTID = E.DEPTID
					         START WITH B1.DEPTID = #deptID:VARCHAR#
					        CONNECT BY PRIOR B1.DEPTID = B1.PARENT_DEPT_ID)  
		    ]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="key">
			<![CDATA[		   
		     (e.empid=#key:varchar# or e.chinesename like '%' || #key:VARCHAR# || '%')
		    ]]>
		</isNotEmpty>
	</select>

	<select id="eatListBus" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
		select *
			  from (select 'line_non' as line_code,
			               ' 无' as line_name,
			               '63000000' as cpny_id,
			               0 as view_order
			          from dual
			        union all
			        select t.line_code, t.line_name, t.cpny_id, t.view_order
			          from gm_bus_line t
			         where t.cpny_id = '63000000') a
			 order by a.view_order
	    ]]>
	</select>

	<insert id="addEatApply" parameterClass="SimpleMap">
		INSERT INTO GM_EATAPPLY ( ID, PERSON_ID, OTDATE, FOODTYPE,
		EATTYPE, CAR, APPLYPERSON_ID, APPLYDATE )values (
		gm_eatapply_SEQ.Nextval, #PERSON_ID:VARCHAR#,
		TO_DATE(#selectdate:varchar#,'YYYY-MM-DD'), #FOODTYPE:VARCHAR#,
		#EATTYPE:VARCHAR#, #CAR:VARCHAR#, #adminId:VARCHAR#, sysdate )

	</insert>

	<select id="eatConfirmSize" parameterClass="SimpleMap"
		resultClass="int">
		<![CDATA[
select count(*)
  from gm_eatapply t, hr_employee e, hr_department d
 where t.person_id = e.person_id
   and e.deptid = d.deptid
   and (EXISTS ( SELECT SAD.ADMIN_DEPTID
					  FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
					  WHERE SAD.ADMIN_NO = SA.ADMINNO
					   AND SA.ADMINID = #adminId:varchar#
					   AND SAD.ADMIN_DEPTID = e.DEPTID	
				   ) OR T.PERSON_ID=#adminId:varchar#)
	]]>
		<isNotEmpty prepend="AND" property="deptID">
			<![CDATA[	
		EXISTS
					 (SELECT *
					          FROM HR_DEPARTMENT B1
					         WHERE B1.DEPTID = D.DEPTID
					         START WITH B1.DEPTID = #deptID:VARCHAR#
					        CONNECT BY PRIOR B1.DEPTID = B1.PARENT_DEPT_ID)  	   
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="key">
			<![CDATA[		   
		(e.empid=#key:varchar# or e.chinesename like '%' || #key:VARCHAR# || '%')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="selectdate">
			<![CDATA[
         to_char(t.otdate, 'YYYY-MM-DD') = #selectdate:varchar# 
	  ]]>
		</isNotEmpty>
		<isEqual prepend="AND" property="qryType" compareValue="0">
			<![CDATA[
         t.confirm = #qryType:varchar#
	  ]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="1">
			<![CDATA[
         t.confirm = #qryType:varchar#
	  ]]>
		</isEqual>
	</select>

	<select id="eatConfirmList" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[
	select t.id,
       to_char(t.otdate,'YYYY-MM-DD') as otdate,
       t.foodtype,
       t.eattype,
       t.car,
       e.empid,
       e.chinesename,
       d.deptname,
       t1.deptname as deptname1,
       NVL(b.line_name,'无') line_name,
       c.code_name,
       t.confirm,
       t.FALG,
       to_char(t.applydate,'YYYY-MM-DD HH24:MI') as applydate
  from gm_eatapply t, hr_employee e, hr_department d,hr_department t1,gm_bus_line b,sy_code c
 where t.person_id = e.person_id
   and e.deptid = d.deptid
   and d.fourthdept = t1.deptid
   and t.car = b.line_code(+)
   and c.code_id = t.foodtype
   and ( EXISTS ( SELECT SAD.ADMIN_DEPTID
					  FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
					  WHERE SAD.ADMIN_NO = SA.ADMINNO
					   AND SA.ADMINID = #adminId:varchar#
					   AND SAD.ADMIN_DEPTID = e.DEPTID	
				   ) OR T.PERSON_ID=#adminId:varchar#)
	]]>
		<isNotEmpty prepend="AND" property="deptID">
			<![CDATA[		   
				EXISTS
					 (SELECT *
					          FROM HR_DEPARTMENT B1
					         WHERE B1.DEPTID = D.DEPTID
					         START WITH B1.DEPTID = #deptID:VARCHAR#
					        CONNECT BY PRIOR B1.DEPTID = B1.PARENT_DEPT_ID)  
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="key">
			<![CDATA[		   
		(e.empid=#key:varchar# or e.chinesename like '%' || #key:VARCHAR# || '%')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="selectdate">
			<![CDATA[
         to_char(t.otdate, 'YYYY-MM-DD') = #selectdate:varchar# 
	  ]]>
		</isNotEmpty>
		<isEqual prepend="AND" property="qryType" compareValue="0">
			<![CDATA[
         t.confirm = #qryType:varchar#
	  ]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="1">
			<![CDATA[
         t.confirm = #qryType:varchar#
	  ]]>
		</isEqual>
	</select>

	<update id="confirmUpdate" parameterClass="SimpleMap">
		<![CDATA[
		update gm_eatapply y set y.CONFIRM = '1' where y.id = #applyNo:varchar#
	 
	]]>
	</update>

	<delete id="eat_confirmDel" parameterClass="SimpleMap">
		<![CDATA[
		delete gm_eatapply y where y.id = #chNo:varchar#
	 
	]]>
	</delete>
	<delete id="deleteConfimList" parameterClass="SimpleMap">
		<![CDATA[
	delete from gm_eatery_confirm t
    where t.cpny_id=#cpnyId:varchar#
    and t.count_date=to_date(#current_date:varchar#,'YYYY-MM-DD')
		
	]]>
	</delete>
	<insert id="insertApplyDetail" parameterClass="SimpleMap">
		<![CDATA[
	   insert into gm_eatery_confirm(
				eat_count_id,
				countm_type,
				count_fourdept,
				count_dept,
				count_date,
				count_num,
				cpny_id,
				flag
	           )
		select 
				gm_eatery_confirm_seq.nextval eat_count_id,
				countm_type,
				count_fourdept,
				count_dept,
				count_date,
				count_num,
				cpny_id,
				#updateFlag:VARCHAR# flag
				from (select count(apply.person_id) count_num,
				       de.deptid count_dept,
				       de.fourthdept count_fourdept,
				       apply.otdate count_date,
				       #break:VARCHAR# countm_type,
				       #cpnyId:varchar# cpny_id
				  from gm_eatapply apply, hr_employee hr, hr_department de
				 where apply.person_id = hr.person_id
				   and hr.deptid = de.deptid
				   and apply.foodtype = 'Cinese_Food'
				   and hr.cpny_id = #cpnyId:varchar#
				   and apply.confirm = '1'
				   and instr(',' || apply.eattype, ','||#break:VARCHAR#||',') > 0
				   and apply.otdate = to_date(#current_date:varchar#, 'YYYY-MM-DD')
				 group by de.deptid, de.fourthdept, apply.otdate
				UNION
				select count(apply.person_id) count_num,
				       de.deptid count_dept,
				       de.fourthdept count_fourdept,
				       apply.otdate count_date,
				       #lunch:VARCHAR# countm_type,
				       #cpnyId:varchar# cpny_id
				  from gm_eatapply apply, hr_employee hr, hr_department de
				 where apply.person_id = hr.person_id
				   and hr.deptid = de.deptid
				   and apply.foodtype = 'Cinese_Food'
				   and hr.cpny_id = #cpnyId:varchar#
				   and apply.confirm = '1'
				   and instr(',' || apply.eattype, ','||#lunch:VARCHAR#||',') > 0
				   and apply.otdate = to_date(#current_date:varchar#, 'YYYY-MM-DD')
				 group by de.deptid, de.fourthdept, apply.otdate
				UNION
				select count(apply.person_id) count_num,
				       de.deptid count_dept,
				       de.fourthdept count_fourdept,
				       apply.otdate count_date,
				       #supper:VARCHAR# countm_type,
				       #cpnyId:varchar# cpny_id
				  from gm_eatapply apply, hr_employee hr, hr_department de
				 where apply.person_id = hr.person_id
				   and hr.deptid = de.deptid
				   and apply.foodtype = 'Cinese_Food'
				   and hr.cpny_id =#cpnyId:varchar#
				   and apply.confirm = '1'
				   and instr(',' || apply.eattype, ','||#supper:VARCHAR#||',') > 0
				   and apply.otdate = to_date(#current_date:varchar#, 'YYYY-MM-DD')
				 group by de.deptid, de.fourthdept, apply.otdate
				UNION
				select count(apply.person_id) count_num,
				       de.deptid count_dept,
				       de.fourthdept count_fourdept,
				       apply.otdate count_date,
				       #dinner:VARCHAR# countm_type,
				       #cpnyId:varchar# cpny_id
				  from gm_eatapply apply, hr_employee hr, hr_department de
				 where apply.person_id = hr.person_id
				   and hr.deptid = de.deptid
				   and apply.foodtype = 'Cinese_Food'
				   and hr.cpny_id = #cpnyId:varchar#
				   and apply.confirm = '1'
				   and instr(',' || apply.eattype, ','||#dinner:VARCHAR#||',') > 0
				   and apply.otdate = to_date(#current_date:varchar#, 'YYYY-MM-DD')
				 group by de.deptid, de.fourthdept, apply.otdate
				union
				select count(apply.person_id) count_num,
				       de.deptid count_dept,
				       de.fourthdept count_fourdept,
				       apply.otdate count_date,
				       apply.car countm_type,
				       #cpnyId:varchar# cpny_id
				  from gm_eatapply apply, hr_employee hr, hr_department de
				 where apply.person_id = hr.person_id
				   and hr.deptid = de.deptid
				   and hr.cpny_id = #cpnyId:varchar#
				   and apply.confirm = '1'
				   and apply.car<>'line_non'
				   and apply.otdate = to_date(#current_date:varchar#, 'YYYY-MM-DD')
				 group by de.deptid, de.fourthdept, apply.otdate, apply.car
				 )base 

		
	]]>
	</insert>
	
	<delete id="deleteConfimListKO" parameterClass="SimpleMap">
		<![CDATA[
	delete from gm_eatery_ko_confirm t
    where t.cpny_id=#cpnyId:varchar#
    and t.count_date=to_date(#current_date:varchar#,'YYYY-MM-DD')
		
	]]>
	</delete>
	<insert id="insertApplyDetailKO" parameterClass="SimpleMap">
		<![CDATA[
	   insert into gm_eatery_ko_confirm(
				eat_count_id,
				countm_type,
				count_fourdept,
				count_dept,
				count_date,
				count_num,
				cpny_id,
				flag
	           )
		select 
				gm_eatery_ko_confirm_seq.nextval eat_count_id,
				countm_type,
				count_fourdept,
				count_dept,
				count_date,
				count_num,
				cpny_id,
				#updateFlag:VARCHAR# flag
				from (select count(apply.person_id) count_num,
				       de.deptid count_dept,
				       de.fourthdept count_fourdept,
				       apply.otdate count_date,
				       #break:VARCHAR# countm_type,
				       #cpnyId:varchar# cpny_id
				  from gm_eatapply apply, hr_employee hr, hr_department de
				 where apply.person_id = hr.person_id
				   and hr.deptid = de.deptid
				   and apply.foodtype = 'Korean_Food'
				   and hr.cpny_id = #cpnyId:varchar#
				   and apply.confirm = '1'
				   and instr(',' || apply.eattype, ','||#break:VARCHAR#||',') > 0
				   and apply.otdate = to_date(#current_date:varchar#, 'YYYY-MM-DD')
				 group by de.deptid, de.fourthdept, apply.otdate
				UNION
				select count(apply.person_id) count_num,
				       de.deptid count_dept,
				       de.fourthdept count_fourdept,
				       apply.otdate count_date,
				       #lunch:VARCHAR# countm_type,
				       #cpnyId:varchar# cpny_id
				  from gm_eatapply apply, hr_employee hr, hr_department de
				 where apply.person_id = hr.person_id
				   and hr.deptid = de.deptid
				   and apply.foodtype = 'Korean_Food'
				   and hr.cpny_id = #cpnyId:varchar#
				   and apply.confirm = '1'
				   and instr(',' || apply.eattype, ','||#lunch:VARCHAR#||',') > 0
				   and apply.otdate = to_date(#current_date:varchar#, 'YYYY-MM-DD')
				 group by de.deptid, de.fourthdept, apply.otdate
				UNION
				select count(apply.person_id) count_num,
				       de.deptid count_dept,
				       de.fourthdept count_fourdept,
				       apply.otdate count_date,
				       #supper:VARCHAR# countm_type,
				       #cpnyId:varchar# cpny_id
				  from gm_eatapply apply, hr_employee hr, hr_department de
				 where apply.person_id = hr.person_id
				   and hr.deptid = de.deptid
				   and apply.foodtype = 'Korean_Food'
				   and hr.cpny_id =#cpnyId:varchar#
				   and apply.confirm = '1'
				   and instr(',' || apply.eattype, ','||#supper:VARCHAR#||',') > 0
				   and apply.otdate = to_date(#current_date:varchar#, 'YYYY-MM-DD')
				 group by de.deptid, de.fourthdept, apply.otdate
				UNION
				select count(apply.person_id) count_num,
				       de.deptid count_dept,
				       de.fourthdept count_fourdept,
				       apply.otdate count_date,
				       #dinner:VARCHAR# countm_type,
				       #cpnyId:varchar# cpny_id
				  from gm_eatapply apply, hr_employee hr, hr_department de
				 where apply.person_id = hr.person_id
				   and hr.deptid = de.deptid
				   and apply.foodtype = 'Korean_Food'
				   and hr.cpny_id = #cpnyId:varchar#
				   and apply.confirm = '1'
				   and instr(',' || apply.eattype, ','||#dinner:VARCHAR#||',') > 0
				   and apply.otdate = to_date(#current_date:varchar#, 'YYYY-MM-DD')
				 group by de.deptid, de.fourthdept, apply.otdate
				 )base 

		
	]]>
	</insert>
	<update id="confimApplyDetail" parameterClass="SimpleMap">
		<![CDATA[
		update  gm_eatapply apply
	            set apply.falg = #updateFlag:VARCHAR#
	   where apply.otdate = to_date(#current_date:varchar#, 'YYYY-MM-DD')
			   and apply.foodtype = 'Cinese_Food'
			   and exists (select hr.person_id
			          from hr_employee hr
			         where apply.person_id = hr.person_id
			           and hr.cpny_id = #cpnyId:varchar#)

		
	]]>
	</update>
	<update id="confimApplyDetailKO" parameterClass="SimpleMap">
		<![CDATA[
	update  gm_eatapply apply
	            set apply.falg = #updateFlag:VARCHAR#
	   where apply.otdate = to_date(#current_date:varchar#, 'YYYY-MM-DD')
			   and apply.foodtype = 'Korean_Food'
			   and exists (select hr.person_id
			          from hr_employee hr
			         where apply.person_id = hr.person_id
			           and hr.cpny_id = #cpnyId:varchar#)
		
	]]>
	</update>
	<select id="eatConfirmListSum" parameterClass="SimpleMap"  resultClass="SimpleMap">
	<![CDATA[	 
	select DD.* from 
		(select base.empid,
		       base.chinesename,
		       base.deptname,
               base.fourdeptname,
		       TO_CHAR(base.count_date,'YYYY-MM-DD') count_date,
		       base.countm_type,
		       base.foodtype,
		       base.count_num,
		       base.line_one,
		       base.line_two,
		       base.line_three,
		       base.line_four,
		       base.line_five,
		       base.line_six,
		       base.line_seven,
		       base.line_eight,
		       base.line_nine,
		       base.line_ten,
		       base.line_eleven,
		       base.line_twelve,
		       base.line_thirteen,
		       base.line_fourteen,
		       base.line_fifteen,
		       base.line_sixteen,
		       base.line_seventeen,
		       base.line_eighteen,
		       base.line_nineteen,
		       base.line_twenty
		  from (select count(apply.person_id) count_num,
		               hr.empid,
		               hr.chinesename,
		               de.deptname,
                       fourdept.deptname fourdeptname,
		               apply.otdate count_date,
		               '晚餐' countm_type,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr,hr_department de,hr_department fourdept
		         where apply.person_id = hr.person_id
		            and hr.deptid = de.deptid
                   and de.fourthdept = fourdept.deptid
		           and hr.cpny_id =#cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#supper:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by hr.empid,
		                  hr.chinesename,
		                  apply.otdate,
		                  de.deptname,
                          fourdept.deptname,
		                  apply.car,
		                  apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               hr.chinesename,
		               de.deptname,
                       fourdept.deptname fourdeptname,
		               apply.otdate count_date,
		               '早餐' countm_type,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr,hr_department de,hr_department fourdept
		         where apply.person_id = hr.person_id
		           and hr.deptid = de.deptid
                   and de.fourthdept = fourdept.deptid
		           and hr.cpny_id =#cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#break:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by hr.empid,
		                  hr.chinesename,
		                  apply.otdate,
		                  de.deptname,
                          fourdept.deptname,
		                  apply.car,
		                  apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               hr.chinesename,
		               de.deptname,
                       fourdept.deptname fourdeptname,
		               apply.otdate count_date,
		               '午餐' countm_type,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr,hr_department de,hr_department fourdept
		         where apply.person_id = hr.person_id
		           and hr.deptid = de.deptid
                   and de.fourthdept = fourdept.deptid
		           and hr.cpny_id = #cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#lunch:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by hr.empid,
		                  hr.chinesename,
		                  apply.otdate,
		                  de.deptname,
                          fourdept.deptname,
		                  apply.car,
		                  apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               hr.chinesename,
		               de.deptname,
                       fourdept.deptname fourdeptname,
		               apply.otdate count_date,
		               '夜餐' countm_type,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr,hr_department de,hr_department fourdept
		         where apply.person_id = hr.person_id
		           and hr.deptid = de.deptid
                   and de.fourthdept = fourdept.deptid
		           and hr.cpny_id =#cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#dinner:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by hr.empid,
		                  hr.chinesename,
		                  apply.otdate,
		                  de.deptname,
                          fourdept.deptname,
		                  apply.car,
		                  apply.foodtype
		        
		        ) base
		 order by base.foodtype, base.countm_type) DD
		union all
		
		select '',
		       '',
		       '',
		       '',
		       '',
		       '',       
		       sumrry.foodtype,
		       sum(sumrry.count_num) count_num,
		       sum(sumrry.line_one) line_one,
		       sum(sumrry.line_two) line_two,
		       sum(sumrry.line_three) line_three,
		       sum(sumrry.line_four) line_four,
		       sum(sumrry.line_five) line_five,
		       sum(sumrry.line_six) line_six,
		       sum(sumrry.line_seven) line_seven,
		       sum(sumrry.line_eight) line_eight,
		       sum(sumrry.line_nine) line_nine,
		       sum(sumrry.line_ten) line_ten,
		       sum(sumrry.line_eleven) line_eleven,
		       sum(sumrry.line_twelve) line_twelve,
		       sum(sumrry.line_thirteen) line_thirteen,
		       sum(sumrry.line_fourteen) line_fourteen,
		       sum(sumrry.line_fifteen) line_fifteen
		  from (select count(apply.person_id) count_num,
		               hr.empid,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr
		         where apply.person_id = hr.person_id
		           and hr.cpny_id = #cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#supper:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by apply.car, hr.empid, apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr
		         where apply.person_id = hr.person_id
		           and hr.cpny_id = #cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#break:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by apply.car, hr.empid, apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr
		         where apply.person_id = hr.person_id
		           and hr.cpny_id = #cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#lunch:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by apply.car, hr.empid, apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr
		         where apply.person_id = hr.person_id
		           and hr.cpny_id = #cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#dinner:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by apply.car, hr.empid, apply.foodtype) sumrry
		 group by sumrry.foodtype
			]]>
	</select>
	
	
	<select id="eatConfirmListSumReport" parameterClass="SimpleMap"  resultClass="SimpleMap">
	<![CDATA[	 
	select DD.* from 
		(select base.empid,
		       substr(empid,3)  as empidno,
		       base.chinesename,
		       base.deptname,
               base.fourdeptname,
		       TO_CHAR(base.count_date,'YYYY-MM-DD') count_date,
		       base.countm_type,
		       base.foodtype,
		       base.count_num,
		       base.line_one,
		       base.line_two,
		       base.line_three,
		       base.line_four,
		       base.line_five,
		       base.line_six,
		       base.line_seven,
		       base.line_eight,
		       base.line_nine,
		       base.line_ten,
		       base.line_eleven,
		       base.line_twelve,
		       base.line_thirteen,
		       base.line_fourteen,
		       base.line_fifteen
		  from (select count(apply.person_id) count_num,
		               hr.empid,
		               hr.chinesename,
		               de.deptname,
                       fourdept.deptname fourdeptname,
		               apply.otdate count_date,
		               '晚餐' countm_type,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr,hr_department de,hr_department fourdept
		         where apply.person_id = hr.person_id
		            and hr.deptid = de.deptid
                   and de.fourthdept = fourdept.deptid
		           and hr.cpny_id =#cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#supper:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by hr.empid,
		                  hr.chinesename,
		                  apply.otdate,
		                  de.deptname,
                          fourdept.deptname,
		                  apply.car,
		                  apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               hr.chinesename,
		               de.deptname,
                       fourdept.deptname fourdeptname,
		               apply.otdate count_date,
		               '早餐' countm_type,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr,hr_department de,hr_department fourdept
		         where apply.person_id = hr.person_id
		           and hr.deptid = de.deptid
                   and de.fourthdept = fourdept.deptid
		           and hr.cpny_id =#cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#break:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by hr.empid,
		                  hr.chinesename,
		                  apply.otdate,
		                  de.deptname,
                          fourdept.deptname,
		                  apply.car,
		                  apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               hr.chinesename,
		               de.deptname,
                       fourdept.deptname fourdeptname,
		               apply.otdate count_date,
		               '午餐' countm_type,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr,hr_department de,hr_department fourdept
		         where apply.person_id = hr.person_id
		           and hr.deptid = de.deptid
                   and de.fourthdept = fourdept.deptid
		           and hr.cpny_id = #cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#lunch:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by hr.empid,
		                  hr.chinesename,
		                  apply.otdate,
		                  de.deptname,
                          fourdept.deptname,
		                  apply.car,
		                  apply.foodtype
		        union
		        select 0 as count_num,
		               hr.empid,
		               hr.chinesename,
		               de.deptname,
                       fourdept.deptname fourdeptname,
		               apply.otdate count_date,
		               '无' countm_type,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr,hr_department de,hr_department fourdept
		         where apply.person_id = hr.person_id
		           and hr.deptid = de.deptid
                   and de.fourthdept = fourdept.deptid
		           and hr.cpny_id = #cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#wu:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by hr.empid,
		                  hr.chinesename,
		                  apply.otdate,
		                  de.deptname,
                          fourdept.deptname,
		                  apply.car,
		                  apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               hr.chinesename,
		               de.deptname,
                       fourdept.deptname fourdeptname,
		               apply.otdate count_date,
		               '夜餐' countm_type,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr,hr_department de,hr_department fourdept
		         where apply.person_id = hr.person_id
		           and hr.deptid = de.deptid
                   and de.fourthdept = fourdept.deptid
		           and hr.cpny_id =#cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#dinner:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by hr.empid,
		                  hr.chinesename,
		                  apply.otdate,
		                  de.deptname,
                          fourdept.deptname,
		                  apply.car,
		                  apply.foodtype
		        
		        ) base
		 order by base.foodtype, base.countm_type) DD
		union all
		
		select '',
		       '',
		       '',
		       '',
		       '',
		       '',
		       '',       
		       sumrry.foodtype,
		       sum(sumrry.count_num) count_num,
		       sum(sumrry.line_one) line_one,
		       sum(sumrry.line_two) line_two,
		       sum(sumrry.line_three) line_three,
		       sum(sumrry.line_four) line_four,
		       sum(sumrry.line_five) line_five,
		       sum(sumrry.line_six) line_six,
		       sum(sumrry.line_seven) line_seven,
		       sum(sumrry.line_eight) line_eight,
		       sum(sumrry.line_nine) line_nine,
		       sum(sumrry.line_ten) line_ten,
		       sum(sumrry.line_eleven) line_eleven,
		       sum(sumrry.line_twelve) line_twelve,
		       sum(sumrry.line_thirteen) line_thirteen,
		       sum(sumrry.line_fourteen) line_fourteen,
		       sum(sumrry.line_fifteen) line_fifteen
		  from (select count(apply.person_id) count_num,
		               hr.empid,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr
		         where apply.person_id = hr.person_id
		           and hr.cpny_id = #cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#supper:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by apply.car, hr.empid, apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr
		         where apply.person_id = hr.person_id
		           and hr.cpny_id = #cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#break:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by apply.car, hr.empid, apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr
		         where apply.person_id = hr.person_id
		           and hr.cpny_id = #cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#lunch:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by apply.car, hr.empid, apply.foodtype
		         union
		        select 0 as count_num,
		               hr.empid,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr
		         where apply.person_id = hr.person_id
		           and hr.cpny_id = #cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#wu:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by apply.car, hr.empid, apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               decode(apply.foodtype, 'Cinese_Food', '中餐', '韩餐') foodtype,
		               decode(apply.car, 'line_one', 1, 0) line_one,
		               decode(apply.car, 'line_two', 1, 0) line_two,
		               decode(apply.car, 'line_three', 1, 0) line_three,
		               decode(apply.car, 'line_four', 1, 0) line_four,
		               decode(apply.car, 'line_five', 1, 0) line_five,
		               decode(apply.car, 'line_six', 1, 0) line_six,
		               decode(apply.car, 'line_seven', 1, 0) line_seven,
		               decode(apply.car, 'line_eight', 1, 0) line_eight,
		               decode(apply.car, 'line_nine', 1, 0) line_nine,
		               decode(apply.car, 'line_ten', 1, 0) line_ten,
		               decode(apply.car, 'line_eleven', 1, 0) line_eleven,
		               decode(apply.car, 'line_twelve', 1, 0) line_twelve,
		               decode(apply.car, 'line_thirteen', 1, 0) line_thirteen,
		               decode(apply.car, 'line_fourteen', 1, 0) line_fourteen,
		               decode(apply.car, 'line_fifteen', 1, 0) line_fifteen,
		               decode(apply.car, 'line_sixteen', 1, 0) line_sixteen,
		               decode(apply.car, 'line_seventeen', 1, 0) line_seventeen,
		               decode(apply.car, 'line_eighteen', 1, 0) line_eighteen,
		               decode(apply.car, 'line_nineteen', 1, 0) line_nineteen,
		               decode(apply.car, 'line_twenty', 1, 0) line_twenty
		          from gm_eatapply apply, hr_employee hr
		         where apply.person_id = hr.person_id
		           and hr.cpny_id = #cpnyId:VARCHAR#
		           and apply.confirm = '1'
		           and instr(',' || apply.eattype, ','||#dinner:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by apply.car, hr.empid, apply.foodtype) sumrry
		 group by sumrry.foodtype
			]]>
	</select>
	
	<select id="ImportExcelInterface" parameterClass="SimpleMap"  resultClass="SimpleMap">
	<![CDATA[	 
        select substr(base.empid,3) empid,
		       base.chinesename,
		       TO_CHAR(base.count_date,'YYYY-MM-DD') count_date,
		       base.countm_type,
               base.deptname
		  from (select count(apply.person_id) count_num,
		               hr.empid,
		               hr.chinesename,
		               de.deptname,
		               apply.otdate count_date,
		               '晚餐' countm_type
		          from gm_eatapply apply, hr_employee hr,hr_department de
		         where apply.person_id = hr.person_id
		           and hr.cpny_id =#cpnyId:VARCHAR#
		           and hr.join_type_code in ('C_12009_1330061', 'C_12009_1330066')
		           and apply.confirm = '1'
		           and hr.deptid=de.deptid
                   and apply.foodtype='Cinese_Food'
		           and instr(',' || apply.eattype, ','||#supper:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by hr.empid,
		                  hr.chinesename,
		                  de.deptname,
		                  apply.otdate,
		                  apply.car,
		                  apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               hr.chinesename,
		               de.deptname,
		               apply.otdate count_date,
		               '早餐' countm_type
		          from gm_eatapply apply, hr_employee hr,hr_department de
		         where apply.person_id = hr.person_id
		           and hr.cpny_id =#cpnyId:VARCHAR#
		           and hr.join_type_code in ('C_12009_1330061', 'C_12009_1330066')
		           and apply.confirm = '1'
		           and hr.deptid=de.deptid
                   and apply.foodtype='Cinese_Food'
		           and instr(',' || apply.eattype, ','||#break:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by hr.empid,
		                  hr.chinesename,
		                  de.deptname,
		                  apply.otdate,
		                  apply.car,
		                  apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               hr.chinesename,
		               de.deptname,
		               apply.otdate count_date,
		               '午餐' countm_type
		          from gm_eatapply apply, hr_employee hr,hr_department de
		         where apply.person_id = hr.person_id
		           and hr.cpny_id = #cpnyId:VARCHAR#
		           and hr.join_type_code in ('C_12009_1330061', 'C_12009_1330066')
		           and apply.confirm = '1'
		            and hr.deptid=de.deptid
                   and apply.foodtype='Cinese_Food'
		           and instr(',' || apply.eattype, ','||#lunch:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by hr.empid,
		                  hr.chinesename,
		                  de.deptname,
		                  apply.otdate,
		                  apply.car,
		                  apply.foodtype
		        union
		        select count(apply.person_id) count_num,
		               hr.empid,
		               hr.chinesename,
		               de.deptname,
		               apply.otdate count_date,
		               '夜餐' countm_type
		          from gm_eatapply apply, hr_employee hr,hr_department de
		         where apply.person_id = hr.person_id
		           and hr.cpny_id =#cpnyId:VARCHAR#
		           and hr.join_type_code in ('C_12009_1330061', 'C_12009_1330066')
		           and apply.confirm = '1'
		            and hr.deptid=de.deptid
                   and apply.foodtype='Cinese_Food'
		           and instr(',' || apply.eattype, ','||#dinner:VARCHAR#||',') > 0
		           and apply.otdate = to_date(#selectdate:varchar#, 'YYYY-MM-DD')
		         group by hr.empid,
		                  hr.chinesename,
		                  de.deptname,
		                  apply.otdate,
		                  apply.car,
		                  apply.foodtype
		        
		        ) base
		 order by base.countm_type
		]]>
	</select>
   <select id="confirmFlagToday" parameterClass="SimpleMap" resultClass="int">
		<![CDATA[	
		select NVL(SUM(T.FLAG),0) from gm_eatery_confirm t
			where t.flag=1
			and t.cpny_id=#cpnyId:varchar#
			and t.count_date=TO_DATE(#selectdate:varchar# ,'YYYY-MM-DD')	
		]]>
  </select>
  
  
  <select id="eatApplySelectCount" parameterClass="SimpleMap"
		resultClass="int">
		<![CDATA[
		  select count(*)
		  from gm_eatapply t
		 where t.person_id = #PERSON_ID:varchar# 
		   and t.otdate = TO_DATE(#selectdate:varchar#,'YYYY-MM-DD')
		  
	]]>
	</select>

</sqlMap>