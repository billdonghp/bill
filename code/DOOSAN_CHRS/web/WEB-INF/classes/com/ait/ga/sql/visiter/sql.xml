<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ga.visiter">
	<!-- emp record list -->
	<select id="visiterApplyId" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			  select t.ga_visiter_apply_id from ga_visiter_apply t
	  	]]>
	</select>
	
	<select id="visitersApplyId" parameterClass="SimpleMap" resultClass="string">
		<![CDATA[
			  select temp.ga_visiter_apply_id
			  from (select t.ga_visiter_apply_id
			          from ga_visiter_apply t
			         order by substr(t.ga_visiter_apply_id,9,10) desc) temp
			   where rownum = 1  
	  	]]>
	</select>
	<select id="visiterViewDetail" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
	select t.ga_visiter_apply_id,
   		 t.visiter_company,
	               t.visit_type,
	               t.visiter_contact_tel,
	               t.visit_intro_dept,   
	               t.visit_place,
	               t.visit_count,
	               t.visiter_name,
	               t.visitor_type ,
	               t.expect_result,
	               t.reception_lead,
	               t.reception_act_phone,
	               t.note,         
	               t.welcome_scr,
	               t.reception_office,
	               t.tea,
	               t.coffee,
	               t.advertising_video,
	               t.defend_facility,
	               t.interpret_facility,
	               t.shoot,
	               t.present,
	               t.lunch_repast,
	               t.restaurant,
	               t.fruit,
				   t.visiter_carnum, 
       t.visiter_objective,
      
       t.visiter_date,

     
       h.deptname,
       (select e.chinesename from hr_employee e where e.person_id=t.Play_Apply) AS play_applyChinesename,
       t.play_apply,
       t.active,
       t.apply_date,
       
       t.visiter_people_num,
       t.visiter_out_date,
       he1.chinesename,
       t.welcome,
       t.visiter_people_num,
       
       t.visiter_come_time,
       t.visiter_end_time,
       t.HUIYISHI_APPLYID,
       (select e.chinesename from hr_employee e where e.person_id=t.front_emp_id) as front_emp,
       substr(t.DEVICE,0,length(t.DEVICE)-1)  as DEVICE,
       
       t.visiter_carnum,
       
       T.VISITER_CAR_MODEL,
       T.VISITER_EATRY_FLAG,
       T.VISITER_EATRY_DISTINCTION,
      
       T.VISITER_EATRY_NAME,
       T.VISITER_EATRY_DATE,
       T.VISITER_EATRY_TIME,
       T.VISITER_EATRY_TYPE,
      
       T.VISITER_EATRY_NUMBER,
       T.VISITER_EATRY_MEMO,
       
       T.VISITER_VOITURE_FLAG,
       T.VISITER_VOITURE_NUMBER,
       T.VISITER_VOITURE_IN_DATE,
       T.VISITER_VOITURE_IN_TIME,
       T.VISITER_VOITURE_OUT_DATE,
       T.VISITER_VOITURE_OUT_TIME,
       T.VISITER_VOITURE_START_AREA,
       T.VISITER_VOITURE_PASS_AREA,
       T.VISITER_VOITURE_END_AREA,
       T.VISITER_VOITURE_MEMO,
       
       T.VISITER_CONFERENCE_FLAG,
       T.VISITER_CONFERENCE_ROOM,
       p.roomname as VISITER_CONFERENCE_ROOM_NAME,
       substr(t.VISITER_CONFERENCE_LANGUAGE,
              0,
              length(t.VISITER_CONFERENCE_LANGUAGE) - 1) as VISITER_CONFERENCE_LANGUAGE,
       T.VISITER_CONFERENCE_PEOPLE,
       T.VISITER_CONFERENCE_MANAGE,
       T.VISITER_CONFERENCE_MANAGE as VISITER_CONFERENCE_MANAGE_NAME,
       substr(t.VISITER_CONFERENCE_DATE,
              0,
              length(t.VISITER_CONFERENCE_DATE) - 1) as VISITER_CONFERENCE_DATE,
       T.VISITER_CONFERENCE_TIME,
       T.VISITER_CONFERENCE_PURPOSE,
       
       T.VISITER_FACTORY_FLAG,
       T.VISITER_FACTORY_NUMBER,
       T.VISITER_FACTORY_METHOD,
       
       T.VISITER_FACTORY_ROUTE,
       
       substr(t.VISITER_FACTORY_DEVICE,
              0,
              length(t.VISITER_FACTORY_DEVICE) - 1) as VISITER_FACTORY_DEVICE,
       T.VISITER_FACTORY_HELMET,
       
       T.VISITER_FACTORY_HELMET_NUMBER,
       T.VISITER_FACTORY_SYSTEM,
       
       T.VISITER_FACTORY_C_NUMBER,
       T.VISITER_FACTORY_K_NUMBER,
       T.VISITER_FACTORY_E_NUMBER,
       T.VISITER_FACTORY_PEOPLE,
       T.VISITER_FACTORY_WELCOME_SPEECH,
      
       substr(t.VISITER_FACTORY_LANGUAGE,
              0,
              length(t.VISITER_FACTORY_LANGUAGE) - 1) as VISITER_FACTORY_LANGUAGE,
       T.VISITER_FACTORY_MEMO,
       
       T.VISITER_TOURISM_FLAG,
       T.VISITER_TOURISM,
       
       T.VISITER_TOURISM_DATE,
       T.VISITER_TOURISM_TIME,
       T.VISITER_TOURISM_TYPE,
       
       T.VISITER_TOURISM_FEE,
       T.VISITER_TOURISM_MEMO
  from ga_visiter_apply t,
       hr_department    h,
      
       hr_employee      he,
      
       hr_employee      he1,
      
       pu_room          p
       
 where t.front_dept = h.deptid(+)
  
   and he.empid(+) = t.play_apply   
   and he1.empid(+) = t.front_emp_id
  
   and p.id (+) = t.VISITER_CONFERENCE_ROOM
   
   
   and t.GA_VISITER_APPLY_ID=#applyno:VARCHAR# 
	  	]]>
	</select>
	
	<select id="visiterViewDetail1" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
				select T.VIST_NAME,
					T.ID,
			       T.CORPORATION,
			       T.DIFFER AS DIFFER1,
			       (select c.code_name from sy_code c where c.code_id=t.differ ) as DIFFER,
			       T.TELEPHONE, 
			       T.PRESENT_APPPLY,
			       (select s.code_name from sy_code s where s.code_id=t.PRESENT_APPPLY ) as PRESENT_APPPLY_NAME,
			       T.PRESENT,
			       T.PRESENT_NUM,
			       T.MEMO,
			       T.JOBS
			  from GA_VISITER_PRESENT t
			 WHERE T.GA_VISITER_APPLY_ID = #applyno:VARCHAR# 
	  	]]>
	</select>
	
	<select id="visiterViewDetail2" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
				select T.ID,
				       t.accommodation_name,
				       (select c.code_name
				          from sy_code c
				         where c.code_id = t.accommodation_standard) as accommodation_standard_name,
				       t.accommodation_in_date,
				       t.accommodation_in_time,
				       substr(t.accommodation_in_time,1,2) accommodation_in_hour,
				       substr(t.accommodation_in_time,4,2) accommodation_in_min,
				       t.accommodation_out_date,
				       t.accommodation_out_time,
				       substr(t.accommodation_out_time,1,2) accommodation_out_hour,
				       substr(t.accommodation_out_time,4,2) accommodation_out_min,
				       t.accommodation_memo,
				       t.accommodation_standard
				  from ga_visiter_accommodation t
				 WHERE T.GA_VISITER_APPLY_ID = #applyno:VARCHAR#
	  	]]>
	</select>
	
	<select id="visiterViewDetail3" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
				select T.ID,
		               t.visiter_eatry_distinction,
		               (select c.code_name
		                  from sy_code c
		                 where c.code_id = t.visiter_eatry_distinction) as visiter_eatry_distinction_name,
		               t.visiter_eatry_name,
		               t.visiter_eatry_date,
		               t.visiter_eatry_time,
		               substr(t.visiter_eatry_time,1,2) visiter_eatry_hour,
		               substr(t.visiter_eatry_time,4,2) visiter_eatry_min,
		               t.visiter_eatry_type,
		               (select s.code_name
		                  from sy_code s
		                 where s.code_id = t.visiter_eatry_type) as visiter_eatry_type_name,
		               t.visiter_eatry_number,
		               t.visiter_eatry_memo
		               
		          from ga_visiter_eatry t
		         WHERE T.GA_VISITER_APPLY_ID = #applyno:VARCHAR#
	  	]]>
	</select>
	
	
	<select id="visiterViewDetailReport" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select G.GA_VISITER_APPLY_ID,
				   G.VIST_NAME,
			       G.ID,
			       G.CORPORATION,
			       (select c.code_name from sy_code c where c.code_id = G.differ) as DIFFER,
			       G.TELEPHONE,
			       G.PRESENT,
			       G.PRESENT_NUM,
			       G.MEMO,
			       G.JOBS
			  from ga_visiter_apply   t,
			       GA_VISITER_PRESENT g,
			       hr_department      h,
			       hr_department      h2,
			       sy_code            s,
			       sy_code            s1,
			       sy_code            s2,
			       hr_employee        he1,
			       hr_employee        hr
			 where g.ga_visiter_apply_id(+) = t.ga_visiter_apply_id
			   AND t.front_dept = h.deptid(+)
			   and t.active = '1'
			   and he1.person_id(+) = t.front_emp_id
			   and s.code_id(+) = t.visiter_country
			   and s1.code_id(+) = t.visiter_type
			   and s2.code_id(+) = t.visiter_distiniction
			   and t.play_apply = hr.person_id(+)
			   and hr.deptid = h2.deptid
	  	]]>
	  	
	  	<isEqual prepend="AND" property="falg" compareValue="0">
			<![CDATA[
				t.MODIFY_FLAG = '0'
			]]>
		</isEqual>
		<isEqual prepend="AND" property="falg" compareValue="1">
			<![CDATA[
				t.MODIFY_FLAG = '1'
			]]>
		</isEqual>
		<isNotEmpty prepend="AND" property="visitDate">
			<![CDATA[
				t.visiter_date >= #visitDate:VARCHAR#
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		 to_date(t.VISITER_DATE,'yyyy-mm-dd') >= to_date(#startDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			<![CDATA[		   
		 to_date(t.VISITER_DATE,'yyyy-mm-dd') <= to_date(#endDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="country">
			<![CDATA[
				 t.visiter_country = #country:varchar#
			]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.front_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
		<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (t.play_apply LIKE  '%'||#key:VARCHAR# || '%'   or hr.chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="ADMIN_ID">
			<![CDATA[		   
		 EXISTS ( SELECT SAD.ADMIN_DEPTID
					   FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
					  WHERE SAD.ADMIN_NO = SA.ADMINNO
					    AND SA.ADMINID = #ADMIN_ID:VARCHAR2#
					    AND SAD.ADMIN_DEPTID = h2.DEPTID	
				   ) 
		]]>
		</isNotEmpty>
		<![CDATA[
			order by t.ga_visiter_apply_id desc
		]]>
	</select>
	
	
	<insert id="visiterApplySave" parameterClass="SimpleMap">
		<![CDATA[
			insert into ga_visiter_apply t
			    (t.ga_visiter_apply_id,
			     t.VISIT_INTRO_DEPT,
			     t.VISITER_CONTACT_TEL,
			     t.VISITER_COMPANY,
			     t.VISIT_PLACE,
			     t.visit_count,
			     t.visiter_name,
			     t.note,
			     t.visiter_date,
			     t.visiter_carnum,
			     t.expect_result,
			     t.VISIT_TYPE,
			     t.visitor_type,
			     t.play_apply,
			     t.active,
			     t.apply_date,
			     t.visiter_type,
		         t.VISITER_PEOPLE_NUM,
		         t.FRONT_DEPT,
		         t.FRONT_EMP_ID,
		         t.RECEPTION_LEAD,
		         t.RECEPTION_ACT_PHONE,
		         t.VISITER_OBJECTIVE,
		         t.VISITER_COME_TIME,
		         t.VISITER_END_TIME,
		         t.MODIFY_FLAG,
		          
		         T.VISITER_CAR_MODEL,
		         T.VISITER_EATRY_FLAG,
		         T.VISITER_EATRY_DISTINCTION,
		         T.VISITER_EATRY_NAME,
		         T.VISITER_EATRY_DATE,
		         T.VISITER_EATRY_TIME,
		         T.VISITER_EATRY_TYPE,
		         T.VISITER_EATRY_NUMBER,
		         T.VISITER_EATRY_MEMO,
		         
		         T.VISITER_VOITURE_FLAG,
		         T.VISITER_VOITURE_NUMBER,
		         T.VISITER_VOITURE_IN_DATE,
		         T.VISITER_VOITURE_IN_TIME,
		         T.VISITER_VOITURE_OUT_DATE,
		         T.VISITER_VOITURE_OUT_TIME,
		         T.VISITER_VOITURE_START_AREA,
		         T.VISITER_VOITURE_PASS_AREA,
		         T.VISITER_VOITURE_END_AREA,
		         T.VISITER_VOITURE_MEMO,
		         
		         T.VISITER_CONFERENCE_FLAG,
		         T.VISITER_CONFERENCE_ROOM,
		         T.VISITER_CONFERENCE_LANGUAGE,
		         T.VISITER_CONFERENCE_PEOPLE,
		         T.VISITER_CONFERENCE_MANAGE,
		         T.VISITER_CONFERENCE_DATE,
		         T.VISITER_CONFERENCE_TIME,
		         T.VISITER_CONFERENCE_PURPOSE,
		         
		         T.VISITER_FACTORY_FLAG,
		         T.VISITER_FACTORY_NUMBER,
		         T.VISITER_FACTORY_METHOD,
		         T.VISITER_FACTORY_ROUTE,
		         T.VISITER_FACTORY_DEVICE,
		         T.VISITER_FACTORY_HELMET,
		         T.VISITER_FACTORY_HELMET_NUMBER,
		         T.VISITER_FACTORY_SYSTEM,
		         T.VISITER_FACTORY_C_NUMBER,
		         T.VISITER_FACTORY_K_NUMBER,
		         T.VISITER_FACTORY_E_NUMBER,
		         T.VISITER_FACTORY_PEOPLE,
		         T.VISITER_FACTORY_WELCOME_SPEECH,
		         T.VISITER_FACTORY_LANGUAGE,
		         T.VISITER_FACTORY_MEMO,
		         
		         T.VISITER_TOURISM_FLAG,
		         T.VISITER_TOURISM,
		         T.VISITER_TOURISM_DATE,
		         T.VISITER_TOURISM_TIME,
		         T.VISITER_TOURISM_TYPE,
		         T.VISITER_TOURISM_FEE,
		         T.VISITER_TOURISM_MEMO, 
		         T.WELCOME_SCR, 
		         T.RECEPTION_OFFICE, 
		         T.TEA, 
		         T.COFFEE, 
		         T.ADVERTISING_VIDEO, 
		         T.DEFEND_FACILITY, 
		         T.INTERPRET_FACILITY, 
		         T.SHOOT, 
		         T.PRESENT, 
		         T.LUNCH_REPAST, 
		         T.RESTAURANT, 
		         T.FRUIT
		         )
		         
			  values
			    (#applyId:VARCHAR#,
			     #visitIntroDept:VARCHAR#,
			     #visitPhone:VARCHAR#,
			     #visitDept:VARCHAR#,
			     #visitPlace:VARCHAR#,
			     #visitCount:VARCHAR#,
			     #visitNamePosition:VARCHAR#,
			     #note:VARCHAR#,
			     #visiterTime:VARCHAR#,
				 #carNum:VARCHAR#,
				 #expectResult:VARCHAR#,
				 #visitType:VARCHAR#,
				 #visitorType:VARCHAR#,
			     #supervisor:VARCHAR#,
			     '0',
			     sysdate,
			     #visiterType:VARCHAR#,
			     #peopleNum:NUMERIC#,
			     #frontdeptID:VARCHAR#,
			     #person_id:VARCHAR#,
			     #receptionLead:VARCHAR#,
			     #receptionActPhone:VARCHAR#,
			     #visitObjective:VARCHAR#,
			     #visiterComeTime:VARCHAR#,
			     #visiterEndTime:VARCHAR#,
			     '0',
                  
                 #visiterCarModel:VARCHAR#,
                 decode(#visiterCarModel:VARCHAR#,'true',#visiterEatryFlag:VARCHAR#,''),
			     decode(#visiterCarModel:VARCHAR#,'true',#visiterEatryDistinction:VARCHAR#,''),
			     decode(#visiterCarModel:VARCHAR#,'true',#visiterEatryName:VARCHAR#,''),
			     decode(#visiterCarModel:VARCHAR#,'true',#visiterEatryDate:VARCHAR#,''),
			     decode(#visiterCarModel:VARCHAR#,'true',#visiterEatryTime:VARCHAR#,''),
			     decode(#visiterCarModel:VARCHAR#,'true',#visiterEatryType:VARCHAR#,''),
			     decode(#visiterCarModel:VARCHAR#,'true',#visiterEatryNumber:NUMERIC#,''),
			     decode(#visiterCarModel:VARCHAR#,'true',#visiterEatryMemo:VARCHAR#,''),
			     
			     #visiterVoitureFlag:VARCHAR#,
			     decode(#visiterVoitureFlag:VARCHAR#,'true',#visiterVoitureNumber:NUMERIC#,''),
			     decode(#visiterVoitureFlag:VARCHAR#,'true',#visiterVoitureInDate:VARCHAR#,''),
			     decode(#visiterVoitureFlag:VARCHAR#,'true',#visiterVoitureInTime:VARCHAR#,''),
			     decode(#visiterVoitureFlag:VARCHAR#,'true',#visiterVoitureOutDate:VARCHAR#,''),
			     decode(#visiterVoitureFlag:VARCHAR#,'true',#visiterVoitureOutTime:VARCHAR#,''),
			     decode(#visiterVoitureFlag:VARCHAR#,'true',#visiterVoitureStartArea:VARCHAR#,''),
			     decode(#visiterVoitureFlag:VARCHAR#,'true',#visiterVoiturePassArea:VARCHAR#,''),
			     decode(#visiterVoitureFlag:VARCHAR#,'true',#visiterVoitureEndArea:VARCHAR#,''),
			     decode(#visiterVoitureFlag:VARCHAR#,'true',#visiterVoitureMemo:VARCHAR#,''),
			     
			     #visiterConferenceFlag:VARCHAR#,
			     decode(#visiterConferenceFlag:VARCHAR#,'true',#visiterConferenceRoom:VARCHAR#,''),
			     decode(#visiterConferenceFlag:VARCHAR#,'true',#visiter_conference_language:VARCHAR#,''),
			     decode(#visiterConferenceFlag:VARCHAR#,'true',#visiterConferencePeople:VARCHAR#,''),
			     decode(#visiterConferenceFlag:VARCHAR#,'true',#visiterConferenceManageYesOrNo:VARCHAR#,''),
			     decode(#visiterConferenceFlag:VARCHAR#,'true',#pian_language:VARCHAR#,''),
			     decode(#visiterConferenceFlag:VARCHAR#,'true',#visiterConferenceTime:VARCHAR#,''),
			     decode(#visiterConferenceFlag:VARCHAR#,'true',#visiterConferencePurpose:VARCHAR#,''),

			     #visiterFactoryFlag:VARCHAR#,
			     decode(#visiterFactoryFlag:VARCHAR#,'true',#visiterFactoryNumber:NUMERIC#,''),
			     decode(#visiterFactoryFlag:VARCHAR#,'true',#visiterFactoryMethod:VARCHAR#,''),
			     decode(#visiterFactoryFlag:VARCHAR#,'true',#visiterFactoryRoute:VARCHAR#,''),
			     decode(#visiterFactoryFlag:VARCHAR#,'true',#visiter_factory_device:VARCHAR#,''),
			     decode(#visiterFactoryFlag:VARCHAR#,'true',#visiterFactoryHelmetYesOrNo:VARCHAR#,''),
			     decode(#visiterFactoryFlag:VARCHAR#,'true',#visiterFactoryHelmetNumber:NUMERIC#,''),
			     decode(#visiterFactoryFlag:VARCHAR#,'true',#visiterFactorySystemYesOrNo:VARCHAR#,''),
			     decode(#visiterFactoryFlag:VARCHAR#,'true',#visiterFactoryCNumber:NUMERIC#,''),
			     decode(#visiterFactoryFlag:VARCHAR#,'true',#visiterFactoryKNumber:NUMERIC#,''),
			     decode(#visiterFactoryFlag:VARCHAR#,'true',#visiterFactoryENumber:NUMERIC#,''),
			     decode(#visiterFactoryFlag:VARCHAR#,'true',#visiterFactoryPeople:VARCHAR#,''),
			     decode(#visiterFactoryFlag:VARCHAR#,'true',#visiterFactoryWelcomeSpeech:VARCHAR#,''),
			     decode(#visiterFactoryFlag:VARCHAR#,'true',#visiter_factory_language:VARCHAR#,''),
			     decode(#visiterFactoryFlag:VARCHAR#,'true',#visiterFactoryMemo:VARCHAR#,''),
			     
			     #visiterTourismFlag:VARCHAR#,
			     decode(#visiterTourismFlag:VARCHAR#,'true',#visiterTourismYesOrNo:VARCHAR#,''),
			     decode(#visiterTourismFlag:VARCHAR#,'true',#visiterTourismDate:VARCHAR#,''),
			     decode(#visiterTourismFlag:VARCHAR#,'true',#visiterTourismTime:VARCHAR#,''),
			     decode(#visiterTourismFlag:VARCHAR#,'true',#visiterTourismType:VARCHAR#,''),
			     decode(#visiterTourismFlag:VARCHAR#,'true',#visiterTourismFee:VARCHAR#,''),
			     decode(#visiterTourismFlag:VARCHAR#,'true',#visiterTourismMemo:VARCHAR#,''),
			     #welcome:VARCHAR#,
			     #receptionOffice:VARCHAR#,
			     #tea:VARCHAR#,
			     #coffee:VARCHAR#,
			     #advertisingVideo:VARCHAR#,
			     #defendFacility:VARCHAR#,
			     #interpretFacility:VARCHAR#,
			     #shoot:VARCHAR#,
			     #present:VARCHAR#,
			     #lunchRepast:VARCHAR#,
			     #restaurant:VARCHAR#,
			     #fruit:VARCHAR#
			     
			     )
		]]>
	</insert>
	
	<insert id="accessApplySave" parameterClass="SimpleMap">
		<![CDATA[
			insert into ga_access_apply t
			    (t.ga_access_apply_id,
			     t.access_country,
			     t.access_date,
			     t.access_carnumber,
			     t.access_carnum,
			     t.front_dept,
			     t.play_apply,
			     t.active,
			     t.apply_date,
			     t.access_type,
		         t.access_PEOPLE_NUM,
		         t.FRONT_EMP_ID,
		         t.WELCOME,
		         t.access_OBJECTIVE,
		         t.device,
		         t.access_distiniction,
		         t.access_COME_TIME,
		         t.access_END_TIME,
		         t.huiyishi_applyid,
		         t.MODIFY_FLAG,
		         T.jiangjie,
		         t.cpnyid
		         )
			  values
			    (#applyId:VARCHAR#,
			     #visiterCountry:VARCHAR#,
			     #visiterTime:VARCHAR#,
			     #visiterCarNumber:VARCHAR#,
				 #visiterCarNum:VARCHAR#,
			     #frontdeptID:VARCHAR#,
			     #supervisor:VARCHAR#,
			     '0',
			     sysdate,
			     #visiterType:VARCHAR#,
			     #peopleNum:NUMERIC#,
			     #person_id:VARCHAR#,
			     #Welcome:VARCHAR#,
			     #Objective:VARCHAR#,
			     #Device:VARCHAR#,
			     #Distinction:VARCHAR#,
			     #visiterComeTime:VARCHAR#,
			     #visiterEndTime:VARCHAR#,
			     #huiyishiApplyId:VARCHAR#,
			     '0',
			     #jiangjie:VARCHAR#,
			     #cpnyId:VARCHAR#
			     )
		]]>
	</insert>
	
	<insert id="accessManagementSave" parameterClass="SimpleMap">
		<![CDATA[
			  insert into GA_ACCESS_PRESENT t
			    (t.GA_ACCESS_APPLY_ID,
			     t.ACCESS_NAME,
          		 t.CORPORATION,
			     t.DIFFER,
			     t.TELEPHONE,
			     t.PRESENT,
			     t.PRESENT_NUM,
			     t.MEMO,
			     t.JOBS,
			     t.CREATED_BY,
			     t.CREATE_DATE,
			     T.ID)
			  values
			    (#ga_vister_apply_id:VARCHAR#,
			     #vist_name:VARCHAR#,
          		 #corpopation:NUMERIC#,
			     #differ:VARCHAR#,
			     #telephone:VARCHAR#, 
			     #present:VARCHAR#,
			     #present_num:VARCHAR#,
			     #memo:VARCHAR#,
			     #jobs:VARCHAR#,
				 #person_id:VARCHAR#,
			     sysdate,
			     GA_ACCESS_SEQ.NEXTVAL)
		]]>
	</insert>
	
	<insert id="visiterManagementSave" parameterClass="SimpleMap">
		<![CDATA[
			  insert into GA_VISITER_PRESENT t
			    (t.GA_VISITER_APPLY_ID,
			     t.VIST_NAME,
          		 t.CORPORATION,
			     t.DIFFER,
			     t.TELEPHONE,
			     t.PRESENT,
			     t.PRESENT_NUM,
			     t.MEMO,
			     t.JOBS,
			     t.CREATED_BY,
			     t.CREATE_DATE,
			     t.PRESENT_APPPLY,
			     T.ID)
			  values
			    (#ga_vister_apply_id:VARCHAR#,
			     #vist_name:VARCHAR#,
          		 #corpopation:NUMERIC#,
			     #differ:VARCHAR#,
			     #telephone:VARCHAR#, 
			     #present:VARCHAR#,
			     #present_num:VARCHAR#,
			     #memo:VARCHAR#,
			     #jobs:VARCHAR#,
				 #person_id:VARCHAR#,
			     sysdate,
                 #present_appply:VARCHAR#,
			     GA_PRESENT_SEQ.NEXTVAL)
		]]>
	</insert>
	
	<insert id="visiterAccommodationSave" parameterClass="SimpleMap">
		<![CDATA[
			  insert into GA_VISITER_ACCOMMODATION t
			    (t.GA_VISITER_APPLY_ID,
			     t.ACCOMMODATION_NAME,
          		 t.ACCOMMODATION_STANDARD,
			     t.ACCOMMODATION_IN_DATE,
			     t.ACCOMMODATION_IN_TIME,
			     t.ACCOMMODATION_OUT_DATE,
			     t.ACCOMMODATION_OUT_TIME,
			     t.ACCOMMODATION_MEMO,
			     t.CREATED_BY,
			     t.CREATE_DATE,
			     T.ID)
			  values
			    (#ga_vister_apply_id:VARCHAR#,
			     #accommodation_name:VARCHAR#,
          		 #accommodation_standard:VARCHAR#,
			     #accommodation_in_date:VARCHAR#,
			     #accommodation_in_time:VARCHAR#, 
			     #accommodation_out_date:VARCHAR#,
			     #accommodation_out_time:VARCHAR#,
			     #accommodation_memo:VARCHAR#,
				 #person_id:VARCHAR#,
			     sysdate,
			     GA_ACCOMMODATION_SEQ.NEXTVAL)
		]]>
	</insert>
	
	<insert id="visiterEatrySave" parameterClass="SimpleMap">
		<![CDATA[
			  insert into GA_VISITER_EATRY t
			    (t.GA_VISITER_APPLY_ID,
			     t.VISITER_EATRY_DISTINCTION,
          		 t.VISITER_EATRY_NAME,
			     t.VISITER_EATRY_DATE,
			     t.VISITER_EATRY_TIME,
			     t.VISITER_EATRY_TYPE,
			     t.VISITER_EATRY_NUMBER,
			     t.VISITER_EATRY_MEMO,
			     t.CREATED_BY,
			     t.CREATE_DATE,
			     T.ID)
			  values
			    (#ga_vister_apply_id:VARCHAR#,
			     #visiter_eatry_distinction:VARCHAR#,
          		 #visiter_eatry_name:VARCHAR#,
			     #visiter_eatry_date:VARCHAR#,
			     #visiter_eatry_time:VARCHAR#, 
			     #visiter_eatry_type:VARCHAR#,
			     #visiter_eatry_number:NUMERIC#,
			     #visiter_eatry_memo:VARCHAR#,
				 #person_id:VARCHAR#,
			     sysdate,
			     GA_EATRY_SEQ.NEXTVAL)
		]]>
	</insert>
	
	<insert id="visiterAffirmSave" parameterClass="SimpleMap">
		<![CDATA[
			  INSERT INTO ga_visiter_apply_affirm
			  (GA_AFFIRM_NO,
			   APPLY_NO,
			   AFFIRM_FLAG,
			   CREATE_DATE,
			   CREATED_BY,
			   AFFIRM_LEVEL,
			   AFFIRMOR_ID,
			   ACTIVITY,
			   APPLY_TYPE
			   )
			VALUES
			  (GA_VISITER_APPLY_AFFIRM_SEQ.NEXTVAL,
			    #applyId:NUMERIC#,
			    #affirmFlag:NUMERIC#,
			   SYSDATE,
			   #supervisor:VARCHAR#,
			   #AFFIRM_LEVEL:NUMERIC#,
			   #AFFIRMOR_ID:VARCHAR#,
			   1,
			   'Visiter_Apply'
			   )
		]]>
	</insert>
	
	<select id="apiLanguage" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			  select *
				  from sy_code s
				 where s.parent_code = 'LanguageTypeCode'
				   and s.code_id <> 'LanguageTypeCode170'
				   and s.code_id <> 'LanguageTypeCode130'
	  	]]>
	</select>
	
	<select id="allvisiterApplyInformation" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			   select t.ga_visiter_apply_id,
				       t.visiter_company,
	               t.visit_type,
	               t.visiter_contact_tel,
	               t.visit_intro_dept,   
	               t.visit_place,
	               t.visit_count,
	               t.visiter_name,
	               t.visitor_type ,
	               t.expect_result,
	               t.reception_lead,
	               t.reception_act_phone,
	               t.note,         
	               t.welcome_scr,
	               t.reception_office,
	               t.tea,
	               t.coffee,
	               t.advertising_video,
	               t.defend_facility,
	               t.interpret_facility,
	               t.shoot,
	               t.present,
	               t.lunch_repast,
	               t.restaurant,
	               t.fruit,
				   t.visiter_carnum,   
				       t.visiter_objective,
				       t.visiter_date,
				       h.deptname,
				       t.active,
				       he.chinesename as play_applyChinesename,
              			 t.play_apply,
				       t.active,
				       t.apply_date,
				       
               t.visiter_people_num,
               t.visiter_out_date,
               he1.chinesename,
               t.welcome,
               t.visiter_people_num,
              
               t.visiter_come_time,
               t.visiter_end_time,
               t.HUIYISHI_APPLYID,
               AFFIRM.AFFIRM_FLAG as AFFIRM_FLAG,
               m.affirmoridea
				  from ga_visiter_apply t,
				  ga_visiter_apply_affirm m,
				       hr_department    h,
				    
				       hr_employee      he,
				     
               hr_employee      he1,
               (SELECT 
 visiter_apply_affirm.*,
 UP_AFFIRM.AFFIRMOR_ID UP_AFFIRMOR_ID,
 NVL(UP_AFFIRM.AFFIRM_FLAG,1) UP_AFFIRM_FLAG,
 CASE 
 WHEN visiter_apply_affirm.AFFIRM_LEVEL=MAX_AFFIRM.MAX_LEVEL
 THEN 1
 ELSE 0
 END AS MAX_LEVEL_FLAG
 FROM 
 (SELECT ga_visiter_apply_affirm.*,
       ga_visiter_apply_affirm.AFFIRM_LEVEL - 1 UP_LEVEL,
       ga_visiter_apply_affirm.AFFIRM_LEVEL + 1 NEXT_LEVEL
  FROM ga_visiter_apply_affirm) visiter_apply_affirm,
  (SELECT  ga_visiter_apply_affirm.APPLY_NO,ga_visiter_apply_affirm.AFFIRM_LEVEL,ga_visiter_apply_affirm.AFFIRMOR_ID,ga_visiter_apply_affirm.AFFIRM_FLAG
  FROM ga_visiter_apply_affirm 
  ) UP_AFFIRM,
  (SELECT  ga_visiter_apply_affirm.APPLY_NO,MAX(ga_visiter_apply_affirm.AFFIRM_LEVEL) MAX_LEVEL
  FROM ga_visiter_apply_affirm 
   GROUP BY ga_visiter_apply_affirm.APPLY_NO ) MAX_AFFIRM
   WHERE visiter_apply_affirm.APPLY_NO=UP_AFFIRM.APPLY_NO(+)
    AND visiter_apply_affirm.UP_LEVEL=UP_AFFIRM.AFFIRM_LEVEL(+)    
    AND visiter_apply_affirm.APPLY_NO=MAX_AFFIRM.APPLY_NO(+)
    and visiter_apply_affirm.affirmor_id=#supervisor:VARCHAR# ) AFFIRM 
    
				 where t.front_dept = h.deptid(+)				   
				   and he.person_id (+)= t.play_apply
				   and t.ga_visiter_apply_id in (select distinct a.apply_no from ga_visiter_apply_affirm a where a.affirmor_id=#supervisor:VARCHAR# 
				   ]]>
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				 a.affirm_flag=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 a.affirm_flag =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 a.affirm_flag =2
	]]>
	</isEqual>
	<isEmpty prepend="AND" property="qryType">
		<![CDATA[		   
		 a.affirm_flag=0
		]]>	
	</isEmpty>
  <![CDATA[	
   )
  ]]>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (t.play_apply LIKE  '%'||#key:VARCHAR# || '%'   or he.chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.front_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		 to_date(t.VISITER_DATE,'yyyy-mm-dd') >= to_date(#startDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			<![CDATA[		   
		 to_date(t.VISITER_DATE,'yyyy-mm-dd') <= to_date(#endDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="cpnyId">
		<![CDATA[		   
		 h.cpny_id=#cpnyId:VARCHAR#
		]]>	
	</isNotEmpty>
		
	<![CDATA[	
                   and he1.person_id(+) = t.front_emp_id
				   and t.ga_visiter_apply_id=AFFIRM.APPLY_NO
				   AND AFFIRM.UP_AFFIRM_FLAG=1
				      and t.ga_visiter_apply_id = m.apply_no
   					and m.affirmor_id = #supervisor:VARCHAR# 
                 
				 order by t.ga_visiter_apply_id desc
	  	]]>
	</select>
	
	<select id="allvisiterApplyInformationCount" parameterClass="SimpleMap" resultClass="int">
			<![CDATA[
			   select count(*)
				  from ga_visiter_apply t,
				  ga_visiter_apply_affirm m,
				       hr_department    h,
				       hr_employee      he,
               		   hr_employee      he1,
               (SELECT 
				 visiter_apply_affirm.*,
				 UP_AFFIRM.AFFIRMOR_ID UP_AFFIRMOR_ID,
				 NVL(UP_AFFIRM.AFFIRM_FLAG,1) UP_AFFIRM_FLAG,
				 CASE 
				 WHEN visiter_apply_affirm.AFFIRM_LEVEL=MAX_AFFIRM.MAX_LEVEL
				 THEN 1
				 ELSE 0
				 END AS MAX_LEVEL_FLAG
				 FROM 
				 (SELECT ga_visiter_apply_affirm.*,
				       ga_visiter_apply_affirm.AFFIRM_LEVEL - 1 UP_LEVEL,
				       ga_visiter_apply_affirm.AFFIRM_LEVEL + 1 NEXT_LEVEL
				  FROM ga_visiter_apply_affirm) visiter_apply_affirm,
				  (SELECT  ga_visiter_apply_affirm.APPLY_NO,ga_visiter_apply_affirm.AFFIRM_LEVEL,ga_visiter_apply_affirm.AFFIRMOR_ID,ga_visiter_apply_affirm.AFFIRM_FLAG
				  FROM ga_visiter_apply_affirm 
				  ) UP_AFFIRM,
				  (SELECT  ga_visiter_apply_affirm.APPLY_NO,MAX(ga_visiter_apply_affirm.AFFIRM_LEVEL) MAX_LEVEL
				  FROM ga_visiter_apply_affirm 
				   GROUP BY ga_visiter_apply_affirm.APPLY_NO ) MAX_AFFIRM
				   WHERE visiter_apply_affirm.APPLY_NO=UP_AFFIRM.APPLY_NO(+)
				    AND visiter_apply_affirm.UP_LEVEL=UP_AFFIRM.AFFIRM_LEVEL(+)    
				    AND visiter_apply_affirm.APPLY_NO=MAX_AFFIRM.APPLY_NO(+)
				    and visiter_apply_affirm.affirmor_id=#supervisor:VARCHAR# ) AFFIRM 
    
				 where t.front_dept = h.deptid(+)				   
				   and he.person_id (+)= t.play_apply
				   and t.ga_visiter_apply_id in (select distinct a.apply_no from ga_visiter_apply_affirm a where a.affirmor_id=#supervisor:VARCHAR# 
				   ]]>
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				 a.affirm_flag=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 a.affirm_flag =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 a.affirm_flag =2
	]]>
	</isEqual>
	<isEmpty prepend="AND" property="qryType">
		<![CDATA[		   
		 a.affirm_flag=0
		]]>	
	</isEmpty>
  <![CDATA[	
   )
  ]]>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (t.play_apply LIKE  '%'||#key:VARCHAR# || '%'   or he.chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.front_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		 to_date(t.VISITER_DATE,'yyyy-mm-dd') >= to_date(#startDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			<![CDATA[		   
		 to_date(t.VISITER_DATE,'yyyy-mm-dd') <= to_date(#endDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="cpnyId">
		<![CDATA[		   
		 h.cpny_id=#cpnyId:VARCHAR#
		]]>	
	</isNotEmpty>
		
	<![CDATA[	
                   and he1.person_id(+) = t.front_emp_id
				   and t.ga_visiter_apply_id=AFFIRM.APPLY_NO
				   AND AFFIRM.UP_AFFIRM_FLAG=1
				      and t.ga_visiter_apply_id = m.apply_no
   					and m.affirmor_id = #supervisor:VARCHAR# 
				 order by t.ga_visiter_apply_id desc
	  	]]>
	</select>
		
	<select id="allvisiterAffrimInfoList" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			   select t.ga_visiter_apply_id,
				      t.visiter_name,
	               t.visiter_company,
	               t.visit_type,
	               t.visiter_contact_tel,
	               t.visit_intro_dept,   
	               t.visit_place,
	               t.visit_count,
	               t.visitor_type ,
	               t.expect_result,
	               t.reception_lead,
	               t.reception_act_phone,
	               t.note,         
	               t.welcome_scr,
	               t.reception_office,
	               t.tea,
	               t.coffee,
	               t.advertising_video,
	               t.defend_facility,
	               t.interpret_facility,
	               t.shoot,
	               t.present,
	               t.lunch_repast,
	               t.restaurant,
	               t.fruit,
				       t.visiter_objective,
				       t.visiter_date,
				       t.visiter_carnum,   
				       h.deptname,
				       he.chinesename as play_applyChinesename,
              			 t.play_apply,
				       t.active,
				       t.apply_date,
               t.visiter_people_num,
               t.visiter_out_date,
               he1.chinesename,
               t.welcome,
               t.visiter_people_num,
              
               t.visiter_come_time,
               t.visiter_end_time,
               t.HUIYISHI_APPLYID,
               t.MODIFY_FLAG,
                      t.confirmidea,
       			hr.chinesename as chinesename1,
       			t.MANY
				  from ga_visiter_apply t,
				       hr_department    h,
				       hr_employee      he,
				       hr_employee      hr,
              		   hr_employee      he1
				 where t.front_dept = h.deptid(+)	and t.confirmorid = hr.person_id(+)	   
			   and he.person_id(+) = t.play_apply
			   and t.ga_visiter_apply_id in (select distinct  a.apply_no from ga_visiter_apply_affirm a where a.activity =1)
				   ]]>
				   
			<isNotEmpty prepend="AND" property="ADMIN_ID">
		<![CDATA[
			EXISTS ( SELECT SAD.ADMIN_DEPTID
				   FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
				  WHERE SAD.ADMIN_NO = SA.ADMINNO
				    AND SA.ADMINID = #ADMIN_ID:VARCHAR2#
				    AND SAD.ADMIN_DEPTID = he.deptid	
			   ) 
		]]>
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="supervisor">
			<![CDATA[		
			   t.play_apply = #supervisor:VARCHAR#
		]]>
		</isNotEmpty>
			
         <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
			<![CDATA[
						 t.MODIFY_FLAG=0 and (t.active = 1 or t.active = 0)
			]]>
			</isEqual>
			<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
				<![CDATA[
						 t.MODIFY_FLAG =1 and t.active = 1
			]]>
			</isEqual>
			<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
				<![CDATA[
						 t.MODIFY_FLAG =2
			]]>
			</isEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (t.play_apply LIKE  '%'||#key:VARCHAR# || '%'   or he.chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.front_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		 to_date(t.VISITER_DATE,'yyyy-mm-dd') >= to_date(#startDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			<![CDATA[		   
		 to_date(t.VISITER_DATE,'yyyy-mm-dd') <= to_date(#endDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
	<![CDATA[	
                   and he1.person_id(+) = t.front_emp_id
				  
				 order by t.ga_visiter_apply_id desc
	  	]]>
	</select>	
		
	<select id="allvisiterAffrimInfoCount" parameterClass="SimpleMap" resultClass="int">
		<![CDATA[
			 select count(*)
				  from ga_visiter_apply t,
				       hr_department    h,
				       hr_employee      he,
				       hr_employee      hr,
              		   hr_employee      he1
				 where t.front_dept = h.deptid(+)	and t.confirmorid = hr.person_id(+)	   
			   and he.person_id(+) = t.play_apply
			   and t.ga_visiter_apply_id in (select distinct  a.apply_no from ga_visiter_apply_affirm a where a.activity =1)
			         				   ]]>
			         				   
			 <isNotEmpty prepend="AND" property="ADMIN_ID">
		<![CDATA[
			EXISTS ( SELECT SAD.ADMIN_DEPTID
				   FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
				  WHERE SAD.ADMIN_NO = SA.ADMINNO
				    AND SA.ADMINID = #ADMIN_ID:VARCHAR2#
				    AND SAD.ADMIN_DEPTID = t.FRONT_DEPT	
			   ) 
		]]>
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="supervisor">
			<![CDATA[		
			   t.play_apply = #supervisor:VARCHAR#
		]]>
		</isNotEmpty>
		
			 <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
			<![CDATA[
						 t.MODIFY_FLAG=0 and (t.active = 1 or t.active = 0)
			]]>
			</isEqual>
			<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
				<![CDATA[
						 t.MODIFY_FLAG =1 and t.active = 1
			]]>
			</isEqual>
			<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
				<![CDATA[
						 t.MODIFY_FLAG =2
			]]>
			</isEqual>
		<isNotEmpty prepend="AND" property="key">
			<![CDATA[		   
		 (t.play_apply LIKE  '%'||#key:VARCHAR# || '%'   or he.chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deptid">
			<![CDATA[		   
		 t.front_dept=#deptid:VARCHAR#
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		 to_date(t.VISITER_DATE,'yyyy-mm-dd') >= to_date(#startDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			<![CDATA[		   
		 to_date(t.VISITER_DATE,'yyyy-mm-dd') <= to_date(#endDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<![CDATA[	
			   
			 and he1.person_id(+) = t.front_emp_id
				 order by t.ga_visiter_apply_id desc
				 
	  	]]>	
	 </select>
	
	<select id="affirmByInformation" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			 SELECT SY_AFFIRM_RELATION_TB.AFFIRMOR_ID,
			       HR_AFFIRMOR.CHINESENAME AFFIRMOR_NAME,
			       HR_AFFIRMOR.Chinese_Pinyin,
			       HR_AFFIRMOR.KOREANNAME,
			       SY_AFFIRM_RELATION_TB.AFFIRM_LEVEL,
			       $seq$ AS SEQ
			  FROM SY_AFFIRM_RELATION_TB, HR_EMPLOYEE, HR_EMPLOYEE HR_AFFIRMOR
			 WHERE SY_AFFIRM_RELATION_TB.AFFIRM_OBJECT = HR_EMPLOYEE.EMPID(+)
			   AND SY_AFFIRM_RELATION_TB.AFFIRMOR_ID = HR_AFFIRMOR.EMPID(+)
			   AND SY_AFFIRM_RELATION_TB.AFFIRM_TYPE_ID = 'Visiter_Apply'
			   AND HR_EMPLOYEE.EMPID = #supervisor:VARCHAR#
			 ORDER BY AFFIRM_LEVEL
	  	]]>
	</select>
	
	<select id="affirmByInformation1" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			 SELECT SY_AFFIRM_RELATION_TB.AFFIRMOR_ID,
			        HR_AFFIRMOR.CHINESENAME AFFIRMOR_NAME,
			        HR_AFFIRMOR.Chinese_Pinyin,
			        HR_AFFIRMOR.KOREANNAME,
			        SY_AFFIRM_RELATION_TB.AFFIRM_LEVEL,
			        $seq$ AS SEQ
			   FROM SY_AFFIRM_RELATION_TB, HR_EMPLOYEE, HR_EMPLOYEE HR_AFFIRMOR
			  WHERE SY_AFFIRM_RELATION_TB.AFFIRM_OBJECT = HR_EMPLOYEE.DEPTID(+)
			    AND SY_AFFIRM_RELATION_TB.AFFIRMOR_ID = HR_AFFIRMOR.EMPID(+)
			    AND SY_AFFIRM_RELATION_TB.AFFIRM_TYPE_ID = 'Visiter_Apply'
			    AND HR_EMPLOYEE.EMPID = #supervisor:VARCHAR#
			  ORDER BY AFFIRM_LEVEL
	  	]]>
	</select>
	
	<select id="allVisiterApproval" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
select t.ga_affirm_no,
       t.affirm_flag,
       t.apply_no,
       t.affirm_level,
       t.affirmor_id,
       hr.chinesename,
       TO_CHAR(T.UPDATE_DATE,'YYYY-MM-DD HH24:MI') UPDATE_DATE,
       CASE WHEN 
       T.AFFIRM_LEVEL=MAX_AFFIRM_TABLE.MAX_AFFIRM_LEVEL
       THEN 1
       ELSE 0
       END MAX_AFFIRM_FLAG,
       t.AFFIRMORIDEA
  from ga_visiter_apply_affirm t,
       hr_employee hr,
       (select  max(affirm.affirm_level) MAX_AFFIRM_LEVEL
          from ga_visiter_apply_affirm affirm
         WHERE affirm.apply_no=#applyId:NUMERIC#
        ) MAX_AFFIRM_TABLE
 where t.affirmor_id = hr.person_id
   and t.apply_no = #applyId:NUMERIC#
 order by t.affirm_level

	  	]]>
	</select>
	
	<select id="allVisiterApproval1" parameterClass="SimpleMap" resultClass="string">
		<![CDATA[
			 select affirm.affirm_flag
			  from HR_EMPLOYEE HR, ga_visiter_apply_affirm affirm
			 where affirm.apply_no = #applyId:VARCHAR#
			   and affirm.affirmor_id = hr.empid
			   and affirm.affirm_level =
			       (select a.affirm_level
			          from (select affirm.apply_no,
			                       affirm.ga_affirm_no,
			                       hr.chinesename,
			                       hr.empid,
			                       affirm.affirm_flag,
			                       affirm.affirm_level
			                  from HR_EMPLOYEE HR, ga_visiter_apply_affirm affirm
			                 where affirm.apply_no = #applyId:VARCHAR#
			                   and empid = #empid:VARCHAR#
			                   and affirm.affirmor_id = hr.empid
			                 order by affirm.affirm_level) a) + 1
	  	]]>
	</select>
	
	<select id="allVisiterApproval2" parameterClass="SimpleMap" resultClass="string">
		<![CDATA[
			 select affirm.affirm_flag
			  from HR_EMPLOYEE HR, ga_visiter_apply_affirm affirm
			 where affirm.apply_no = #applyId:VARCHAR#
			   and affirm.affirmor_id = hr.empid
			   and affirm.affirm_level =
			       (select a.affirm_level
			          from (select affirm.apply_no,
			                       affirm.ga_affirm_no,
			                       hr.chinesename,
			                       hr.empid,
			                       affirm.affirm_flag,
			                       affirm.affirm_level
			                  from HR_EMPLOYEE HR, ga_visiter_apply_affirm affirm
			                 where affirm.apply_no = #applyId:VARCHAR#
			                   and empid = #empid:VARCHAR#
			                   and affirm.affirmor_id = hr.empid
			                 order by affirm.affirm_level) a) - 1
	  	]]>
	</select>
	
	<select id="getAffirmor" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			 
			SELECT SY_AFFIRM_RELATION_TB.AFFIRMOR_ID,
			       HR_AFFIRMOR.CHINESENAME AFFIRMOR_NAME,
			       SY_AFFIRM_RELATION_TB.AFFIRM_LEVEL,
       			   HR_EMPLOYEE.EMAIL
			  FROM SY_AFFIRM_RELATION_TB, HR_EMPLOYEE, HR_EMPLOYEE HR_AFFIRMOR
			 WHERE SY_AFFIRM_RELATION_TB.AFFIRM_OBJECT = HR_EMPLOYEE.EMPID
			   AND SY_AFFIRM_RELATION_TB.AFFIRMOR_ID = HR_AFFIRMOR.EMPID
			   AND SY_AFFIRM_RELATION_TB.AFFIRM_TYPE_ID = 'Visiter_Apply'
			   AND HR_EMPLOYEE.EMPID = #play_apply:VARCHAR#
			 ORDER BY AFFIRM_LEVEL
	  	]]>
	</select>
	
	<update id="updateAffirmFlag" parameterClass="SimpleMap">
		<![CDATA[
			 update ga_visiter_apply_affirm set AFFIRM_FLAG = #flag:NUMERIC#,AFFIRMORIDEA=#affirmorIdea:varchar#,UPDATE_DATE = SYSDATE
         		where GA_AFFIRM_NO = #affirmNo:NUMERIC#
	  	]]>
	</update>
	
	<delete id="deleteApply" parameterClass="SimpleMap">
	<![CDATA[
	 delete from ga_visiter_apply t where t.GA_VISITER_APPLY_ID=#visiterNo:VARCHAR#
	  ]]>
	</delete>
	<delete id="deleteAffirm" parameterClass="SimpleMap">
	<![CDATA[
	 delete from ga_visiter_apply_affirm t  where t.apply_no=#visiterNo:NUMERIC#
	  ]]>
	</delete>  
	<delete id="deletePresent" parameterClass="SimpleMap">
	<![CDATA[
	 delete from ga_visiter_present t  where t.GA_VISITER_APPLY_ID=#visiterNo:NUMERIC#
	  ]]>
	</delete>  
	<delete id="deleteAccommodation" parameterClass="SimpleMap">
	<![CDATA[
	 delete from ga_visiter_accommodation t  where t.GA_VISITER_APPLY_ID=#visiterNo:NUMERIC#
	  ]]>
	</delete>  
	<delete id="deleteEatry" parameterClass="SimpleMap">
	<![CDATA[
	 delete from ga_visiter_eatry t  where t.GA_VISITER_APPLY_ID=#visiterNo:NUMERIC#
	  ]]>
	</delete>  
	
	<select id="getSeq" parameterClass="SimpleMap" resultClass="int">
		<![CDATA[
			 SELECT GA_VISITER_ID_SEQ.NEXTVAL FROM DUAL
	  	]]>
	</select>
	
	<select id="getAllVisiterCountry" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			 select * from sy_code t where t.parent_code = 'Visiter_Country'
	  	]]>
	</select>
	
	<select id="visiterType" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select * from sy_code s where s.parent_code = 'Visiter_Type' order by s.orderno
	  	]]>
	</select>
	
	<select id="getDept" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select * from hr_department d where d.dept_level = 4
	  	]]>
	</select>
	
	
	<select id="allDevice" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select * from sy_code t where t.parent_code = 'Facilities'
		]]>
	</select>
	
	<select id="allLanguage" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			 select *
				  from sy_code s
				 where s.parent_code = 'LanguageTypeCode'
				   and s.code_id <> 'LanguageTypeCode170'
				   and s.code_id <> 'LanguageTypeCode130'
		]]>
	</select>
	
	<select id="allFile" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select * from sy_code t where t.parent_code = 'file' 
		]]>
	<isNotEmpty prepend="AND" property="cpny_id">
			<![CDATA[		   
		 (t.cpny_id=#cpny_id:VARCHAR# OR t.cpny_id IS NULL)
		]]>
	</isNotEmpty>
	</select>
	
	<select id="visit_item" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select * from sy_code t where t.parent_code = 'visit_item'
		]]>
	</select>
	
	<select id="allVisiterDistiniction" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select * from sy_code s where s.parent_code = 'Visiter_Distiniction'
		]]>
	</select>
	
	<select id="getconfirm" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select email
			  from hr_employee
			 where empid in
			       ($applerId$)
		]]>
	</select>
	
	<select id="getSingleInfo" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select t.visiter_date,
			       s1.code_name as visiter_type,
			       t.visiter_people_num,
			       t.visiter_come_time,
			       t.visiter_end_time,
       		       t.play_apply,
       				he.chinesename
			  from ga_visiter_apply t,
			       hr_department    h,
			       hr_employee      he,
			       sy_code          s1,
			       hr_employee      he1
			 where t.front_dept = h.deptid
			   and t.active <> 0
			   and he.empid = t.play_apply
			   and he1.empid = t.front_emp_id
			   and t.visiter_type = s1.code_id(+)
			   and t.play_apply = #empid:VARCHAR#
		]]>
	</select>
	
	<select id="getTopAffirmId" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
		select affirm.affirmor_id,HR.chinesename
			  from HR_EMPLOYEE HR, ga_visiter_apply_affirm affirm
			 where affirm.apply_no = #applyId:VARCHAR#
			   and affirm.affirmor_id = hr.empid
			   and affirm.affirm_level =
			       (select a.affirm_level
			          from (select affirm.apply_no,
			                       affirm.ga_affirm_no,
			                       hr.chinesename,
			                       hr.empid,
			                       affirm.affirm_flag,
			                       affirm.affirm_level
			                  from HR_EMPLOYEE HR, ga_visiter_apply_affirm affirm
			                 where affirm.apply_no = #applyId:VARCHAR#
			                   and empid = #empid:VARCHAR#
			                   and affirm.affirmor_id = hr.empid
			                 order by affirm.affirm_level) a) + 1
		]]>
	</select>
	
<select id="getapplyemail" parameterClass="SimpleMap" resultClass="string">
  <![CDATA[	
select email from hr_employee where person_id=#adminId1:VARCHAR#
    ]]>
</select>

<update id="confirmVisiterApply" parameterClass="SimpleMap">
		<![CDATA[
			 update ga_visiter_apply set active = #flag:NUMERIC#
         		where GA_VISITER_APPLY_ID = #applyno:NUMERIC#
	  	]]>
</update>
<select id="getupaffrimemail" parameterClass="SimpleMap" resultClass="string">
  <![CDATA[	
select h.email
from ga_visiter_apply_affirm t,hr_employee h
where  t.apply_no=#applyno:VARCHAR# 
and t.affirmor_id = h.person_id 
and t.affirm_level = #affrimlevel:numeric# + 1 
order by t.affirm_level
    ]]>
</select>

<select id="getVisiterApplyInfo" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select t.ga_visiter_apply_id,
   		 t.visiter_company,
	               t.visit_type,
	               t.visiter_contact_tel,
	               t.visit_intro_dept,   
	               t.visit_place,
	               t.visit_count,
	               t.visiter_name,
	               t.visitor_type ,
	               t.expect_result,
	               t.reception_lead,
	               t.reception_act_phone,
	               t.note,         
	               t.welcome_scr,
	               t.reception_office,
	               t.tea,
	               t.coffee,
	               t.advertising_video,
	               t.defend_facility,
	               t.interpret_facility,
	               t.shoot,
	               t.present,
	               t.lunch_repast,
	               t.restaurant,
	               t.fruit,
				   t.visiter_carnum, 
       t.visiter_objective,
      
       t.visiter_date,

     
       h.deptname,
       (select e.chinesename from hr_employee e where e.person_id=t.Play_Apply) AS play_applyChinesename,
       t.play_apply,
       t.active,
       t.apply_date,
       
       t.visiter_people_num,
       t.visiter_out_date,
       he1.chinesename,
       t.welcome,
       t.visiter_people_num,
       
       t.visiter_come_time,
       t.visiter_end_time,
       t.HUIYISHI_APPLYID,
       (select e.chinesename from hr_employee e where e.person_id=t.front_emp_id) as front_emp,
       substr(t.DEVICE,0,length(t.DEVICE)-1)  as DEVICE,
       
       t.visiter_carnum,
       
       T.VISITER_CAR_MODEL,
       T.VISITER_EATRY_FLAG,
       T.VISITER_EATRY_DISTINCTION,
      
       T.VISITER_EATRY_NAME,
       T.VISITER_EATRY_DATE,
       T.VISITER_EATRY_TIME,
       T.VISITER_EATRY_TYPE,
      
       T.VISITER_EATRY_NUMBER,
       T.VISITER_EATRY_MEMO,
       
       T.VISITER_VOITURE_FLAG,
       T.VISITER_VOITURE_NUMBER,
       T.VISITER_VOITURE_IN_DATE,
       T.VISITER_VOITURE_IN_TIME,
       T.VISITER_VOITURE_OUT_DATE,
       T.VISITER_VOITURE_OUT_TIME,
       T.VISITER_VOITURE_START_AREA,
       T.VISITER_VOITURE_PASS_AREA,
       T.VISITER_VOITURE_END_AREA,
       T.VISITER_VOITURE_MEMO,
       
       T.VISITER_CONFERENCE_FLAG,
       T.VISITER_CONFERENCE_ROOM,
       p.roomname as VISITER_CONFERENCE_ROOM_NAME,
       substr(t.VISITER_CONFERENCE_LANGUAGE,
              0,
              length(t.VISITER_CONFERENCE_LANGUAGE) - 1) as VISITER_CONFERENCE_LANGUAGE,
       T.VISITER_CONFERENCE_PEOPLE,
       T.VISITER_CONFERENCE_MANAGE,
       T.VISITER_CONFERENCE_MANAGE as VISITER_CONFERENCE_MANAGE_NAME,
       substr(t.VISITER_CONFERENCE_DATE,
              0,
              length(t.VISITER_CONFERENCE_DATE) - 1) as VISITER_CONFERENCE_DATE,
       T.VISITER_CONFERENCE_TIME,
       T.VISITER_CONFERENCE_PURPOSE,
       
       T.VISITER_FACTORY_FLAG,
       T.VISITER_FACTORY_NUMBER,
       T.VISITER_FACTORY_METHOD,
       
       T.VISITER_FACTORY_ROUTE,
       
       substr(t.VISITER_FACTORY_DEVICE,
              0,
              length(t.VISITER_FACTORY_DEVICE) - 1) as VISITER_FACTORY_DEVICE,
       T.VISITER_FACTORY_HELMET,
       
       T.VISITER_FACTORY_HELMET_NUMBER,
       T.VISITER_FACTORY_SYSTEM,
       
       T.VISITER_FACTORY_C_NUMBER,
       T.VISITER_FACTORY_K_NUMBER,
       T.VISITER_FACTORY_E_NUMBER,
       T.VISITER_FACTORY_PEOPLE,
       T.VISITER_FACTORY_WELCOME_SPEECH,
      
       substr(t.VISITER_FACTORY_LANGUAGE,
              0,
              length(t.VISITER_FACTORY_LANGUAGE) - 1) as VISITER_FACTORY_LANGUAGE,
       T.VISITER_FACTORY_MEMO,
       
       T.VISITER_TOURISM_FLAG,
       T.VISITER_TOURISM,
       
       T.VISITER_TOURISM_DATE,
       T.VISITER_TOURISM_TIME,
       T.VISITER_TOURISM_TYPE,
       
       T.VISITER_TOURISM_FEE,
       T.VISITER_TOURISM_MEMO
  from ga_visiter_apply t,
       hr_department    h,
       hr_employee      he,
       hr_employee      he1,
       pu_room          p
       
 where t.front_dept = h.deptid(+)
   and he.empid(+) = t.play_apply   
   and he1.empid(+) = t.front_emp_id
   and p.id (+) = t.VISITER_CONFERENCE_ROOM
   and t.GA_VISITER_APPLY_ID=#LEAVE_NO:VARCHAR# 
		]]>
	</select>
	
	<select id="getSaleWastes" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select v.*,e.chinesename as create_by1
  from gm_waste_v v,hr_employee e
		 where v.cpny_id = #cpny_id:varchar# and v.waste_id=#waste_no:varhcar# and e.person_id(+) = v.create_by 
		]]>
	</select>
	
	<select id="getAccessApplyId" parameterClass="SimpleMap" resultClass="string">
	  <![CDATA[	
	       select MAX(t.ga_access_apply_id) as accessApplyId from ga_access_apply t where t.ga_access_apply_id = #accessApplyId:VARCHAR# 
	    ]]>
    </select>

</sqlMap> 