<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="common.sys">

	<!-- retrieve code list -->
	<select id="RetrieveCodeList" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[	
		    SELECT CODE_NO,
				   CODE_ID,
				   CODE_NAME,
				   CODE_EN_NAME,
				   DESCRIPTION,
				   NVL(PARENT_CODE,'无') PARENT_CODE,
				   DEPTH,
				   ORDERNO,
				   ACTIVITY,
				   CPNY_ID,
				   R_CPNY_ID
			  FROM SY_CODE A
			 WHERE A.ACTIVITY = 1
		]]>
	
		<isNotEmpty prepend="AND" property="cpnyId">
			<![CDATA[
			    (A.CPNY_ID=#cpnyId:VARCHAR# OR A.CPNY_ID IS NULL)
		    ]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="parentCode">
			<![CDATA[
			    A.PARENT_CODE = #parentCode:VARCHAR#
		    ]]>
		</isNotEmpty>
		
		<![CDATA[
			ORDER BY PARENT_CODE,CODE_ID
		]]>
	
	</select>
	
	
	<!-- retrieve code list DICC -->
	<select id="RetrieveCodeListNotDiy" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[	
		    SELECT CODE_NO,
				   CODE_ID,
				   CODE_NAME,
				   CODE_EN_NAME,
				   DESCRIPTION,
				   NVL(PARENT_CODE,'无') PARENT_CODE,
				   DEPTH,
				   ORDERNO,
				   ACTIVITY,
				   CPNY_ID,
				   R_CPNY_ID
			  FROM SY_CODE A
			 WHERE A.ACTIVITY = 1
			 AND A.Code_Id not in('60000000','61000000','FN000000') 
		]]>
	
		<isNotEmpty prepend="AND" property="cpnyId">
			<![CDATA[
			    (A.CPNY_ID=#cpnyId:VARCHAR# OR A.CPNY_ID IS NULL)
		    ]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="codeName">
			<![CDATA[
			    A.CODE_NAME like  '%' || #codeName:VARCHAR# || '%' 
		    ]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="parentCode">
			<![CDATA[
			    A.PARENT_CODE = #parentCode:VARCHAR#
		    ]]>
		</isNotEmpty>
		
		<![CDATA[
			ORDER BY PARENT_CODE,CODE_ID
		]]>
	
	</select>
	
	
	 <!-- create file import temp table -->
	 <update id="createImportTempTable" parameterClass="SimpleMap" >
		<![CDATA[
		
		 	CREATE TABLE $tempTable$ AS SELECT * FROM $sourceTable$ WHERE 0 = 1
	 	]]>
	 </update>
	 
	 <!-- insert imported file data into import temp table  -->
	 <insert id="insertImportTempTable" parameterClass="SimpleMap" >
		<![CDATA[	
		       INSERT INTO $sql_head$  
 					VALUES ( $sql_content_file$ $sql_content_append$)
		  ]]>
	 </insert>
	 
	 <!-- insert imported file data into import temp table by select result -->
	 <insert id="insertImportTempTableBySelectResult" parameterClass="SimpleMap" >
		<![CDATA[	
		       INSERT INTO $sql_head$  
 					$sql_content$
		  ]]>
	 </insert>
	 
	 <!-- drop temp import table -->
	 <update id="dropImportTempTable" parameterClass="SimpleMap" >
		<![CDATA[
		
		 	DROP TABLE $tempTable$
	 	]]>
	 </update>
	 
	 <!-- delete repeat data in final import table -->
	 <delete id="deleteRepeatData" parameterClass="SimpleMap" >
		<![CDATA[	
		
	 		DELETE $sourceTable$
 			 WHERE ($pk_str$) 
 			        IN 
 			       (SELECT $pk_str$ FROM $tempTable$)
	 		  ]]>
	 </delete>
	 
	 <!-- insert imported file data into final import table  -->
	 <insert id="insertFinalImportTable" parameterClass="SimpleMap" >
		<![CDATA[	
		
	 		INSERT INTO $sourceTable$ SELECT * FROM $tempTable$
	 		  ]]>
	 </insert>
	 
	<!-- retrieve column information list -->
	<select id="retrieveColumnList" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[	
		
			    SELECT COLUMN_NAME, 
			   		   DATA_TYPE,
				       DECODE (DATA_TYPE,
				               'DATE', 1,
				               'NUMBER', 2,
				               'INT', 2,
				               'FLOAT', 2,
				               'DOUBLE', 2,
				               'DECIMAL', 2,
				               'INTEGER', 2,
				               'LONG', 2,
				               'PRECISION', 2,
				               0
				              ) DATA_TYPE_CODE,
		       		   NULLABLE
				  FROM USER_TAB_COLUMNS
				 WHERE TABLE_NAME = #tempTable#
		]]>
	</select>
	
	<!-- retrieve send email job status -->
	<select id="retrieveSendEmailJobStatus" resultClass="SimpleMap">
		<![CDATA[	
		
		    SELECT DESCRIPTION AS STATUS
			  FROM SY_PARAM A
			 WHERE A.CLSNAME = 'common.mail.status'
	]]>
	</select>
	
	<!-- update send email job status -->
	 <update id="updateSendEmailJobStatus" parameterClass="SimpleMap" >
		<![CDATA[
		
		 UPDATE SY_PARAM
		    SET DESCRIPTION = #STATUS#
		  WHERE CLSNAME = 'common.mail.status'
	 	]]>
	 </update>
	 
	<!-- retrieve email list -->
	<select id="retrieveEmailList" parameterClass="SimpleMap" resultClass="SimpleMap">
	<![CDATA[	
		SELECT EMAIL_SND_SEQ,
			   SND_STAT,
			   RCVR_EMAIL_ADDR,
			   EMAIL_TITLE,
			   EMAIL_CONTNT
		  FROM SY_EMAIL_SND
		 WHERE SND_STAT NOT IN ('Y','2')
		   AND USE_YN = 'Y'
	]]>		
	</select>
	
	<!-- update email send status -->
	<update id="updateEmailSendStatus" parameterClass="SimpleMap">
	<![CDATA[	
		UPDATE SY_EMAIL_SND
		   SET SND_STAT = DECODE(#SND_STAT#,'N',DECODE(SND_STAT,'N','1','1','2'),#SND_STAT#)
		 WHERE EMAIL_SND_SEQ = #EMAIL_SND_SEQ#
		]]>		
	</update>
	
	<!-- retrieve history menu -->
	<select id="retrieveHistoryMenu" parameterClass="SimpleMap" resultClass="SimpleMap">
	<![CDATA[	
		  SELECT MENU_CODE,
		  		 MENU_PARENT_CODE,
		  		 DEPTH,
		  		 MENU_INTRO,
		  		 MENU_EN_INTRO,
		  		 MENU_KOR_INTRO
		    FROM SY_MENU
		 START WITH MENU_CODE = #menu_code#
		CONNECT BY PRIOR MENU_PARENT_CODE = MENU_CODE
		ORDER BY DEPTH
	]]>		
	</select>
	
	<!-- retrieve report table -->
	<select id="retrieveReportTableList" parameterClass="SimpleMap" resultClass="ReportTable">
	<![CDATA[	
		  SELECT *
		    FROM REPORT_TABLE 
		    WHERE MENU_CODE = #menuCode:VARCHAR#
		      AND CPNY_ID = #cpnyId:VARCHAR#
			ORDER BY CREATE_DATE
	]]>		
	</select>
	
	<!-- retrieve report item -->
	<select id="retrieveReportItemList" parameterClass="ReportTable" resultClass="ReportItem">
	<![CDATA[	
		  SELECT *
		    FROM REPORT_ITEM 
		    WHERE RT_NO = #rt_no#
			ORDER BY ORDER_NO
	]]>		
	</select>
	
	<!-- retrieve report item A.ITEM_NAME||substr(decode(GET_CODE_NAME(B.UNIT),'小时','时',GET_CODE_NAME(B.UNIT)),1,1) AS ITEM_NAME,-->
	<select id="retrieveReportItemForArMonthList" parameterClass="ReportTable" resultClass="ReportItem">
	<![CDATA[	
		  SELECT    A.RI_NO,
					A.RT_NO,
					A.ITEM_NAME,
					A.REF_TABLE_NAME,
					A.REF_ITEM_NO,
					A.REF_ITEM_ID,
					A.CREATE_BY,
					A.CREATE_DATE,
					A.ORDER_NO
		    FROM REPORT_ITEM A, AR_STA_ITEM B
		    WHERE A.RT_NO = #rt_no#
		    AND A.REF_ITEM_ID = B.STA_ITEM_ID(+)
			ORDER BY ORDER_NO
	]]>		
	</select>
	
	<!-- retrieve report item -->
	<select id="getReportItemList" parameterClass="SimpleMap" resultClass="SimpleMap">
	<![CDATA[	
		  SELECT A.RI_NO,
		  		 A.RT_NO,
		  		 A.ITEM_NAME||substr(decode(GET_CODE_NAME(C.UNIT),'小时','时',GET_CODE_NAME(C.UNIT)),1,1) AS ITEM_NAME,
		  		 A.REF_TABLE_NAME,
		  		 A.REF_ITEM_ID
		    FROM REPORT_ITEM A,
				 REPORT_TABLE B,
				 AR_STA_ITEM C
		    WHERE A.RT_NO = B.RT_NO
			  AND B.VIEW_MODEL IN (1,3)
			  AND A.REF_ITEM_ID = C.STA_ITEM_ID(+)
			  AND B.CPNY_ID = #cpnyId:VARCHAR#
	]]>
			  
	<isNotEmpty prepend="AND" property="rtNo">
		<![CDATA[
		    B.RT_NO = #rtNo:VARCHAR#
	    ]]>
	</isNotEmpty>
	
	<isNotEmpty prepend="AND" property="menuCode">
		<![CDATA[
		    B.MENU_CODE = #menuCode:VARCHAR#
	    ]]>
	</isNotEmpty>
	
	<isNotEmpty prepend="AND" property="reportType">
		<![CDATA[
		    B.REPORT_TYPE = #reportType:VARCHAR#
	    ]]>
	</isNotEmpty>
		
	<![CDATA[
			ORDER BY A.RT_NO,A.ORDER_NO
	]]>		
	</select>
	
	<!-- retrieve report data -->
	<select id="retrieveReportDataList" parameterClass="SimpleMap" resultClass="SimpleMap" remapResults="true">
	<![CDATA[	
		  $sql$ WHERE 1=1
	 ]]>	
		
		<isNotEmpty prepend="AND" property="empID">
			<![CDATA[
			    (A.PERSON_ID = #empID:VARCHAR#
			     OR A.EMPID = #empID:VARCHAR#
			     OR A.CHINESENAME = #empID:VARCHAR#
			     )
		    ]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="cpnyId">
			<![CDATA[
			    A.CPNY_ID = #cpnyId:VARCHAR#
		    ]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="condition">
			<![CDATA[
			    (   A.EMPID = #condition:VARCHAR#
			     OR A.PERSON_ID = #condition:VARCHAR#
		         OR A.CHINESENAME = #condition:VARCHAR#
		        )	
		    ]]>
		</isNotEmpty>
		
		<isEqual property="reportType" compareValue="1" >

			<isEmpty prepend="" property="arEndMonth">
				<isNotEmpty prepend="AND" property="arMonth">
					<![CDATA[
					    A.AR_MONTH = #arMonth:VARCHAR#
				    ]]>
				</isNotEmpty>
			</isEmpty>
			
			<isNotEmpty prepend="" property="arEndMonth">
				<isNotEmpty prepend="AND" property="arMonth">
					<![CDATA[
					    A.AR_MONTH BETWEEN #arMonth:VARCHAR# AND #arEndMonth:VARCHAR#
				    ]]>
			    </isNotEmpty>
			</isNotEmpty>
		
		</isEqual>
		
		<isEqual property="reportType" compareValue="2" >
		
			<isNotEmpty prepend="AND" property="paMonth">
				<![CDATA[
				      A.PA_MONTH = #paMonth:VARCHAR#
			    ]]>
			</isNotEmpty>
			
			<isNotEmpty prepend="AND" property="paYear">
				<![CDATA[
				      SUBSTR(A.PA_MONTH,0,4) = #paYear:VARCHAR#
			    ]]>
			</isNotEmpty>
			
			<isNotEmpty prepend="AND" property="supplyFlag">
				<![CDATA[
				      NVL(A.SUPPLY_FLAG,'N') = #supplyFlag:VARCHAR#
			    ]]>
			</isNotEmpty>
		
		</isEqual>
		
		<isNotEmpty prepend="AND" property="deptID">
			<![CDATA[
		   EXISTS (SELECT *
                     FROM HR_DEPARTMENT B1
                    WHERE B1.DEPTID = A.DEPTID
               START WITH B1.DEPTID = #deptID:VARCHAR#
               CONNECT BY PRIOR B1.DEPTID = B1.PARENT_DEPT_ID)
		    ]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="empType">
			<isEqual prepend="" property="empType" compareValue="office"> <!-- 职员 -->
			<![CDATA[
					  A.POST_GRADE_CODE <> 'C_12004_1330054' 
			      AND A.POST_GRADE_CODE <> 'C_12004_1324167'
			]]>
			</isEqual>		
			<isEqual prepend="" property="empType" compareValue="work"> <!-- 工人 -->
			<![CDATA[
					 A.POST_GRADE_CODE IN ('C_12004_1330054','C_12004_1324167') 
			]]>
			</isEqual>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="supervisor">
			<![CDATA[
					(EXISTS ( SELECT *
                                FROM AR_SUPERVISOR_INFO J
                               WHERE AR_SUPERVISOR_ID = #supervisor:VARCHAR#
                                 AND A.DEPTID = J.SUPERVISED_DEPTID 
					  ) OR A.PERSON_ID = #supervisor:VARCHAR#
					    OR A.EMPID = #supervisor:VARCHAR#
					 )
			]]>
		</isNotEmpty>
		
	</select>
	
   <select id="EmpDiffTag" parameterClass="SimpleMap" resultClass="SimpleMap">
	<![CDATA[	
		  select DISTINCT hr.emp_diff_code EMPDIFFCODE, sy.code_name NAME, sy.ORDERNO
                 from hr_employee hr, sy_code sy
				 where hr.emp_diff_code = sy.code_id(+)
				   AND HR.ACTIVITY = 1
   	]]>	
   	
	<isNotEmpty prepend="AND" property="cpnyDiff">
			<![CDATA[
			      HR.CPNY_ID=#cpnyDiff:VARCHAR#
		    ]]>
    </isNotEmpty>	
    
    <![CDATA[
    	 ORDER BY SY.ORDERNO
    ]]>
	</select>

	<!-- retrieve perosnid -->
	<select id="retrievePersonId" parameterClass="SimpleMap" resultClass="SimpleMap">
	<![CDATA[	
		  SELECT GET_PERSONID(#empID:VARCHAR#,#cpnyId:VARCHAR#) AS personId
		    FROM DUAL
	]]>		
	</select>
	
	<!-- view by paging -->
	<select id="viewByPagin" parameterClass="SimpleMap" resultClass="SimpleMap">
	<![CDATA[	
		    SELECT *
			  FROM (SELECT A.*, ROWNUM RNM
			          FROM ( $sql$ ) A
			         WHERE ROWNUM <= #startRownum:NUMERIC#)
			 WHERE RNM > #endRownum:NUMERIC#
 
	]]>		
	</select>
		
	<!-- AJAX在评页面中通过下拉框里选择的工种得到该类别所对应的LIne -->
	<select id="retrievecraftByLine" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[	
		    select t.code_id   lineid,
		       t.code_name lineName
		    from evs_code t 
		    where activity='1'
		    and t.code_flag = 'LE' 

		]]>
		
		<isNotEmpty prepend="AND" property="craft">
			t.parent_code = #craft#
		</isNotEmpty>
		
		<![CDATA[
			ORDER BY t.code_id
		]]>
	</select>
	
	<!-- AJAX在评页面中通过下拉框里选择的工种得到该类别所对应的择能类型 -->
	<select id="retrievecraftByStype" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[	
		    select t.code_id   stypeid,
		       t.code_name stypeName
		    from evs_code t 
		    where activity='1'
		    and t.code_flag = 'ST' 

		]]>
		
		<isNotEmpty prepend="AND" property="craft">
			t.parent_code = #craft#
		</isNotEmpty>
		
		<![CDATA[
			ORDER BY t.code_id
		]]>
	</select>
	 
	<!-- AJAX在评页面中通过下拉框里选择的Line得到该类别所对应的机种 -->
	<select id="retrieveLineByAircraft" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[	
		    select t.code_id   aircraftid,
		       t.code_name aircraftName
		    from evs_code t 
		    where activity='1'
		    and t.code_flag = 'AF' 

		]]>
		
		<isNotEmpty prepend="AND" property="lineid">
			t.parent_code = #lineid#
		</isNotEmpty>
		
		<![CDATA[
			ORDER BY t.code_id
		]]>
	</select>
	
	
	<!-- AJAX在评页面中通过下拉框里选择的Line得到该类别所对应的工序 -->
	<select id="retrieveLineByProcess" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[	
		    select t.code_id   processid,
		       t.code_name processName
		    from evs_code t 
		    where activity='1'
		    and t.code_flag = 'JC' 

		]]>
		
		<isNotEmpty prepend="AND" property="lineid">
			t.parent_code = #lineid#
		</isNotEmpty>
		
		<![CDATA[
			ORDER BY t.code_id
		]]>
	</select>
	<!-- AJAX在评页面中通过积分得到该积分所对应的工序 -->
	<select id="retrieveLineByPro" parameterClass="SimpleMap"	resultClass="SimpleMap">
		<![CDATA[	
		    select t.dengji from EVS_GXJNDJ t  where code_flag ='JC'
			and djjffrom <= #pro# and djjfto >= #pro#

		]]>
	</select>
	<!-- AJAX在评页面中通过饼图需要数据 -->
	<select id="retrieveSetupcount" parameterClass="SimpleMap"	resultClass="SimpleMap">
		<![CDATA[	
		    select 
			(SELECT count(1)  FROM ( select evs_empid,craft,max(zyzgdjlevel) zyzgdjlevel from evs_setupcode t 
        		where status ='3' and purpose ='yes' group by evs_empid,craft ) t 
      		  where evs_empid in ( select person_id from hr_employee where  status_code !='EmpStatus3' 
      		  ]]>  
      		 <isNotEmpty prepend="AND" property="adminid">
				<![CDATA[
					deptid  in  ( SELECT DISTINCT deptid  FROM  HR_DEPARTMENT
						   START   WITH deptid = (select deptid from hr_employee where person_id= #adminid:VARCHAR2#)
						 CONNECT  BY PRIOR deptid= parent_dept_id )				   
				]]>
			  </isNotEmpty>
      		<![CDATA[
      		) and ZYZGDJLEVEL ='实习工') as count0,
			(SELECT count(1) count1 FROM ( select evs_empid,craft,max(zyzgdjlevel) zyzgdjlevel from evs_setupcode t 
        		where status ='3' and purpose ='yes' group by evs_empid,craft ) t 
      		  where evs_empid in ( select person_id from hr_employee where  status_code !='EmpStatus3'
      		  ]]>  
      		 <isNotEmpty prepend="AND" property="adminid">
				<![CDATA[
					deptid  in  ( SELECT DISTINCT deptid  FROM  HR_DEPARTMENT
						   START   WITH deptid = (select deptid from hr_employee where person_id= #adminid:VARCHAR2#)
						 CONNECT  BY PRIOR deptid= parent_dept_id )				   
				]]>
			  </isNotEmpty>
      		<![CDATA[
      		   ) and ZYZGDJLEVEL ='初级工' ) as count1,
			(SELECT count(1) count2 FROM ( select evs_empid,craft,max(zyzgdjlevel) zyzgdjlevel from evs_setupcode t 
        		where status ='3' and purpose ='yes' group by evs_empid,craft ) t 
      		  where evs_empid in ( select person_id from hr_employee where  status_code !='EmpStatus3' 
      		  ]]>  
      		 <isNotEmpty prepend="AND" property="adminid">
				<![CDATA[
					deptid  in  ( SELECT DISTINCT deptid  FROM  HR_DEPARTMENT
						   START   WITH deptid = (select deptid from hr_employee where person_id= #adminid:VARCHAR2#)
						 CONNECT  BY PRIOR deptid= parent_dept_id )				   
				]]>
			  </isNotEmpty>
      		<![CDATA[
      		  ) and ZYZGDJLEVEL ='中级工' ) as count2,
			(SELECT count(1) count3 FROM ( select evs_empid,craft,max(zyzgdjlevel) zyzgdjlevel from evs_setupcode t 
        		where status ='3' and purpose ='yes' group by evs_empid,craft ) t 
      		  where evs_empid in ( select person_id from hr_employee where  status_code !='EmpStatus3' 
      		  ]]>  
      		 <isNotEmpty prepend="AND" property="adminid">
				<![CDATA[
					deptid  in  ( SELECT DISTINCT deptid  FROM  HR_DEPARTMENT
						   START   WITH deptid = (select deptid from hr_employee where person_id= #adminid:VARCHAR2#)
						 CONNECT  BY PRIOR deptid= parent_dept_id )				   
				]]>
			  </isNotEmpty>
      		<![CDATA[
      		  ) and ZYZGDJLEVEL ='高级工' ) as count3,
			(SELECT count(1) count4 FROM ( select evs_empid,craft,max(zyzgdjlevel) zyzgdjlevel from evs_setupcode t 
        		where status ='3' and purpose ='yes' group by evs_empid,craft ) t 
      		  where evs_empid in ( select person_id from hr_employee where  status_code !='EmpStatus3' 
      		  ]]>  
      		 <isNotEmpty prepend="AND" property="adminid">
				<![CDATA[
					deptid  in  ( SELECT DISTINCT deptid  FROM  HR_DEPARTMENT
						   START   WITH deptid = (select deptid from hr_employee where person_id= #adminid:VARCHAR2#)
						 CONNECT  BY PRIOR deptid= parent_dept_id )				   
				]]>
			  </isNotEmpty>
      		<![CDATA[
      		  ) and ZYZGDJLEVEL ='技师' ) as count4
			from dual
		]]>
		
	</select>
	<!-- AJAX在评页面中通过柱形图人员数需要数据 -->
	<select id="retrieveSetupempcount" parameterClass="SimpleMap"	resultClass="SimpleMap">
		<![CDATA[	
		    select count0,evs_empid,h.chinesename,t.deptke,t.deptzhi,t.deptzu
			from hr_employee h,
			 (select count(1) count0,evs_empid,min(deptke) deptke,min(deptzhi) deptzhi,min(deptzu) deptzu
			from evs_setupcode
			where status ='3' and purpose ='yes'
			group by evs_empid) t
			where h.person_id(+) = t.evs_empid
			and h.status_code !='EmpStatus3'
		]]>
		<isNotEmpty prepend="AND" property="evDeptId">
			 h.deptid  in  (SELECT DISTINCT  
					deptid  FROM  HR_DEPARTMENT  START WITH deptid = #evDeptId#
					 CONNECT  BY PRIOR deptid= parent_dept_id )
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deptke">
			t.deptke = #deptke#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deptzhi">
			t.deptzhi = #deptzhi#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deptzu">
			t.deptzu = #deptzu#
		</isNotEmpty>
	</select>
	<!-- AJAX在评页面中通过柱形图人员数需要数据 -->
	<select id="retrieveSetupempcount2" parameterClass="SimpleMap"	resultClass="SimpleMap">
		<![CDATA[	
		    select count0,jobcontent,t.craft,t.line
		      from 
		       (select count(1) count0,jobcontent,min(craft) craft,min(line) line
		      from evs_setupcode 
		      where status ='3' and purpose ='yes'
		      and evs_empid in ( select person_id from hr_employee where  status_code !='EmpStatus3' )
		]]>
		<isNotEmpty prepend="AND" property="evDeptId">
			evs_empid in ( select person_id from hr_employee where   deptid  in  (SELECT DISTINCT  
					deptid  FROM  HR_DEPARTMENT  START WITH deptid = #evDeptId#
					 CONNECT  BY PRIOR deptid= parent_dept_id ))
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deptke">
			deptke = #deptke#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deptzhi">
			deptzhi = #deptzhi#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deptzu">
			deptzu = #deptzu#
		</isNotEmpty>
		<![CDATA[	
		   
		      group by jobcontent) t
		      where 1=1
		]]>
		
		<isNotEmpty prepend="AND" property="craft">
			t.craft = #craft#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="line">
			t.line = #line#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="jobcontent">
			t.jobcontent = #jobcontent#
		</isNotEmpty>
	</select>
	<!-- AJAX在评页面中通过柱形图人员数需要数据 -->
	<select id="retrieveSetupempcount3" parameterClass="SimpleMap"	resultClass="SimpleMap">
		<![CDATA[	
		    select count0,deptzu,t.deptke,t.deptzhi,t.deptzu
		      from
		       (select count(1) count0,min(deptke) deptke,min(deptzhi) deptzhi, deptzu
		      from evs_setupcode
		      where status ='3' and purpose ='yes'
		      and evs_empid in ( select person_id from hr_employee where  status_code !='EmpStatus3' )
		]]>
		<isNotEmpty prepend="AND" property="evDeptId">
			evs_empid in ( select person_id from hr_employee where deptid  in  (SELECT DISTINCT  
					deptid  FROM  HR_DEPARTMENT  START WITH deptid = #evDeptId#
					 CONNECT  BY PRIOR deptid= parent_dept_id ))
		</isNotEmpty>
		<![CDATA[			   
		      and SHEOPERCYQ = 'yes'
		      group by deptzu) t
		      where 1=1
		]]>
		<isNotEmpty prepend="AND" property="deptke">
			t.deptke = #deptke#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deptzhi">
			t.deptzhi = #deptzhi#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="deptzu">
			t.deptzu = #deptzu#
		</isNotEmpty>
	</select>
	<!-- AJAX在评页面中通过饼图需要数据 -->
	<select id="retrieveSetupcount1" parameterClass="SimpleMap"	resultClass="SimpleMap">
		<![CDATA[	
		    select 
			(SELECT count(1)  FROM ( select evs_empid,craft,max(zyzgdjlevel) zyzgdjlevel from evs_setupcode t 
        		where status ='3' and purpose ='yes' group by evs_empid,craft ) t 
      		  where evs_empid in ( select person_id from hr_employee where  status_code !='EmpStatus3' 
      		]]>  
      		 <isNotEmpty prepend="AND" property="adminid">
				<![CDATA[
					deptid  in  ( SELECT DISTINCT deptid  FROM  HR_DEPARTMENT
						   START   WITH deptid = (select deptid from hr_employee where person_id= #adminid:VARCHAR2#)
						 CONNECT  BY PRIOR deptid= parent_dept_id )				   
				]]>
			  </isNotEmpty>
      		<![CDATA[
      		  ) and craft = #craft# and ZYZGDJLEVEL ='实习工' ) as count0,
			(SELECT count(1) count1 FROM ( select evs_empid,craft,max(zyzgdjlevel) zyzgdjlevel from evs_setupcode t 
        		where status ='3' and purpose ='yes' group by evs_empid,craft ) t 
      		  where evs_empid in ( select person_id from hr_employee where  status_code !='EmpStatus3' 
      		  ]]>  
      		 <isNotEmpty prepend="AND" property="adminid">
				<![CDATA[
					deptid  in  ( SELECT DISTINCT deptid  FROM  HR_DEPARTMENT
						   START   WITH deptid = (select deptid from hr_employee where person_id= #adminid:VARCHAR2#)
						 CONNECT  BY PRIOR deptid= parent_dept_id )				   
				]]>
			  </isNotEmpty>
      		<![CDATA[
      		 ) and craft = #craft#  and ZYZGDJLEVEL ='初级工' ) as count1,
			(SELECT count(1) count2 FROM ( select evs_empid,craft,max(zyzgdjlevel) zyzgdjlevel from evs_setupcode t 
        		where status ='3' and purpose ='yes' group by evs_empid,craft ) t 
      		  where evs_empid in ( select person_id from hr_employee where  status_code !='EmpStatus3' 
      		  ]]>  
      		 <isNotEmpty prepend="AND" property="adminid">
				<![CDATA[
					deptid  in  ( SELECT DISTINCT deptid  FROM  HR_DEPARTMENT
						   START   WITH deptid = (select deptid from hr_employee where person_id= #adminid:VARCHAR2#)
						 CONNECT  BY PRIOR deptid= parent_dept_id )				   
				]]>
			  </isNotEmpty>
      		<![CDATA[
      		) and craft = #craft#  and ZYZGDJLEVEL ='中级工' ) as count2,
			(SELECT count(1) count3 FROM ( select evs_empid,craft,max(zyzgdjlevel) zyzgdjlevel from evs_setupcode t 
        		where status ='3' and purpose ='yes' group by evs_empid,craft ) t 
      		  where evs_empid in ( select person_id from hr_employee where  status_code !='EmpStatus3' 
      		  ]]>  
      		 <isNotEmpty prepend="AND" property="adminid">
				<![CDATA[
					deptid  in  ( SELECT DISTINCT deptid  FROM  HR_DEPARTMENT
						   START   WITH deptid = (select deptid from hr_employee where person_id= #adminid:VARCHAR2#)
						 CONNECT  BY PRIOR deptid= parent_dept_id )				   
				]]>
			  </isNotEmpty>
      		<![CDATA[
      		) and craft = #craft# and ZYZGDJLEVEL ='高级工' ) as count3,
			(SELECT count(1) count4 FROM ( select evs_empid,craft,max(zyzgdjlevel) zyzgdjlevel from evs_setupcode t 
        		where status ='3' and purpose ='yes' group by evs_empid,craft ) t 
      		  where evs_empid in ( select person_id from hr_employee where  status_code !='EmpStatus3'
      		  ]]>  
      		 <isNotEmpty prepend="AND" property="adminid">
				<![CDATA[
					deptid  in  ( SELECT DISTINCT deptid  FROM  HR_DEPARTMENT
						   START   WITH deptid = (select deptid from hr_employee where person_id= #adminid:VARCHAR2#)
						 CONNECT  BY PRIOR deptid= parent_dept_id )				   
				]]>
			  </isNotEmpty>
      		<![CDATA[
      		 ) and craft = #craft# and ZYZGDJLEVEL ='技师' ) as count4
			from dual
			where 1=1
		]]>
		
	</select>
	<!-- AJAX在评页面中通过下拉框里选择的工序得到该类别所对应的作业内容 -->
	<select id="retrieveProcessByJcoent" parameterClass="SimpleMap"
		resultClass="SimpleMap">
		<![CDATA[	
		    select t.code_id   jcoentid,
		       t.code_name jcoentName
		    from evs_code t 
		    where activity='1'
		    and t.code_flag = 'JC' 

		]]>
		
		<isNotEmpty prepend="AND" property="processid">
			t.parent_code = #processid#
		</isNotEmpty>
		
		<![CDATA[
			ORDER BY t.code_id
		]]>
	</select>
	
	
	
	
</sqlMap>