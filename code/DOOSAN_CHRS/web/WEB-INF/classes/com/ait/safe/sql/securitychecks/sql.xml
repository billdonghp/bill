<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="safe.securitychecks">

<select id="securityChecksList" parameterClass="SimpleMap" resultClass="SimpleMap">
<![CDATA[
select t.documentno,
       hr.chinesename,
       to_char(t.securitychecksdate, 'yyyy-mm-dd') securitychecksdate,
       v.deptname,
       t.location,
       t.hiddendangerscommunications,
       sc1.code_name hiddendangers_name,
       t.rectificationrequirements,
       t.brief,
       sc2.code_name rectification_name,
       to_char(t.rectification_date, 'yyyy-mm-dd') rectification_date,
       t.isrectification,      
       t.iscompletedrectification,
       to_char(apply.OVERDATE,'yyyy-mm-dd') as OVERDATE,
       to_char(t.PLANCOMPLETIONDATE,'yyyy-mm-dd') as PLANCOMPLETIONDATE,
       t.ZHENGGAINUM,
       t.ZHENGGAIPLAN,
       t.ISPLAN,
       t.ISCONFIRM,
       t.CONFIRMIDEA,
       t.mail_num,
       t.HIDDENDANGERSTYPE,
       sc3.code_name hiddendangerstype_name
  from se_securitychecks_record t,sy_code sc1,sy_code sc2,sy_code sc3, hr_employee hr, hr_department v,se_completrectificat_apply apply
 where t.active = '1'
   and hr.person_id(+) = t.securitychecksor_id
   and t.deptid = v.deptid(+)
   and sc1.code_id(+)= t.hiddendangerscommunications
   and sc2.code_id(+)= t.rectificationrequirements 
   and sc3.code_id(+)= t.hiddendangerstype 
   
   and apply.securitychecksno(+)=t.documentno
   
   ]]>
   
<isEqual prepend="AND" property="cpnyId" compareValue="63000000"> <!--DISD 只查询自己所属部门的信息 -->
		<![CDATA[
				 HR.DEPTID = #deptId:VARCHAR#
		]]>
</isEqual> 
<isNotEqual prepend="AND" property="cpnyId" compareValue="63000000"><!-- OTHER -->
	<![CDATA[
	 EXISTS 
	(SELECT SAD.ADMIN_DEPTID 
	 FROM SY_ADMIN_DEPTID SAD,SY_ADMIN SA
	 WHERE SAD.ADMIN_NO = SA.ADMINNO 
	       AND SA.ADMINID =#applerId:VARCHAR# 
	       AND SAD.ADMIN_DEPTID = hr.deptid)
	 ]]>      
</isNotEqual>  
<isNotEmpty prepend="AND" property="documentno">
			<![CDATA[
		 		(t.documentno like '%' || #documentno:VARCHAR# || '%')
			]]>
</isNotEmpty>
<isNotEmpty prepend="AND" property="StartDate">
			<![CDATA[
		 		( (to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') >= to_date(#StartDate:VARCHAR#,'yyyy-mm-dd')) )
			]]>
</isNotEmpty>
<isNotEmpty prepend="AND" property="EndDate">
			<![CDATA[
		 		( (to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') <= to_date(#EndDate:VARCHAR#,'yyyy-mm-dd')))
			]]>
</isNotEmpty>
<isNotEmpty prepend="AND" property="serchDept">
			<![CDATA[
		 		(t.deptid like '%'||#serchDept:VARCHAR#||'%')
			]]>
</isNotEmpty>
<isNotEmpty prepend="AND" property="HiddenDangersCommunications">
			<![CDATA[
		 		(t.HIDDENDANGERSCOMMUNICATIONS = #HiddenDangersCommunications:VARCHAR#)
			]]>
</isNotEmpty>
<isNotEmpty prepend="AND" property="HiddenDangersType">
			<![CDATA[
		 		(t.HIDDENDANGERSTYPE = #HiddenDangersType:VARCHAR#)
			]]>
</isNotEmpty>
<isNotEmpty prepend="AND" property="Rectification_requirements">
			<![CDATA[
		 		(t.RECTIFICATIONREQUIREMENTS = #Rectification_requirements:VARCHAR#)
			]]>
</isNotEmpty>
<isNotEmpty prepend="" property="status_code">
	<isEqual prepend="AND" property="status_code" compareValue="4"> <!-- 已通知 -->
	<![CDATA[
			( t.ISRECTIFICATION = 0 and t.ISPLAN = 0)
	]]>
	</isEqual>
	<isEqual prepend="AND" property="status_code" compareValue="0"> <!-- 计划反馈 -->
	<![CDATA[
			(t.ISCOMPLETEDRECTIFICATION = 0 and t.ISPLAN = 1)
	]]>
	</isEqual>
	<isEqual prepend="AND" property="status_code" compareValue="1"> <!-- 整改反馈 -->
	<![CDATA[
			(t.ISCOMPLETEDRECTIFICATION =1 and t.ISRECTIFICATION = 0)
	]]>
	</isEqual>
	<isEqual prepend="AND" property="status_code" compareValue="2"> <!-- 未确认 -->
	<![CDATA[
			(t.ISRECTIFICATION = 3)
	]]>
	</isEqual>
	<isEqual prepend="AND" property="status_code" compareValue="3"> <!-- 确认完成 -->
	<![CDATA[
			(t.ISRECTIFICATION = 1)
	]]>
	</isEqual>
	<isEqual prepend="AND" property="status_code" compareValue="5"> <!-- 退回 -->
	<![CDATA[
			(t.ISRECTIFICATION = 2)
	]]>
	</isEqual>
</isNotEmpty>

 <![CDATA[
 order by t.documentno desc,securitychecksdate desc,rectification_date desc
 	]]>
 </select>
 
<select id="securityChecksListNumber" parameterClass="SimpleMap" resultClass="int">
 <![CDATA[
select count(t.documentno)
  from se_securitychecks_record t,sy_code sc1,sy_code sc2, hr_employee hr, hr_department v,se_completrectificat_apply apply
 where t.active = '1'
   and hr.person_id(+) = t.securitychecksor_id
   and t.deptid = v.deptid(+)
   and sc1.code_id(+)= t.hiddendangerscommunications
   and sc2.code_id(+)= t.rectificationrequirements 
   and apply.securitychecksno(+)=t.documentno
    ]]>
<isEqual prepend="AND" property="cpnyId" compareValue="63000000"> <!--DISD 只查询自己所属部门的信息 -->
		<![CDATA[
				 HR.DEPTID = #deptId:VARCHAR#
		]]>
</isEqual> 
<isNotEqual prepend="AND" property="cpnyId" compareValue="63000000"><!-- OTHER -->
	 <![CDATA[
	 EXISTS 
	(SELECT SAD.ADMIN_DEPTID 
	 FROM SY_ADMIN_DEPTID SAD,SY_ADMIN SA
	 WHERE SAD.ADMIN_NO = SA.ADMINNO 
	       AND SA.ADMINID =#applerId:VARCHAR# 
	       AND SAD.ADMIN_DEPTID = hr.deptid)
	 ]]>   
</isNotEqual>      
<isNotEmpty prepend="AND" property="documentno">
			<![CDATA[
		 		(t.documentno like '%' || #documentno:VARCHAR# || '%')
			]]>
</isNotEmpty>
<isNotEmpty prepend="AND" property="StartDate">
			<![CDATA[
		 		( (to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') >= to_date(#StartDate:VARCHAR#,'yyyy-mm-dd'))   )
			]]>
</isNotEmpty>
<isNotEmpty prepend="AND" property="EndDate">
			<![CDATA[
		 		( (to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') <= to_date(#EndDate:VARCHAR#,'yyyy-mm-dd')) )
			]]>
</isNotEmpty>
<isNotEmpty prepend="AND" property="serchDept">
			<![CDATA[
		 		(t.deptid like '%'||#serchDept:VARCHAR#||'%')
			]]>
</isNotEmpty>
<isNotEmpty prepend="AND" property="HiddenDangersCommunications">
			<![CDATA[
		 		(t.HIDDENDANGERSCOMMUNICATIONS = #HiddenDangersCommunications:VARCHAR#)
			]]>
</isNotEmpty>
<isNotEmpty prepend="AND" property="HiddenDangersType">
			<![CDATA[
		 		(t.HIDDENDANGERSTYPE = #HiddenDangersType:VARCHAR#)
			]]>
</isNotEmpty>
<isNotEmpty prepend="AND" property="Rectification_requirements">
			<![CDATA[
		 		(t.RECTIFICATIONREQUIREMENTS = #Rectification_requirements:VARCHAR#)
			]]>
</isNotEmpty>
<isNotEmpty prepend="" property="status_code">
	<isEqual prepend="AND" property="status_code" compareValue="4"> <!-- 已通知 -->
	<![CDATA[
			( t.ISRECTIFICATION = 0 and t.ISPLAN = 0)
	]]>
	</isEqual>
	<isEqual prepend="AND" property="status_code" compareValue="0"> <!-- 计划反馈 -->
	<![CDATA[
			(t.ISCOMPLETEDRECTIFICATION = 0 and t.ISPLAN = 1)
	]]>
	</isEqual>
	<isEqual prepend="AND" property="status_code" compareValue="1"> <!-- 整改反馈 -->
	<![CDATA[
			(t.ISCOMPLETEDRECTIFICATION =1 and t.ISRECTIFICATION = 0)
	]]>
	</isEqual>
	<isEqual prepend="AND" property="status_code" compareValue="2"> <!-- 未确认 -->
	<![CDATA[
			(t.ISRECTIFICATION = 3)
	]]>
	</isEqual>
	<isEqual prepend="AND" property="status_code" compareValue="3"> <!-- 确认完成 -->
	<![CDATA[
			(t.ISRECTIFICATION = 1)
	]]>
	</isEqual>
	<isEqual prepend="AND" property="status_code" compareValue="5"> <!-- 退回 -->
	<![CDATA[
			(t.ISRECTIFICATION = 2)
	]]>
	</isEqual>
</isNotEmpty>
</select>
 
 
<select id="AnSecurityChecksInformation" parameterClass="SimpleMap" resultClass="SimpleMap">
<![CDATA[
select t.documentno,
       hr.chinesename,
       to_char(t.securitychecksdate, 'yyyy-mm-dd') securitychecksdate,
       v.deptname,
       t.deptid,
       t.brief,
       t.location,
       t.mailempidlist,
       t.hiddendangerscommunications,       
       sc1.code_name hiddendangers_name,
       t.rectificationrequirements,
       sc2.code_name rectification_name,
       to_char(t.rectification_date, 'yyyy-mm-dd') rectification_date,
       ZHENGGAINUM,
       t.hiddendangerstype

  from se_securitychecks_record t,sy_code sc1,sy_code sc2,hr_employee hr,hr_department v
 where t.active = '1'
 and hr.person_id=t.securitychecksor_id
 and sc1.code_id = t.hiddendangerscommunications
   and sc2.code_id = t.rectificationrequirements
  and t.deptid=v.deptid(+)
 and t.documentno=#securityChecksNo:VARCHAR#
    ]]>
 </select>
 
 <select id="getAnSecurityInformation" parameterClass="SimpleMap" resultClass="SimpleMap">
<![CDATA[
select to_char(t.PLANCOMPLETIONDATE, 'yyyy-mm-dd') PLANCOMPLETIONDATE

  from se_correctiveplan_apply t
 where t.active = '1' and t.documentno=#securityChecksNo:VARCHAR#
    ]]>
 </select>
 <select id="selectEmpidLStr" parameterClass="SimpleMap" resultClass="SimpleMap">
<![CDATA[
select hr.chinesename,de.deptname,hr.empid,hr.person_id from hr_employee hr ,hr_department de
where hr.person_id in($selectEmpidLStr$)
and hr.deptid=de.deptid
AND HR.ACTIVITY = 1
    ]]>
 </select>
 
 <select id="getAnviewCorrectivePlan" parameterClass="SimpleMap" resultClass="SimpleMap">
<![CDATA[
select plan.securitychecksno,
       v.deptname,
       hr.chinesename,      
       plan.crfnote,     
       t.iscompletedrectification,
       to_char(plan.overdate,'yyyy-mm-dd') overdate,
       to_char(plan.completiondate,'yyyy-mm-dd') completiondate

  from se_securitychecks_record t,hr_employee hr,hr_department v,se_completrectificat_apply plan
 where t.active = '1'
 and hr.person_id(+)=plan.applyorid
  and plan.deptid=v.deptid(+) 
  and plan.active='0' 
  and t.documentno=plan.securitychecksno
  and t.documentno=#securityChecksNo:VARCHAR#
    ]]>
 </select>
 
  <select id="getAnviewCorrectivePlan_plan" parameterClass="SimpleMap" resultClass="SimpleMap">
<![CDATA[
select plan.securitychecksno,
       v.deptname,
       hr.chinesename,
       t.zhenggaiplantext as CORRECTIVEPLAN,
       t.iscompletedrectification,
       to_char(plan.overdate, 'yyyy-mm-dd') overdate,
       to_char(t.plancompletiondate, 'yyyy-mm-dd') plandate
  from se_securitychecks_record t,
       hr_employee              hr,
       hr_department            v,
       se_completrectificat_apply  plan
 where  hr.person_id(+) = plan.applyorid
   and plan.deptid = v.deptid(+)


   and t.documentno = plan.securitychecksno
  and t.documentno=#securityChecksNo:VARCHAR#
    ]]>
 </select>
 
 <update id="oingConfirm" parameterClass="SimpleMap">
 <![CDATA[
 update se_securitychecks_record t
 set t.isrectification=#falg:varchar#,t.CONFIRMIDEA = #affirmorIdea:varchar#
 where  t.documentno=#securityChecksNo:VARCHAR#
    ]]>
 </update>
   <select id="getOing" parameterClass="SimpleMap" resultClass="SimpleMap">
<![CDATA[
 select  DOCUMENTNO,
 	SECURITYCHECKSOR_ID,
 	to_char(SECURITYCHECKSDATE,'YYYY-MM-DD') as SECURITYCHECKSDATE,
 	DEPTID,
 	LOCATION,
 	HIDDENDANGERSCOMMUNICATIONS,
 	RECTIFICATIONREQUIREMENTS,
 	to_char(RECTIFICATION_DATE,'YYYY-MM-DD') as RECTIFICATION_DATE,
 	MAILEMPIDLIST ,
 	APPLORID ,
 	to_char(APPLYDATE,'YYYY-MM-DD') as APPLYDATE,
 	BRIEF, 
 	ZHENGGAINUM, 
 	cpny_id from SE_SECURITYCHECKS_RECORD hr where hr.DOCUMENTNO=#documentno:VARCHAR#
    ]]>
 </select>
 
 <insert id="saveOing" parameterClass="SimpleMap">
 <![CDATA[
 	insert into SE_SECURITYCHECKS_RECORD (
 	DOCUMENTNO,
 	SECURITYCHECKSOR_ID,
 	SECURITYCHECKSDATE,
 	DEPTID,
 	LOCATION,
 	HIDDENDANGERSCOMMUNICATIONS,
 	RECTIFICATIONREQUIREMENTS,
 	RECTIFICATION_DATE,
 	MAILEMPIDLIST ,
 	APPLORID ,
 	APPLYDATE,
 	BRIEF, 
 	ZHENGGAINUM, 
 	cpny_id)
 	values (
 	#DOCUMENTNO:varchar#,
 	#SECURITYCHECKSOR_ID:varchar#,
 	to_date(#SECURITYCHECKSDATE:varchar#,'YYYY-MM-DD'),
 	#DEPTID:varchar#,
 	#LOCATION:varchar#,
 	#HIDDENDANGERSCOMMUNICATIONS:varchar#,
 	#RECTIFICATIONREQUIREMENTS:varchar#,
 	to_date(#RECTIFICATION_DATE:varchar#,'YYYY-MM-DD'),
 	#MAILEMPIDLIST:varchar#,
 	#APPLORID:VARCHAR#,
 	TO_DATE(#APPLYDATE#,'YYYY-MM-DD'),
 	#BRIEF:VARCHAR#,
 	'1',
 	#CPNY_ID:varchar#)
    ]]>
 </insert>
   <select id="PHOTO" parameterClass="SimpleMap" resultClass="SimpleMap">
<![CDATA[
 select * from FILE_OR_PHOTO_PATH t where t.documentno=#documentno:varchar#
    ]]>
 </select>
  <insert id="savePHOTO" parameterClass="SimpleMap">
 <![CDATA[
 	insert into FILE_OR_PHOTO_PATH (DOCUMENTNO,CHINESENAME,PATHADDRESS,FILENAME) values(#DOCUMENTNO1:varchar#,
 	#CHINESENAME:varchar#,#PATHADDRESS:varchar#,#FILENAME:varchar#)
    ]]>
 </insert>
 
  <select id="getEmail" parameterClass="SimpleMap" resultClass="string">
<![CDATA[
 select  hr.email from hr_employee hr where hr.person_id=#empid:VARCHAR#
    ]]>
 </select>
 
  <delete id="deleteSecurityCheck" parameterClass="SimpleMap">
 <![CDATA[
 delete  from se_securitychecks_record t 
 where  t.documentno=#securityChecksNo:VARCHAR#
    ]]>
 </delete>
 <select id="getQueryView" parameterClass="SimpleMap" resultClass="SimpleMap">
 select ZHENGGAIPLANTEXT,DOCUMENTNO,to_char(PLANCOMPLETIONDATE,'YYYY-MM-DD') as PLANCOMPLETIONDATE 
 from SE_SECURITYCHECKS_RECORD where DOCUMENTNO = #DOCUMENTNO:varchar#
 </select>
 
  <update id="updateView" parameterClass="SimpleMap">
  update se_securitychecks_record t
 set t.PLANCOMPLETIONDATE=to_date(#PLANCOMPLETIONDATE:varchar#,'YYYY-MM-DD'),ZHENGGAIPLANTEXT=#ZHENGGAIPLANTEXT:varchar#,ZHENGGAIPLAN='1',ISPLAN='1'
 where  t.documentno=#DOCUMENTNO:varchar#
 </update>
 
 
 <select id="getSecurityChecksTotalExcelList" parameterClass="SimpleMap" resultClass="SimpleMap">
<![CDATA[
            select 
            typedeptid.deptid,
            hr_department.deptname,
            typecount0_deptid,
            typecount0_001,
            typecount0_002,
            typecount0_003,
            typecount0_004,
            typecount0_005,
            typecount0_006,
            typecount0_007,
            typecount0_008,
            typecount0_009,
            typecount1_deptid,
            typecount1_001,
            typecount1_002,
            typecount1_003,
            typecount1_004,
            typecount1_005,
            typecount1_006,
            typecount1_007,
            typecount1_008,
            typecount1_009,
            typecount2_deptid,
            typecount2_001,
            typecount2_002,
            typecount2_003,
            typecount2_004,
            typecount2_005,
            typecount2_006,
            typecount2_007,
            typecount2_008,
            typecount2_009,
            typecount3_deptid,
            typecount3_001,
            typecount3_002,
            typecount3_003,
            typecount3_004,
            typecount3_005,
            typecount3_006,
            typecount3_007,
            typecount3_008,
            typecount3_009,
            typecount4_deptid,
            typecount4_001,
            typecount4_002,
            typecount4_003,
            typecount4_004,
            typecount4_005,
            typecount4_006,
            typecount4_007,
            typecount4_008,
            typecount4_009,
            typecount5_deptid,
            typecount5_001,
            typecount5_002,
            typecount5_003,
            typecount5_004,
            typecount5_005,
            typecount5_006,
            typecount5_007,
            typecount5_008,
            typecount5_009
            from  
			
			(select deptid
			from se_securitychecks_record t where 1=1
			]]>
			<isNotEmpty prepend="AND" property="safeStartDate">
			<![CDATA[
		 		(  (to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') >= to_date(#safeStartDate:VARCHAR#,'yyyy-mm-dd')) )
			]]>
            </isNotEmpty>
			<isNotEmpty prepend="AND" property="safeEndDate">
						<![CDATA[
					 		(  (to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') <= to_date(#safeEndDate:VARCHAR#,'yyyy-mm-dd')))
						]]>
			</isNotEmpty>
			<![CDATA[
			group by deptid) typedeptid,
			(select deptid typecount0_deptid,sum(DangerType001) typecount0_001,sum(DangerType002) typecount0_002,sum(DangerType003) typecount0_003,sum(DangerType004) typecount0_004,sum(DangerType005) typecount0_005,sum(DangerType006) typecount0_006,sum(DangerType007) typecount0_007,sum(DangerType008) typecount0_008,sum(DangerType009) typecount0_009 
			from (
			select deptid, 
			decode(hiddendangerstype,'DangerType001',1) DangerType001,
			decode(hiddendangerstype,'DangerType002',1) DangerType002,
			decode(hiddendangerstype,'DangerType003',1) DangerType003,
			decode(hiddendangerstype,'DangerType004',1) DangerType004,
			decode(hiddendangerstype,'DangerType005',1) DangerType005,
			decode(hiddendangerstype,'DangerType006',1) DangerType006,
			decode(hiddendangerstype,'DangerType007',1) DangerType007,
			decode(hiddendangerstype,'DangerType008',1) DangerType008,
			decode(hiddendangerstype,'DangerType009',1) DangerType009
			from se_securitychecks_record t where ISCOMPLETEDRECTIFICATION = 0 and ISPLAN = 1 
			and cpny_id = #CPNY_ID:varchar#
			
			]]>
			<isNotEmpty prepend="AND" property="safeStartDate">
			<![CDATA[
		 		(  (to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') >= to_date(#safeStartDate:VARCHAR#,'yyyy-mm-dd')) )
			]]>
            </isNotEmpty>
			<isNotEmpty prepend="AND" property="safeEndDate">
						<![CDATA[
					 		(  (to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') <= to_date(#safeEndDate:VARCHAR#,'yyyy-mm-dd')))
						]]>
			</isNotEmpty>
			<![CDATA[
			 )   group by deptid) typecount0,
			(select deptid typecount1_deptid,sum(DangerType001) typecount1_001,sum(DangerType002) typecount1_002,sum(DangerType003) typecount1_003,sum(DangerType004) typecount1_004,sum(DangerType005) typecount1_005,sum(DangerType006) typecount1_006,sum(DangerType007) typecount1_007,sum(DangerType008) typecount1_008,sum(DangerType009) typecount1_009
			from (
			select deptid, 
			decode(hiddendangerstype,'DangerType001',1) DangerType001,
			decode(hiddendangerstype,'DangerType002',1) DangerType002,
			decode(hiddendangerstype,'DangerType003',1) DangerType003,
			decode(hiddendangerstype,'DangerType004',1) DangerType004,
			decode(hiddendangerstype,'DangerType005',1) DangerType005,
			decode(hiddendangerstype,'DangerType006',1) DangerType006,
			decode(hiddendangerstype,'DangerType007',1) DangerType007,
			decode(hiddendangerstype,'DangerType008',1) DangerType008,
			decode(hiddendangerstype,'DangerType009',1) DangerType009
			from se_securitychecks_record t where ISCOMPLETEDRECTIFICATION =1 and ISRECTIFICATION = 0  
			and cpny_id = #CPNY_ID:varchar#
			]]>
			<isNotEmpty prepend="AND" property="safeStartDate">
			<![CDATA[
		 		((to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') >= to_date(#safeStartDate:VARCHAR#,'yyyy-mm-dd')))
			]]>
            </isNotEmpty>
			<isNotEmpty prepend="AND" property="safeEndDate">
			<![CDATA[
				((to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') <= to_date(#safeEndDate:VARCHAR#,'yyyy-mm-dd')))
			]]>
			</isNotEmpty>
			<![CDATA[
			)   group by deptid) typecount1,
			(select deptid typecount2_deptid,sum(DangerType001) typecount2_001,sum(DangerType002) typecount2_002,sum(DangerType003) typecount2_003,sum(DangerType004) typecount2_004,sum(DangerType005) typecount2_005,sum(DangerType006) typecount2_006,sum(DangerType007) typecount2_007,sum(DangerType008) typecount2_008,sum(DangerType009) typecount2_009
			from (
			select deptid, 
			decode(hiddendangerstype,'DangerType001',1) DangerType001,
			decode(hiddendangerstype,'DangerType002',1) DangerType002,
			decode(hiddendangerstype,'DangerType003',1) DangerType003,
			decode(hiddendangerstype,'DangerType004',1) DangerType004,
			decode(hiddendangerstype,'DangerType005',1) DangerType005,
			decode(hiddendangerstype,'DangerType006',1) DangerType006,
			decode(hiddendangerstype,'DangerType007',1) DangerType007,
			decode(hiddendangerstype,'DangerType008',1) DangerType008,
			decode(hiddendangerstype,'DangerType009',1) DangerType009
			from se_securitychecks_record  t where ISRECTIFICATION = 3 
			and cpny_id = #CPNY_ID:varchar#
			]]>
			<isNotEmpty prepend="AND" property="safeStartDate">
			<![CDATA[
		 		((to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') >= to_date(#safeStartDate:VARCHAR#,'yyyy-mm-dd')))
			]]>
            </isNotEmpty>
			<isNotEmpty prepend="AND" property="safeEndDate">
			<![CDATA[
				((to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') <= to_date(#safeEndDate:VARCHAR#,'yyyy-mm-dd')))
			]]>
			</isNotEmpty>
			<![CDATA[
			)   group by deptid) typecount2,
			(select deptid typecount3_deptid,sum(DangerType001) typecount3_001,sum(DangerType002) typecount3_002,sum(DangerType003) typecount3_003,sum(DangerType004) typecount3_004,sum(DangerType005) typecount3_005,sum(DangerType006) typecount3_006,sum(DangerType007) typecount3_007,sum(DangerType008) typecount3_008,sum(DangerType009) typecount3_009
			from (
			select deptid, 
			decode(hiddendangerstype,'DangerType001',1) DangerType001,
			decode(hiddendangerstype,'DangerType002',1) DangerType002,
			decode(hiddendangerstype,'DangerType003',1) DangerType003,
			decode(hiddendangerstype,'DangerType004',1) DangerType004,
			decode(hiddendangerstype,'DangerType005',1) DangerType005,
			decode(hiddendangerstype,'DangerType006',1) DangerType006,
			decode(hiddendangerstype,'DangerType007',1) DangerType007,
			decode(hiddendangerstype,'DangerType008',1) DangerType008,
			decode(hiddendangerstype,'DangerType009',1) DangerType009
			from se_securitychecks_record t where ISRECTIFICATION = 1 
			and cpny_id = #CPNY_ID:varchar#
			]]>
			<isNotEmpty prepend="AND" property="safeStartDate">
			<![CDATA[
		 		((to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') >= to_date(#safeStartDate:VARCHAR#,'yyyy-mm-dd')))
			]]>
            </isNotEmpty>
			<isNotEmpty prepend="AND" property="safeEndDate">
			<![CDATA[
				((to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') <= to_date(#safeEndDate:VARCHAR#,'yyyy-mm-dd')))
			]]>
			</isNotEmpty>
			<![CDATA[
			)   group by deptid) typecount3,
			(select deptid typecount4_deptid,sum(DangerType001) typecount4_001,sum(DangerType002) typecount4_002,sum(DangerType003) typecount4_003,sum(DangerType004) typecount4_004,sum(DangerType005) typecount4_005,sum(DangerType006) typecount4_006,sum(DangerType007) typecount4_007,sum(DangerType008) typecount4_008,sum(DangerType009) typecount4_009
			from (
			select deptid, 
			decode(hiddendangerstype,'DangerType001',1) DangerType001,
			decode(hiddendangerstype,'DangerType002',1) DangerType002,
			decode(hiddendangerstype,'DangerType003',1) DangerType003,
			decode(hiddendangerstype,'DangerType004',1) DangerType004,
			decode(hiddendangerstype,'DangerType005',1) DangerType005,
			decode(hiddendangerstype,'DangerType006',1) DangerType006,
			decode(hiddendangerstype,'DangerType007',1) DangerType007,
			decode(hiddendangerstype,'DangerType008',1) DangerType008,
			decode(hiddendangerstype,'DangerType009',1) DangerType009
			from se_securitychecks_record t where ISRECTIFICATION = 0 and ISPLAN = 0 
			and cpny_id = #CPNY_ID:varchar#
			]]>
			<isNotEmpty prepend="AND" property="safeStartDate">
			<![CDATA[
		 		((to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') >= to_date(#safeStartDate:VARCHAR#,'yyyy-mm-dd')))
			]]>
            </isNotEmpty>
			<isNotEmpty prepend="AND" property="safeEndDate">
			<![CDATA[
				((to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') <= to_date(#safeEndDate:VARCHAR#,'yyyy-mm-dd')))
			]]>
			</isNotEmpty>
			<![CDATA[
			)   group by deptid) typecount4,
			(select deptid typecount5_deptid,sum(DangerType001) typecount5_001,sum(DangerType002) typecount5_002,sum(DangerType003) typecount5_003,sum(DangerType004) typecount5_004,sum(DangerType005) typecount5_005,sum(DangerType006) typecount5_006,sum(DangerType007) typecount5_007,sum(DangerType008) typecount5_008,sum(DangerType009) typecount5_009
			from (
			select deptid, 
			decode(hiddendangerstype,'DangerType001',1) DangerType001,
			decode(hiddendangerstype,'DangerType002',1) DangerType002,
			decode(hiddendangerstype,'DangerType003',1) DangerType003,
			decode(hiddendangerstype,'DangerType004',1) DangerType004,
			decode(hiddendangerstype,'DangerType005',1) DangerType005,
			decode(hiddendangerstype,'DangerType006',1) DangerType006,
			decode(hiddendangerstype,'DangerType007',1) DangerType007,
			decode(hiddendangerstype,'DangerType008',1) DangerType008,
			decode(hiddendangerstype,'DangerType009',1) DangerType009
			from se_securitychecks_record t where ISRECTIFICATION = 2 
			and cpny_id = #CPNY_ID:varchar#
			]]>
			<isNotEmpty prepend="AND" property="safeStartDate">
			<![CDATA[
		 		((to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') >= to_date(#safeStartDate:VARCHAR#,'yyyy-mm-dd')))
			]]>
            </isNotEmpty>
			<isNotEmpty prepend="AND" property="safeEndDate">
			<![CDATA[
				((to_date(to_char(t.securitychecksdate, 'yyyy-mm-dd'),'yyyy-mm-dd') <= to_date(#safeEndDate:VARCHAR#,'yyyy-mm-dd')))
			]]>
			</isNotEmpty>
			<![CDATA[
			)   group by deptid) typecount5,
			hr_department
			
			where  typedeptid.deptid = typecount0.typecount0_deptid(+)
			and  typedeptid.deptid = typecount1.typecount1_deptid(+)
			and  typedeptid.deptid = typecount2.typecount2_deptid(+)
			and  typedeptid.deptid = typecount3.typecount3_deptid(+)
			and  typedeptid.deptid = typecount4.typecount4_deptid(+)
			and  typedeptid.deptid = typecount5.typecount5_deptid(+)
			and  typedeptid.deptid = hr_department.deptid


            ]]>
 </select>
 
</sqlMap>