<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="report.evs">
   
   		<!-- Retrieve 78000000 Report0535List -->
	<select id="retrieve780Report0535List" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			 select e.ev_year as EV_YEAR,
				       r.ev_emp_name AS EV_EMPNAME,
				       r.ev_dept_id AS EV_DEPT_ID,
				       r.ev_dept_name AS EV_DEPT_NAME,
				       get_code_name(r.ev_process_id) as EV_PROCESS_NAME,
				       r.ev_flag AS EV_FLAG,
				       get_empid(t.evs_empid) AS EV_EMPID,
				       t.ev_period_id AS EV_PERIOD_ID,
				       get_code_name(t.ev_type_id) AS EV_TYPE_ID,
				       get_evscodename(t.craft, 'CRAFT', '78000000') CRAFT,
				       get_evscodename(t.line, t.craft, '78000000') LINE,
				       get_evscodename(t.aircraft, t.line, '78000000') AIRCRAFT,
				       get_evscodename(t.process, t.line, '78000000') PROCESS,
				       get_code_name(t.skilllevel) as SKILLLEVEL,
				       get_code_name(t.qualification) as QUALIFICATION,
				       t.skillscore as SKILLSCORE,
				       get_code_name(t.purpose) as PURPOSE,
				       get_evscodename(t.jobcontent, t.process, '78000000') JOBCONTENT,
				       get_evscodename(t.skilltype, t.craft, '78000000') SKILLTYPE,
       				   get_evscodename(t.typeoperation,'1','78000000') TYPEOPERATION
				  from evs_setupcode t, evs_emp r,evs_period e
				 where e.ev_year between #year:VARCHAR# and #yearEnd:VARCHAR#
				   and t.ev_period_id = e.ev_period_id
				   and t.evs_empid = r.ev_emp_id
				   and t.ev_period_id = r.ev_period_id
				   and t.ev_type_id = r.ev_type_id
				 
					  
		]]>
		
	 <isNotEmpty prepend="AND" property="deptid">
		<![CDATA[
			 r.ev_dept_id IN (
                      SELECT DEPTID 
                          FROM hr_department_dt 
                          START WITH DEPTID = #deptid:VARCHAR#
                          CONNECT BY PRIOR DEPTID = PARENT_DEPT_ID
             )  
		]]>
	</isNotEmpty><!--
	
	 <isNotEmpty prepend="AND" property="skilltypenum" >
		<![CDATA[
			(select count(evs_empid) as countnum 
          from (select distinct et.evs_empid, et.skilltype
                  from evs_setupcode et, evs_setupcode r
                 where et.evs_empid = r.evs_empid
                   and et.ev_period_id = r.ev_period_id
                   and et.ev_type_id = r.ev_type_id
                 group by et.skilltype, r.skilltype, et.evs_empid
                having et.skilltype <> r.skilltype
                 order by et.evs_empid)  
                 where evs_empid = t.evs_empid
                 group by evs_empid) = #skilltypenum:VARCHAR#
		]]>
	</isNotEmpty>
	 
	 -->
<isNotEmpty prepend="" property="skilltypenum" >
	 <isEqual prepend="and" compareValue="1" property="skilltypenum">
	       <![CDATA[
	      ( select count(evs_empid) as countnum 
          from (select   et.evs_empid,et.ev_period_id,et.ev_type_id, et.skilltype
                  from evs_setupcode et 
                  group by evs_empid, ev_period_id, ev_type_id,et.skilltype
                  order by et.evs_empid)  
                  where evs_empid = t.evs_empid
                  group by evs_empid,ev_period_id,ev_type_id )= #skilltypenum:VARCHAR#
	    ]]>
	 </isEqual>
	 
	  <isNotEqual prepend="and" compareValue="1" property="skilltypenum">
	       <![CDATA[
	     	(select count(evs_empid) as countnum 
          from (select distinct et.evs_empid, et.skilltype
                  from evs_setupcode et, evs_setupcode r
                 where et.evs_empid = r.evs_empid
                   and et.ev_period_id = r.ev_period_id
                   and et.ev_type_id = r.ev_type_id
                 group by et.skilltype, r.skilltype, et.evs_empid
                having et.skilltype <> r.skilltype
                 order by et.evs_empid)  
                 where evs_empid = t.evs_empid
                 group by evs_empid) = #skilltypenum:VARCHAR#
	    ]]>
	 </isNotEqual>
</isNotEmpty><!-- 
	 
	 <isNotEmpty prepend="AND" property="processnum">
		<![CDATA[
			  (select count(*) as countnum
				          from (select distinct et.evs_empid, et.process
				                  from evs_setupcode et, evs_setupcode r
				                 where et.evs_empid = r.evs_empid
				                   and et.ev_period_id = r.ev_period_id
				                   and et.ev_type_id = r.ev_type_id
				                 group by et.process, r.process, et.evs_empid
				                having et.process <> r.process
				                 order by et.evs_empid)
				                  where evs_empid = t.evs_empid
                                  group by evs_empid) = #processnum:VARCHAR#
		]]>
	</isNotEmpty>	
	 
	 -->
   <isNotEmpty prepend="" property="processnum" >
	 <isEqual prepend="and" compareValue="1" property="processnum">
	       <![CDATA[
	      ( select count(evs_empid) as countnum 
          from (select   et.evs_empid,et.ev_period_id,et.ev_type_id, et.process
                  from evs_setupcode et 
                  group by evs_empid, ev_period_id, ev_type_id,et.process
                  order by et.evs_empid)  
                  where evs_empid = t.evs_empid
                  group by evs_empid,ev_period_id,ev_type_id )= #processnum:VARCHAR#
	    ]]>
	 </isEqual>
	 
	  <isNotEqual prepend="and" compareValue="1" property="processnum">
	       <![CDATA[
	     	  (select count(*) as countnum
				          from (select distinct et.evs_empid, et.process
				                  from evs_setupcode et, evs_setupcode r
				                 where et.evs_empid = r.evs_empid
				                   and et.ev_period_id = r.ev_period_id
				                   and et.ev_type_id = r.ev_type_id
				                 group by et.process, r.process, et.evs_empid
				                having et.process <> r.process
				                 order by et.evs_empid)
				                  where evs_empid = t.evs_empid
                                  group by evs_empid) = #processnum:VARCHAR#
	    ]]>
	 </isNotEqual>
</isNotEmpty><!-- 
	 
	 <isNotEmpty prepend="AND" property="skilltype">
		<![CDATA[
			(select count(evs_empid) as countnum 
          from (select distinct et.evs_empid, et.skilltype
                  from evs_setupcode et, evs_setupcode r
                 where et.evs_empid = r.evs_empid
                   and et.ev_period_id = r.ev_period_id
                   and et.ev_type_id = r.ev_type_id
                 group by et.skilltype, r.skilltype, et.evs_empid
                having et.skilltype <> r.skilltype
                 order by et.evs_empid)  
                 where evs_empid = t.evs_empid
                 group by evs_empid) >= #skilltype:VARCHAR#
		]]>
	</isNotEmpty>
	 -->
	 
   <isNotEmpty prepend="" property="skilltype" >
	 <isEqual prepend="and" compareValue="1" property="skilltype">
	       <![CDATA[
	      ( select count(evs_empid) as countnum 
          from (select   et.evs_empid,et.ev_period_id,et.ev_type_id, et.skilltype
                  from evs_setupcode et
                  group by evs_empid, ev_period_id, ev_type_id,et.skilltype
                  order by et.evs_empid)  
                  where evs_empid = t.evs_empid
                  group by evs_empid,ev_period_id,ev_type_id )= #skilltype:VARCHAR#
	    ]]>
	 </isEqual>
	 
	  <isNotEqual prepend="and" compareValue="1" property="skilltype">
	       <![CDATA[
	    (select count(evs_empid) as countnum 
          from (select distinct et.evs_empid, et.skilltype
                  from evs_setupcode et, evs_setupcode r
                 where et.evs_empid = r.evs_empid
                   and et.ev_period_id = r.ev_period_id
                   and et.ev_type_id = r.ev_type_id
                 group by et.skilltype, r.skilltype, et.evs_empid
                having et.skilltype <> r.skilltype
                 order by et.evs_empid)  
                 where evs_empid = t.evs_empid
                 group by evs_empid) >= #skilltype:VARCHAR#
	    ]]>
	 </isNotEqual>
</isNotEmpty><!-- 
	 
	 <isNotEmpty prepend="AND" property="process">
		<![CDATA[
			  (select count(*) as countnum
				          from (select distinct et.evs_empid, et.process
				                  from evs_setupcode et, evs_setupcode r
				                 where et.evs_empid = r.evs_empid
				                   and et.ev_period_id = r.ev_period_id
				                   and et.ev_type_id = r.ev_type_id
				                 group by et.process, r.process, et.evs_empid
				                having et.process <> r.process
				                 order by et.evs_empid)
				                  where evs_empid = t.evs_empid
                                  group by evs_empid) >= #process:VARCHAR#
		]]>
	</isNotEmpty> -->
	
	<isNotEmpty prepend="" property="process" >
	 <isEqual prepend="and" compareValue="1" property="process">
	       <![CDATA[
	      ( select count(evs_empid) as countnum 
          from (select   et.evs_empid,et.ev_period_id,et.ev_type_id, et.process
                  from evs_setupcode et 
                  group by evs_empid, ev_period_id, ev_type_id,et.process
                  order by et.evs_empid)  
                  where evs_empid = t.evs_empid
                  group by evs_empid,ev_period_id,ev_type_id)= #process:VARCHAR#
	    ]]>
	 </isEqual>
	 
	  <isNotEqual prepend="and" compareValue="1" property="process">
	       <![CDATA[
	     (select count(*) as countnum
				          from (select distinct et.evs_empid, et.process
				                  from evs_setupcode et, evs_setupcode r
				                 where et.evs_empid = r.evs_empid
				                   and et.ev_period_id = r.ev_period_id
				                   and et.ev_type_id = r.ev_type_id
				                 group by et.process, r.process, et.evs_empid
				                having et.process <> r.process
				                 order by et.evs_empid)
				                  where evs_empid = t.evs_empid
                                  group by evs_empid) >= #process:VARCHAR#
	    ]]>
	 </isNotEqual>
</isNotEmpty> 
	 
	 order by t.evs_empid
	</select>
	
	<select id="retrieve780Report0536List" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			 select e.ev_year as EV_YEAR,
				       r.ev_emp_name AS EV_EMPNAME,
				       r.ev_dept_id AS EV_DEPT_ID,
				       r.ev_dept_name AS EV_DEPT_NAME,
				       get_code_name(r.ev_process_id) as EV_PROCESS_NAME,
				       r.ev_flag AS EV_FLAG,
				       get_empid(t.evs_empid) AS EV_EMPID,
				       t.ev_period_id AS EV_PERIOD_ID,
				       get_code_name(t.ev_type_id) AS EV_TYPE_ID,
				       get_evscodename(t.craft, 'CRAFT', '78000000') CRAFT,
				       get_evscodename(t.line, t.craft, '78000000') LINE,
				       get_evscodename(t.aircraft, t.line, '78000000') AIRCRAFT,
				       get_evscodename(t.process, t.line, '78000000') PROCESS,
				       get_code_name(t.skilllevel) as SKILLLEVEL,
				       get_code_name(t.qualification) as QUALIFICATION,
				       t.skillscore as SKILLSCORE,
				       get_code_name(t.purpose) as PURPOSE,
				       get_evscodename(t.jobcontent, t.process, '78000000') JOBCONTENT,
				       get_evscodename(t.skilltype, t.craft, '78000000') SKILLTYPE,
       				   get_evscodename(t.typeoperation,'1','78000000') TYPEOPERATION
				  from evs_setupcode t, evs_emp r,evs_period e
				 where e.ev_year between #year:VARCHAR# and #yearEnd:VARCHAR#
				   and t.ev_period_id = e.ev_period_id
				   and t.evs_empid = r.ev_emp_id
				   and t.ev_period_id = r.ev_period_id
				   and t.ev_type_id = r.ev_type_id
				 
					  
		]]>
		
	 <isNotEmpty prepend="AND" property="deptid">
		<![CDATA[
			 r.ev_dept_id IN (
                      SELECT DEPTID 
                          FROM hr_department_dt 
                          START WITH DEPTID = #deptid:VARCHAR#
                          CONNECT BY PRIOR DEPTID = PARENT_DEPT_ID
             )  
		]]>
	</isNotEmpty>	
		
	 <isNotEmpty prepend="AND" property="skiltypeid">
		<![CDATA[
			t.skilltype  = #skiltypeid:VARCHAR#
		]]>
	</isNotEmpty>
	 
	 <isNotEmpty prepend="AND" property="skileid">
		<![CDATA[
			 t.skilllevel = #skileid:VARCHAR#
		]]>
	</isNotEmpty>	
	 
	 order by t.evs_empid
	</select>
	
	<select id="retrieve780Report0537List" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			 select e.ev_year as EV_YEAR,
				       r.ev_emp_name AS EV_EMPNAME,
				       r.ev_dept_id AS EV_DEPT_ID,
				       r.ev_dept_name AS EV_DEPT_NAME,
				       get_code_name(r.ev_process_id) as EV_PROCESS_NAME,
				       r.ev_flag AS EV_FLAG,
				       get_empid(t.evs_empid) AS EV_EMPID,
				       t.ev_period_id AS EV_PERIOD_ID,
				       get_code_name(t.ev_type_id) AS EV_TYPE_ID,
				       get_evscodename(t.craft, 'CRAFT', '78000000') CRAFT,
				       get_evscodename(t.line, t.craft, '78000000') LINE,
				       get_evscodename(t.aircraft, t.line, '78000000') AIRCRAFT,
				       get_evscodename(t.process, t.line, '78000000') PROCESS,
				       get_code_name(t.skilllevel) as SKILLLEVEL,
				       get_code_name(t.qualification) as QUALIFICATION,
				       t.skillscore as SKILLSCORE,
				       get_code_name(t.purpose) as PURPOSE,
				       get_evscodename(t.jobcontent, t.process, '78000000') JOBCONTENT,
				       get_evscodename(t.skilltype, t.craft, '78000000') SKILLTYPE,
       				   get_evscodename(t.typeoperation,'1','78000000') TYPEOPERATION
				  from evs_setupcode t, evs_emp r,evs_period e
				 where e.ev_year between #year:VARCHAR# and #yearEnd:VARCHAR#
				   and t.ev_period_id = e.ev_period_id
				   and t.evs_empid = r.ev_emp_id
				   and t.ev_period_id = r.ev_period_id
				   and t.ev_type_id = r.ev_type_id
				 
					  
		]]>
	 <isNotEmpty prepend="AND" property="deptid">
		<![CDATA[
			 r.ev_dept_id IN (
                      SELECT DEPTID 
                          FROM hr_department_dt 
                          START WITH DEPTID = #deptid:VARCHAR#
                          CONNECT BY PRIOR DEPTID = PARENT_DEPT_ID
             )  
		]]>
	</isNotEmpty>
	 
	 <isNotEmpty prepend="AND" property="typeoationid">
		<![CDATA[
			 t.typeoperation = #typeoationid:VARCHAR#
		]]>
	</isNotEmpty>	
	 
	 order by t.evs_empid
	</select>
	
	<select id="retrieve780Report0538List" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			 select e.ev_year as EV_YEAR,
				       r.ev_emp_name AS EV_EMPNAME,
				       r.ev_dept_id AS EV_DEPT_ID,
				       r.ev_dept_name AS EV_DEPT_NAME,
				       get_code_name(r.ev_process_id) as EV_PROCESS_NAME,
				       r.ev_flag AS EV_FLAG,
				       get_empid(t.evs_empid) AS EV_EMPID,
				       t.ev_period_id AS EV_PERIOD_ID,
				       get_code_name(t.ev_type_id) AS EV_TYPE_ID,
				       get_evscodename(t.craft, 'CRAFT', '78000000') CRAFT,
				       get_evscodename(t.line, t.craft, '78000000') LINE,
				       get_evscodename(t.aircraft, t.line, '78000000') AIRCRAFT,
				       get_evscodename(t.process, t.line, '78000000') PROCESS,
				       get_code_name(t.skilllevel) as SKILLLEVEL,
				       get_code_name(t.qualification) as QUALIFICATION,
				       get_code_name(t.purpose) as PURPOSE,
				       t.skillscore as SKILLSCORE,
				       get_code_name(t.purpose) as PURPOSE,
				       get_evscodename(t.jobcontent, t.process, '78000000') JOBCONTENT,
				       get_evscodename(t.skilltype, t.craft, '78000000') SKILLTYPE,
       				   get_evscodename(t.typeoperation,'1','78000000') TYPEOPERATION,
       				   t.proficiency AS PROFICIENCY,
       				   t.sheopercyq  as SHEOPERCYQ,
		               t.operationcom AS OPERATIONCOM,
		               t.qualityofwork AS QUALITYOFWORK,
		               t.standardaction AS STANDARDACTION,
		               t.composite AS COMPOSITE,
		               t.remark AS REMARK
				  from evs_setupcode t, evs_emp r,evs_period e
				 where  e.ev_year between #year:VARCHAR# and #yearEnd:VARCHAR#
                   and t.ev_period_id = e.ev_period_id
				   and t.evs_empid = r.ev_emp_id
				   and t.ev_period_id = r.ev_period_id
				   and t.ev_type_id = r.ev_type_id
				 
					  
		]]>
	 <isNotEmpty prepend="AND" property="deptid">
		<![CDATA[
			 r.ev_dept_id IN (
                      SELECT DEPTID 
                          FROM hr_department_dt 
                          START WITH DEPTID = #deptid:VARCHAR#
                          CONNECT BY PRIOR DEPTID = PARENT_DEPT_ID
             )  
		]]>
	</isNotEmpty>
	 
	 <isNotEmpty prepend="AND" property="empId">
		<![CDATA[
			 get_empid(t.evs_empid) = #empId:VARCHAR#
		]]>
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="craftid">
		<![CDATA[
			 t.craft = #craftid:VARCHAR#
		]]>
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="qualificationid">
		<![CDATA[
			 t.qualification = #qualificationid:VARCHAR#
		]]>
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="purposeid">
		<![CDATA[
			 t.purpose = #purposeid:VARCHAR#
		]]>
	</isNotEmpty>		
	 
	 order by t.evs_empid
	</select>
	
	<!--  round( a v g (t.composite), 1) as COMPOS -->
	<select id="retrieve780Report0539List" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			   select e.ev_year as EV_YEAR,
		        r.ev_dept_name AS EV_DEPT_NAME,
		        r.ev_dept_id AS EV_DEPT_ID,
		        round(avg(t.proficiency), 1) as PROFIC,
		        round(avg(t.sheopercyq), 1) as SHEPQ,
		        round(avg(t.operationcom), 1) as OPERA,
		        round(avg(t.qualityofwork), 1) as QUALIT,
		        round(avg(t.standardaction), 1) as STAND,
		        round(avg(t.proficiency), 1) + round(avg(t.operationcom), 1) +
		        round(avg(t.sheopercyq), 1) + round(avg(t.qualityofwork), 1) +
		        round(avg(t.standardaction), 1) as COMPOS
		   from evs_setupcode t, evs_emp r, evs_period e
		  where e.ev_year between #year:VARCHAR# and #yearEnd:VARCHAR#
		    and t.ev_period_id = e.ev_period_id
		    and t.evs_empid = r.ev_emp_id
		    and t.ev_period_id = r.ev_period_id
		    and t.ev_type_id = r.ev_type_id
		]]>
	 <isNotEmpty prepend="AND" property="deptid">
		<![CDATA[
			 r.ev_dept_id IN (
                      SELECT DEPTID 
                          FROM hr_department_dt 
                          START WITH DEPTID = #deptid:VARCHAR#
                          CONNECT BY PRIOR DEPTID = PARENT_DEPT_ID
             )  
		]]>
	</isNotEmpty>
	 
	 group by r.ev_dept_name, e.ev_year, r.ev_dept_id
	 order by r.ev_dept_id
	</select>
	
	
</sqlMap>

