<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="safe.rules">

	<select id="DisplayInformation" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select t.upload_id as fileId,
			       t.upload_name as fileName,
			       nvl(to_char(s.system_id),c.code_id) as menuId,
			       nvl(s.system_name,c.code_name) as menu,
			       to_char(t.implementation_date,'yyyy-MM-dd') as implementation_date,
			       to_char(t.create_date,'yyyy-MM-dd') as create_date,
			       to_char(t.update_date,'yyyy-MM-dd') as update_date,
			       t.upload_path as filePath,
			       t.fileaddress
			  from se_regulation_upload_file t, se_regulation s, sy_code c
			 where t.code_id = to_char(s.system_id(+)) and t.code_id = c.code_id(+)
			   and  t.cpny_id=#cpny_id:varchar#
			   and t.code_id IN (select A.CODE_ID
			                       from (select to_char(t.system_id) as code_id,
			                                    t.system_name as code_name,
			                                    t.code_id as parent_code,
			                                    t.create_date,
			                                    t.update_date
			                               from se_regulation t where t.cpny_id=#cpny_id:varchar# or t.cpny_id is null
			                             union
			                             select sy.code_id,
			                                    sy.code_name,
			                                    sy.parent_code,
			                                    sy.create_date,
			                                    sy.update_date
			                               from sy_code sy
			                              where sy.parent_code = 'System_admin'
			                                 or sy.code_id = 'System_admin' and (sy.cpny_id=#cpny_id:varchar# or sy.cpny_id is null)) A
			                      START WITH A.CODE_ID = 'System_admin'
			                     CONNECT BY PRIOR A.CODE_ID = A.PARENT_CODE)
		]]>
		
		<isNotEmpty prepend="AND" property="systemName">
			<![CDATA[
		 		t.upload_name like '%' || #systemName:VARCHAR# || '%'
			]]>
		</isNotEmpty>
	</select>
	
	<select id="AllMenu" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select A.*,level
			  from (select to_char(t.system_id) as code_id,
			               t.system_name as code_name,
			               t.code_id as parent_code,
			               t.create_date,
			               t.update_date
			          from se_regulation t
			          where (t.cpny_id is null or t.cpny_id=#cpnyId:VARCHAR#)
			        union
			        select sy.code_id,
			               sy.code_name,
			               sy.parent_code,
			               sy.create_date,
			               sy.update_date
			          from sy_code sy
			         where sy.parent_code = 'System_admin'
			         and (sy.cpny_id is null or sy.cpny_id=#cpnyId:VARCHAR#) ) A
			 START WITH A.PARENT_CODE = 'System_admin'
			CONNECT BY PRIOR A.CODE_ID = A.PARENT_CODE
      		order siblings by A.CODE_ID
		]]>
	</select>
	
	<insert id="AddFile" parameterClass="SimpleMap">
		<![CDATA[
			insert into se_regulation_upload_file s
				  (s.upload_id,
				   s.upload_name,
				   s.upload_path,
				   s.code_id,
				   s.create_date,
				   s.implementation_date,
				   s.fileaddress,
				   s.upload_path_random,
				   s.cpny_id)
				values
			  (
				  #seq:NUMERIC#, 
				  #fname:VARCHAR#, 
				  #filename:VARCHAR#, 
				  #menu:VARCHAR#, 
				  sysdate, 
				  to_date(#date:VARCHAR#,'yyyy-MM_dd hh24:mi'),
				  #myfile:VARCHAR#,
				  #seq:NUMERIC#,
				  #cpny_id:VARCHAR#
			  )
		]]>
	</insert>
	
	<select id="getSeq" parameterClass="SimpleMap" resultClass="int">
		<![CDATA[
			select se_regulation_seq.nextval from dual
		]]>
	</select>
	
	<select id="AllUpdateInformation" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select t.upload_id,
			       t.upload_name,
			       t.upload_path,
			       t.code_id,
			       t.create_date,
			       to_char(t.implementation_date, 'yyyy-MM-dd') as implementation_date,
			       t.update_date
			  from se_regulation_upload_file t
			  where t.upload_id=#uploadId:NUMERIC#
		]]>
	</select>
	<select id="SingleMenu" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select t.upload_id as fileId,
			       t.upload_name as fileName,
			       nvl(to_char(s.system_id),c.code_id) as menuId,
			       nvl(s.system_name,c.code_name) as menu,
			       to_char(t.implementation_date,'yyyy-MM-dd') as implementation_date,
			       to_char(t.create_date,'yyyy-MM-dd') as create_date,
			       t.update_date,
			       t.upload_path as filePath
			  from se_regulation_upload_file t, se_regulation s, sy_code c
			 where nvl(to_char(s.system_id),c.code_id) = #menuid:VARCHAR# and t.code_id = to_char(s.system_id(+)) and t.code_id = c.code_id(+)
			   and t.code_id IN (select A.CODE_ID
			                       from (select to_char(t.system_id) as code_id,
			                                    t.system_name as code_name,
			                                    t.code_id as parent_code,
			                                    t.create_date,
			                                    t.update_date
			                               from se_regulation t
			                             union
			                             select sy.code_id,
			                                    sy.code_name,
			                                    sy.parent_code,
			                                    sy.create_date,
			                                    sy.update_date
			                               from sy_code sy
			                              where sy.parent_code = 'System_admin'
			                                 or sy.code_id = 'System_admin') A
			                      START WITH A.CODE_ID = 'System_admin'
			                     CONNECT BY PRIOR A.CODE_ID = A.PARENT_CODE)
                      
		]]>
	</select>
	
	<delete id="DeleteFileInformation" parameterClass="SimpleMap">
		<![CDATA[
			delete se_regulation_upload_file t where t.upload_id = #uploadId:NUMERIC#
		]]>
	</delete>
	
	<update id="UpdateSingleFileInformation" parameterClass="SimpleMap">
		<![CDATA[
				update se_regulation_upload_file s
				   set s.upload_name = #fname:VARCHAR#,
				       s.upload_path = #filename:VARCHAR#,
				       s.code_id     = #singleMenu:VARCHAR#,
				       s.UPDATE_DATE = sysdate,
				       s.implementation_date=to_date(#implementationdate:VARCHAR#, 'yyyy-MM-dd')
				where s.upload_id=#uploadId:NUMERIC#
		]]>
	</update>
	
	<update id="UpdateSingleFileInformation1" parameterClass="SimpleMap">
		<![CDATA[
				update se_regulation_upload_file s
				   set s.code_id     = #singleMenu:VARCHAR#,
				       s.UPDATE_DATE = sysdate,
				       s.implementation_date=to_date(#implementationdate:VARCHAR#, 'yyyy-MM-dd')
				where s.upload_id=#uploadId:NUMERIC#
		]]>
	</update>
	
	<select id="AllMenuInformation" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select A.*,level
			  from (select to_char(t.system_id) as code_id,
			               t.system_name as code_name,
			               t.code_id as parent_code,
			               t.create_date,
			               t.update_date
			          from se_regulation t
			          where t.cpny_id=#cpnyId:VARCHAR#
			        union
			        select sy.code_id,
			               sy.code_name,
			               sy.parent_code,
			               sy.create_date,
			               sy.update_date
			          from sy_code sy
			         where sy.parent_code = 'System_admin'
			         and (sy.cpny_id = #cpnyId:VARCHAR# or sy.cpny_id is null)) A
			 START WITH A.PARENT_CODE = 'System_admin'
			CONNECT BY PRIOR A.CODE_ID = A.PARENT_CODE
      		order siblings by A.CODE_ID
		]]>
	</select>
	
	
		<select id="DisplayInformationNumber" parameterClass="SimpleMap" resultClass="int">
		 <![CDATA[
			select count(t.upload_id)
			       
			  from se_regulation_upload_file t, se_regulation s, sy_code c
			 where t.code_id = to_char(s.system_id(+))
			   and t.code_id = c.code_id(+)
			   and  t.cpny_id=#cpny_id:varchar#
          ]]>
		   <isNotEmpty prepend="AND" property="systemName">
					<![CDATA[
				 		t.upload_name like '%' || #systemName:VARCHAR# || '%'
					]]>
				</isNotEmpty>
					<![CDATA[
		   and t.code_id IN
		       (select A.CODE_ID
		          from (select to_char(t.system_id) as code_id,
		                       t.system_name as code_name,
		                       t.code_id as parent_code,
		                       t.create_date,
		                       t.update_date
		                  from se_regulation t where t.cpny_id=#cpny_id:varchar# or t.cpny_id is null
		                union
		                select sy.code_id,
		                       sy.code_name,
		                       sy.parent_code,
		                       sy.create_date,
		                       sy.update_date
		                  from sy_code sy
		                 where sy.parent_code = 'System_admin'
		                    or sy.code_id = 'System_admin' and (sy.cpny_id=#cpny_id:varchar# or sy.cpny_id is null)) A
		         START WITH A.CODE_ID = 'System_admin'
		        CONNECT BY PRIOR A.CODE_ID = A.PARENT_CODE)
		]]>	
	</select>
	<insert id="addmenu" parameterClass="SimpleMap">
		<![CDATA[
			insert into se_regulation t (t.system_id , t.system_name , t.create_date , t.code_id, cpny_id,ORDERNO,t.activity)
				values(se_regulation_seq.nextval , #menuName:VARCHAR# , sysdate , #topMenuId:VARCHAR#, #cpny_id:varchar#,#orderno:number#,#activity#)
		]]>
	</insert>
	
	<select id="menuInformation" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select A.*,level
			  from (select to_char(t.system_id) as system_id,
			               t.system_name as system_name,
			               t.code_id as code_id,
			               to_char(t.create_date,'yyyy-MM-dd hh24:mi') as create_date,
			               to_char(t.update_date,'yyyy-MM-dd hh24:mi') as update_date,
			               to_char(t.ORDERNO) as ORDERNO
			          from se_regulation t 
			          where (t.cpny_id=#cpny_id:varchar# or t.cpny_id is null)
			          and   t.activity = 1		          
			        union
			        select sy.code_id,
			               sy.code_name,
			               sy.parent_code,
			               to_char(sy.create_date,'yyyy-MM-dd hh24:mi') as create_date,
			               to_char(sy.update_date,'yyyy-MM-dd hh24:mi') as update_date,
			                to_char(sy.ORDERNO) as ORDERNO
			          from sy_code sy
			         where sy.parent_code = 'System_admin' and (sy.cpny_id=#cpny_id:varchar# or sy.cpny_id is null)) A
			 START WITH A.code_id = 'System_admin'
			CONNECT BY PRIOR A.system_id = A.code_id
      		order siblings by A.code_id,a.ORDERNO
		]]>
	</select>
	
	<select id="menuInformation_1" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select A.*,level
			  from (select to_char(t.system_id) as system_id,
			               t.system_name as system_name,
			               t.code_id as code_id,
			               to_char(t.create_date,'yyyy-MM-dd hh24:mi') as create_date,
			               to_char(t.update_date,'yyyy-MM-dd hh24:mi') as update_date,
			               to_char(t.ORDERNO) as ORDERNO,
			               t.activity as activity
			          from se_regulation t 
			          where (t.cpny_id=#cpny_id:varchar# or t.cpny_id is null)	          
			        union
			        select sy.code_id,
			               sy.code_name,
			               sy.parent_code,
			               to_char(sy.create_date,'yyyy-MM-dd hh24:mi') as create_date,
			               to_char(sy.update_date,'yyyy-MM-dd hh24:mi') as update_date,
			                to_char(sy.ORDERNO) as ORDERNO,
			                sy.activity activtiy
			          from sy_code sy
			         where sy.parent_code = 'System_admin' and (sy.cpny_id=#cpny_id:varchar# or sy.cpny_id is null)) A
			 START WITH A.code_id = 'System_admin'
			CONNECT BY PRIOR A.system_id = A.code_id
      		order siblings by A.code_id,a.ORDERNO
		]]>
	</select>
	
	
	<select id="getFileInfo" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select * from se_regulation_upload_file t where t.code_id = #systemId:VARCHAR#
		]]>
	</select>
	
	<select id="topMenu" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select *
			  from (select to_char(t.system_id) as code_id,
			               t.system_name as code_name,
			               t.code_id as parent_code,
			               t.create_date,
			               t.update_date
			          from se_regulation t
			        union
			        select sy.code_id,
			               sy.code_name,
			               sy.parent_code,
			               sy.create_date,
			               sy.update_date
			          from sy_code sy
			         where sy.parent_code = 'System_admin'
			            or sy.code_id = 'System_admin') A
			            
			            where A.CODE_ID= #topMenuId:VARCHAR#
			 START WITH A.CODE_ID = 'System_admin'
			CONNECT BY PRIOR A.CODE_ID = A.PARENT_CODE
		]]>
	</select>
	
	<select id="menuName" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select t.system_id,
			       t.system_name,
			       to_char(t.create_date, 'yyyy-MM-dd') as create_date,
			       to_char(t.update_date, 'yyyy-MM-dd') as update_date,
			       t.code_id,
			       t.ORDERNO,
			        t.activity
			  from se_regulation t
			where t.system_id = #menuId:VARCHAR#
		]]>
	</select>
	
	<select id="singleMenu" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select *
			  from (select to_char(t.system_id) as code_id,
			               t.system_name as code_name,
			               t.code_id as parent_code,
			               t.create_date,
			               t.update_date
			          from se_regulation t
			        union
			        select sy.code_id,
			               sy.code_name,
			               sy.parent_code,
			               sy.create_date,
			               sy.update_date
			          from sy_code sy
			         where sy.parent_code = 'System_admin'
			            or sy.code_id = 'System_admin') A
			            
			           where A.CODE_ID = #topmenuId:VARCHAR#
			 START WITH A.CODE_ID = 'System_admin'
			CONNECT BY PRIOR A.CODE_ID = A.PARENT_CODE
			 order siblings by A.CODE_ID
		]]>
	</select>
	
	<update id="updatemenu" parameterClass="SimpleMap">
		<![CDATA[
				update se_regulation t
			    set t.system_name = #menuName:VARCHAR#,
			       t.update_date = sysdate,
			       t.code_id     = #topMenuId:VARCHAR#,
			       t.ORDERNO     = #orderno:number#,
			       t.activity    = #activity:number#
			    where t.system_id = #menuId:VARCHAR#
		]]>
	</update>
	
	<delete id="DeleteSingleMenuInformation" parameterClass="SimpleMap">
		<![CDATA[
			 delete se_regulation t where t.system_id = #menuid:VARCHAR#
		]]>
	</delete>
	
	<select id="parentCode" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select t.code_id as parentCode from se_regulation t
		]]>
	</select>
	
	<select id="SuperTopMenu" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select * from sy_code s where s.parent_code = 'System_admin'
		]]>
	</select>
	
	<select id="nextMenu" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select *
			  from (select to_char(t.system_id) as code_id,
			               t.system_name as code_name,
			               t.code_id as parent_code,
			               t.create_date,
			               t.update_date
			          from se_regulation t
			        union
			        select sy.code_id,
			               sy.code_name,
			               sy.parent_code,
			               sy.create_date,
			               sy.update_date
			          from sy_code sy
			         where sy.parent_code = 'System_admin'
			            or sy.code_id = 'System_admin') A
			            
			            where A.PARENT_CODE = #menuId:VARCHAR#
			 START WITH A.CODE_ID = 'System_admin'
			CONNECT BY PRIOR A.CODE_ID = A.PARENT_CODE
			 order siblings by A.CODE_ID
		]]>
	</select>
	
	<select id="yesornoSubset" parameterClass="SimpleMap" resultClass="int">
		<![CDATA[
			select count(*)
			  from (select to_char(t.system_id) as code_id,
			               t.system_name as code_name,
			               t.code_id as parent_code,
			               t.create_date,
			               t.update_date
			          from se_regulation t
			        union
			        select sy.code_id,
			               sy.code_name,
			               sy.parent_code,
			               sy.create_date,
			               sy.update_date
			          from sy_code sy
			         where sy.parent_code = 'System_admin'
			            or sy.code_id = 'System_admin') A
			            
			            where A.PARENT_CODE = #menuId:VARCHAR#
			 START WITH A.CODE_ID = 'System_admin'
			CONNECT BY PRIOR A.CODE_ID = A.PARENT_CODE
			 order siblings by A.CODE_ID
		]]>
	</select>
	
	<select id="fileview" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select t.upload_id as fileId,
			       t.upload_name as fileName,
			       nvl(to_char(s.system_id),c.code_id) as menuId,
			       nvl(s.system_name,c.code_name) as menu,
			       to_char(t.implementation_date,'yyyy-MM-dd') as implementation_date,
			       to_char(t.create_date,'yyyy-MM-dd') as create_date,
			       to_char(t.update_date,'yyyy-MM-dd') as update_date,
			       t.upload_path as filePath
			  from se_regulation_upload_file t, se_regulation s, sy_code c
			 where t.code_id = to_char(s.system_id(+)) and t.code_id = c.code_id(+)
			   and t.code_id = #systemId:VARCHAR#
		]]>
	</select>
	
	
	<select id="getSystemName" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			select t.upload_id as fileId,
			       t.upload_name as fileName,
			       nvl(to_char(s.system_id),c.code_id) as menuId,
			       nvl(s.system_name,c.code_name) as menu,
			       to_char(t.implementation_date,'yyyy-MM-dd') as implementation_date,
			       to_char(t.create_date,'yyyy-MM-dd') as create_date,
			       to_char(t.update_date,'yyyy-MM-dd') as update_date,
			       t.upload_path as filePath
			  from se_regulation_upload_file t, se_regulation s, sy_code c
			 where t.code_id = to_char(s.system_id(+)) and t.code_id = c.code_id(+)
			   and t.upload_name like '%' || #systemName:VARCHAR# || '%'
		]]>
	</select>
	
	<select id="getMyhrefaddress" parameterClass="SimpleMap" resultClass="string">
		<![CDATA[
			select t.upload_path as filePath
			  from se_regulation_upload_file t, se_regulation s, sy_code c
			 where t.upload_id = #myhreffileId:NUMERIC# and t.code_id = to_char(s.system_id(+)) and t.code_id = c.code_id(+)
			   and t.code_id IN (select A.CODE_ID
			                       from (select to_char(t.system_id) as code_id,
			                                    t.system_name as code_name,
			                                    t.code_id as parent_code,
			                                    t.create_date,
			                                    t.update_date
			                               from se_regulation t
			                             union
			                             select sy.code_id,
			                                    sy.code_name,
			                                    sy.parent_code,
			                                    sy.create_date,
			                                    sy.update_date
			                               from sy_code sy
			                              where sy.parent_code = 'System_admin'
			                                 or sy.code_id = 'System_admin') A
			                      START WITH A.CODE_ID = 'System_admin'
			                     CONNECT BY PRIOR A.CODE_ID = A.PARENT_CODE)
		]]>
	</select>
	
	<select id="getFileloadpath" parameterClass="SimpleMap" resultClass="string">
		<![CDATA[
			select t.upload_path as filePath
			  from se_regulation_upload_file t, se_regulation s, sy_code c
			 where t.upload_id = #uploadId:NUMERIC# and t.code_id = to_char(s.system_id(+)) and t.code_id = c.code_id(+)
			   and t.code_id IN (select A.CODE_ID
			                       from (select to_char(t.system_id) as code_id,
			                                    t.system_name as code_name,
			                                    t.code_id as parent_code,
			                                    t.create_date,
			                                    t.update_date
			                               from se_regulation t
			                             union
			                             select sy.code_id,
			                                    sy.code_name,
			                                    sy.parent_code,
			                                    sy.create_date,
			                                    sy.update_date
			                               from sy_code sy
			                              where sy.parent_code = 'System_admin'
			                                 or sy.code_id = 'System_admin') A
			                      START WITH A.CODE_ID = 'System_admin'
			                     CONNECT BY PRIOR A.CODE_ID = A.PARENT_CODE)
		]]>
	</select>
</sqlMap>