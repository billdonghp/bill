<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ga.eatingCard">
<select id="eatingCardAffirmList" parameterClass="SimpleMap" resultClass="SimpleMap">
  <![CDATA[		  
       
        select t.apply_no,
               decode(t.employee_type,'external','外来人员','Local','本社员工') employee_type,
               diff.code_name eatery_diff,
               decode(t.employee_type,'external',t.useror,'Local',hr.chinesename) useror,
               t.user_num,
               apply.chinesename applyer,
               de.deptname applyer_dept,
               to_char(t.APPLY_DATE,'YYYY-MM-DD') start_date,
               to_char(t.end_date,'YYYY-MM-DD') end_date,
               to_char(t.apply_date, 'YYYY-MM-DD') apply_date,
               t.postion,
               t.eatery_type,
               t.companyname,
               t.rmark,
               t.cpny_id,
               apply.email ,
               t.active,
               AFFIRM.GA_AFFIRM_NO,
               AFFIRM.AFFIRM_FLAG,
               NVL(AFFIRM.AFFIRMOR_IDEA,'') AFFIRMOR_IDEA,
               AFFIRM.AFFIRM_LEVEL,
               AFFIRM.AFFIRMOR_ID,
               NVL(AFFIRM.UP_AFFIRM_FLAG,1) UP_AFFIRM_FLAG,
               AFFIRM.MAX_AFFIRM_FLAG,
               t.TJSX
        
          from ga_card_application t,sy_code diff,hr_employee hr,hr_employee apply,hr_department de,
          (SELECT ga_card_application_affirm.*,
       UP_AFFIRM.AFFIRMOR_ID UP_AFFIRMOR_ID,
       UP_AFFIRM.AFFIRM_FLAG UP_AFFIRM_FLAG,
       CASE
         WHEN ga_card_application_affirm.AFFIRM_LEVEL = MAX_AFFIRM.MAX_LEVEL THEN
          1
         ELSE
          0
       END AS MAX_AFFIRM_FLAG
  FROM (SELECT ga_card_application_affirm.*,
               ga_card_application_affirm.AFFIRM_LEVEL - 1 UP_LEVEL
          FROM ga_card_application_affirm) ga_card_application_affirm,
       (SELECT ga_card_application_affirm.APPLY_NO,
               ga_card_application_affirm.AFFIRM_LEVEL,
               ga_card_application_affirm.AFFIRMOR_ID,
               ga_card_application_affirm.AFFIRM_FLAG
          FROM ga_card_application_affirm) UP_AFFIRM,
       (SELECT ga_card_application_affirm.APPLY_NO,
               MAX(ga_card_application_affirm.AFFIRM_LEVEL) MAX_LEVEL
          FROM ga_card_application_affirm
         GROUP BY ga_card_application_affirm.APPLY_NO) MAX_AFFIRM

 WHERE ga_card_application_affirm.APPLY_NO = UP_AFFIRM.APPLY_NO(+)
   AND ga_card_application_affirm.UP_LEVEL = UP_AFFIRM.AFFIRM_LEVEL(+)
   AND ga_card_application_affirm.APPLY_NO = MAX_AFFIRM.APPLY_NO(+)
   and ga_card_application_affirm.AFFIRMOR_ID = #adminId:VARCHAR#
 ) AFFIRM
          where t.eatery_diff=diff.code_id(+)
                and t.useror=hr.person_id(+)
                and t.applyer=apply.person_id(+)
                and t.applyer_dept=de.deptid(+)
                and t.cpny_id=#cpnyId:VARCHAR#
                and NVL(AFFIRM.UP_AFFIRM_FLAG,1)=1
                AND T.APPLY_NO=AFFIRM.APPLY_NO
	  
   ]]>
 <isNotEqual prepend="" property="qryType" compareValue="3">
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				 AFFIRM.AFFIRM_FLAG=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 AFFIRM.AFFIRM_FLAG =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 AFFIRM.AFFIRM_FLAG =2
	]]>
	</isEqual>
 </isNotEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (hr.Chinesename LIKE  '%'||#key:VARCHAR# || '%' or hr.empid  LIKE  '%'||#key:VARCHAR# || '%' or t.useror  LIKE  '%'||#key:VARCHAR# || '%'  )
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.applyer_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>		
	<isNotEmpty prepend="AND" property="cpnyId">
		<![CDATA[		   
		 t.CPNY_ID=#cpnyId:VARCHAR#
		]]>	
	</isNotEmpty>		
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 to_date(to_char(t.apply_date,'yyyy-mm-dd'),'yyyy-mm-dd') >=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		to_date(to_char(t.apply_date,'yyyy-mm-dd'),'yyyy-mm-dd') <=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<![CDATA[	
     order by t.apply_date desc
    ]]>
</select>
<select id="tempCardAffirmList" parameterClass="SimpleMap" resultClass="SimpleMap">
  <![CDATA[		  
       select t.apply_no,
               decode(t.employee_type,'external','外来人员','Local','本社员工') employee_type,
               apply.chinesename applyer,
               de.deptname applyer_dept,
               t.user_name,
               t.user_business,
               to_char(t.start_date,'YYYY-MM-DD') start_date,
               to_char(t.end_date,'YYYY-MM-DD') end_date,
               t.PERMISSIONS_TYPE,
               to_char(t.apply_date, 'YYYY-MM-DD') apply_date,
               t.cpny_id,
               apply.email ,
               t.active,
               AFFIRM.GA_AFFIRM_NO,
               AFFIRM.AFFIRM_FLAG,
               NVL(AFFIRM.AFFIRMOR_IDEA,'') AFFIRMOR_IDEA,
               AFFIRM.AFFIRM_LEVEL,
               AFFIRM.AFFIRMOR_ID,
               NVL(AFFIRM.UP_AFFIRM_FLAG,1) UP_AFFIRM_FLAG,
               AFFIRM.MAX_AFFIRM_FLAG
        
          from GA_TEMPCARD_APPLICATION t,hr_employee hr,hr_employee apply,hr_department de,
          (SELECT GA_TEMPCARD_APPLICATION_AFFIRM.*,
       UP_AFFIRM.AFFIRMOR_ID UP_AFFIRMOR_ID,
       UP_AFFIRM.AFFIRM_FLAG UP_AFFIRM_FLAG,
       CASE
         WHEN GA_TEMPCARD_APPLICATION_AFFIRM.AFFIRM_LEVEL = MAX_AFFIRM.MAX_LEVEL THEN
          1
         ELSE
          0
       END AS MAX_AFFIRM_FLAG
  FROM (SELECT GA_TEMPCARD_APPLICATION_AFFIRM.*,
               GA_TEMPCARD_APPLICATION_AFFIRM.AFFIRM_LEVEL - 1 UP_LEVEL
          FROM GA_TEMPCARD_APPLICATION_AFFIRM) GA_TEMPCARD_APPLICATION_AFFIRM,
       (SELECT GA_TEMPCARD_APPLICATION_AFFIRM.APPLY_NO,
               GA_TEMPCARD_APPLICATION_AFFIRM.AFFIRM_LEVEL,
               GA_TEMPCARD_APPLICATION_AFFIRM.AFFIRMOR_ID,
               GA_TEMPCARD_APPLICATION_AFFIRM.AFFIRM_FLAG
          FROM GA_TEMPCARD_APPLICATION_AFFIRM) UP_AFFIRM,
       (SELECT GA_TEMPCARD_APPLICATION_AFFIRM.APPLY_NO,
               MAX(GA_TEMPCARD_APPLICATION_AFFIRM.AFFIRM_LEVEL) MAX_LEVEL
          FROM GA_TEMPCARD_APPLICATION_AFFIRM
         GROUP BY GA_TEMPCARD_APPLICATION_AFFIRM.APPLY_NO) MAX_AFFIRM

 WHERE GA_TEMPCARD_APPLICATION_AFFIRM.APPLY_NO = UP_AFFIRM.APPLY_NO(+)
   AND GA_TEMPCARD_APPLICATION_AFFIRM.UP_LEVEL = UP_AFFIRM.AFFIRM_LEVEL(+)
   AND GA_TEMPCARD_APPLICATION_AFFIRM.APPLY_NO = MAX_AFFIRM.APPLY_NO(+)
   and GA_TEMPCARD_APPLICATION_AFFIRM.AFFIRMOR_ID = #adminId:VARCHAR#
 ) AFFIRM
          where t.user_name=hr.person_id(+)
                and t.applyer=apply.person_id(+)
                and t.applyer_dept=de.deptid(+)
                and t.cpny_id=#cpnyId:VARCHAR#
                and NVL(AFFIRM.UP_AFFIRM_FLAG,1)=1
                AND T.APPLY_NO=AFFIRM.APPLY_NO
	  
   ]]>
 <isNotEqual prepend="" property="qryType" compareValue="3">
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				 AFFIRM.AFFIRM_FLAG=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 AFFIRM.AFFIRM_FLAG =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 AFFIRM.AFFIRM_FLAG =2
	]]>
	</isEqual>
 </isNotEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (hr.Chinesename LIKE  '%'||#key:VARCHAR# || '%' or hr.empid  LIKE  '%'||#key:VARCHAR# || '%' or t.useror  LIKE  '%'||#key:VARCHAR# || '%'  )
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.applyer_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 to_date(to_char(t.apply_date,'yyyy-mm-dd'),'yyyy-mm-dd') >=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		to_date(to_char(t.apply_date,'yyyy-mm-dd'),'yyyy-mm-dd') <=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<![CDATA[	
     order by t.apply_date desc
    ]]>
</select>
<select id="eatingCardAffirmListNumber" parameterClass="SimpleMap" resultClass="int">
    <![CDATA[	
	
       
        select count(*)
        
          from ga_card_application t,hr_employee apply,hr_employee hr,
          (SELECT ga_card_application_affirm.*,
       UP_AFFIRM.AFFIRMOR_ID UP_AFFIRMOR_ID,
       UP_AFFIRM.AFFIRM_FLAG UP_AFFIRM_FLAG,
       CASE
         WHEN ga_card_application_affirm.AFFIRM_LEVEL = MAX_AFFIRM.MAX_LEVEL THEN
          1
         ELSE
          0
       END AS MAX_LEVEL_FLAG
  FROM (SELECT ga_card_application_affirm.*,
               ga_card_application_affirm.AFFIRM_LEVEL - 1 UP_LEVEL
          FROM ga_card_application_affirm) ga_card_application_affirm,
       (SELECT ga_card_application_affirm.APPLY_NO,
               ga_card_application_affirm.AFFIRM_LEVEL,
               ga_card_application_affirm.AFFIRMOR_ID,
               ga_card_application_affirm.AFFIRM_FLAG
          FROM ga_card_application_affirm) UP_AFFIRM,
       (SELECT ga_card_application_affirm.APPLY_NO,
               MAX(ga_card_application_affirm.AFFIRM_LEVEL) MAX_LEVEL
          FROM ga_card_application_affirm
         GROUP BY ga_card_application_affirm.APPLY_NO) MAX_AFFIRM

 WHERE ga_card_application_affirm.APPLY_NO = UP_AFFIRM.APPLY_NO(+)
   AND ga_card_application_affirm.UP_LEVEL = UP_AFFIRM.AFFIRM_LEVEL(+)
   AND ga_card_application_affirm.APPLY_NO = MAX_AFFIRM.APPLY_NO(+)
   and ga_card_application_affirm.AFFIRMOR_ID = #adminId:VARCHAR#
 ) AFFIRM
          where t.cpny_id=#cpnyId:VARCHAR#
                and NVL(AFFIRM.UP_AFFIRM_FLAG,1)=1
                 and t.useror=hr.person_id(+)
                AND T.APPLY_NO=AFFIRM.APPLY_NO
                and t.applyer=apply.person_id(+)

   ]]>
 <isNotEqual prepend="" property="qryType" compareValue="3">
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				 AFFIRM.AFFIRM_FLAG=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 AFFIRM.AFFIRM_FLAG =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 AFFIRM.AFFIRM_FLAG =2
	]]>
	</isEqual>
 </isNotEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (hr.Chinesename LIKE  '%'||#key:VARCHAR# || '%' or hr.empid  LIKE  '%'||#key:VARCHAR# || '%' or t.useror  LIKE  '%'||#key:VARCHAR# || '%'  )
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.applyer_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 to_date(to_char(t.apply_date,'yyyy-mm-dd'),'yyyy-mm-dd') >=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		to_date(to_char(t.apply_date,'yyyy-mm-dd'),'yyyy-mm-dd') <=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
</select>
<select id="tempCardAffirmListNumber" parameterClass="SimpleMap" resultClass="int">
    <![CDATA[	
        select count(*)
        
          from GA_TEMPCARD_APPLICATION t,hr_employee apply,hr_employee hr,
          (SELECT GA_TEMPCARD_APPLICATION_AFFIRM.*,
       UP_AFFIRM.AFFIRMOR_ID UP_AFFIRMOR_ID,
       UP_AFFIRM.AFFIRM_FLAG UP_AFFIRM_FLAG,
       CASE
         WHEN GA_TEMPCARD_APPLICATION_AFFIRM.AFFIRM_LEVEL = MAX_AFFIRM.MAX_LEVEL THEN
          1
         ELSE
          0
       END AS MAX_LEVEL_FLAG
  FROM (SELECT GA_TEMPCARD_APPLICATION_AFFIRM.*,
               GA_TEMPCARD_APPLICATION_AFFIRM.AFFIRM_LEVEL - 1 UP_LEVEL
          FROM GA_TEMPCARD_APPLICATION_AFFIRM) GA_TEMPCARD_APPLICATION_AFFIRM,
       (SELECT GA_TEMPCARD_APPLICATION_AFFIRM.APPLY_NO,
               GA_TEMPCARD_APPLICATION_AFFIRM.AFFIRM_LEVEL,
               GA_TEMPCARD_APPLICATION_AFFIRM.AFFIRMOR_ID,
               GA_TEMPCARD_APPLICATION_AFFIRM.AFFIRM_FLAG
          FROM GA_TEMPCARD_APPLICATION_AFFIRM) UP_AFFIRM,
       (SELECT GA_TEMPCARD_APPLICATION_AFFIRM.APPLY_NO,
               MAX(GA_TEMPCARD_APPLICATION_AFFIRM.AFFIRM_LEVEL) MAX_LEVEL
          FROM GA_TEMPCARD_APPLICATION_AFFIRM
         GROUP BY GA_TEMPCARD_APPLICATION_AFFIRM.APPLY_NO) MAX_AFFIRM

 WHERE GA_TEMPCARD_APPLICATION_AFFIRM.APPLY_NO = UP_AFFIRM.APPLY_NO(+)
   AND GA_TEMPCARD_APPLICATION_AFFIRM.UP_LEVEL = UP_AFFIRM.AFFIRM_LEVEL(+)
   AND GA_TEMPCARD_APPLICATION_AFFIRM.APPLY_NO = MAX_AFFIRM.APPLY_NO(+)
   and GA_TEMPCARD_APPLICATION_AFFIRM.AFFIRMOR_ID = #adminId:VARCHAR#
 ) AFFIRM
          where t.cpny_id=#cpnyId:VARCHAR#
                and NVL(AFFIRM.UP_AFFIRM_FLAG,1)=1
                 and t.user_name=hr.person_id(+)
                AND T.APPLY_NO=AFFIRM.APPLY_NO
                and t.applyer=apply.person_id(+)

   ]]>
 <isNotEqual prepend="" property="qryType" compareValue="3">
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				 AFFIRM.AFFIRM_FLAG=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 AFFIRM.AFFIRM_FLAG =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 AFFIRM.AFFIRM_FLAG =2
	]]>
	</isEqual>
 </isNotEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (hr.Chinesename LIKE  '%'||#key:VARCHAR# || '%' or hr.empid  LIKE  '%'||#key:VARCHAR# || '%' or t.useror  LIKE  '%'||#key:VARCHAR# || '%'  )
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.applyer_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 to_date(to_char(t.apply_date,'yyyy-mm-dd'),'yyyy-mm-dd') >=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		to_date(to_char(t.apply_date,'yyyy-mm-dd'),'yyyy-mm-dd') <=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
</select>
<select id="eatingCardAffirmInfoList" parameterClass="SimpleMap" resultClass="SimpleMap">
  <![CDATA[	
		select t.apply_no,
		       decode(t.employee_type, 'external', '外来人员', 'Local', '本社员工') employee_type,
		       diff.code_name eatery_diff,
		       decode(t.employee_type,
		              'external',
		              t.useror,
		              'Local',
		              hr.chinesename) useror,
		       t.user_num,
		       apply.chinesename applyer,
		       t.APPLYER APPLYERID,
		       t.eatery_type,
		       de.deptname applyer_dept,
		       to_char(t.APPLY_DATE, 'YYYY-MM-DD') start_date,
		       to_char(t.end_date, 'YYYY-MM-DD') end_date,
		       t.postion,
		       t.companyname,
		       t.rmark,
		       t.cpny_id,
		       t.active,
		       t.isconfirm,
		       confirm.chinesename  confirmor,
		       t.confirmor_idea,
		       AFFIRM.AFFIRM_FLAG firstAffirmFlag,
		       T.TJSX
		      
		  from ga_card_application t,
		       sy_code diff,
		       hr_employee hr,
		       hr_employee apply,
		       hr_employee confirm,
		       hr_department de,
		       (SELECT apply_no,
		       affirm_flag,
		       affirm_level
		  FROM ga_card_application_affirm
		 WHERE affirm_level=1) AFFIRM
		 where t.eatery_diff = diff.code_id(+)
		   and t.useror = hr.person_id(+)
		   and t.confirmor=confirm.person_id(+)
		   and t.applyer = apply.person_id(+)
		   and t.applyer_dept = de.deptid(+)
		   and t.cpny_id = #cpnyId:VARCHAR#
		   AND T.APPLY_NO = AFFIRM.APPLY_NO			

                          ]]>
                          
  <isNotEmpty prepend="AND" property="ADMIN_ID">
		<![CDATA[
			EXISTS ( SELECT SAD.ADMIN_DEPTID
				   FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
				  WHERE SAD.ADMIN_NO = SA.ADMINNO
				    AND SA.ADMINID = #ADMIN_ID:VARCHAR2#
				    AND SAD.ADMIN_DEPTID = t.APPLYER_DEPT	
			   ) 
		]]>
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="adminId">
			<![CDATA[		
			   t.APPLYER = #adminId:VARCHAR#
		]]>
		</isNotEmpty>
		
		
  <isNotEqual prepend="" property="qryType" compareValue="3">
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未通过的 -->
		<![CDATA[
				 t.active<2 	and t.isconfirm=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 t.active=1 	and t.isconfirm=1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				  (t.active=2 	or  t.isconfirm=2)
	]]>
	</isEqual>
 </isNotEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (hr.Chinesename LIKE  '%'||#key:VARCHAR# || '%' or hr.empid  LIKE  '%'||#key:VARCHAR# || '%' or t.useror  LIKE  '%'||#key:VARCHAR# || '%'  )
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.applyer_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 t.start_date >=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		t.end_date <=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<![CDATA[	
	 order by t.apply_date desc
	]]>	
</select>
<select id="tempCardAffirmInfoList" parameterClass="SimpleMap" resultClass="SimpleMap">
  <![CDATA[	
	select t.apply_no,
           decode(t.employee_type, 'external', '外来人员', 'Local', '本社员工') employee_type,
           de.deptname applyer_dept,
           apply.chinesename applyer,
		   t.APPLYER APPLYERID,
           to_char(t.start_date, 'YYYY-MM-DD') start_date,
           to_char(t.end_date, 'YYYY-MM-DD') end_date,
           t.user_name,
           t.user_business,
           t.PERMISSIONS_TYPE,
           t.APPLY_DATE,
           t.CARD_NUMBER,
           t.return_yn,
           t.return_date,
           t.cpny_id,
           t.active,
           t.isconfirm,
           confirm.chinesename  confirmor,
           t.confirmor_idea,
           AFFIRM.AFFIRM_FLAG firstAffirmFlag
          
      from GA_TEMPCARD_APPLICATION t,
           hr_employee hr,
           hr_employee apply,
           hr_employee confirm,
           hr_department de,
           (SELECT apply_no,
           affirm_flag,
           affirm_level
      FROM GA_TEMPCARD_APPLICATION_AFFIRM
     WHERE affirm_level=1) AFFIRM
     where t.confirmor=confirm.person_id(+)
	   and t.user_name = hr.person_id(+)
       and t.applyer = apply.person_id(+)
       and t.applyer_dept = de.deptid(+)
       and t.cpny_id = #cpnyId:VARCHAR#
       AND T.APPLY_NO = AFFIRM.APPLY_NO 		

                          ]]>
                          
  <isNotEmpty prepend="AND" property="ADMIN_ID">
		<![CDATA[
			EXISTS ( SELECT SAD.ADMIN_DEPTID
				   FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
				  WHERE SAD.ADMIN_NO = SA.ADMINNO
				    AND SA.ADMINID = #ADMIN_ID:VARCHAR2#
				    AND SAD.ADMIN_DEPTID = t.APPLYER_DEPT	
			   ) 
		]]>
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="adminId">
			<![CDATA[		
			   t.APPLYER = #adminId:VARCHAR#
		]]>
		</isNotEmpty>
		
		
  <isNotEqual prepend="" property="qryType" compareValue="3">
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未通过的 -->
		<![CDATA[
				 t.active<2 	and t.isconfirm=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 t.active=1 	and t.isconfirm=1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				  (t.active=2 	or  t.isconfirm=2)
	]]>
	</isEqual>
 </isNotEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (hr.Chinesename LIKE  '%'||#key:VARCHAR# || '%' or hr.empid  LIKE  '%'||#key:VARCHAR# || '%' or t.useror  LIKE  '%'||#key:VARCHAR# || '%'  )
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.applyer_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 t.start_date >=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		t.end_date <=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<![CDATA[	
	 order by t.apply_date desc
	]]>	
</select>
<select id="eatingCardAffirmInfoListNumber" parameterClass="SimpleMap" resultClass="int">
    <![CDATA[	
		select count(*)
			  from ga_card_application t,       
			       hr_employee hr,
			       hr_employee apply
			      
			      
			 where t.useror = hr.person_id(+)
			   and t.applyer = apply.person_id(+)
			   and t.cpny_id =#cpnyId:VARCHAR#
                          ]]>
  <isNotEmpty prepend="AND" property="ADMIN_ID">
		<![CDATA[
			EXISTS ( SELECT SAD.ADMIN_DEPTID
				   FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
				  WHERE SAD.ADMIN_NO = SA.ADMINNO
				    AND SA.ADMINID = #ADMIN_ID:VARCHAR2#
				    AND SAD.ADMIN_DEPTID = t.APPLYER_DEPT	
			   ) 
		]]>
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="adminId">
			<![CDATA[		
			   t.APPLYER = #adminId:VARCHAR#
		]]>
		</isNotEmpty>
		
  <isNotEqual prepend="" property="qryType" compareValue="3">
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未通过的 -->
		<![CDATA[
				 t.active<2 	and t.isconfirm=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 t.active=1 	and t.isconfirm=1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				  (t.active=2 	or  t.isconfirm=2)
	]]>
	</isEqual>
 </isNotEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (hr.Chinesename LIKE  '%'||#key:VARCHAR# || '%' or hr.empid  LIKE  '%'||#key:VARCHAR# || '%' or t.useror  LIKE  '%'||#key:VARCHAR# || '%'  )
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.applyer_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>		
	<isNotEmpty prepend="AND" property="cpnyId">
		<![CDATA[		   
		 t.CPNY_ID=#cpnyId:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 t.start_date >=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		t.end_date <=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
</select>
<select id="tempCardAffirmInfoListNumber" parameterClass="SimpleMap" resultClass="int">
    <![CDATA[	
		select count(*)
        from GA_TEMPCARD_APPLICATION t,       
             hr_employee hr,
             hr_employee apply
       where t.USER_NAME = hr.person_id(+)
         and t.applyer = apply.person_id(+)
			   and t.cpny_id =#cpnyId:VARCHAR#
                          ]]>
  <isNotEmpty prepend="AND" property="ADMIN_ID">
		<![CDATA[
			EXISTS ( SELECT SAD.ADMIN_DEPTID
				   FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
				  WHERE SAD.ADMIN_NO = SA.ADMINNO
				    AND SA.ADMINID = #ADMIN_ID:VARCHAR2#
				    AND SAD.ADMIN_DEPTID = t.APPLYER_DEPT	
			   ) 
		]]>
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="adminId">
			<![CDATA[		
			   t.APPLYER = #adminId:VARCHAR#
		]]>
		</isNotEmpty>
		
  <isNotEqual prepend="" property="qryType" compareValue="3">
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未通过的 -->
		<![CDATA[
				 t.active<2 	and t.isconfirm=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 t.active=1 	and t.isconfirm=1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				  (t.active=2 	or  t.isconfirm=2)
	]]>
	</isEqual>
 </isNotEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (hr.Chinesename LIKE  '%'||#key:VARCHAR# || '%' or hr.empid  LIKE  '%'||#key:VARCHAR# || '%' or t.useror  LIKE  '%'||#key:VARCHAR# || '%'  )
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.applyer_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 t.start_date >=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		t.end_date <=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
</select>
<select id="getEateryConfirmList" parameterClass="SimpleMap" resultClass="SimpleMap">
  <![CDATA[	
		select t.apply_no,
		       decode(t.employee_type, 'external', '外来人员', 'Local', '本社员工') employee_type,
		       diff.code_name eatery_diff,
		       decode(t.employee_type,
		              'external',
		              t.useror,
		              'Local',
		              hr.chinesename) useror,
		       t.user_num,
		       apply.chinesename applyer,
		       t.eatery_type,
		       de.deptname applyer_dept,
		       to_char(t.APPLY_DATE, 'YYYY-MM-DD') start_date,
		       to_char(t.end_date, 'YYYY-MM-DD') end_date,
		       t.postion,
		       t.companyname,
		       t.rmark,
		       t.cpny_id,
		       t.active,	
		       t.isconfirm,
		       NVL(t.confirmor_idea,'') confirmor_idea ,
		       T.TJSX    
		  from ga_card_application t,
		       sy_code diff,
		       hr_employee hr,
		       hr_employee apply,
		       hr_department de		       
		 where t.eatery_diff = diff.code_id(+)
		   and t.useror = hr.person_id(+)
		   and t.applyer = apply.person_id(+)
		   and t.applyer_dept = de.deptid(+)	
		   and t.active=1	   
		   and EXISTS (SELECT SAD.ADMIN_DEPTID
				          FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
				         WHERE SAD.ADMIN_NO = SA.ADMINNO
				           AND SA.ADMINID = #adminId:VARCHAR#
				           AND SAD.ADMIN_DEPTID = t.applyer_dept)		

                          ]]>
  <isNotEqual prepend="" property="qryType" compareValue="3">
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				 T.isconfirm=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 T.isconfirm =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 T.isconfirm =2
	]]>
	</isEqual>
 </isNotEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (hr.Chinesename LIKE  '%'||#key:VARCHAR# || '%' or hr.empid  LIKE  '%'||#key:VARCHAR# || '%' or t.useror  LIKE  '%'||#key:VARCHAR# || '%' )
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="serialNumber">
		<![CDATA[		   
		 t.apply_no in (select provide.apply_no from ga_card_provide provide where provide.serial_number like '%'||#serialNumber:VARCHAR#||'%')
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="cardNumber">
		<![CDATA[		   
		 t.apply_no in (select provide.apply_no from ga_card_provide provide where provide.card_number like '%'||#cardNumber:VARCHAR#||'%')
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="provideFlag">
		<![CDATA[		   
		 t.apply_no in (select provide.apply_no from ga_card_provide provide where provide.flag=#provideFlag:NUMERIC#)
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.applyer_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="cpnyId">
		<![CDATA[		   
		 t.CPNY_ID=#cpnyId:VARCHAR#
		]]>	
	</isNotEmpty>		
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 t.apply_date >=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		t.apply_date <=to_date(#endDate:VARCHAR#,'yyyy-mm-dd')+1 
		]]>	
	</isNotEmpty>
	<![CDATA[	
	 order by t.apply_date desc
	]]>	
</select>

<select id="getTempCardConfirmList" parameterClass="SimpleMap" resultClass="SimpleMap">
  <![CDATA[	
		select t.apply_no,
		       decode(t.employee_type, 'external', '外来人员', 'Local', '本社员工') employee_type,
		       de.deptname applyer_dept,
		       apply.chinesename applyer,
		       t.user_name,
           t.user_business,
		       to_char(t.start_date, 'YYYY-MM-DD') start_date,
           to_char(t.end_date, 'YYYY-MM-DD') end_date,
           t.permissions_type,
           t.apply_date,
           t.cpny_id,
           t.active,  
           t.isconfirm,
           NVL(t.confirmor_idea,'') confirmor_idea,
           t.Card_Number,
           t.return_yn,
           t.return_date,
           t.Card_Person
      from GA_TEMPCARD_APPLICATION t,
           hr_employee hr,
           hr_employee apply,
           hr_department de           
     where t.user_name = hr.person_id(+)
       and t.applyer = apply.person_id(+)
       and t.applyer_dept = de.deptid(+)  
       and t.active=1 
       and t.cpny_id = #cpnyId:VARCHAR#    
       and EXISTS (SELECT SAD.ADMIN_DEPTID
                  FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
                 WHERE SAD.ADMIN_NO = SA.ADMINNO
                   AND SA.ADMINID = #adminId:VARCHAR#
                   AND SAD.ADMIN_DEPTID = t.applyer_dept)  	

                          ]]>
  <isNotEqual prepend="" property="qryType" compareValue="3">
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				 T.isconfirm=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 T.isconfirm =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 T.isconfirm =2
	]]>
	</isEqual>
 </isNotEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (hr.Chinesename LIKE  '%'||#key:VARCHAR# || '%' or hr.empid  LIKE  '%'||#key:VARCHAR# || '%' )
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.applyer_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 t.apply_date >=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		t.apply_date <=to_date(#endDate:VARCHAR#,'yyyy-mm-dd')+1 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="provideFlag">
		<![CDATA[		   
		t.employee_type=#provideFlag:VARCHAR#
		]]>	
	</isNotEmpty>
	<![CDATA[	
	 order by t.apply_date desc
	]]>	
</select>
<select id="getEateryConfirmListNumber" parameterClass="SimpleMap" resultClass="int">
    <![CDATA[	
		select count(*) from ga_card_application t, hr_employee hr, hr_employee apply
				 where t.useror = hr.person_id(+)
				   and t.applyer = apply.person_id(+)
				   and t.active=1
				   and EXISTS (SELECT SAD.ADMIN_DEPTID
				          FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
				         WHERE SAD.ADMIN_NO = SA.ADMINNO
				           AND SA.ADMINID = #adminId:VARCHAR#
				           AND SAD.ADMIN_DEPTID = t.applyer_dept)
                          ]]>
  <isNotEqual prepend="" property="qryType" compareValue="3">
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				 T.isconfirm=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 T.isconfirm =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 T.isconfirm =2
	]]>
	</isEqual>
 </isNotEqual>
    <isNotEmpty prepend="AND" property="serialNumber">
		<![CDATA[		   
		 t.apply_no in (select provide.apply_no from ga_card_provide provide where provide.serial_number like '%'||#serialNumber:VARCHAR#||'%')
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="cardNumber">
		<![CDATA[		   
		 t.apply_no in (select provide.apply_no from ga_card_provide provide where provide.card_number like '%'||#cardNumber:VARCHAR#||'%')
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="provideFlag">
		<![CDATA[		   
		 t.apply_no in (select provide.apply_no from ga_card_provide provide where provide.flag=#provideFlag:NUMERIC#)
		]]>	
	</isNotEmpty>
	
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[	 
		 (hr.Chinesename LIKE  '%'||#key:VARCHAR# || '%' or hr.empid  LIKE  '%'||#key:VARCHAR# || '%' or t.useror  LIKE  '%'||#key:VARCHAR# || '%' )
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.applyer_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>		
	<isNotEmpty prepend="AND" property="cpnyId">
		<![CDATA[		   
		 t.CPNY_ID=#cpnyId:VARCHAR#
		]]>	
	</isNotEmpty>		
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 t.apply_date >=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		t.apply_date <=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
</select>
<select id="getTempCardConfirmListNumber" parameterClass="SimpleMap" resultClass="int">
    <![CDATA[	
		select count(*) from GA_TEMPCARD_APPLICATION t, hr_employee hr, hr_employee apply
         where t.user_name = hr.person_id(+)
           and t.applyer = apply.person_id(+)
            and t.cpny_id = #cpnyId:VARCHAR#  
           and t.active=1
           and EXISTS (SELECT SAD.ADMIN_DEPTID
                  FROM SY_ADMIN_DEPTID SAD, SY_ADMIN SA
                 WHERE SAD.ADMIN_NO = SA.ADMINNO
                   AND SA.ADMINID = #adminId:VARCHAR#
                   AND SAD.ADMIN_DEPTID = t.applyer_dept)
                          ]]>
  <isNotEqual prepend="" property="qryType" compareValue="3">
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				 T.isconfirm=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 T.isconfirm =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 T.isconfirm =2
	]]>
	</isEqual>
 </isNotEqual>
	
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[	 
		 (hr.Chinesename LIKE  '%'||#key:VARCHAR# || '%' or hr.empid  LIKE  '%'||#key:VARCHAR# || '%' )
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.applyer_dept=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 t.apply_date >=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		t.apply_date <=to_date(#endDate:VARCHAR#,'yyyy-mm-dd')+1  
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="provideFlag">
		<![CDATA[		   
		t.employee_type=#provideFlag:VARCHAR# 
		]]>	
	</isNotEmpty>
</select>
<select id="eatingCardAffirmorList" parameterClass="SimpleMap" resultClass="SimpleMap">
  <![CDATA[	
    select t.ga_affirm_no,
	       t.affirm_flag,
	       t.affirm_level,
	       t.affirmor_id,
	       hr.chinesename affirmor_name,
	       t.apply_no,
	       hr.email,
	       t.affirmor_idea	      
	  from ga_card_application_affirm t,
	       hr_employee hr	      
	 where t.affirmor_id = hr.person_id
	   and t.apply_no = #applyNo:VARCHAR#
	 order by t.affirm_level
    ]]>
</select>
<select id="tempCardAffirmorList" parameterClass="SimpleMap" resultClass="SimpleMap">
  <![CDATA[	
    select t.ga_affirm_no,
	       t.affirm_flag,
	       t.affirm_level,
	       t.affirmor_id,
	       hr.chinesename affirmor_name,
	       t.apply_no,
	       hr.email,
	       t.affirmor_idea,
	       TO_CHAR(T.UPDATE_DATE,'YYYY-MM-DD HH24:MI') UPDATE_DATE
	  from GA_TEMPCARD_APPLICATION_AFFIRM t,
	       hr_employee hr	      
	 where t.affirmor_id = hr.person_id
	   and t.apply_no = #applyNo:VARCHAR#
	 order by t.affirm_level
    ]]>
</select>
<select id="gmid" parameterClass="SimpleMap" resultClass="SimpleMap">
  <![CDATA[	
    select t.gm_id, t.gm_type from gm_eatery t
     where t.cpny_id=#cpnyId:VARCHAR#
    
    ]]>
</select>

<select id="tempcardgmid" parameterClass="SimpleMap" resultClass="SimpleMap">
  <![CDATA[	
    select t.gm_id, t.gm_type from gm_temporarycard_authority t
     where t.cpny_id =#cpnyId:VARCHAR# and t.activity = '1'
    
    ]]>
</select>

<select id="getvoitureInt" parameterClass="SimpleMap" resultClass="int">
    <![CDATA[	
			select count(*)
							  from GA_VOITURE_APPLY t,
							  hr_employee e,
			               (SELECT 
			 GA_VOITURE_AFFIRM.*,
			 UP_AFFIRM.AFFIRMOR_ID UP_AFFIRMOR_ID,
			 NVL(UP_AFFIRM.AFFIRM_FLAG,1) UP_AFFIRM_FLAG,
			 CASE 
			 WHEN GA_VOITURE_AFFIRM.AFFIRM_LEVEL=MAX_AFFIRM.MAX_LEVEL
			 THEN 1
			 ELSE 0
			 END AS MAX_LEVEL_FLAG
			 FROM 
			 (SELECT GA_VOITURE_AFFIRM.*,
			       GA_VOITURE_AFFIRM.AFFIRM_LEVEL - 1 UP_LEVEL,
			       GA_VOITURE_AFFIRM.AFFIRM_LEVEL + 1 NEXT_LEVEL
			  FROM GA_VOITURE_AFFIRM) GA_VOITURE_AFFIRM,
			  (SELECT  GA_VOITURE_AFFIRM.APPLY_NO,GA_VOITURE_AFFIRM.AFFIRM_LEVEL,GA_VOITURE_AFFIRM.AFFIRMOR_ID,GA_VOITURE_AFFIRM.AFFIRM_FLAG
			  FROM GA_VOITURE_AFFIRM 
			  ) UP_AFFIRM,
			  (SELECT  GA_VOITURE_AFFIRM.APPLY_NO,MAX(GA_VOITURE_AFFIRM.AFFIRM_LEVEL) MAX_LEVEL
			  FROM GA_VOITURE_AFFIRM 
			   GROUP BY GA_VOITURE_AFFIRM.APPLY_NO ) MAX_AFFIRM
			   WHERE GA_VOITURE_AFFIRM.APPLY_NO=UP_AFFIRM.APPLY_NO(+)
			    AND GA_VOITURE_AFFIRM.UP_LEVEL=UP_AFFIRM.AFFIRM_LEVEL(+)    
			    AND GA_VOITURE_AFFIRM.APPLY_NO=MAX_AFFIRM.APPLY_NO(+)
			    and GA_VOITURE_AFFIRM.affirmor_id=#supervisor:VARCHAR#) AFFIRM 
			    where t.voiture_applyid in (select a.APPLY_NO from GA_VOITURE_AFFIRM a where a.AFFIRMOR_ID=#supervisor:VARCHAR#)
               AND AFFIRM.UP_AFFIRM_FLAG=1
               and t.applyer_id=e.person_id
   ]]>
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				  AFFIRM.affirm_flag=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 AFFIRM.affirm_flag =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 AFFIRM.affirm_flag =2
	]]>
	</isEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (e.chinesename LIKE  '%'||#key:VARCHAR# || '%'  or t.APPLYER_ID LIKE  '%'||#key:VARCHAR# || '%')
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.applyer_deptname=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 APPLY_DATE<=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		 t.APPLY_ENDDATE>=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="cpnyId">
		<![CDATA[		   
		 e.cpny_id=#cpnyId:VARCHAR#
		]]>	
	</isNotEmpty>	
	<![CDATA[	
	and t.voiture_applyid = AFFIRM.APPLY_NO
     order by t.voiture_applyid desc
    ]]>
</select>
<select id="getvoitureList" parameterClass="SimpleMap" resultClass="SimpleMap">
      <![CDATA[	
			select t.VOITURE_APPLYID,
       e.Chinesename, 
       to_char(t.CREATE_DATE,'YYYY-MM-DD') as CREATE_DATE,
       t.APPLYER_ID,
       dt.DEPTNAME as APPLYER_DEPTNAME,
       to_char(t.APPLY_DATE, 'YYYY-MM-DD') as APPLY_DATE,
       t.APPLY_STARTTIME,
       to_char(t.APPLY_ENDDATE, 'YYYY-MM-DD') as APPLY_ENDDATE,
       t.APPLY_ENDTIME,
       t.APPLY_USERSCOUNT,
       t.DEPARTURES,
       t.DESTINATIONS,
       t.KILOMETER,
       t.LARDER,
       t.PURPOSE,
       t.DRIVERFLAG,
       t.ACTIVE,
       m.AFFIRMORIDEA,
        AFFIRM.AFFIRM_FLAG,
        t.MODIFY_FLAG
		  from GA_VOITURE_APPLY t,
		  ga_voiture_affirm m,
		  hr_employee e,
		  hr_department dt,
             (SELECT 
			 GA_VOITURE_AFFIRM.*,
			 UP_AFFIRM.AFFIRMOR_ID UP_AFFIRMOR_ID,
			 NVL(UP_AFFIRM.AFFIRM_FLAG,1) UP_AFFIRM_FLAG,
			 CASE 
			 WHEN GA_VOITURE_AFFIRM.AFFIRM_LEVEL=MAX_AFFIRM.MAX_LEVEL
			 THEN 1
			 ELSE 0
			 END AS MAX_LEVEL_FLAG
			 FROM 
			 (SELECT GA_VOITURE_AFFIRM.*,
			       GA_VOITURE_AFFIRM.AFFIRM_LEVEL - 1 UP_LEVEL,
			       GA_VOITURE_AFFIRM.AFFIRM_LEVEL + 1 NEXT_LEVEL
			  FROM GA_VOITURE_AFFIRM) GA_VOITURE_AFFIRM,
			  (SELECT  GA_VOITURE_AFFIRM.APPLY_NO,GA_VOITURE_AFFIRM.AFFIRM_LEVEL,GA_VOITURE_AFFIRM.AFFIRMOR_ID,GA_VOITURE_AFFIRM.AFFIRM_FLAG
			  FROM GA_VOITURE_AFFIRM 
			  ) UP_AFFIRM,
			  (SELECT  GA_VOITURE_AFFIRM.APPLY_NO,MAX(GA_VOITURE_AFFIRM.AFFIRM_LEVEL) MAX_LEVEL
			  FROM GA_VOITURE_AFFIRM 
			   GROUP BY GA_VOITURE_AFFIRM.APPLY_NO ) MAX_AFFIRM
			   WHERE GA_VOITURE_AFFIRM.APPLY_NO=UP_AFFIRM.APPLY_NO(+)
			    AND GA_VOITURE_AFFIRM.UP_LEVEL=UP_AFFIRM.AFFIRM_LEVEL(+)    
			    AND GA_VOITURE_AFFIRM.APPLY_NO=MAX_AFFIRM.APPLY_NO(+)
			    and GA_VOITURE_AFFIRM.affirmor_id=#supervisor:VARCHAR#) AFFIRM 
			    where t.voiture_applyid in (select a.APPLY_NO from GA_VOITURE_AFFIRM a where a.AFFIRMOR_ID=#supervisor:VARCHAR#)
               AND AFFIRM.UP_AFFIRM_FLAG=1
               and t.applyer_id=e.person_id
   ]]>
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				  AFFIRM.affirm_flag=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 AFFIRM.affirm_flag =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 AFFIRM.affirm_flag =2
	]]>
	</isEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (e.chinesename LIKE  '%'||#key:VARCHAR# || '%'  or t.APPLYER_ID LIKE  '%'||#key:VARCHAR# || '%')
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="deptid">
		<![CDATA[		   
		 t.APPLYER_DEPTNAME=#deptid:VARCHAR#
		]]>	
	</isNotEmpty>	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 APPLY_DATE<=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		 t.APPLY_ENDDATE>=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="cpnyId">
		<![CDATA[		   
		 e.cpny_id=#cpnyId:VARCHAR#
		]]>	
	</isNotEmpty>	
	<![CDATA[	
	and dt.DEPTID=t.applyer_deptname
	and t.voiture_applyid = AFFIRM.APPLY_NO
	and  m.apply_no = t.voiture_applyid
    and m.affirmor_id = #supervisor:VARCHAR#
     order by t.voiture_applyid desc
    ]]>
</select>

<select id="getVoitureDistinctionList" parameterClass="SimpleMap" resultClass="SimpleMap">
      <![CDATA[	
			select t.distinction_id,
       t.distinction,
       to_char(t.apply_date,'YYYY-MM-DD') as apply_date,
       t.apply_starttime,
       t.content,
       t.drive_way,
       t.apply_no,
       t.note,
       t.create_date
  from ga_voiture_apply_distinction t 
  where t.APPLY_NO = #APPLY_NO:VARCHAR#
 order by t.distinction
   ]]>
   
</select>

<select id="getVoitureAffiirmList"  parameterClass="SimpleMap" resultClass="SimpleMap">
<![CDATA[
	select t.ID,
       t.affirm_flag,
       t.apply_no,
       t.affirm_level,
       t.affirmor_id,
       hr.chinesename,
       CASE WHEN 
       T.AFFIRM_LEVEL=MAX_AFFIRM_TABLE.MAX_AFFIRM_LEVEL
       THEN 1
       ELSE 0
       END MAX_AFFIRM_FLAG
  from GA_VOITURE_AFFIRM t,
       hr_employee hr,
       (select  max(affirm.affirm_level) MAX_AFFIRM_LEVEL
          from ga_voiture_affirm affirm
         WHERE affirm.APPLY_NO=#APPLY_NO:VARCHAR#
        ) MAX_AFFIRM_TABLE
 where t.affirmor_id = hr.person_id
   and t.APPLY_NO = #APPLY_NO:VARCHAR#
 order by t.affirm_level

	]]>
</select>
<insert id="addCardApplication"  parameterClass="SimpleMap">
		 insert into GA_CARD_APPLICATION( 
		  APPLY_NO,
		  EMPLOYEE_TYPE,
		  EATERY_DIFF,
		  EATERY_TYPE,
		  USEROR,
		  USER_NUM,
		  APPLYER,
		  APPLYER_DEPT,
		  APPLY_DATE,
		  START_DATE,
		  END_DATE,
		  POSTION,
		  COMPANYNAME,
		  RMARK,
		  CPNY_ID,
		  ACTIVE,
		  TJSX
		  )values
		  (
		  #applyNo:NUMERIC#,
		  #EmployeeType:VARCHAR#,
		  #foodType:VARCHAR#,
		  #eatType:VARCHAR#,
		  #used:VARCHAR#,
		  #peoples:NUMERIC#,
		  #adminId:VARCHAR#,
		  #deptid:VARCHAR#,
		  SYSDATE,
		  TO_DATE(#starttime:VARCHAR#,'YYYY-MM-DD'),
		  TO_DATE(#endtime:VARCHAR#,'YYYY-MM-DD'),
		  #jobtitle:VARCHAR#,
		  #company:VARCHAR#,
		  #Remarks:VARCHAR#,
		  #cpnyId:VARCHAR#,
		  '0'	,
		  #TJSX:varchar#	  
		  )
</insert>
<insert id="addTempCardApplication"  parameterClass="SimpleMap">
	insert into GA_TEMPCARD_APPLICATION( 
      APPLY_NO,
      EMPLOYEE_TYPE,
      APPLYER,
      APPLYER_DEPT,
      APPLY_DATE,
      START_DATE,
      END_DATE,
      USER_NAME,
      USER_BUSINESS,
      PERMISSIONS_TYPE,
      CPNY_ID,
      ACTIVE
      )values
      (
      #applyNo:NUMERIC#,
      #EmployeeType:VARCHAR#,
      #adminId:VARCHAR#,
      #deptid:VARCHAR#,
      SYSDATE,
      TO_DATE(#starttime:VARCHAR#,'YYYY-MM-DD'),
      TO_DATE(#endtime:VARCHAR#,'YYYY-MM-DD'),
      #username:VARCHAR#,
      #userbusiness:VARCHAR#,
      #permissionsType:VARCHAR#,
      #cpnyId:VARCHAR#,
      '0'    
      )
</insert>
 <insert id="addAffirmListForCardApply"  parameterClass="SimpleMap">
		 insert into GA_CARD_APPLICATION_AFFIRM( 
		  GA_AFFIRM_NO,
		  APPLY_NO,
		  AFFIRM_FLAG,
		  AFFIRM_LEVEL,
		  AFFIRMOR_ID,
		  CREATE_DATE,
		  CREATED_BY,  
		  ACTIVITY,
		  APPLY_TYPE
		  )values
		  (
		  ga_card_application_affirm_seq.nextval,
		  #applyNo:NUMERIC#,
		  0,
		  #affirmorLevel:NUMERIC#,
		  #affirmorId:VARCHAR#,
		  SYSDATE,
		  #adminId:VARCHAR#,
		  1,
		  'CARD_APPLICATION'
		  
		  )

</insert>
 <insert id="addAffirmListForTempCardApply"  parameterClass="SimpleMap">
    insert into GA_TEMPCARD_APPLICATION_AFFIRM( 
      GA_AFFIRM_NO,
      APPLY_NO,
      AFFIRM_FLAG,
      AFFIRM_LEVEL,
      AFFIRMOR_ID,
      CREATE_DATE,
      CREATED_BY,  
      ACTIVITY,
      APPLY_TYPE
      )values
      (
      GA_TCAR_APPLICATION_AFFIRM_SEQ.nextval,
      #applyNo:NUMERIC#,
      0,
      #affirmorLevel:NUMERIC#,
      #affirmorId:VARCHAR#,
      SYSDATE,
      #adminId:VARCHAR#,
      1,
      'temporarycardApply'
      )

</insert>
	<select id="getEateryTypeName"  parameterClass="SimpleMap" resultClass="SimpleMap">
	 select t.gm_id,t.gm_type from gm_eatery t
	       where t.gm_id in ($eateryType$)
	       and t.cpny_id=#cpnyId:VARCHAR#
	
	</select>
	<select id="getTempCardTypeName"  parameterClass="SimpleMap" resultClass="SimpleMap">
	 select t.gm_id,t.gm_type from GM_TEMPORARYCARD_AUTHORITY t
	       where t.gm_id in ($PERMISSIONS_TYPE$)
	       and t.cpny_id=#cpnyId:VARCHAR#
	
	</select>
	<update id="oingAffirm" parameterClass="SimpleMap">
	
	  update ga_card_application_affirm t
			set t.affirm_flag=#affirmFlag:NUMERIC#,
			t.update_date=SYSDATE,
			t.updated_by=#adminId:VARCHAR#,
			t.affirmor_idea=#affirmorIdea:VARCHAR#
			where t.ga_affirm_no=#affirmNo:NUMERIC#	
	</update>
	<update id="oingTempAffirm" parameterClass="SimpleMap">
	
	  update GA_TEMPCARD_APPLICATION_AFFIRM t
			set t.affirm_flag=#affirmFlag:NUMERIC#,
			t.update_date=SYSDATE,
			t.updated_by=#adminId:VARCHAR#,
			t.affirmor_idea=#affirmorIdea:VARCHAR#
			where t.ga_affirm_no=#affirmNo:NUMERIC#	
	</update>
	<update id="oingConfirm" parameterClass="SimpleMap">
	 update ga_card_application t
        set t.isconfirm=#Flag:NUMERIC#,
        t.confirmor=#adminId:VARCHAR#,
        t.confirmdate=SYSDATE,
        t.confirmor_idea=#confirmorIdea:VARCHAR#        
	 where t.apply_no=#applyNo:NUMERIC#		 
	</update>
	
	<update id="oingTempCardConfirm" parameterClass="SimpleMap">
	  update GA_TEMPCARD_APPLICATION t
        set t.isconfirm=#Flag:VARCHAR#,
        t.confirmor=#adminId:VARCHAR#,
        t.confirmdate=SYSDATE,
        t.confirmor_idea=#confirmorIdea:VARCHAR#
	 where t.apply_no=#applyNo:NUMERIC#  	 
	</update>
	
	<update id="updateApplyInfo" parameterClass="SimpleMap">
	
	 update ga_card_application t
        set t.active=#affirmFlag:NUMERIC#
	 where t.apply_no=#applyNo:NUMERIC#	
	</update>	
	
	<update id="updateTempCardApplyInfo" parameterClass="SimpleMap">
	
	 update GA_TEMPCARD_APPLICATION t
        set t.active=#affirmFlag:NUMERIC#
	 where t.apply_no=#applyNo:NUMERIC#	
	</update>
	
	<select id="getupaffrimemail"  parameterClass="SimpleMap" resultClass="string">
	select  hr.email
		 from ga_card_application_affirm t, hr_employee hr
		 where t.apply_no =#applyNo:NUMERIC#
		 and t.affirmor_id = hr.person_id(+)
		 and t.affirm_level = (select t.affirm_level
		                       from ga_card_application_affirm t
		                       where t.ga_affirm_no = #affirmNo:NUMERIC#)+1
	
	</select>

   <select id="getuptcaraffrimemail"  parameterClass="SimpleMap" resultClass="string">
	select  hr.email
		 from GA_TEMPCARD_APPLICATION_AFFIRM t, hr_employee hr
		 where t.apply_no =#applyNo:NUMERIC#
		 and t.affirmor_id = hr.person_id(+)
		 and t.affirm_level = (select t.affirm_level
		                       from GA_TEMPCARD_APPLICATION_AFFIRM t
		                       where t.ga_affirm_no = #affirmNo:NUMERIC#)+1
	
	</select>
	
	<select id="getCardType"  parameterClass="SimpleMap" resultClass="SimpleMap">
	  select t.type_no, t.type_name from gm_eatery_cardtype t
            where t.cpny_id=#cpnyId:VARCHAR#
	
	</select>
	
	
	<insert id="cardProvideAdd" parameterClass="SimpleMap">
	 insert into GA_CARD_PROVIDE(
	      PKNO ,
		  APPLY_NO,
		  SERIAL_NUMBER ,
		  CARD_NUMBER,
		  CARD_TYPE,
		  FLAG,
		  PROVIDER,
		  PROVIDE_DATE,
		  CPNYID 
	 )values(
	 ga_card_provide_seq.nextval,
	 #applyNo:NUMERIC#,
	 #serialNumber:VARCHAR#,
	 #cardNumber:VARCHAR#,
	 #cardType:VARCHAR#,
	 0,
	 #adminId:VARCHAR#,
	 SYSDATE,
	 #cpnyId:VARCHAR#	 
	 )

	</insert>
	<update id="cardProvideUpdate" parameterClass="SimpleMap">
	 update GA_CARD_PROVIDE
       SET SERIAL_NUMBER=#serialNumber:VARCHAR#,
           CARD_NUMBER=#cardNumber:VARCHAR#,
           CARD_TYPE= #cardType:VARCHAR#,
           FLAG=#flag:NUMERIC#		 
	WHERE PKNO=#pkNo:NUMERIC#	 

	</update>
	
	<update id="tempCardSave" parameterClass="SimpleMap">
	  update GA_TEMPCARD_APPLICATION t
       SET t.card_number=#cardNumber:VARCHAR#,
           t.card_person=#adminName:VARCHAR#,
           t.return_yn= #returnYn:VARCHAR#,
           t.return_date=TO_DATE(#returnDate:VARCHAR#,'YYYY-MM-DD')		 
	WHERE t.apply_no=#applyNO:VARCHAR# 
	</update>
	
	<delete id="cardProvideDelete" parameterClass="SimpleMap">
	 delete  from  GA_CARD_PROVIDE       	 
	   WHERE PKNO=#pkNo:NUMERIC#	 

	</delete>
	
	<select id="cardProvidList"  parameterClass="SimpleMap" resultClass="SimpleMap">
			  select 
			    t.pkno,
			    t.apply_no,
		        t.serial_number,
		        t.card_number,
		        type.type_name,
		        t.card_type,
		        t.flag,
		        hr.chinesename,
		        to_char(t.provide_date,'YYYY-MM-DD HH24:MI') provide_date
				from  ga_card_provide t,hr_employee hr,gm_eatery_cardtype type
				where t.provider=hr.person_id(+)
				    and t.card_type=type.type_no
				    and t.cpnyid=#cpnyId:VARCHAR#    
				    and t.apply_no=#applyNo:NUMERIC#        
	
	</select>
	
	<select id="tempCardProvidList"  parameterClass="SimpleMap" resultClass="SimpleMap">
		 select 
			  t.apply_no,
              t.card_number,
              t.card_person,
              t.return_yn,
		      hr.chinesename,
		      to_char(t.return_date,'YYYY-MM-DD') return_date
			from  GA_TEMPCARD_APPLICATION t,hr_employee hr
			  where t.card_person=hr.person_id(+)
				    and t.cpny_id=#cpnyId:VARCHAR#    
				    and t.apply_no=#applyNo:NUMERIC#     
	
	</select>

    <select id="getdriverOtList" parameterClass="SimpleMap" resultClass="SimpleMap">
      <![CDATA[	
		select 
				T.DRIVER_OT_APPLYID,
				t.applyer_id,
				t.applyer_chinesename,
				t.driver_id,
			    t.driver_chinesename,
			    s.code_name as driver_ot_type_name,
			    s1.code_name as ot_type_name,
				to_char(t.apply_date,'YYYY-MM-DD') as apply_date,
				to_char(t.apply_startdate,'YYYY-MM-DD') as apply_startdate,
				t.apply_starttime,
				to_char(t.apply_enddate,'YYYY-MM-DD') as apply_enddate,
				t.apply_endtime,
				t.reason,
				t.OT_LENGTH,
				t.remark,
				t.active,
				to_char(t.create_date,'YYYY-MM-DD') as create_date,
				m.AFFIRMORIDEA,
				AFFIRM.AFFIRM_FLAG
		  from GA_DRIVER_OT_APPLY t,
		       GA_DRIVER_OT_AFFIRM m,
		       hr_employee e,
		       sy_code s,
		       sy_code s1,
		       (SELECT GA_DRIVER_OT_AFFIRM.*,
		               UP_AFFIRM.AFFIRMOR_ID UP_AFFIRMOR_ID,
		               NVL(UP_AFFIRM.AFFIRM_FLAG, 1) UP_AFFIRM_FLAG,
		               CASE
		                 WHEN GA_DRIVER_OT_AFFIRM.AFFIRM_LEVEL = MAX_AFFIRM.MAX_LEVEL THEN
		                  1
		                 ELSE
		                  0
		               END AS MAX_LEVEL_FLAG
		          FROM (SELECT GA_DRIVER_OT_AFFIRM.*,
		                       GA_DRIVER_OT_AFFIRM.AFFIRM_LEVEL - 1 UP_LEVEL,
		                       GA_DRIVER_OT_AFFIRM.AFFIRM_LEVEL + 1 NEXT_LEVEL
		                  FROM GA_DRIVER_OT_AFFIRM) GA_DRIVER_OT_AFFIRM,
		               (SELECT GA_DRIVER_OT_AFFIRM.APPLY_NO,
		                       GA_DRIVER_OT_AFFIRM.AFFIRM_LEVEL,
		                       GA_DRIVER_OT_AFFIRM.AFFIRMOR_ID,
		                       GA_DRIVER_OT_AFFIRM.AFFIRM_FLAG
		                  FROM GA_DRIVER_OT_AFFIRM) UP_AFFIRM,
		               (SELECT GA_DRIVER_OT_AFFIRM.APPLY_NO,
		                       MAX(GA_DRIVER_OT_AFFIRM.AFFIRM_LEVEL) MAX_LEVEL
		                  FROM GA_DRIVER_OT_AFFIRM
		                 GROUP BY GA_DRIVER_OT_AFFIRM.APPLY_NO) MAX_AFFIRM
		         WHERE GA_DRIVER_OT_AFFIRM.APPLY_NO = UP_AFFIRM.APPLY_NO(+)
		           AND GA_DRIVER_OT_AFFIRM.UP_LEVEL = UP_AFFIRM.AFFIRM_LEVEL(+)
		           AND GA_DRIVER_OT_AFFIRM.APPLY_NO = MAX_AFFIRM.APPLY_NO(+)
		           and GA_DRIVER_OT_AFFIRM.affirmor_id = #supervisor:VARCHAR#) AFFIRM
		 where t.DRIVER_OT_APPLYID in
		       (select a.APPLY_NO from GA_DRIVER_OT_AFFIRM a where a.AFFIRMOR_ID = #supervisor:VARCHAR#)
		   AND AFFIRM.UP_AFFIRM_FLAG = 1
		   and t.applyer_id = e.person_id
		   and t.DRIVER_OT_TYPE = s.code_id(+)
		   and t.OTTYPE = s1.code_id(+)
   ]]>
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				  AFFIRM.affirm_flag=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 AFFIRM.affirm_flag =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 AFFIRM.affirm_flag =2
	]]>
	</isEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (t.driver_chinesename LIKE  '%'||#key:VARCHAR# || '%'  or t.applyer_chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>	
	</isNotEmpty>	
	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 t.APPLY_STARTDATE>=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		 t.APPLY_ENDDATE<=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<![CDATA[	
    
	   and t.DRIVER_OT_APPLYID = AFFIRM.APPLY_NO
	   and m.apply_no = t.DRIVER_OT_APPLYID
	   and m.affirmor_id = #supervisor:VARCHAR#
	 order by t.DRIVER_OT_APPLYID desc
     
    ]]>
</select>

<select id="getdriverOtListAll" parameterClass="SimpleMap" resultClass="SimpleMap">
      <![CDATA[	
	select 
				T.DRIVER_OT_APPLYID,
				t.applyer_id,
				t.applyer_chinesename,
				t.driver_id,
			    t.driver_chinesename,
			    s.code_name as driver_ot_type_name,
			    s1.code_name as ot_type_name,
				to_char(t.apply_date,'YYYY-MM-DD') as apply_date,
				to_char(t.apply_startdate,'YYYY-MM-DD') as apply_startdate,
				t.apply_starttime,
				to_char(t.apply_enddate,'YYYY-MM-DD') as apply_enddate,
				t.apply_endtime,
				t.reason,
				t.remark,
				t.active,
				t.ot_length,
				to_char(t.CREATE_DATE,'YYYY-MM-DD HH24:MI:SS') as CREATE_DATE
				 from GA_DRIVER_OT_APPLY t,
				  sy_code s,
				  sy_code s1,
				  hr_employee he
				 where  t.DRIVER_OT_APPLYID in
				       (select distinct a.apply_no
				          from GA_DRIVER_OT_AFFIRM a
				         where a.active = 1)
				        and t.DRIVER_OT_TYPE = s.code_id(+)
				        and t.OTTYPE = s1.code_id(+)
        ]]>

		
		<isNotEmpty prepend="AND" property="ADMIN_ID">
			<![CDATA[		
			   t.APPLYER_ID = #ADMIN_ID:varchar#
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="driverOtType">
			<![CDATA[		
			   t.DRIVER_OT_TYPE = #driverOtType:varchar#
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="OTTypeCode">
			<![CDATA[		
			   t.OTTYPE = #OTTypeCode:varchar#
		]]>
		</isNotEmpty>

		<isEqual prepend="AND" property="qryType" compareValue="0">
			<![CDATA[
						 t.active = 0
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="1">
			<!-- 决裁通过的 -->
			<![CDATA[
						  t.active = 1
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="2">
			<!-- 决裁否决的 -->
			<![CDATA[
						 t.active = 2
			]]>
		</isEqual>
		<isNotEmpty prepend="AND" property="key">
			<![CDATA[		   
		 (t.driver_chinesename LIKE  '%'||#key:VARCHAR# || '%'   or t.applyer_chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		 t.APPLY_STARTDATE >= to_date(#startDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			<![CDATA[		   
		 t.APPLY_ENDDATE <= to_date(#endDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<![CDATA[
         and he.person_id = t.applyer_id
         order by t.DRIVER_OT_APPLYID desc
    ]]>
	</select>
	
	<select id="getbusArrangeListAll" parameterClass="SimpleMap" resultClass="SimpleMap">
      <![CDATA[	
	select 
			    t.bus_arrange_applyid,
		        t.applyer_id,
		        t.applyer_chinesename,
		        t.driver_id,
		        t.driver_chinesename,
		        s.code_name as bus,
		        s1.code_name as bus_area,
		        to_char(t.apply_startdate,'YYYY-MM-DD') as apply_startdate,
		        t.apply_starttime,
		        to_char(t.arrive_date,'YYYY-MM-DD') as arrive_date,
		        t.arrive_time,
		        t.seatnum,
		        t.ridenum,
		        nvl(t.ridenum/t.seatnum,0) as ridepercent,
		        decode(least(to_number(replace(arrive_time,':','')),745),'745',1,0) as arrive_time_flag,
		        t.remark,
		        t.active,
		        to_char(t.create_date,'YYYY-MM-DD') as create_date
				 from GA_bus_arrange_APPLY t,
				  sy_code s,
				  sy_code s1,
				  hr_employee he
				 where  t.bus_arrange_applyid in
				       (select distinct a.apply_no
				          from GA_BUS_ARRANGE_AFFIRM a
				         where a.active = 1)
				        and t.bus = s.code_id(+)
				        and t.bus_area = s1.code_id(+)
        ]]>

		
		<isNotEmpty prepend="AND" property="ADMIN_ID">
			<![CDATA[		
			   t.APPLYER_ID = #ADMIN_ID:varchar#
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="busAreaType">
		<![CDATA[		   
		  t.bus_area = #busAreaType:VARCHAR#
		]]>	
		</isNotEmpty>	
		
		<isNotEmpty prepend="AND" property="busTypeCode">
			<![CDATA[		   
			 t.bus = #busTypeCode:VARCHAR#
			]]>	
		</isNotEmpty>
		
		
		
		<isEqual prepend="AND" property="arriveType" compareValue="1">
			<![CDATA[
						 decode(least(to_number(replace(t.arrive_time,':','')),745),'745',1,0) = 1
			]]>
		</isEqual>	

		<isEqual prepend="AND" property="arriveType" compareValue="0">
			<![CDATA[
						 decode(least(to_number(replace(t.arrive_time,':','')),745),'745',1,0) = 0
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="0">
			<![CDATA[
						 t.active = 0
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="1">
			<!-- 决裁通过的 -->
			<![CDATA[
						  t.active = 1
			]]>
		</isEqual>
		<isEqual prepend="AND" property="qryType" compareValue="2">
			<!-- 决裁否决的 -->
			<![CDATA[
						 t.active = 2
			]]>
		</isEqual>
		<isNotEmpty prepend="AND" property="key">
			<![CDATA[		   
		 (t.driver_chinesename LIKE  '%'||#key:VARCHAR# || '%'   or t.applyer_chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>
		</isNotEmpty>
		
		<isNotEmpty prepend="AND" property="startDate">
			<![CDATA[		   
		 t.APPLY_STARTDATE >= to_date(#startDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="endDate">
			<![CDATA[		   
		 t.ARRIVE_DATE <= to_date(#endDate:VARCHAR#,'YYYY-MM-DD')
		]]>
		</isNotEmpty>
		<![CDATA[
         and he.person_id = t.applyer_id
         order by t.bus_arrange_applyid desc
    ]]>
	</select>

<select id="getBusArrangeList" parameterClass="SimpleMap" resultClass="SimpleMap">
      <![CDATA[	
		select 
        t.bus_arrange_applyid,
        t.applyer_id,
        t.applyer_chinesename,
        t.driver_id,
        t.driver_chinesename,
        s.code_name as bus,
        s1.code_name as bus_area,
        to_char(t.apply_startdate,'YYYY-MM-DD') as apply_startdate,
        t.apply_starttime,
        to_char(t.arrive_date,'YYYY-MM-DD') as arrive_date,
        t.arrive_time,
        t.seatnum,
        t.ridenum,
        nvl(t.ridenum/t.seatnum,0) as ridepercent,
        t.remark,
        t.active,
        to_char(t.create_date,'YYYY-MM-DD') as create_date,
        m.AFFIRMORIDEA,
        AFFIRM.AFFIRM_FLAG
      from GA_bus_arrange_APPLY t,
           GA_bus_arrange_AFFIRM m,
           hr_employee e,
           sy_code s,
           sy_code s1,
           (SELECT GA_BUS_ARRANGE_AFFIRM.*,
                   UP_AFFIRM.AFFIRMOR_ID UP_AFFIRMOR_ID,
                   NVL(UP_AFFIRM.AFFIRM_FLAG, 1) UP_AFFIRM_FLAG,
                   CASE
                     WHEN GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL = MAX_AFFIRM.MAX_LEVEL THEN
                      1
                     ELSE
                      0
                   END AS MAX_LEVEL_FLAG
              FROM (SELECT GA_BUS_ARRANGE_AFFIRM.*,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL - 1 UP_LEVEL,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL + 1 NEXT_LEVEL
                      FROM GA_BUS_ARRANGE_AFFIRM) GA_BUS_ARRANGE_AFFIRM,
                   (SELECT GA_BUS_ARRANGE_AFFIRM.APPLY_NO,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRMOR_ID,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRM_FLAG
                      FROM GA_BUS_ARRANGE_AFFIRM) UP_AFFIRM,
                   (SELECT GA_BUS_ARRANGE_AFFIRM.APPLY_NO,
                           MAX(GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL) MAX_LEVEL
                      FROM GA_BUS_ARRANGE_AFFIRM
                     GROUP BY GA_BUS_ARRANGE_AFFIRM.APPLY_NO) MAX_AFFIRM
             WHERE GA_BUS_ARRANGE_AFFIRM.APPLY_NO = UP_AFFIRM.APPLY_NO(+)
               AND GA_BUS_ARRANGE_AFFIRM.UP_LEVEL = UP_AFFIRM.AFFIRM_LEVEL(+)
               AND GA_BUS_ARRANGE_AFFIRM.APPLY_NO = MAX_AFFIRM.APPLY_NO(+)
               and GA_BUS_ARRANGE_AFFIRM.affirmor_id =#supervisor:VARCHAR#) AFFIRM
     where t.bus_arrange_applyid in
           (select a.APPLY_NO from GA_BUS_ARRANGE_AFFIRM a where a.AFFIRMOR_ID = #supervisor:VARCHAR#)
       AND AFFIRM.UP_AFFIRM_FLAG = 1
       and t.applyer_id = e.person_id
       and t.bus = s.code_id(+)
        and t.bus_area = s1.code_id(+)
   ]]>
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				  AFFIRM.affirm_flag=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 AFFIRM.affirm_flag =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 AFFIRM.affirm_flag =2
	]]>
	</isEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (t.driver_chinesename LIKE  '%'||#key:VARCHAR# || '%'  or t.applyer_chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>	
	</isNotEmpty>
	
	<isNotEmpty prepend="AND" property="busAreaType">
		<![CDATA[		   
		  t.bus_area = #busAreaType:VARCHAR#
		]]>	
	</isNotEmpty>	
	
	<isNotEmpty prepend="AND" property="busTypeCode">
		<![CDATA[		   
		 t.bus = #busTypeCode:VARCHAR#
		]]>	
	</isNotEmpty>		
	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 t.APPLY_STARTDATE>=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		 t.ARRIVE_DATE<=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<![CDATA[	
    
	    and t.bus_arrange_applyid = AFFIRM.APPLY_NO
	   and m.apply_no = t.bus_arrange_applyid
	   and m.affirmor_id = #supervisor:VARCHAR#
	 order by t.bus_arrange_applyid desc
     
    ]]>
</select>

<select id="getBusArrangeListAll" parameterClass="SimpleMap" resultClass="SimpleMap">
      <![CDATA[	
		select 
        t.bus_arrange_applyid,
        t.applyer_id,
        t.applyer_chinesename,
        t.driver_id,
        t.driver_chinesename,
        s.code_name as bus,
        s1.code_name as bus_area,
        to_char(t.apply_startdate,'YYYY-MM-DD') as apply_startdate,
        t.apply_starttime,
        to_char(t.arrive_date,'YYYY-MM-DD') as arrive_date,
        t.arrive_time,
        t.seatnum,
        t.ridenum,
        nvl(t.ridenum/t.seatnum,0) as ridepercent,
        t.remark,
        t.active,
        to_char(t.create_date,'YYYY-MM-DD') as create_date,
        m.AFFIRMORIDEA,
        AFFIRM.AFFIRM_FLAG
      from GA_bus_arrange_APPLY t,
           GA_bus_arrange_AFFIRM m,
           hr_employee e,
           sy_code s,
           sy_code s1,
           (SELECT GA_BUS_ARRANGE_AFFIRM.*,
                   UP_AFFIRM.AFFIRMOR_ID UP_AFFIRMOR_ID,
                   NVL(UP_AFFIRM.AFFIRM_FLAG, 1) UP_AFFIRM_FLAG,
                   CASE
                     WHEN GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL = MAX_AFFIRM.MAX_LEVEL THEN
                      1
                     ELSE
                      0
                   END AS MAX_LEVEL_FLAG
              FROM (SELECT GA_BUS_ARRANGE_AFFIRM.*,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL - 1 UP_LEVEL,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL + 1 NEXT_LEVEL
                      FROM GA_BUS_ARRANGE_AFFIRM) GA_BUS_ARRANGE_AFFIRM,
                   (SELECT GA_BUS_ARRANGE_AFFIRM.APPLY_NO,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRMOR_ID,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRM_FLAG
                      FROM GA_BUS_ARRANGE_AFFIRM) UP_AFFIRM,
                   (SELECT GA_BUS_ARRANGE_AFFIRM.APPLY_NO,
                           MAX(GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL) MAX_LEVEL
                      FROM GA_BUS_ARRANGE_AFFIRM
                     GROUP BY GA_BUS_ARRANGE_AFFIRM.APPLY_NO) MAX_AFFIRM
             WHERE GA_BUS_ARRANGE_AFFIRM.APPLY_NO = UP_AFFIRM.APPLY_NO(+)
               AND GA_BUS_ARRANGE_AFFIRM.UP_LEVEL = UP_AFFIRM.AFFIRM_LEVEL(+)
               AND GA_BUS_ARRANGE_AFFIRM.APPLY_NO = MAX_AFFIRM.APPLY_NO(+)
               and GA_BUS_ARRANGE_AFFIRM.affirmor_id =#supervisor:VARCHAR#) AFFIRM
     where t.bus_arrange_applyid in
           (select a.APPLY_NO from GA_BUS_ARRANGE_AFFIRM a where a.AFFIRMOR_ID = #supervisor:VARCHAR#)
       AND AFFIRM.UP_AFFIRM_FLAG = 1
       and t.applyer_id = e.person_id
       and t.bus = s.code_id(+)
       and t.active <> '0'
        and t.bus_area = s1.code_id(+)
   ]]>
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				  AFFIRM.affirm_flag=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 AFFIRM.affirm_flag =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 AFFIRM.affirm_flag =2
	]]>
	</isEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (t.driver_chinesename LIKE  '%'||#key:VARCHAR# || '%'  or t.applyer_chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>	
	</isNotEmpty>
	
	<isNotEmpty prepend="AND" property="busAreaType">
		<![CDATA[		   
		  t.bus_area = #busAreaType:VARCHAR#
		]]>	
	</isNotEmpty>	
	
	<isNotEmpty prepend="AND" property="busTypeCode">
		<![CDATA[		   
		 t.bus = #busTypeCode:VARCHAR#
		]]>	
	</isNotEmpty>		
	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 t.APPLY_STARTDATE>=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		 t.ARRIVE_DATE<=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<![CDATA[	
    
	    and t.bus_arrange_applyid = AFFIRM.APPLY_NO
	   and m.apply_no = t.bus_arrange_applyid
	   and m.affirmor_id = #supervisor:VARCHAR#
	 order by t.bus_arrange_applyid desc
     
    ]]>
</select>

<select id="getdriverOtInt" parameterClass="SimpleMap" resultClass="int">
    <![CDATA[	
			select count(*)
			   from GA_DRIVER_OT_APPLY t,
		       GA_DRIVER_OT_AFFIRM m,
		       hr_employee e,
		       (SELECT GA_DRIVER_OT_AFFIRM.*,
		               UP_AFFIRM.AFFIRMOR_ID UP_AFFIRMOR_ID,
		               NVL(UP_AFFIRM.AFFIRM_FLAG, 1) UP_AFFIRM_FLAG,
		               CASE
		                 WHEN GA_DRIVER_OT_AFFIRM.AFFIRM_LEVEL = MAX_AFFIRM.MAX_LEVEL THEN
		                  1
		                 ELSE
		                  0
		               END AS MAX_LEVEL_FLAG
		          FROM (SELECT GA_DRIVER_OT_AFFIRM.*,
		                       GA_DRIVER_OT_AFFIRM.AFFIRM_LEVEL - 1 UP_LEVEL,
		                       GA_DRIVER_OT_AFFIRM.AFFIRM_LEVEL + 1 NEXT_LEVEL
		                  FROM GA_DRIVER_OT_AFFIRM) GA_DRIVER_OT_AFFIRM,
		               (SELECT GA_DRIVER_OT_AFFIRM.APPLY_NO,
		                       GA_DRIVER_OT_AFFIRM.AFFIRM_LEVEL,
		                       GA_DRIVER_OT_AFFIRM.AFFIRMOR_ID,
		                       GA_DRIVER_OT_AFFIRM.AFFIRM_FLAG
		                  FROM GA_DRIVER_OT_AFFIRM) UP_AFFIRM,
		               (SELECT GA_DRIVER_OT_AFFIRM.APPLY_NO,
		                       MAX(GA_DRIVER_OT_AFFIRM.AFFIRM_LEVEL) MAX_LEVEL
		                  FROM GA_DRIVER_OT_AFFIRM
		                 GROUP BY GA_DRIVER_OT_AFFIRM.APPLY_NO) MAX_AFFIRM
		         WHERE GA_DRIVER_OT_AFFIRM.APPLY_NO = UP_AFFIRM.APPLY_NO(+)
		           AND GA_DRIVER_OT_AFFIRM.UP_LEVEL = UP_AFFIRM.AFFIRM_LEVEL(+)
		           AND GA_DRIVER_OT_AFFIRM.APPLY_NO = MAX_AFFIRM.APPLY_NO(+)
		           and GA_DRIVER_OT_AFFIRM.affirmor_id = #supervisor:VARCHAR#) AFFIRM
		 where t.DRIVER_OT_APPLYID in
		       (select a.APPLY_NO from GA_DRIVER_OT_AFFIRM a where a.AFFIRMOR_ID = #supervisor:VARCHAR#)
		   AND AFFIRM.UP_AFFIRM_FLAG = 1
		   and t.applyer_id = e.person_id
   ]]>
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				  AFFIRM.affirm_flag=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 AFFIRM.affirm_flag =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 AFFIRM.affirm_flag =2
	]]>
	</isEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (t.driver_chinesename LIKE  '%'||#key:VARCHAR# || '%'  or t.applyer_chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>	
	</isNotEmpty>	
	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 t.APPLY_STARTDATE>=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		 t.APPLY_ENDDATE<=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<![CDATA[	
	 and t.DRIVER_OT_APPLYID = AFFIRM.APPLY_NO
	   and m.apply_no = t.DRIVER_OT_APPLYID
	   and m.affirmor_id = #supervisor:VARCHAR#
	 order by t.DRIVER_OT_APPLYID desc
    ]]>
</select>

<select id="getBusArrangeInt" parameterClass="SimpleMap" resultClass="int">
    <![CDATA[	
			select count(*)
			    from GA_bus_arrange_APPLY t,
           GA_bus_arrange_AFFIRM m,
           hr_employee e,
           sy_code s,
           sy_code s1,
           (SELECT GA_BUS_ARRANGE_AFFIRM.*,
                   UP_AFFIRM.AFFIRMOR_ID UP_AFFIRMOR_ID,
                   NVL(UP_AFFIRM.AFFIRM_FLAG, 1) UP_AFFIRM_FLAG,
                   CASE
                     WHEN GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL = MAX_AFFIRM.MAX_LEVEL THEN
                      1
                     ELSE
                      0
                   END AS MAX_LEVEL_FLAG
              FROM (SELECT GA_BUS_ARRANGE_AFFIRM.*,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL - 1 UP_LEVEL,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL + 1 NEXT_LEVEL
                      FROM GA_BUS_ARRANGE_AFFIRM) GA_BUS_ARRANGE_AFFIRM,
                   (SELECT GA_BUS_ARRANGE_AFFIRM.APPLY_NO,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRMOR_ID,
                           GA_BUS_ARRANGE_AFFIRM.AFFIRM_FLAG
                      FROM GA_BUS_ARRANGE_AFFIRM) UP_AFFIRM,
                   (SELECT GA_BUS_ARRANGE_AFFIRM.APPLY_NO,
                           MAX(GA_BUS_ARRANGE_AFFIRM.AFFIRM_LEVEL) MAX_LEVEL
                      FROM GA_BUS_ARRANGE_AFFIRM
                     GROUP BY GA_BUS_ARRANGE_AFFIRM.APPLY_NO) MAX_AFFIRM
             WHERE GA_BUS_ARRANGE_AFFIRM.APPLY_NO = UP_AFFIRM.APPLY_NO(+)
               AND GA_BUS_ARRANGE_AFFIRM.UP_LEVEL = UP_AFFIRM.AFFIRM_LEVEL(+)
               AND GA_BUS_ARRANGE_AFFIRM.APPLY_NO = MAX_AFFIRM.APPLY_NO(+)
               and GA_BUS_ARRANGE_AFFIRM.affirmor_id =#supervisor:VARCHAR#) AFFIRM
     where t.bus_arrange_applyid in
           (select a.APPLY_NO from GA_BUS_ARRANGE_AFFIRM a where a.AFFIRMOR_ID = #supervisor:VARCHAR#)
       AND AFFIRM.UP_AFFIRM_FLAG = 1
       and t.applyer_id = e.person_id
       and t.bus = s.code_id(+)
        and t.bus_area = s1.code_id(+)
   ]]>
   <isEqual prepend="AND" property="qryType" compareValue="0"> <!-- 未决裁过的 -->
		<![CDATA[
				  AFFIRM.affirm_flag=0
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="1"> <!-- 决裁通过的 -->
		<![CDATA[
				 AFFIRM.affirm_flag =1
	]]>
	</isEqual>
	<isEqual prepend="AND" property="qryType" compareValue="2"> <!-- 决裁否决的 -->
		<![CDATA[
				 AFFIRM.affirm_flag =2
	]]>
	</isEqual>
	<isNotEmpty prepend="AND" property="key">
		<![CDATA[		   
		 (t.driver_chinesename LIKE  '%'||#key:VARCHAR# || '%'  or t.applyer_chinesename LIKE  '%'||#key:VARCHAR# || '%')
		]]>	
	</isNotEmpty>	
	
	<isNotEmpty prepend="AND" property="startDate">
		<![CDATA[		   
		 t.APPLY_STARTDATE>=to_date(#startDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="endDate">
		<![CDATA[		   
		 t.ARRIVE_DATE<=to_date(#endDate:VARCHAR#,'yyyy-mm-dd') 
		]]>	
	</isNotEmpty>
	<![CDATA[	
	    and t.bus_arrange_applyid = AFFIRM.APPLY_NO
	   and m.apply_no = t.bus_arrange_applyid
	   and m.affirmor_id = #supervisor:VARCHAR#
	
     
    ]]>
</select>

<select id="getDriverOtAffiirmList"  parameterClass="SimpleMap" resultClass="SimpleMap">
<![CDATA[
	select t.ID,
       t.affirm_flag,
       t.apply_no,
       t.affirm_level,
       t.affirmor_id,
       hr.chinesename,
       CASE WHEN 
       T.AFFIRM_LEVEL=MAX_AFFIRM_TABLE.MAX_AFFIRM_LEVEL
       THEN 1
       ELSE 0
       END MAX_AFFIRM_FLAG
  from GA_DRIVER_OT_AFFIRM t,
       hr_employee hr,
       (select  max(affirm.affirm_level) MAX_AFFIRM_LEVEL
          from GA_DRIVER_OT_AFFIRM affirm
         WHERE affirm.APPLY_NO=#APPLY_NO:VARCHAR#
        ) MAX_AFFIRM_TABLE
 where t.affirmor_id = hr.person_id
   and t.APPLY_NO = #APPLY_NO:VARCHAR#
 order by t.affirm_level

	]]>
</select>

<select id="getBusArrangeAffiirmList"  parameterClass="SimpleMap" resultClass="SimpleMap">
<![CDATA[
	select t.ID,
       t.affirm_flag,
       t.apply_no,
       t.affirm_level,
       t.affirmor_id,
       hr.chinesename,
       CASE WHEN 
       T.AFFIRM_LEVEL=MAX_AFFIRM_TABLE.MAX_AFFIRM_LEVEL
       THEN 1
       ELSE 0
       END MAX_AFFIRM_FLAG
  from GA_BUS_ARRANGE_AFFIRM t,
       hr_employee hr,
       (select  max(affirm.affirm_level) MAX_AFFIRM_LEVEL
          from GA_DRIVER_OT_AFFIRM affirm
         WHERE affirm.APPLY_NO=#APPLY_NO:VARCHAR#
        ) MAX_AFFIRM_TABLE
 where t.affirmor_id = hr.person_id
   and t.APPLY_NO = #APPLY_NO:VARCHAR#
 order by t.affirm_level

	]]>
</select>

</sqlMap>