<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ga.asset">
	<select id="selectAssetList" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			 		  	SELECT A.SEQ_NO,
						       A.ASSET_TYPE,
						       B.CODE_NAME AS ASSET_TYPE_NAME,
						       A.ASSET_NO,
						       A.ASSET_NAME,
						       A.FILE_NO,
						       A.BRAND,
						       A.SPECIFIC,
						       A.PRODUCT_NO,
						       A.QUANTITY,
						       A.UNIT_PRICE,
						       A.VENDOR,
						       TO_CHAR(A.BUY_DATE, 'YYYY-MM-DD') AS BUY_DATE,
						       A.WARRANTY,
						       A.CAPITAL_ASSET_NO,
						       A.ASSET_POSITION,
						       A.USE_DEPT_ID,
						       D.DEPTNAME AS USE_DEPT_NAME,
						       A.ASSET_KEEPER_ID,
						       C.CHINESENAME AS ASSET_KEEPER_NAME,
						       TO_CHAR(A.EXAMINE_DATE, 'YYYY-MM-DD') AS EXAMINE_DATE,
						       A.REMARK,
						       A.CREATE_DATE,
						       A.CREATED_BY,
						       A.UPDATE_DATE,
						       A.UPDATED_BY,
						       A.ACTIVITY,
						       A.CPNY_ID,
						       A.TELEPHONE,
						       E.STATUS_CODE AS STATUS_CODE,
						       NVL(E.STATUS,' ') AS STATUS,
						       TO_CHAR(NVL(E.INSPECTION_DATE, A.EXAMINE_DATE), 'YYYY-MM-DD') AS INSPECTION_DATE,
						       E.PERIOD
						  FROM GA_ASSET A,
						       SY_CODE B,
						       HR_EMPLOYEE C,
						       HR_DEPARTMENT D,
						       (SELECT B.ASSET_NO AS ASSET_NO,
						               DECODE(A.PERIOD_UNIT,
						                      'checkUnit001',
						                      (A.INSPECTION_DATE + A.PERIOD_NUM),
						                      'checkUnit002',
						                      (A.INSPECTION_DATE + (A.PERIOD_NUM * 7)),
						                      'checkUnit003',
						                      ADD_MONTHS(A.INSPECTION_DATE, A.PERIOD_NUM),
						                      'checkUnit004',
						                      ADD_MONTHS(A.INSPECTION_DATE, (A.PERIOD_NUM * 12)),
						                      NULL) AS INSPECTION_DATE,
						               A.STATUS AS STATUS_CODE,
						               GET_CODE_NAME(A.STATUS) AS STATUS,
						               CONCAT(TO_CHAR(A.PERIOD_NUM), GET_CODE_NAME(A.PERIOD_UNIT)) AS PERIOD
						          FROM GA_ASSET_INSPECTION A,
						               (SELECT GA.ASSET_NO AS ASSET_NO,
						                       MAX(GA.INSPECTION_DATE) AS INSPECTION_DATE
						                  FROM GA_ASSET_INSPECTION GA
						                 WHERE GA.ACTIVITY = 1
						                 GROUP BY GA.ASSET_NO) B
						         WHERE B.INSPECTION_DATE = A.INSPECTION_DATE
						           AND B.ASSET_NO = A.ASSET_NO) E
						 WHERE A.ASSET_TYPE = B.CODE_ID
						   AND A.ASSET_KEEPER_ID = C.PERSON_ID
						   AND A.USE_DEPT_ID = D.DEPTID
						   AND A.ACTIVITY = 1
						   AND A.ASSET_NO = E.ASSET_NO(+)
	  	]]>
		<isNotEmpty prepend="" property="startDate">
			<isNotEmpty prepend="AND" property="endDate">
				<![CDATA[		   
				 	 NVL(E.INSPECTION_DATE,A.EXAMINE_DATE) BETWEEN TO_DATE(#startDate:VARCHAR#,'YYYY-MM-DD') AND TO_DATE(#endDate:VARCHAR#,'YYYY-MM-DD')
				]]>	
			</isNotEmpty>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="assetNo">
				<![CDATA[		   
				 	A.ASSET_NO LIKE '%'||#assetNo:VARCHAR#||'%'
				]]>	
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="seqNo">
				<![CDATA[		   
				 	A.SEQ_NO = #seqNo:VARCHAR#
				]]>	
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="assetType">
				<![CDATA[		   
				 	A.ASSET_TYPE = #assetType:VARCHAR#
				]]>	
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="useDeptId">
				<![CDATA[		   
				 	A.USE_DEPT_ID = #useDeptId:VARCHAR#
				]]>	
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="cpnyId">
				<![CDATA[		   
				 	A.CPNY_ID = #cpnyId:VARCHAR#
				]]>	
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="assetName">
				<![CDATA[		   
				 	A.ASSET_NAME = #assetName#
				]]>	
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="status">
				<![CDATA[		   
				 	E.STATUS_CODE = #status#
				]]>	
		</isNotEmpty>
		<![CDATA[
			ORDER BY A.ASSET_NO ASC
		]]>		
	</select>
	
	<select id="selectAssetListNumber" parameterClass="SimpleMap" resultClass="int">
		<![CDATA[
			 		  	SELECT COUNT(*) CUT
						  FROM GA_ASSET A,
						       SY_CODE B,
						       HR_EMPLOYEE C,
						       HR_DEPARTMENT D,
						       (SELECT B.ASSET_NO AS ASSET_NO,
						               DECODE(A.PERIOD_UNIT,
						                      'checkUnit001',
						                      (A.INSPECTION_DATE + A.PERIOD_NUM),
						                      'checkUnit002',
						                      (A.INSPECTION_DATE + (A.PERIOD_NUM * 7)),
						                      'checkUnit003',
						                      ADD_MONTHS(A.INSPECTION_DATE, A.PERIOD_NUM),
						                      'checkUnit004',
						                      ADD_MONTHS(A.INSPECTION_DATE, (A.PERIOD_NUM * 12)),
						                      NULL) AS INSPECTION_DATE,
						               A.STATUS AS STATUS_CODE,
						               GET_CODE_NAME(A.STATUS) AS STATUS,
						               CONCAT(TO_CHAR(A.PERIOD_NUM), GET_CODE_NAME(A.PERIOD_UNIT)) AS PERIOD
						          FROM GA_ASSET_INSPECTION A,
						               (SELECT GA.ASSET_NO AS ASSET_NO,
						                       MAX(GA.INSPECTION_DATE) AS INSPECTION_DATE
						                  FROM GA_ASSET_INSPECTION GA
						                 WHERE GA.ACTIVITY = 1
						                 GROUP BY GA.ASSET_NO) B
						         WHERE B.INSPECTION_DATE = A.INSPECTION_DATE
						           AND B.ASSET_NO = A.ASSET_NO) E
						 WHERE A.ASSET_TYPE = B.CODE_ID
						   AND A.ASSET_KEEPER_ID = C.PERSON_ID
						   AND A.USE_DEPT_ID = D.DEPTID
						   AND A.ACTIVITY = 1
						   AND A.ASSET_NO = E.ASSET_NO(+)
	  	]]>
		<isNotEmpty prepend="" property="startDate">
			<isNotEmpty prepend="AND" property="endDate">
				<![CDATA[		   
				 	 NVL(E.INSPECTION_DATE,A.EXAMINE_DATE) BETWEEN TO_DATE(#startDate:VARCHAR#,'YYYY-MM-DD') AND TO_DATE(#endDate:VARCHAR#,'YYYY-MM-DD')
				]]>	
			</isNotEmpty>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="assetNo">
				<![CDATA[		   
				 	A.ASSET_NO LIKE '%'||#assetNo:VARCHAR#||'%'
				]]>	
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="seqNo">
				<![CDATA[		   
				 	A.SEQ_NO = #seqNo:VARCHAR#
				]]>	
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="assetType">
				<![CDATA[		   
				 	A.ASSET_TYPE = #assetType:VARCHAR#
				]]>	
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="useDeptId">
				<![CDATA[		   
				 	A.USE_DEPT_ID = #useDeptId:VARCHAR#
				]]>	
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="cpnyId">
				<![CDATA[		   
				 	A.CPNY_ID = #cpnyId:VARCHAR#
				]]>	
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="assetName">
				<![CDATA[		   
				 	A.ASSET_NAME = #assetName#
				]]>	
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="status">
				<![CDATA[		   
				 	E.STATUS_CODE = #status#
				]]>	
		</isNotEmpty>
		<![CDATA[
			ORDER BY A.ASSET_NO ASC
		]]>		
	</select>
	
	<select id="selectAssetNameList" parameterClass="SimpleMap" resultClass="SimpleMap">
		<![CDATA[
			 	SELECT DISTINCT A.ASSET_NAME AS ID,
        		A.ASSET_NAME AS NAME      
				FROM   GA_ASSET A
				WHERE A.CPNY_ID = #cpnyId:VARCHAR#
	  	]]>
	</select>
	
	<insert id="insertAsset" parameterClass="SimpleMap">
		<![CDATA[	
				INSERT INTO GA_ASSET A
						  (A.SEQ_NO,
						   A.ASSET_TYPE,
						   A.ASSET_NO,
						   A.ASSET_NAME,
						   A.FILE_NO,
						   A.BRAND,
						   A.SPECIFIC,
						   A.PRODUCT_NO,
						   A.QUANTITY,
						   A.UNIT_PRICE,
						   A.VENDOR,
						   A.BUY_DATE,
						   A.WARRANTY,
						   A.CAPITAL_ASSET_NO,
						   A.ASSET_POSITION,
						   A.USE_DEPT_ID,
						   A.ASSET_KEEPER_ID,
						   A.EXAMINE_DATE,
						   A.REMARK,
						   A.CREATE_DATE,
						   A.CREATED_BY,
						   A.ACTIVITY,
						   A.CPNY_ID,
						   A.TELEPHONE)
						values
						   (SEQ_GA_ASSET.NEXTVAL,
						    #assetType:VARCHAR#,
						    #assetNo:VARCHAR#,
						    #assetName:VARCHAR#,
						    #fileNo:VARCHAR#,
						    #brand:VARCHAR#,
						    #specific:VARCHAR#,
						    #productNo:VARCHAR#,
						    #quantity:NUMERIC#,
						    #unitPrice:NUMERIC#,
						    #vendor:VARCHAR#,
						    TO_DATE(#buyDate:VARCHAR#,'YYYY-MM-DD'),
						    #warranty:VARCHAR#,
						    #capitalAssetNo:VARCHAR#,
						    #assetPosition:VARCHAR#,
						    #useDeptId:VARCHAR#,
						    #personId:VARCHAR#,
						    TO_DATE(#examineDate:VARCHAR#,'YYYY-MM-DD'),
						    #remark:VARCHAR#,
						    SYSDATE,
						    #adminId:VARCHAR#,
						    1,
						    #cpnyId:VARCHAR#,
						    #telephone:VARCHAR#)
		]]>
	</insert>
	
	<update id="updateAsset" parameterClass="SimpleMap">
		<![CDATA[
			UPDATE GA_ASSET A
				   SET A.ASSET_TYPE       = #assetType:VARCHAR#,
				       A.ASSET_NO         = #assetNo:VARCHAR#,
				       A.ASSET_NAME       = #assetName:VARCHAR#,
				       A.FILE_NO          = #fileNo:VARCHAR#,
				       A.BRAND            = #brand:VARCHAR#,
				       A.SPECIFIC         = #specific:VARCHAR#,
				       A.PRODUCT_NO       = #productNo:VARCHAR#,
				       A.QUANTITY         = #quantity:NUMERIC#,
				       A.UNIT_PRICE       = #unitPrice:NUMERIC#,
				       A.VENDOR           = #vendor:VARCHAR#,
				       A.BUY_DATE         = TO_DATE(#buyDate:VARCHAR#, 'YYYY-MM-DD'),
				       A.WARRANTY         = #warranty:VARCHAR#,
				       A.CAPITAL_ASSET_NO = #capitalAssetNo:VARCHAR#,
				       A.ASSET_POSITION   = #assetPosition:VARCHAR#,
				       A.USE_DEPT_ID      = #useDeptId:VARCHAR#,
				       A.ASSET_KEEPER_ID  = #personId:VARCHAR#,
				       A.EXAMINE_DATE     = TO_DATE(#examineDate:VARCHAR#, 'YYYY-MM-DD'),
				       A.REMARK           = #remark:VARCHAR#,
				       A.UPDATE_DATE      = SYSDATE,
				       A.UPDATED_BY       = #adminId:VARCHAR#,
				       A.CPNY_ID		  = #cpnyId:VARCHAR#,
				       A.TELEPHONE		  = #telephone:VARCHAR#
				 WHERE A.SEQ_NO = #seqNo:NUMERIC#	
		]]>
	</update>
	
	<update id="deleteAsset" parameterClass="SimpleMap">
		<![CDATA[
			UPDATE GA_ASSET A 
			SET	   A.ACTIVITY=0
			WHERE A.SEQ_NO = #seqNo:NUMERIC#
		]]>
	</update>
	
	<select id="selectAssetTest" parameterClass="SimpleMap" resultClass="int">
		<![CDATA[
			SELECT COUNT(*) CUT
			FROM   GA_ASSET A
			WHERE  A.ASSET_NO = #assetNo#
			AND    A.CPNY_ID = #cpnyId#
		]]>
	</select>

</sqlMap>